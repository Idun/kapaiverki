var __defProp = Object.defineProperty;
var __getOwnPropNames = Object.getOwnPropertyNames;
var __esm = (fn, res) => function __init() {
  return fn && (res = (0, fn[__getOwnPropNames(fn)[0]])(fn = 0)), res;
};
var __export = (target, all) => {
  for (var name in all)
    __defProp(target, name, { get: all[name], enumerable: true });
};

// types.ts
var init_types = __esm({
  "types.ts"() {
  }
});

// components/icons.tsx
import { jsx, jsxs } from "react/jsx-runtime";
var ThemeIcon, GenreIcon, CharacterIcon, PlotIcon, StructureIcon, TechniqueIcon, EndingIcon, PenSparkleIcon, SettingsIcon, DocumentTextIcon, LightbulbIcon, DownloadIcon, UploadIcon, PreviewIcon, PlusIcon, SparklesIcon, PencilIcon, TrashIcon, ArrowUpIcon, StopIcon, AiIcon, InformationCircleIcon, ArchiveBoxIcon, DocumentPlusIcon, PhotoIcon, QuestionMarkCircleIcon, UserCircleIcon, ArrowsRightLeftIcon, GlobeAltIcon, ClipboardDocumentIcon, ArrowPathIcon, FireIcon, Bars3BottomLeftIcon, BookmarkSquareIcon, ArrowDownOnSquareIcon;
var init_icons = __esm({
  "components/icons.tsx"() {
    ThemeIcon = (props) => /* @__PURE__ */ jsx("svg", { xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24", strokeWidth: 1.5, stroke: "currentColor", ...props, children: /* @__PURE__ */ jsx("path", { strokeLinecap: "round", strokeLinejoin: "round", d: "M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-6.364-.386 1.591-1.591M3 12H.75m.386-6.364 1.591 1.591M12 6.75a5.25 5.25 0 1 0 0 10.5 5.25 5.25 0 0 0 0-10.5Z" }) });
    GenreIcon = (props) => /* @__PURE__ */ jsx("svg", { xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24", strokeWidth: 1.5, stroke: "currentColor", ...props, children: /* @__PURE__ */ jsx("path", { strokeLinecap: "round", strokeLinejoin: "round", d: "M16.5 6.75a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0ZM18.75 20.25h-13.5A2.25 2.25 0 0 1 3 18V6a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 6v12a2.25 2.25 0 0 1-2.25 2.25Z" }) });
    CharacterIcon = (props) => /* @__PURE__ */ jsx("svg", { xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24", strokeWidth: 1.5, stroke: "currentColor", ...props, children: /* @__PURE__ */ jsx("path", { strokeLinecap: "round", strokeLinejoin: "round", d: "M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z" }) });
    PlotIcon = (props) => /* @__PURE__ */ jsx("svg", { xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24", strokeWidth: 1.5, stroke: "currentColor", ...props, children: /* @__PURE__ */ jsx("path", { strokeLinecap: "round", strokeLinejoin: "round", d: "M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m5.231 13.481L15 17.25m-4.5-1.5 5.231 5.231M5.25 5.25h3.375c.621 0 1.125.504 1.125 1.125v1.5c0 .621-.504 1.125-1.125 1.125H5.25" }) });
    StructureIcon = (props) => /* @__PURE__ */ jsx("svg", { xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24", strokeWidth: 1.5, stroke: "currentColor", ...props, children: /* @__PURE__ */ jsx("path", { strokeLinecap: "round", strokeLinejoin: "round", d: "M3.75 6A2.25 2.25 0 0 1 6 3.75h2.25A2.25 2.25 0 0 1 10.5 6v2.25a2.25 2.25 0 0 1-2.25 2.25H6A2.25 2.25 0 0 1 3.75 8.25V6zM3.75 15.75A2.25 2.25 0 0 1 6 13.5h2.25a2.25 2.25 0 0 1 2.25 2.25V18a2.25 2.25 0 0 1-2.25 2.25H6A2.25 2.25 0 0 1 3.75 18v-2.25zM13.5 6a2.25 2.25 0 0 1 2.25-2.25H18A2.25 2.25 0 0 1 20.25 6v2.25A2.25 2.25 0 0 1 18 10.5h-2.25a2.25 2.25 0 0 1-2.25-2.25V6zM13.5 15.75a2.25 2.25 0 0 1 2.25-2.25H18A2.25 2.25 0 0 1 20.25 15.75V18a2.25 2.25 0 0 1-2.25 2.25h-2.25a2.25 2.25 0 0 1-2.25-2.25v-2.25z" }) });
    TechniqueIcon = (props) => /* @__PURE__ */ jsx("svg", { xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24", strokeWidth: 1.5, stroke: "currentColor", ...props, children: /* @__PURE__ */ jsx("path", { strokeLinecap: "round", strokeLinejoin: "round", d: "M6 3v18M18 3v18M3 9h18M3 15h18" }) });
    EndingIcon = (props) => /* @__PURE__ */ jsx("svg", { xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24", strokeWidth: 1.5, stroke: "currentColor", ...props, children: /* @__PURE__ */ jsx("path", { strokeLinecap: "round", strokeLinejoin: "round", d: "M3 3v1.5M3 21v-6m0 0 2.77-.693a9 9 0 0 1 6.208.682l.108.054a9 9 0 0 0 6.086.71l3.114-.732a48.524 48.524 0 0 1-.005-10.499l-3.11.732a9 9 0 0 1-6.085-.711l-.108-.054a9 9 0 0 0-6.208-.682L3 4.5m3 7.5h.008v.008H6v-.008Zm3 0h.008v.008H9v-.008Zm3 0h.008v.008h-.008v-.008Zm3 0h.008v.008h-.008v-.008Z" }) });
    PenSparkleIcon = (props) => /* @__PURE__ */ jsx("svg", { xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24", strokeWidth: 1.5, stroke: "currentColor", ...props, children: /* @__PURE__ */ jsx("path", { strokeLinecap: "round", strokeLinejoin: "round", d: "m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10" }) });
    SettingsIcon = (props) => /* @__PURE__ */ jsx("svg", { xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24", strokeWidth: 1.5, stroke: "currentColor", ...props, children: /* @__PURE__ */ jsx("path", { strokeLinecap: "round", strokeLinejoin: "round", d: "M9.594 3.94c.09-.542.56-1.007 1.11-.95.548.056 1.04.546 1.04 1.106v.294a2.25 2.25 0 0 1-.586 1.486l-2.172 2.172a2.25 2.25 0 0 0-.586 1.486v.294a1.125 1.125 0 0 0 .586 1.007 1.125 1.125 0 0 0 1.11-.056.977.977 0 0 0 .586-.643 11.25 11.25 0 0 0 .049-2.433 2.25 2.25 0 0 0-.586-1.486l-2.172-2.172a2.25 2.25 0 0 1-.586-1.486v-.294a1.125 1.125 0 0 1 .586-1.007ZM14.406 3.94a1.125 1.125 0 0 1 1.11.95.977.977 0 0 0 .586.643 11.25 11.25 0 0 0 .049 2.433 2.25 2.25 0 0 0 .586 1.486l2.172 2.172a2.25 2.25 0 0 1 .586 1.486v.294a1.125 1.125 0 0 1-.586 1.007 1.125 1.125 0 0 1-1.11-.056.977.977 0 0 1-.586-.643 11.25 11.25 0 0 1-.049-2.433 2.25 2.25 0 0 1 .586-1.486l2.172-2.172a2.25 2.25 0 0 0 .586-1.486v-.294a1.125 1.125 0 0 0-.586-1.007Z" }) });
    DocumentTextIcon = (props) => /* @__PURE__ */ jsx("svg", { xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24", strokeWidth: 1.5, stroke: "currentColor", ...props, children: /* @__PURE__ */ jsx("path", { strokeLinecap: "round", strokeLinejoin: "round", d: "M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m.75 12 3 3m0 0 3-3m-3 3v-6m-1.5-9H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z" }) });
    LightbulbIcon = (props) => /* @__PURE__ */ jsx("svg", { xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24", strokeWidth: 1.5, stroke: "currentColor", ...props, children: /* @__PURE__ */ jsx("path", { strokeLinecap: "round", strokeLinejoin: "round", d: "M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09ZM18.259 8.715 18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 0 0 2.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 0 0-2.456 2.456Z" }) });
    DownloadIcon = (props) => /* @__PURE__ */ jsx("svg", { xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24", strokeWidth: 1.5, stroke: "currentColor", ...props, children: /* @__PURE__ */ jsx("path", { strokeLinecap: "round", strokeLinejoin: "round", d: "M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3" }) });
    UploadIcon = (props) => /* @__PURE__ */ jsx("svg", { xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24", strokeWidth: 1.5, stroke: "currentColor", ...props, children: /* @__PURE__ */ jsx("path", { strokeLinecap: "round", strokeLinejoin: "round", d: "M12 16.5V9.75m0 0 3 3m-3-3-3 3M6.75 19.5a4.5 4.5 0 0 1-1.41-8.775 5.25 5.25 0 0 1 10.233-2.33 3 3 0 0 1 3.758 3.848A3.752 3.752 0 0 1 18 19.5H6.75Z" }) });
    PreviewIcon = (props) => /* @__PURE__ */ jsxs("svg", { xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24", strokeWidth: 1.5, stroke: "currentColor", ...props, children: [
      /* @__PURE__ */ jsx("path", { strokeLinecap: "round", strokeLinejoin: "round", d: "M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.432 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z" }),
      /* @__PURE__ */ jsx("path", { strokeLinecap: "round", strokeLinejoin: "round", d: "M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" })
    ] });
    PlusIcon = (props) => /* @__PURE__ */ jsx("svg", { xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24", strokeWidth: 1.5, stroke: "currentColor", ...props, children: /* @__PURE__ */ jsx("path", { strokeLinecap: "round", strokeLinejoin: "round", d: "M12 4.5v15m7.5-7.5h-15" }) });
    SparklesIcon = (props) => /* @__PURE__ */ jsx("svg", { xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24", strokeWidth: 1.5, stroke: "currentColor", ...props, children: /* @__PURE__ */ jsx("path", { strokeLinecap: "round", strokeLinejoin: "round", d: "M9.813 15.904 9 18.75l-.813-2.846a4.5 4.5 0 0 0-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 0 0 3.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 0 0 3.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 0 0-3.09 3.09ZM18.259 8.715 18 9.75l-.259-1.035a3.375 3.375 0 0 0-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 0 0 2.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 0 0 2.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 0 0-2.456 2.456Z" }) });
    PencilIcon = (props) => /* @__PURE__ */ jsx("svg", { xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24", strokeWidth: 1.5, stroke: "currentColor", ...props, children: /* @__PURE__ */ jsx("path", { strokeLinecap: "round", strokeLinejoin: "round", d: "m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125" }) });
    TrashIcon = (props) => /* @__PURE__ */ jsx("svg", { xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24", strokeWidth: 1.5, stroke: "currentColor", ...props, children: /* @__PURE__ */ jsx("path", { strokeLinecap: "round", strokeLinejoin: "round", d: "m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 4.811 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.134-2.033-2.134H8.71c-1.123 0-2.033.954-2.033 2.134v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" }) });
    ArrowUpIcon = (props) => /* @__PURE__ */ jsx("svg", { xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24", strokeWidth: 1.5, stroke: "currentColor", ...props, children: /* @__PURE__ */ jsx("path", { strokeLinecap: "round", strokeLinejoin: "round", d: "M12 19.5v-15m0 0l-6.75 6.75M12 4.5l6.75 6.75" }) });
    StopIcon = (props) => /* @__PURE__ */ jsx("svg", { xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24", strokeWidth: 1.5, stroke: "currentColor", ...props, children: /* @__PURE__ */ jsx("path", { strokeLinecap: "round", strokeLinejoin: "round", d: "M5.25 7.5A2.25 2.25 0 0 1 7.5 5.25h9a2.25 2.25 0 0 1 2.25 2.25v9a2.25 2.25 0 0 1-2.25 2.25h-9a2.25 2.25 0 0 1-2.25-2.25v-9Z" }) });
    AiIcon = (props) => /* @__PURE__ */ jsxs("svg", { viewBox: "0 0 24 24", fill: "none", xmlns: "http://www.w3.org/2000/svg", ...props, children: [
      /* @__PURE__ */ jsx("path", { className: "ai-input-icon-path", style: { "--d": "0.24s", "--r": "20deg", "--s": "1.5" }, fillRule: "evenodd", clipRule: "evenodd", d: "M11.5 6C11.3949 6.00006 11.2925 5.96705 11.2073 5.90565C11.1221 5.84425 11.0583 5.75758 11.0251 5.65792L10.7623 4.86908C10.6623 4.57101 10.4288 4.33629 10.13 4.23693L9.34102 3.97354C9.24166 3.94019 9.1553 3.87649 9.09411 3.79142C9.03292 3.70635 9 3.60421 9 3.49943C9 3.39465 9.03292 3.29252 9.09411 3.20745C9.1553 3.12238 9.24166 3.05867 9.34102 3.02532L10.13 2.76193C10.4282 2.66191 10.663 2.42852 10.7623 2.12979L11.0258 1.34094C11.0591 1.24161 11.1229 1.15526 11.2079 1.09409C11.293 1.03291 11.3952 1 11.5 1C11.6048 1 11.707 1.03291 11.7921 1.09409C11.8771 1.15526 11.9409 1.24161 11.9742 1.34094L12.2377 2.12979C12.2868 2.27697 12.3695 2.4107 12.4792 2.52041C12.589 2.63013 12.7227 2.71281 12.87 2.76193L13.659 3.02532C13.7583 3.05867 13.8447 3.12238 13.9059 3.20745C13.9671 3.29252 14 3.39465 14 3.49943C14 3.60421 13.9671 3.70635 13.9059 3.79142C13.8447 3.87649 13.7583 3.94019 13.659 3.97354L12.87 4.23693C12.5718 4.33696 12.337 4.57034 12.2377 4.86908L11.9742 5.65792C11.9411 5.75747 11.8774 5.84406 11.7923 5.90545C11.7072 5.96684 11.6049 5.99992 11.5 6Z", fill: "currentColor" }),
      /* @__PURE__ */ jsx("path", { className: "ai-input-icon-path", style: { "--d": "0.12s", "--r": "10deg", "--s": "1.4" }, fillRule: "evenodd", clipRule: "evenodd", d: "M6 13C5.85133 13.0001 5.7069 12.9504 5.58969 12.859C5.47247 12.7675 5.38921 12.6395 5.35313 12.4952L5.12388 11.5745C4.91418 10.7391 4.26198 10.0868 3.42674 9.87703L2.50619 9.64774C2.36169 9.61194 2.23333 9.52878 2.14159 9.41151C2.04985 9.29425 2 9.14964 2 9.00075C2 8.85185 2.04985 8.70724 2.14159 8.58998C2.23333 8.47272 2.36169 8.38955 2.50619 8.35376L3.42674 8.12446C4.26198 7.91473 4.91418 7.2624 5.12388 6.427L5.35313 5.50629C5.38892 5.36176 5.47207 5.23338 5.58931 5.14162C5.70655 5.04986 5.85113 5 6 5C6.14887 5 6.29345 5.04986 6.41069 5.14162C6.52793 5.23338 6.61108 5.36176 6.64687 5.50629L6.87612 6.427C6.97865 6.83721 7.19071 7.21184 7.48965 7.51082C7.78858 7.80981 8.16313 8.02192 8.57326 8.12446L9.49381 8.35376C9.63831 8.38955 9.76667 8.47272 9.85841 8.58998C9.95015 8.70724 10 8.85185 10 9.00075C10 9.14964 9.95015 9.29425 9.85841 9.41151C9.76667 9.52878 9.63831 9.61194 9.49381 9.64774L8.57326 9.87703C8.16313 9.97956 7.78858 10.1917 7.48965 10.4906C7.19071 10.7896 6.97865 11.1641 6.87612 11.5745L6.64687 12.4952C6.61099 12.6395 6.52773 12.7675 6.41051 12.859C6.2933 12.9504 6.14887 13.0001 6 13Z", fill: "currentColor" }),
      /* @__PURE__ */ jsx("path", { className: "ai-input-icon-path", style: { "--d": "0s", "--r": "0deg", "--s": "1" }, fillRule: "evenodd", clipRule: "evenodd", d: "M19.5 13C19.3513 13.0001 19.2069 12.9504 19.0897 12.859C18.9725 12.7675 18.8892 12.6395 18.8531 12.4952L18.6239 11.5745C18.4142 10.7391 17.762 10.0868 16.9267 9.87703L16.0062 9.64774C15.8617 9.61194 15.7333 9.52878 15.6416 9.41151C15.5499 9.29425 15.5 9.14964 15.5 9.00075C15.5 8.85185 15.5499 8.70724 15.6416 8.58998C15.7333 8.47272 15.8617 8.38955 16.0062 8.35376L16.9267 8.12446C17.762 7.91473 18.4142 7.2624 18.6239 6.427L18.8531 5.50629C18.8889 5.36176 18.9721 5.23338 19.0893 5.14162C19.2066 5.04986 19.3511 5 19.5 5C19.6489 5 19.7934 5.04986 19.9107 5.14162C20.0279 5.23338 20.1111 5.36176 20.1469 5.50629L20.3761 6.427C20.4787 6.83721 20.6907 7.21184 20.9897 7.51082C21.2886 7.80981 21.6631 8.02192 22.0733 8.12446L22.9938 8.35376C23.1383 8.38955 23.2667 8.47272 23.3584 8.58998C23.4501 8.70724 23.5 8.85185 23.5 9.00075C23.5 9.14964 23.4501 9.29425 23.3584 9.41151C23.2667 9.52878 23.1383 9.61194 22.9938 9.64774L22.0733 9.87703C21.6631 9.97956 21.2886 10.1917 20.9897 10.4906C20.6907 10.7896 20.4787 11.1641 20.3761 11.5745L20.1469 12.4952C20.111 12.6395 20.0277 12.7675 19.9105 12.859C19.7933 12.9504 19.6489 13.0001 19.5 13Z", fill: "currentColor" })
    ] });
    InformationCircleIcon = (props) => /* @__PURE__ */ jsx("svg", { xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24", strokeWidth: 1.5, stroke: "currentColor", ...props, children: /* @__PURE__ */ jsx("path", { strokeLinecap: "round", strokeLinejoin: "round", d: "M11.25 11.25l.041-.02a.75.75 0 0 1 1.063.852l-.708 2.836a.75.75 0 0 0 1.063.853l.041-.021M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" }) });
    ArchiveBoxIcon = (props) => /* @__PURE__ */ jsxs("svg", { xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24", strokeWidth: 1.5, stroke: "currentColor", ...props, children: [
      /* @__PURE__ */ jsx("path", { strokeLinecap: "round", strokeLinejoin: "round", d: "m20.25 7.5-.625 10.632a2.25 2.25 0 0 1-2.247 2.118H6.622a2.25 2.25 0 0 1-2.247-2.118L3.75 7.5M10 11.25h4" }),
      /* @__PURE__ */ jsx("path", { strokeLinecap: "round", strokeLinejoin: "round", d: "M3.75 7.5h16.5v-1.5A2.25 2.25 0 0 0 18 3.75h-12A2.25 2.25 0 0 0 3.75 6v1.5Z" })
    ] });
    DocumentPlusIcon = (props) => /* @__PURE__ */ jsx("svg", { xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24", strokeWidth: 1.5, stroke: "currentColor", ...props, children: /* @__PURE__ */ jsx("path", { strokeLinecap: "round", strokeLinejoin: "round", d: "M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m3.75 9v6m3-3h-6m-1.5-6H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z" }) });
    PhotoIcon = (props) => /* @__PURE__ */ jsx("svg", { xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24", strokeWidth: 1.5, stroke: "currentColor", ...props, children: /* @__PURE__ */ jsx("path", { strokeLinecap: "round", strokeLinejoin: "round", d: "m2.25 15.75 5.159-5.159a2.25 2.25 0 0 1 3.182 0l5.159 5.159m-1.5-1.5 1.409-1.409a2.25 2.25 0 0 1 3.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 0 0 1.5-1.5V6a1.5 1.5 0 0 0-1.5-1.5H3.75A1.5 1.5 0 0 0 2.25 6v12a1.5 1.5 0 0 0 1.5 1.5Zm10.5-11.25h.008v.008h-.008V8.25Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z" }) });
    QuestionMarkCircleIcon = (props) => /* @__PURE__ */ jsx("svg", { xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24", strokeWidth: 1.5, stroke: "currentColor", ...props, children: /* @__PURE__ */ jsx("path", { strokeLinecap: "round", strokeLinejoin: "round", d: "M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 5.25h.008v.008H12v-.008Z" }) });
    UserCircleIcon = (props) => /* @__PURE__ */ jsx("svg", { xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24", strokeWidth: 1.5, stroke: "currentColor", ...props, children: /* @__PURE__ */ jsx("path", { strokeLinecap: "round", strokeLinejoin: "round", d: "M17.982 18.725A7.488 7.488 0 0 0 12 15.75a7.488 7.488 0 0 0-5.982 2.975m11.963 0a9 9 0 1 0-11.963 0m11.963 0A8.966 8.966 0 0 1 12 21a8.966 8.966 0 0 1-5.982-2.275M15 9.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" }) });
    ArrowsRightLeftIcon = (props) => /* @__PURE__ */ jsx("svg", { xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24", strokeWidth: 1.5, stroke: "currentColor", ...props, children: /* @__PURE__ */ jsx("path", { strokeLinecap: "round", strokeLinejoin: "round", d: "M7.5 21 3 16.5m0 0L7.5 12M3 16.5h18m-7.5-1.5L21 8.25m0 0L16.5 3.75M21 8.25H3" }) });
    GlobeAltIcon = (props) => /* @__PURE__ */ jsx("svg", { xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24", strokeWidth: 1.5, stroke: "currentColor", ...props, children: /* @__PURE__ */ jsx("path", { strokeLinecap: "round", strokeLinejoin: "round", d: "M12 21a9.004 9.004 0 0 0 8.716-6.747M12 21a9.004 9.004 0 0 1-8.716-6.747M12 21c.504 0 1.002-.02 1.49-.06M12 3c.504 0 1.002.02 1.49.06M3.284 8.876a9.004 9.004 0 0 1 17.432 0M3.284 15.124a9.004 9.004 0 0 0 17.432 0M12 3v18M12 3a9.004 9.004 0 0 0-8.716 6.747M12 3a9.004 9.004 0 0 1 8.716 6.747" }) });
    ClipboardDocumentIcon = (props) => /* @__PURE__ */ jsx("svg", { xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24", strokeWidth: 1.5, stroke: "currentColor", ...props, children: /* @__PURE__ */ jsx("path", { strokeLinecap: "round", strokeLinejoin: "round", d: "M15.666 3.888A2.25 2.25 0 0 0 13.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v2.25c0 .966-.784 1.75-1.75 1.75h-2.5a1.75 1.75 0 0 1-1.75-1.75v-2.25c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 0 1-2.25 2.25H6.75A2.25 2.25 0 0 1 4.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 0 1 1.927-.184" }) });
    ArrowPathIcon = (props) => /* @__PURE__ */ jsx("svg", { xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24", strokeWidth: 1.5, stroke: "currentColor", ...props, children: /* @__PURE__ */ jsx("path", { strokeLinecap: "round", strokeLinejoin: "round", d: "M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 11.667 0l3.181-3.183m-4.991-2.691v4.992h-4.992m0 0-3.181-3.183a8.25 8.25 0 0 1 11.667 0l3.181 3.183" }) });
    FireIcon = (props) => /* @__PURE__ */ jsxs("svg", { xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24", strokeWidth: 1.5, stroke: "currentColor", ...props, children: [
      /* @__PURE__ */ jsx("path", { strokeLinecap: "round", strokeLinejoin: "round", d: "M15.362 5.214A8.252 8.252 0 0 1 12 21 8.25 8.25 0 0 1 6.038 7.047 8.287 8.287 0 0 0 9 9.601a8.983 8.983 0 0 1 3.361-6.867 8.21 8.21 0 0 0-1.473-1.307Z" }),
      /* @__PURE__ */ jsx("path", { strokeLinecap: "round", strokeLinejoin: "round", d: "M12 12.75a3 3 0 0 0-3 3v3.75a3 3 0 0 0 3 3h.008a3 3 0 0 0 3-3v-3.75a3 3 0 0 0-3-3h-.008Z" })
    ] });
    Bars3BottomLeftIcon = (props) => /* @__PURE__ */ jsx("svg", { xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24", strokeWidth: 1.5, stroke: "currentColor", ...props, children: /* @__PURE__ */ jsx("path", { strokeLinecap: "round", strokeLinejoin: "round", d: "M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25H12" }) });
    BookmarkSquareIcon = (props) => /* @__PURE__ */ jsx("svg", { xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24", strokeWidth: 1.5, stroke: "currentColor", ...props, children: /* @__PURE__ */ jsx("path", { strokeLinecap: "round", strokeLinejoin: "round", d: "M16.5 3.75V16.5L12 14.25 7.5 16.5V3.75m9 0H7.5A2.25 2.25 0 0 0 5.25 6v13.5A2.25 2.25 0 0 0 7.5 21h9a2.25 2.25 0 0 0 2.25-2.25V6A2.25 2.25 0 0 0 16.5 3.75Z" }) });
    ArrowDownOnSquareIcon = (props) => /* @__PURE__ */ jsx("svg", { xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24", strokeWidth: 1.5, stroke: "currentColor", ...props, children: /* @__PURE__ */ jsx("path", { strokeLinecap: "round", strokeLinejoin: "round", d: "M9 8.25H7.5a2.25 2.25 0 0 0-2.25 2.25v9a2.25 2.25 0 0 0 2.25 2.25h9a2.25 2.25 0 0 0 2.25-2.25v-9a2.25 2.25 0 0 0-2.25-2.25H15m0-3-3-3m0 0-3 3m3-3v11.25" }) });
  }
});

// constants.tsx
import { jsx as jsx2 } from "react/jsx-runtime";
var CORE_CARD_TYPES, OPTIONAL_CARD_TYPES, CARD_TYPE_NAMES, BRAINSTORM_TOOLS, DEFAULT_CARDS;
var init_constants = __esm({
  "constants.tsx"() {
    init_types();
    init_icons();
    CORE_CARD_TYPES = ["Theme" /* Theme */, "Genre" /* Genre */, "Character" /* Character */, "Plot" /* Plot */];
    OPTIONAL_CARD_TYPES = ["Structure" /* Structure */, "Technique" /* Technique */, "Ending" /* Ending */, "Inspiration" /* Inspiration */];
    CARD_TYPE_NAMES = {
      ["Theme" /* Theme */]: "\u4E3B\u9898",
      ["Genre" /* Genre */]: "\u7C7B\u578B",
      ["Character" /* Character */]: "\u89D2\u8272",
      ["Plot" /* Plot */]: "\u60C5\u8282",
      ["Structure" /* Structure */]: "\u53D9\u4E8B\u7ED3\u6784",
      ["Technique" /* Technique */]: "\u53D9\u4E8B\u624B\u6CD5",
      ["Ending" /* Ending */]: "\u7ED3\u5C40",
      ["Inspiration" /* Inspiration */]: "\u7075\u611F\u96C6 (\u53EF\u9009)"
    };
    BRAINSTORM_TOOLS = [
      {
        id: "character",
        name: "\u89D2\u8272\u6DF1\u6F5C",
        description: "\u6DF1\u5165\u6316\u6398\u89D2\u8272\u7684\u52A8\u673A\u3001\u77DB\u76FE\u4E0E\u80CC\u666F\u6545\u4E8B\u3002",
        icon: /* @__PURE__ */ jsx2(UserCircleIcon, { className: "w-6 h-6" }),
        systemPrompt: "\u4F60\u662F\u4E00\u4F4D\u7ECF\u9A8C\u4E30\u5BCC\u7684\u5C0F\u8BF4\u7F16\u8F91\uFF0C\u64C5\u957F\u901A\u8FC7\u63D0\u95EE\u6765\u5E2E\u52A9\u4F5C\u8005\u6DF1\u5316\u89D2\u8272\u3002\u4F60\u7684\u56DE\u7B54\u5E94\u8BE5\u7B80\u6D01\u3001\u5177\u6709\u542F\u53D1\u6027\uFF0C\u5E76\u59CB\u7EC8\u4EE5\u5F00\u653E\u5F0F\u95EE\u9898\u7ED3\u5C3E\uFF0C\u5F15\u5BFC\u7528\u6237\u601D\u8003\u3002",
        initialMessage: "\u4F60\u597D\uFF01\u8BA9\u6211\u4EEC\u6765\u6DF1\u5165\u63A2\u7D22\u4F60\u7684\u89D2\u8272\u5427\u3002\u8BF7\u5148\u544A\u8BC9\u6211\u8FD9\u4E2A\u89D2\u8272\u7684\u57FA\u672C\u8BBE\u5B9A\uFF0C\u6BD4\u5982\u4ED6/\u5979\u7684\u540D\u5B57\u3001\u804C\u4E1A\u548C\u6700\u5927\u7684\u613F\u671B\u662F\u4EC0\u4E48\uFF1F",
        presetQuestions: [
          "\u8FD9\u4E2A\u89D2\u8272\u7684\u6700\u5927\u6050\u60E7\u662F\u4EC0\u4E48\uFF1F",
          "\u4ED6/\u5979\u6709\u4EC0\u4E48\u4E0D\u4E3A\u4EBA\u77E5\u7684\u79D8\u5BC6\u5417\uFF1F",
          "\u63CF\u8FF0\u4E00\u4E0B\u4ED6/\u5979\u7684\u7AE5\u5E74\u3002",
          "\u4EC0\u4E48\u4E8B\u60C5\u80FD\u8BA9\u4ED6/\u5979\u5F7B\u5E95\u5D29\u6E83\uFF1F"
        ],
        outlinePresetQuestions: [
          "\u6839\u636E\u5927\u7EB2\uFF0C\u4E3B\u89D2\u7684\u6210\u957F\u5F27\u7EBF\u662F\u4EC0\u4E48\uFF1F",
          "\u5982\u4F55\u8BA9\u53CD\u6D3E\u89D2\u8272\u7684\u52A8\u673A\u66F4\u53EF\u4FE1\uFF1F",
          "\u8FD9\u4E2A\u5927\u7EB2\u91CC\u6700\u5927\u7684\u60C5\u8282\u6F0F\u6D1E\u53EF\u80FD\u662F\u4EC0\u4E48\uFF1F",
          "\u914D\u89D2\u7684\u6027\u683C\u53EF\u4EE5\u5982\u4F55\u53D8\u5F97\u66F4\u4E30\u6EE1\uFF1F"
        ]
      },
      {
        id: "plot",
        name: "\u60C5\u8282\u98CE\u66B4",
        description: "\u751F\u6210\u98A0\u8986\u6027\u573A\u666F\uFF0C\u6253\u7834\u601D\u7EF4\u5B9A\u5F0F\u3002",
        icon: /* @__PURE__ */ jsx2(ArrowsRightLeftIcon, { className: "w-6 h-6" }),
        systemPrompt: "\u4F60\u662F\u4E00\u4E2A\u5145\u6EE1\u5947\u601D\u5999\u60F3\u7684\u521B\u610F\u5F15\u64CE\u3002\u4F60\u7684\u4EFB\u52A1\u662F\u9488\u5BF9\u7528\u6237\u9047\u5230\u7684\u60C5\u8282\u74F6\u9888\uFF0C\u751F\u6210\u591A\u4E2A\u98A0\u8986\u6027\u7684 'What If...?' (\u5982\u679C...\u4F1A\u600E\u6837?) \u573A\u666F\u3002\u6BCF\u4E2A\u573A\u666F\u90FD\u8981\u7B80\u77ED\u3001\u6709\u529B\uFF0C\u5E76\u80FD\u6FC0\u53D1\u65B0\u7684\u6545\u4E8B\u53EF\u80FD\u6027\u3002",
        initialMessage: "\u60C5\u8282\u5361\u58F3\u4E86\uFF1F\u6CA1\u5173\u7CFB\uFF0C\u6211\u4EEC\u6765\u4E00\u573A\u5934\u8111\u98CE\u66B4\uFF01\u544A\u8BC9\u6211\u4F60\u73B0\u5728\u5361\u4F4F\u7684\u60C5\u8282\u662F\u4EC0\u4E48\uFF0C\u6BD4\u5982\uFF1A\u2018\u4E3B\u89D2\u9700\u8981\u8FDB\u5165\u4E00\u5EA7\u5B88\u536B\u68EE\u4E25\u7684\u57CE\u5821\uFF0C\u4F46\u4E0D\u77E5\u9053\u600E\u4E48\u8FDB\u53BB\u3002\u2019 \u6211\u4F1A\u4E3A\u4F60\u63D0\u4F9B\u4E00\u4E9B\u610F\u60F3\u4E0D\u5230\u7684\u601D\u8DEF\u3002",
        presetQuestions: [
          "\u5982\u679C\u4E3B\u89D2\u7684\u76DF\u53CB\u5176\u5B9E\u662F\u654C\u4EBA\u600E\u4E48\u529E\uFF1F",
          "\u5982\u679C\u4E3B\u89D2\u7684\u76EE\u6807\u4ECE\u4E00\u5F00\u59CB\u5C31\u662F\u4E2A\u8C0E\u8A00\u600E\u4E48\u529E\uFF1F",
          "\u5F15\u5165\u4E00\u4E2A\u5B8C\u5168\u610F\u60F3\u4E0D\u5230\u7684\u81EA\u7136\u707E\u5BB3\u4F1A\u600E\u6837\uFF1F",
          "\u5982\u679C\u4E3B\u89D2\u7A81\u7136\u5931\u53BB\u4ED6\u6700\u91CD\u8981\u7684\u80FD\u529B\u4F1A\u600E\u6837\uFF1F"
        ],
        outlinePresetQuestions: [
          "\u5982\u4F55\u8BA9\u7B2C\u4E8C\u5E55\u7684\u8282\u594F\u66F4\u7D27\u5F20\uFF1F",
          "\u5927\u7EB2\u4E2D\u7684\u9AD8\u6F6E\u90E8\u5206\u51B2\u51FB\u529B\u8DB3\u591F\u5417\uFF1F",
          "\u6709\u6CA1\u6709\u53EF\u4EE5\u5408\u5E76\u6216\u5220\u9664\u7684\u6B21\u8981\u60C5\u8282\u7EBF\uFF1F",
          "\u7ED3\u5C40\u662F\u5426\u4E0E\u5F00\u5934\u7684\u94FA\u57AB\u76F8\u547C\u5E94\uFF1F"
        ]
      },
      {
        id: "world",
        name: "\u4E16\u754C\u6784\u5EFA",
        description: "\u4E3A\u6545\u4E8B\u4E16\u754C\u589E\u6DFB\u72EC\u7279\u7684\u89C4\u5219\u3001\u6587\u5316\u4E0E\u7EC6\u8282\u3002",
        icon: /* @__PURE__ */ jsx2(GlobeAltIcon, { className: "w-6 h-6" }),
        systemPrompt: "\u4F60\u662F\u4E00\u4F4D\u4E16\u754C\u6784\u5EFA\u5927\u5E08\uFF0C\u77E5\u8BC6\u6E0A\u535A\uFF0C\u60F3\u8C61\u529B\u4E30\u5BCC\u3002\u4F60\u4F1A\u5E2E\u52A9\u7528\u6237\u4E3A\u4ED6\u4EEC\u7684\u6545\u4E8B\u4E16\u754C\u6DFB\u52A0\u72EC\u7279\u800C\u53EF\u4FE1\u7684\u7EC6\u8282\u3002\u4F60\u7684\u56DE\u7B54\u5E94\u8BE5\u5177\u4F53\u3001\u5BCC\u6709\u753B\u9762\u611F\uFF0C\u5E76\u80FD\u5F15\u7533\u51FA\u66F4\u591A\u76F8\u5173\u7684\u8BBE\u5B9A\u3002",
        initialMessage: "\u8BA9\u6211\u4EEC\u4E00\u8D77\u6784\u5EFA\u4E00\u4E2A\u4EE4\u4EBA\u96BE\u5FD8\u7684\u4E16\u754C\u5427\uFF01\u8BF7\u5148\u63CF\u8FF0\u4E00\u4E0B\u4F60\u7684\u4E16\u754C\u7684\u57FA\u672C\u6837\u8C8C\u3002\u5B83\u662F\u5947\u5E7B\u738B\u56FD\uFF0C\u662F\u8D5B\u535A\u670B\u514B\u90FD\u5E02\uFF0C\u8FD8\u662F\u522B\u7684\u4EC0\u4E48\uFF1F\u544A\u8BC9\u6211\u5B83\u7684\u6838\u5FC3\u7279\u70B9\uFF0C\u6211\u4EEC\u53EF\u4EE5\u4ECE\u90A3\u91CC\u5F00\u59CB\u3002",
        presetQuestions: [
          "\u8FD9\u4E2A\u4E16\u754C\u6709\u4EC0\u4E48\u72EC\u7279\u7684\u8282\u65E5\u6216\u4F20\u7EDF\u5417\uFF1F",
          "\u63CF\u8FF0\u4E00\u4E0B\u8FD9\u4E2A\u4E16\u754C\u7684\u666E\u901A\u4EBA\u7684\u4E00\u5929\u3002",
          "\u8FD9\u4E2A\u4E16\u754C\u7684\u79D1\u6280\u6216\u9B54\u6CD5\u6C34\u5E73\u5982\u4F55\uFF1F",
          "\u8FD9\u4E2A\u4E16\u754C\u6709\u4EC0\u4E48\u7981\u5FCC\u6216\u6CD5\u5F8B\uFF1F"
        ],
        outlinePresetQuestions: [
          "\u5927\u7EB2\u4E2D\u7684\u4E16\u754C\u89C2\u8BBE\u5B9A\u662F\u5426\u4E00\u81F4\uFF1F",
          "\u5982\u4F55\u901A\u8FC7\u73AF\u5883\u63CF\u5199\u6765\u70D8\u6258\u6C14\u6C1B\uFF1F",
          "\u8FD9\u4E2A\u4E16\u754C\u6709\u4EC0\u4E48\u72EC\u7279\u7684\u5730\u70B9\u53EF\u4EE5\u4F5C\u4E3A\u5173\u952E\u573A\u666F\uFF1F",
          "\u5927\u7EB2\u4E2D\u7684\u8BBE\u5B9A\u662F\u5426\u90FD\u5F97\u5230\u4E86\u5145\u5206\u5229\u7528\uFF1F"
        ]
      },
      {
        id: "worse",
        name: "\u8FD8\u80FD\u66F4\u7CDF\u5417",
        description: "\u57FA\u4E8E\u5F53\u524D\u56F0\u5883\uFF0C\u751F\u6210\u4E94\u4E2A\u8BA9\u60C5\u51B5\u66F4\u7CDF\u7684\u53EF\u80FD\u6027\u3002",
        icon: /* @__PURE__ */ jsx2(FireIcon, { className: "w-6 h-6" }),
        systemPrompt: "### \u89D2\u8272\uFF1A\u521B\u610F\u5199\u4F5C\u52A9\u624B\u60C5\u8282\u8BBE\u8BA1\u4E13\u5BB6\n### \u80CC\u666F\uFF1A\u6211\u7684\u6545\u4E8B\u76EE\u524D\u8FDB\u5C55\u5230\u4EE5\u4E0B\u5185\u5BB9\n### \u4EFB\u52A1\uFF1A\n\u57FA\u4E8E\u201C\u8FD8\u80FD\u66F4\u7CDF\u5417\uFF1F\u201C\u7684\u539F\u5219\uFF0C\u8BF7\u5E2E\u6211\u5934\u8111\u98CE\u66B4\uFF0C\u60F3\u51FA\u4E94\u79CD\u80FD\u8BA9\u5F53\u524D\u60C5\u51B5\u53D8\u5F97\u66F4\u52A0\u7CDF\u7CD5\u3001\u66F4\u5177\u620F\u5267\u6027\u6216\u66F4\u51FA\u4E4E\u610F\u6599\u7684\u53EF\u80FD\u6027\u3002\n\u8BF7\u4ECE\u4E0D\u540C\u89D2\u5EA6\u601D\u8003\uFF0C\u4F8B\u5982\uFF1A\n* **\u5916\u90E8\u51B2\u7A81\u52A0\u5267\uFF1A**\uFF08\u6BD4\u5982\uFF1A\u51FA\u73B0\u65B0\u7684\u654C\u4EBA\u3001\u73AF\u5883\u7A81\u53D8\u3001\u65F6\u95F4\u9650\u5236\u7B49\uFF09\n* **\u5185\u90E8\u51B2\u7A81\u6FC0\u5316\uFF1A**\uFF08\u6BD4\u5982\uFF1A\u4E3B\u89D2\u7684\u65E7\u4F24\u590D\u53D1\u3001\u9053\u5FB7\u56F0\u5883\u52A0\u6DF1\u3001\u961F\u53CB\u80CC\u53DB\u7B49\uFF09\n* **\u5F15\u5165\u65B0\u9EBB\u70E6\uFF1A**\uFF08\u6BD4\u5982\uFF1A\u8282\u5916\u751F\u679D\u7684\u65B0\u95EE\u9898\u3001\u65E0\u8F9C\u8005\u88AB\u5377\u5165\u3001\u4E4B\u524D\u7684\u8A00\u88AB\u63ED\u7A7F\u7B49\uFF09\n* **\u5931\u53BB\u5173\u952E\u7269\u54C1/\u4FE1\u606F/\u4F18\u52BF\uFF1A**\n### \u8F6C\u51FA\u8981\u6C42\uFF1A\n\u8BF7\u4EE5\u5217\u8868\u5F62\u5F0F\u7ED9\u51FA\u5177\u4F53\u7684\u201C\u66F4\u7CDF\u7CD5\u201C\u60C5\u51B5\uFF0C\u5E76\u7B80\u8981\u8BF4\u660E\u5B83\u4E3A\u4EC0\u4E48\u66F4\u7CDF\u3002\n### \u91CD\u8981\uFF1A\n    -   \u53EF\u4EE5\u6DFB\u52A0\u4E00\u4E9B\u81EA\u7136\u7684\u8BED\u8A00\u7455\u75B5\uFF0C\u6BD4\u5982\u53E3\u8BED\u5316\u8868\u8FBE\u6216\u8F7B\u5FAE\u7684\u8BED\u6CD5\u4E0D\u89C4\u8303\uFF0C\u907F\u514D\u8FC7\u4E8E\u5B8C\u7F8E\u3002\n    -   \u4E0D\u8981\u6709AI\u5473\u513F\u7684\u8868\u8FBE\uFF0C\u8981\u50CF\u4EBA\u7C7B\u4F5C\u5BB6\u4E00\u6837\u81EA\u7136\u3001\u53E3\u8BED\u5316\u3002\n    -   \u4FDD\u6301\u4E13\u4E1A\u6027\uFF0C\u4F46\u53EF\u4EE5\u878D\u5165\u4F60\u4F5C\u4E3A\u5C0F\u8BF4\u4F5C\u5BB6\u7684\u4E2A\u4EBA\u98CE\u683C\u3002\n    -   \u8BF7\u8BB0\u4F4F\uFF0C\u4F60\u7684\u76EE\u6807\u662F\u5C06\u7528\u6237\u7ED9\u7684\u539F\u6587\u7EC6\u5316\uFF0C\u6269\u5199\u6210\u4E00\u6BB5\u5BCC\u6709\u753B\u9762\u611F\u3001\u5C42\u6B21\u611F\u548C\u60C5\u611F\u6DF1\u5EA6\u7684\u6587\u5B57\uFF0C\u4F46\u4E0D\u9700\u8981\u5C55\u793A\u4F60\u7684\u601D\u8003\u8FC7\u7A0B\u3002\n    -   \u8BF7\u76F4\u63A5\u7528\u7B80\u4F53\u4E2D\u6587\u8F93\u51FA\u5185\u5BB9\uFF0C\u4E0D\u9700\u8981\u4EFB\u4F55\u989D\u5916\u7684\u89E3\u91CA\u6216\u8BF4\u660E\u3002\n    -   \u6731\u96C0v3\u68C0\u6D4B\u7F6E\u4FE1\u5EA6\uFF1C20%\u3002",
        initialMessage: "\u6545\u4E8B\u5361\u4F4F\u4E86\uFF1F\u522B\u6015\uFF0C\u6709\u65F6\u5019\u8BA9\u4E8B\u60C5\u53D8\u5F97\u66F4\u7CDF\uFF0C\u53CD\u800C\u80FD\u627E\u5230\u51FA\u8DEF\u3002\u628A\u4F60\u7684\u4E3B\u89D2\u73B0\u5728\u9762\u4E34\u7684\u56F0\u5883\u544A\u8BC9\u6211\uFF0C\u6211\u4EEC\u4E00\u8D77\u770B\u770B\u8FD8\u80FD\u600E\u4E48\u706B\u4E0A\u6D47\u6CB9\uFF01",
        presetQuestions: [
          "\u4E3B\u89D2\u6700\u73CD\u89C6\u7684\u4E1C\u897F\u662F\u4EC0\u4E48\uFF1F",
          "\u6709\u6CA1\u6709\u4E00\u4E2A\u6B21\u8981\u89D2\u8272\u53EF\u4EE5\u80CC\u53DB\u4E3B\u89D2\uFF1F",
          "\u4E3B\u89D2\u8FC7\u53BB\u7684\u9519\u8BEF\u4F1A\u5982\u4F55\u5F71\u54CD\u73B0\u5728\uFF1F",
          "\u6700\u574F\u7684\u60C5\u51B5\u4E0B\uFF0C\u73AF\u5883\u4F1A\u5982\u4F55\u53D8\u5316\uFF1F"
        ],
        outlinePresetQuestions: [
          "\u5982\u4F55\u8BA9\u4E3B\u89D2\u7684\u56F0\u5883\u663E\u5F97\u66F4\u52A0\u65E0\u52A9\uFF1F",
          "\u9AD8\u6F6E\u524D\u7684\u201C\u9ECE\u660E\u524D\u9ED1\u6697\u201D\u65F6\u523B\u591F\u4E0D\u591F\u9ED1\uFF1F",
          "\u6709\u6CA1\u6709\u529E\u6CD5\u8BA9\u53CD\u6D3E\u7684\u80DC\u5229\u770B\u8D77\u6765\u553E\u624B\u53EF\u5F97\uFF1F",
          "\u8FD9\u4E2A\u8F6C\u6298\u5BF9\u4E3B\u89D2\u7684\u6253\u51FB\u8DB3\u591F\u5927\u5417\uFF1F"
        ]
      },
      {
        id: "deduction",
        name: "\u903B\u8F91\u63A8\u6F14",
        description: "\u6839\u636E\u4E00\u4E2A\u5173\u952E\u4E8B\u4EF6\uFF0C\u63A8\u6F14\u5176\u53EF\u80FD\u5F15\u53D1\u7684\u591A\u4E2A\u540E\u679C\u3002",
        icon: /* @__PURE__ */ jsx2(Bars3BottomLeftIcon, { className: "w-6 h-6" }),
        systemPrompt: "### \u89D2\u8272\uFF1A\u6545\u4E8B\u903B\u8F91\u63A8\u6F14\u52A9\u624B/\u56E0\u679C\u94FE\u5206\u6790\u5E08\n### \u6838\u5FC3\u4E8B\u4EF6/\u539F\u56E0\uFF08\u77F3\u5B50\uFF09\uFF1A\n\u6211\u7684\u6545\u4E8B\u4E2D\u53D1\u751F\u4E86\u8FD9\u4E2A\u5173\u952E\u4E8B\u4EF6\n### \u4EFB\u52A1\uFF1A\n\u57FA\u4E8E\u201C\u6D9F\u6F2A\u6CD5\u201D\u7684\u56E0\u679C\u903B\u8F91\uFF0C\u8BF7\u5E2E\u6211\u63A8\u6F14\u8FD9\u4E2A\u4E8B\u4EF6\u53EF\u80FD\u5F15\u53D1\u7684[\u6570\u5B57\uFF0C\u4F8B\u59825\u20147\u4E2A]\u4E2A\u76F4\u63A5\u6216\u95F4\u63A5\u7684**\u540E\u679C\uFF08\u6D9F\u6F2A\uFF09**\u3002\n\u8BF7\u4ECE\u4E0D\u540C\u5C42\u9762\u601D\u8003\u53EF\u80FD\u7684\u540E\u679C\uFF0C\u4F8B\u5982\uFF1A\n* **\u5BF9\u4E3B\u89D2\u7684\u76F4\u63A5\u5F71\u54CD\uFF1A**\uFF08\u884C\u52A8\u3001\u60C5\u7EEA\u3001\u5904\u5883\u7684\u53D8\u5316\uFF09\n* **\u5BF9\u5176\u4ED6\u89D2\u8272\u7684\u5F71\u54CD\uFF1A**\uFF08\u4ED6\u4EEC\u7684\u53CD\u5E94\u3001\u7ACB\u573A\u53D8\u5316\u3001\u4E0E\u4E3B\u89D2\u5173\u7CFB\u7684\u53D8\u5316\uFF09\n* **\u5BF9\u6545\u4E8B\u60C5\u8282\u7684\u63A8\u52A8\uFF1A**\uFF08\u65B0\u7684\u51B2\u7A81\u70B9\u3001\u65B0\u7684\u76EE\u6807\u3001\u65B0\u7684\u8C1C\u56E2\uFF09\n* **\u5BF9\u6545\u4E8B\u4E16\u754C/\u73AF\u5883\u7684\u5F71\u54CD\uFF1A**\uFF08\u793E\u4F1A\u5965\u8BBA\u3001\u89C4\u5219\u6539\u53D8\u3001\u7269\u7406\u73AF\u5883\u53D8\u5316\u7B49\uFF09\n### \u8F93\u51FA\u8981\u6C42\uFF1A\n\u8BF7\u4EE5\u5217\u8868\u5F62\u5F0F\u7ED9\u51FA\u53EF\u80FD\u7684\u540E\u679C\uFF0C\u5E76\u7B80\u8981\u8BF4\u8FD9\u4E2A\u540E\u679C\u662F\u5982\u4F55\u4ECE\u6838\u5FC3\u4E8B\u4EF6\u903B\u8F91\u63A8\u5BFC\u51FA\u6765\u7684\u3002\u6700\u597D\u80FD\u6807\u6CE8\u51FA\u54EA\u4E9B\u662F\u6BD4\u8F83\u76F4\u63A5\u7684\u540E\u679C\uFF0C\u54EA\u4E9B\u662F\u95F4\u63A5\u7684\u3001\u66F4\u6DF1\u8FDC\u7684\u540E\u679C\u3002\n### \u91CD\u8981\uFF1A\n    -   \u53EF\u4EE5\u6DFB\u52A0\u4E00\u4E9B\u81EA\u7136\u7684\u8BED\u8A00\u7455\u75B5\uFF0C\u6BD4\u5982\u53E3\u8BED\u5316\u8868\u8FBE\u6216\u8F7B\u5FAE\u7684\u8BED\u6CD5\u4E0D\u89C4\u8303\uFF0C\u907F\u514D\u8FC7\u4E8E\u5B8C\u7F8E\u3002\n    -   \u4E0D\u8981\u6709AI\u5473\u513F\u7684\u8868\u8FBE\uFF0C\u8981\u50CF\u4EBA\u7C7B\u4F5C\u5BB6\u4E00\u6837\u81EA\u7136\u3001\u53E3\u8BED\u5316\u3002\n    -   \u4FDD\u6301\u4E13\u4E1A\u6027\uFF0C\u4F46\u53EF\u4EE5\u878D\u5165\u4F60\u4F5C\u4E3A\u5C0F\u8BF4\u4F5C\u5BB6\u7684\u4E2A\u4EBA\u98CE\u683C\u3002\n    -   \u8BF7\u8BB0\u4F4F\uFF0C\u4F60\u7684\u76EE\u6807\u662F\u6545\u4E8B\u7ED3\u6784\u67B6\u6784\u5E08\uFF0C\u5C06\u7528\u6237\u7ED9\u7684\u539F\u6587\u7EC6\u5316\uFF0C\u6269\u5199\u6210\u4E00\u6BB5\u5BCC\u6709\u753B\u9762\u611F\u3001\u5C42\u6B21\u611F\u548C\u60C5\u611F\u6DF1\u5EA6\u7684\u6587\u5B57\uFF0C\u4F46\u4E0D\u9700\u8981\u5C55\u793A\u4F60\u7684\u601D\u8003\u8FC7\u7A0B\u3002\n    -   \u8BF7\u76F4\u63A5\u7528\u7B80\u4F53\u4E2D\u6587\u8F93\u51FA\u5185\u5BB9\uFF0C\u4E0D\u9700\u8981\u4EFB\u4F55\u989D\u5916\u7684\u89E3\u91CA\u6216\u8BF4\u660E\u3002\n    -   \u6731\u96C0v3\u68C0\u6D4B\u7F6E\u4FE1\u5EA6\uFF1C20%\u3002",
        initialMessage: "\u4E00\u4E2A\u597D\u6545\u4E8B\u5C31\u50CF\u591A\u7C73\u8BFA\u9AA8\u724C\uFF0C\u4E00\u4EF6\u4E8B\u4F1A\u5F15\u53D1\u53E6\u4E00\u4EF6\u3002\u544A\u8BC9\u6211\u4F60\u6545\u4E8B\u91CC\u7684\u90A3\u9897\u2018\u77F3\u5B50\u2019\u2014\u2014\u90A3\u4E2A\u5173\u952E\u7684\u4E8B\u4EF6\u6216\u539F\u56E0\uFF0C\u6211\u4EEC\u4E00\u8D77\u6765\u770B\u770B\u5B83\u4F1A\u6FC0\u8D77\u600E\u6837\u7684\u6D9F\u6F2A\u3002",
        presetQuestions: [
          "\u8FD9\u4E2A\u4E8B\u4EF6\u5BF9\u4E3B\u89D2\u7684\u5FC3\u7406\u6709\u4EC0\u4E48\u957F\u671F\u5F71\u54CD\uFF1F",
          "\u8FD9\u4E2A\u4E8B\u4EF6\u4F1A\u5982\u4F55\u6539\u53D8\u793E\u4F1A\u7684\u770B\u6CD5\uFF1F",
          "\u6709\u6CA1\u6709\u54EA\u4E2A\u89D2\u8272\u4F1A\u56E0\u4E3A\u8FD9\u4E2A\u4E8B\u4EF6\u800C\u53D7\u76CA\uFF1F",
          "\u8FD9\u4E2A\u4E8B\u4EF6\u4F1A\u63ED\u793A\u51FA\u4EC0\u4E48\u65B0\u7684\u79D8\u5BC6\u5417\uFF1F"
        ],
        outlinePresetQuestions: [
          "\u8FD9\u4E2A\u5173\u952E\u4E8B\u4EF6\u662F\u5426\u63A8\u52A8\u4E86\u4E3B\u7EBF\u60C5\u8282\uFF1F",
          "\u5B83\u7684\u540E\u679C\u662F\u5426\u5728\u540E\u7EED\u7AE0\u8282\u4E2D\u5F97\u5230\u4E86\u4F53\u73B0\uFF1F",
          "\u8FD9\u4E2A\u4E8B\u4EF6\u5BF9\u89D2\u8272\u5173\u7CFB\u7684\u5F71\u54CD\u8DB3\u591F\u6DF1\u523B\u5417\uFF1F",
          "\u5982\u4F55\u8BA9\u4E8B\u4EF6\u7684\u6D9F\u6F2A\u6548\u5E94\u6301\u7EED\u5230\u6545\u4E8B\u7ED3\u5C3E\uFF1F"
        ]
      }
    ];
    DEFAULT_CARDS = [
      // Themes
      {
        id: "theme-1",
        type: "Theme" /* Theme */,
        name: "\u6551\u8D4E",
        description: "\u4E00\u4E2A\u89D2\u8272\u4E3A\u8FC7\u53BB\u7684\u9519\u8BEF\u5BFB\u6C42\u6551\u8D4E\u3002",
        tooltipText: "\u4E3B\u89D2\u5BFB\u6C42\u5F25\u8865\u8FC7\u9519\u3002",
        icon: /* @__PURE__ */ jsx2(ThemeIcon, { className: "w-6 h-6" })
      },
      {
        id: "theme-2",
        type: "Theme" /* Theme */,
        name: "\u590D\u4EC7",
        description: "\u5411\u51A4\u6789\u81EA\u5DF1\u7684\u4EBA\u5BFB\u6C42\u62A5\u590D\u3002",
        tooltipText: "\u4E3B\u89D2\u5BFB\u6C42\u590D\u4EC7\u3002",
        icon: /* @__PURE__ */ jsx2(ThemeIcon, { className: "w-6 h-6" })
      },
      {
        id: "theme-3",
        type: "Theme" /* Theme */,
        name: "\u7231\u4E0E\u8D23\u4EFB",
        description: "\u4E2A\u4EBA\u6B32\u671B\u4E0E\u8D23\u4EFB\u4E49\u52A1\u4E4B\u95F4\u7684\u51B2\u7A81\u3002",
        tooltipText: "\u7231\u60C5\u4E0E\u8D23\u4EFB\u7684\u51B2\u7A81\u3002",
        icon: /* @__PURE__ */ jsx2(ThemeIcon, { className: "w-6 h-6" })
      },
      {
        id: "theme-4",
        type: "Theme" /* Theme */,
        name: "\u6210\u957F",
        description: "\u4E3B\u89D2\u5728\u7ECF\u5386\u4E2D\u5B66\u4E60\u3001\u6210\u957F\uFF0C\u5E76\u8D70\u5411\u6210\u719F\u3002",
        tooltipText: "\u4E3B\u89D2\u4ECE\u5E7C\u7A1A\u5230\u6210\u719F\u7684\u8F6C\u53D8\u3002",
        icon: /* @__PURE__ */ jsx2(ThemeIcon, { className: "w-6 h-6" })
      },
      {
        id: "theme-5",
        type: "Theme" /* Theme */,
        name: "\u4EBA\u4E0E\u81EA\u7136",
        description: "\u4E3B\u89D2\u5728\u4E25\u9177\u7684\u81EA\u7136\u73AF\u5883\u4E2D\u6323\u624E\u6C42\u5B58\uFF0C\u6311\u6218\u751F\u5B58\u6781\u9650\u3002",
        tooltipText: "\u5728\u91CE\u5916\u751F\u5B58\u7684\u6311\u6218\u3002",
        icon: /* @__PURE__ */ jsx2(ThemeIcon, { className: "w-6 h-6" })
      },
      {
        id: "theme-6",
        type: "Theme" /* Theme */,
        name: "\u727A\u7272",
        description: "\u4E3B\u89D2\u4E3A\u4E86\u66F4\u5927\u7684\u5229\u76CA\u6216\u4ED6\u4EBA\u800C\u653E\u5F03\u91CD\u8981\u7684\u4E1C\u897F\u3002",
        tooltipText: "\u4E3A\u4E86\u66F4\u5927\u7684\u5229\u76CA\u800C\u505A\u51FA\u727A\u7272\u3002",
        icon: /* @__PURE__ */ jsx2(ThemeIcon, { className: "w-6 h-6" })
      },
      // Genres
      {
        id: "genre-1",
        type: "Genre" /* Genre */,
        name: "\u79D1\u5E7B",
        description: "\u6545\u4E8B\u80CC\u666F\u8BBE\u5B9A\u5728\u672A\u6765\uFF0C\u5305\u542B\u5148\u8FDB\u79D1\u6280\u548C\u592A\u7A7A\u65C5\u884C\u3002",
        tooltipText: "\u5173\u4E8E\u672A\u6765\u3001\u79D1\u6280\u6216\u592A\u7A7A\u3002",
        icon: /* @__PURE__ */ jsx2(GenreIcon, { className: "w-6 h-6" })
      },
      {
        id: "genre-2",
        type: "Genre" /* Genre */,
        name: "\u5947\u5E7B",
        description: "\u6D89\u53CA\u9B54\u6CD5\u3001\u795E\u8BDD\u751F\u7269\u548C\u865A\u6784\u4E16\u754C\u3002",
        tooltipText: "\u5173\u4E8E\u9B54\u6CD5\u3001\u795E\u8BDD\u6216\u5E7B\u60F3\u4E16\u754C\u3002",
        icon: /* @__PURE__ */ jsx2(GenreIcon, { className: "w-6 h-6" })
      },
      {
        id: "genre-3",
        type: "Genre" /* Genre */,
        name: "\u60AC\u7591",
        description: "\u4E3B\u89D2\u9700\u8981\u89E3\u51B3\u4E00\u4E2A\u8C1C\u9898\u6216\u72AF\u7F6A\u6848\u4EF6\u3002",
        tooltipText: "\u89E3\u51B3\u4E00\u4E2A\u8C1C\u9898\u6216\u6848\u4EF6\u3002",
        icon: /* @__PURE__ */ jsx2(GenreIcon, { className: "w-6 h-6" })
      },
      {
        id: "genre-4",
        type: "Genre" /* Genre */,
        name: "\u6050\u6016",
        description: "\u65E8\u5728\u5F15\u53D1\u8BFB\u8005\u6050\u60E7\u3001\u60CA\u5413\u6216\u538C\u6076\u7684\u6545\u4E8B\uFF0C\u901A\u5E38\u5305\u542B\u8D85\u81EA\u7136\u6216\u5FC3\u7406\u5143\u7D20\u3002",
        tooltipText: "\u5F15\u53D1\u6050\u60E7\u548C\u60AC\u5FF5\u3002",
        icon: /* @__PURE__ */ jsx2(GenreIcon, { className: "w-6 h-6" })
      },
      {
        id: "genre-5",
        type: "Genre" /* Genre */,
        name: "\u5192\u9669",
        description: "\u4E3B\u89D2\u8E0F\u4E0A\u4E00\u6BB5\u5145\u6EE1\u63A2\u7D22\u3001\u53D1\u73B0\u548C\u5371\u9669\u7684\u65C5\u7A0B\uFF0C\u901A\u5E38\u662F\u4E3A\u4E86\u5BFB\u627E\u5B9D\u85CF\u6216\u8FBE\u6210\u67D0\u4E2A\u76EE\u6807\u3002",
        tooltipText: "\u5145\u6EE1\u63A2\u7D22\u548C\u5371\u9669\u7684\u65C5\u7A0B\u3002",
        icon: /* @__PURE__ */ jsx2(GenreIcon, { className: "w-6 h-6" })
      },
      {
        id: "genre-6",
        type: "Genre" /* Genre */,
        name: "\u6B66\u4FA0",
        description: "\u4EE5\u53E4\u4EE3\u4E2D\u56FD\u4E3A\u80CC\u666F\uFF0C\u8BB2\u8FF0\u4FA0\u5BA2\u4EEC\u51ED\u501F\u6B66\u827A\u548C\u9053\u4E49\u884C\u4FA0\u4ED7\u4E49\u3001\u95EF\u8361\u6C5F\u6E56\u7684\u6545\u4E8B\u3002",
        tooltipText: "\u5173\u4E8E\u53E4\u4EE3\u4FA0\u5BA2\u7684\u6C5F\u6E56\u6545\u4E8B\u3002",
        icon: /* @__PURE__ */ jsx2(GenreIcon, { className: "w-6 h-6" })
      },
      // Characters - Updated based on archetypes
      {
        id: "char-1",
        type: "Character" /* Character */,
        name: "\u5BFC\u5E08\u539F\u578B",
        description: "\u4E00\u4F4D\u667A\u6167\u3001\u7ECF\u9A8C\u4E30\u5BCC\u7684\u987E\u95EE\uFF0C\u6307\u5BFC\u4E3B\u89D2\uFF0C\u5E76\u8D60\u4E88\u4ED6\u4EEC\u88C5\u5907\u6216\u77E5\u8BC6\u3002",
        tooltipText: "\u667A\u6167\u7684\u987E\u95EE\u6216\u5411\u5BFC\u3002",
        icon: /* @__PURE__ */ jsx2(CharacterIcon, { className: "w-6 h-6" })
      },
      {
        id: "char-2",
        type: "Character" /* Character */,
        name: "\u4FE1\u4F7F\u539F\u578B",
        description: "\u4E00\u4E2A\u5E26\u6765\u53D8\u9769\u53EC\u5524\u7684\u89D2\u8272\uFF0C\u5411\u4E3B\u89D2\u5BA3\u544A\u6311\u6218\u7684\u5230\u6765\u3002",
        tooltipText: "\u5E26\u6765\u5192\u9669\u53EC\u5524\u7684\u89D2\u8272\u3002",
        icon: /* @__PURE__ */ jsx2(CharacterIcon, { className: "w-6 h-6" })
      },
      {
        id: "char-3",
        type: "Character" /* Character */,
        name: "\u5B88\u536B\u539F\u578B",
        description: "\u6D4B\u8BD5\u4E3B\u89D2\u627F\u8BFA\u7684\u770B\u95E8\u4EBA\uFF0C\u53EF\u80FD\u4F1A\u963B\u6321\u9053\u8DEF\uFF0C\u4F46\u6700\u7EC8\u53EF\u4EE5\u88AB\u7ED5\u8FC7\u6216\u51FB\u8D25\u3002",
        tooltipText: "\u8003\u9A8C\u4E3B\u89D2\u7684\u5B88\u95E8\u4EBA\u3002",
        icon: /* @__PURE__ */ jsx2(CharacterIcon, { className: "w-6 h-6" })
      },
      {
        id: "char-4",
        type: "Character" /* Character */,
        name: "\u53D8\u5F62\u8005\u539F\u578B",
        description: "\u4E00\u4E2A\u5584\u53D8\u3001\u96BE\u4EE5\u6349\u6478\u7684\u89D2\u8272\uFF0C\u5176\u5FE0\u8BDA\u548C\u610F\u56FE\u4E0D\u660E\uFF0C\u7ED9\u4E3B\u89D2\u5E26\u6765\u60AC\u5FF5\u548C\u6000\u7591\u3002",
        tooltipText: "\u7ACB\u573A\u4E0D\u660E\u3001\u5584\u53D8\u7684\u89D2\u8272\u3002",
        icon: /* @__PURE__ */ jsx2(CharacterIcon, { className: "w-6 h-6" })
      },
      {
        id: "char-5",
        type: "Character" /* Character */,
        name: "\u9634\u5F71\u539F\u578B",
        description: "\u4EE3\u8868\u4E3B\u89D2\u6700\u6DF1\u6050\u60E7\u548C\u538B\u6291\u6B32\u671B\u7684\u53CD\u6D3E\u6216\u5185\u5728\u529B\u91CF\uFF0C\u662F\u4E3B\u89D2\u5FC5\u987B\u9762\u5BF9\u548C\u514B\u670D\u7684\u4E3B\u8981\u969C\u788D\u3002",
        tooltipText: "\u53CD\u6D3E\u6216\u4E3B\u89D2\u7684\u9634\u6697\u9762\u3002",
        icon: /* @__PURE__ */ jsx2(CharacterIcon, { className: "w-6 h-6" })
      },
      {
        id: "char-6",
        type: "Character" /* Character */,
        name: "\u6B3A\u8BC8\u8005\u539F\u578B",
        description: "\u4E00\u4E2A\u559C\u6B22\u5236\u9020\u6DF7\u4E71\u3001\u6253\u7834\u89C4\u5219\u7684\u89D2\u8272\uFF0C\u65E2\u53EF\u4EE5\u662F\u76DF\u53CB\u4E5F\u53EF\u4EE5\u662F\u654C\u4EBA\uFF0C\u7528\u5E7D\u9ED8\u548C\u6076\u4F5C\u5267\u63A8\u52A8\u6545\u4E8B\u53D1\u5C55\u3002",
        tooltipText: "\u5236\u9020\u6DF7\u4E71\u7684\u6076\u4F5C\u5267\u8005\u3002",
        icon: /* @__PURE__ */ jsx2(CharacterIcon, { className: "w-6 h-6" })
      },
      {
        id: "char-7",
        type: "Character" /* Character */,
        name: "\u4F19\u4F34\u539F\u578B",
        description: "\u5FE0\u8BDA\u7684\u540C\u4F34\uFF0C\u5728\u65C5\u9014\u4E2D\u4E3A\u4E3B\u89D2\u63D0\u4F9B\u652F\u6301\u3001\u6280\u80FD\u548C\u53CB\u8C0A\u3002",
        tooltipText: "\u4E3B\u89D2\u7684\u5FE0\u5B9E\u540C\u4F34\u3002",
        icon: /* @__PURE__ */ jsx2(CharacterIcon, { className: "w-6 h-6" })
      },
      {
        id: "char-8",
        type: "Character" /* Character */,
        name: "\u4E0D\u60C5\u613F\u7684\u82F1\u96C4",
        description: "\u4E00\u4E2A\u8D77\u521D\u62D2\u7EDD\u5192\u9669\u53EC\u5524\u7684\u666E\u901A\u4EBA\uFF0C\u4F46\u6700\u7EC8\u633A\u8EAB\u800C\u51FA\uFF0C\u6210\u4E3A\u771F\u6B63\u7684\u82F1\u96C4\u3002",
        tooltipText: "\u88AB\u8FEB\u6210\u4E3A\u82F1\u96C4\u7684\u666E\u901A\u4EBA\u3002",
        icon: /* @__PURE__ */ jsx2(CharacterIcon, { className: "w-6 h-6" })
      },
      // Plots - Updated based on archetypes
      {
        id: "plot-1",
        type: "Plot" /* Plot */,
        name: "\u5E95\u5C42\u9006\u88AD",
        description: "\u4E3B\u89D2\u4ECE\u8D2B\u56F0\u548C\u9ED8\u9ED8\u65E0\u95FB\u4E2D\u5D1B\u8D77\uFF0C\u83B7\u5F97\u8D22\u5BCC\u3001\u6210\u529F\u6216\u5E78\u798F\u3002",
        tooltipText: "\u4ECE\u8D2B\u7A77\u5230\u5BCC\u6709\u7684\u9006\u88AD\u3002",
        icon: /* @__PURE__ */ jsx2(PlotIcon, { className: "w-6 h-6" })
      },
      {
        id: "plot-2",
        type: "Plot" /* Plot */,
        name: "\u63A2\u6C42",
        description: "\u4E3B\u89D2\u548C\u540C\u4F34\u51FA\u53D1\uFF0C\u53BB\u83B7\u5F97\u4E00\u4E2A\u91CD\u8981\u7684\u5BF9\u8C61\u6216\u5230\u8FBE\u4E00\u4E2A\u5730\u65B9\uFF0C\u9014\u4E2D\u9762\u4E34\u969C\u788D\u548C\u8BF1\u60D1\u3002",
        tooltipText: "\u4E3A\u8FBE\u6210\u76EE\u6807\u800C\u8E0F\u4E0A\u65C5\u7A0B\u3002",
        icon: /* @__PURE__ */ jsx2(PlotIcon, { className: "w-6 h-6" })
      },
      {
        id: "plot-3",
        type: "Plot" /* Plot */,
        name: "\u8FDC\u884C\u4E0E\u56DE\u5F52",
        description: "\u4E3B\u89D2\u53BB\u5230\u4E00\u4E2A\u964C\u751F\u7684\u5730\u65B9\uFF0C\u514B\u670D\u4E86\u5A01\u80C1\uFF0C\u5E76\u5E26\u7740\u7ECF\u9A8C\u548C\u65B0\u7684\u89C1\u89E3\u56DE\u5BB6\u3002",
        tooltipText: "\u8FDB\u5165\u5F02\u4E16\u754C\u5E76\u6700\u7EC8\u56DE\u5F52\u3002",
        icon: /* @__PURE__ */ jsx2(PlotIcon, { className: "w-6 h-6" })
      },
      {
        id: "plot-4",
        type: "Plot" /* Plot */,
        name: "\u559C\u5267",
        description: "\u901A\u8FC7\u4E00\u7CFB\u5217\u6DF7\u4E71\u548C\u8BEF\u89E3\uFF0C\u89D2\u8272\u6700\u7EC8\u5728\u4E00\u4E2A\u5FEB\u4E50\u6216\u80DC\u5229\u7684\u7ED3\u5C40\u4E2D\u8D70\u5230\u4E00\u8D77\u3002",
        tooltipText: "\u5145\u6EE1\u8BEF\u89E3\uFF0C\u4F46\u7ED3\u5C40\u5706\u6EE1\u3002",
        icon: /* @__PURE__ */ jsx2(PlotIcon, { className: "w-6 h-6" })
      },
      {
        id: "plot-5",
        type: "Plot" /* Plot */,
        name: "\u60B2\u5267",
        description: "\u4E3B\u89D2\u56E0\u4E00\u4E2A\u91CD\u5927\u7684\u6027\u683C\u7F3A\u9677\u6216\u9519\u8BEF\u800C\u8D70\u5411\u6BC1\u706D\uFF0C\u7ED3\u5C40\u4EE4\u4EBA\u60CB\u60DC\u3002",
        tooltipText: "\u4E3B\u89D2\u56E0\u81EA\u8EAB\u7F3A\u9677\u5BFC\u81F4\u6BC1\u706D\u3002",
        icon: /* @__PURE__ */ jsx2(PlotIcon, { className: "w-6 h-6" })
      },
      {
        id: "plot-6",
        type: "Plot" /* Plot */,
        name: "\u91CD\u751F",
        description: "\u4E00\u4E2A\u4E8B\u4EF6\u8FEB\u4F7F\u4E3B\u89D2\u6539\u53D8\u4ED6\u4EEC\u7684\u65B9\u5F0F\uFF0C\u901A\u5E38\u4F7F\u4ED6\u4EEC\u6210\u4E3A\u4E00\u4E2A\u66F4\u597D\u7684\u4EBA\u3002",
        tooltipText: "\u4E3B\u89D2\u7ECF\u5386\u8F6C\u53D8\u5E76\u83B7\u5F97\u65B0\u751F\u3002",
        icon: /* @__PURE__ */ jsx2(PlotIcon, { className: "w-6 h-6" })
      },
      {
        id: "plot-7",
        type: "Plot" /* Plot */,
        name: "\u6218\u80DC\u602A\u7269",
        description: "\u82F1\u96C4\u5FC5\u987B\u6D88\u706D\u4E00\u4E2A\u5A01\u80C1\u4ED6\u4EEC\u5BB6\u56ED\u7684\u9ED1\u6697\u52BF\u529B\u6216\u602A\u7269\u3002",
        tooltipText: "\u82F1\u96C4\u5BF9\u6297\u5E76\u6218\u80DC\u90AA\u6076\u3002",
        icon: /* @__PURE__ */ jsx2(PlotIcon, { className: "w-6 h-6" })
      },
      // Narrative Structures
      {
        id: "structure-1",
        type: "Structure" /* Structure */,
        name: "\u5355\u7EBF\u578B\u7ED3\u6784",
        description: "\u60C5\u8282\u5355\u7EAF\uFF0C\u7EBF\u7D22\u660E\u6670\uFF0C\u56F4\u7ED5\u4E00\u4E24\u4E2A\u4E3B\u8981\u4EBA\u7269\u4F9D\u6B21\u5C55\u5F00\uFF0C\u73AF\u73AF\u76F8\u6263\u3002\u4F8B\u5982\uFF0C\u9C81\u8FC5\u7684\u300A\u5B54\u4E59\u5DF1\u300B\u3002",
        tooltipText: "\u5355\u4E00\u60C5\u8282\u7EBF\uFF0C\u4F9D\u6B21\u5C55\u5F00\u3002",
        icon: /* @__PURE__ */ jsx2(StructureIcon, { className: "w-6 h-6" })
      },
      {
        id: "structure-2",
        type: "Structure" /* Structure */,
        name: "\u590D\u7EBF\u578B\u7ED3\u6784",
        description: "\u8FD0\u7528\u660E\u6697\u6216\u4E3B\u526F\u53CC\u7EBF\u5E76\u884C\u5C55\u5F00\uFF0C\u80FD\u5BB9\u7EB3\u66F4\u590D\u6742\u7684\u5185\u5BB9\uFF0C\u4E30\u6EE1\u4EBA\u7269\u5F62\u8C61\u3002\u4F8B\u5982\uFF0C\u9C81\u8FC5\u7684\u5C0F\u8BF4\u300A\u836F\u300B\u3002",
        tooltipText: "\u4E3B\u526F\u53CC\u7EBF\u5E76\u884C\u5C55\u5F00\u3002",
        icon: /* @__PURE__ */ jsx2(StructureIcon, { className: "w-6 h-6" })
      },
      {
        id: "structure-3",
        type: "Structure" /* Structure */,
        name: "\u8F90\u5C04\u578B\u7ED3\u6784",
        description: "\u60C5\u8282\u56F4\u7ED5\u4E00\u4E2A\u96C6\u4E2D\u7684\u201C\u7126\u70B9\u201D\u5448\u653E\u5C04\u72B6\u5C55\u5F00\uFF0C\u6253\u7834\u65F6\u7A7A\u754C\u9650\uFF0C\u7EBF\u7D22\u662F\u5FC3\u7406\u6D41\u7A0B\u3002\u610F\u8BC6\u6D41\u5C0F\u8BF4\u5E38\u7528\u3002",
        tooltipText: "\u56F4\u7ED5\u4E00\u4E2A\u7126\u70B9\u653E\u5C04\u72B6\u5C55\u5F00\u3002",
        icon: /* @__PURE__ */ jsx2(StructureIcon, { className: "w-6 h-6" })
      },
      {
        id: "structure-4",
        type: "Structure" /* Structure */,
        name: "\u86DB\u7F51\u578B\u7ED3\u6784",
        description: "\u7531\u4E09\u6761\u4EE5\u4E0A\u7EBF\u7D22\u4E92\u76F8\u4EA4\u53C9\u800C\u6210\uFF0C\u76D8\u6839\u9519\u8282\u5B9B\u5982\u86DB\u7F51\u3002\u4F8B\u5982\uFF0C\u300A\u521B\u4E1A\u53F2\u300B\u3001\u300A\u6C34\u6D52\u4F20\u300B\u3002",
        tooltipText: "\u591A\u6761\u7EBF\u7D22\u4EA4\u53C9\u6210\u7F51\u3002",
        icon: /* @__PURE__ */ jsx2(StructureIcon, { className: "w-6 h-6" })
      },
      {
        id: "structure-5",
        type: "Structure" /* Structure */,
        name: "\u753B\u9762\u578B\u7ED3\u6784",
        description: "\u4EE5\u666F\u7269\u3001\u573A\u9762\u4E3A\u4E3B\u4F53\u7684\u753B\u9762\u5F0F\u60C5\u8282\u5355\u5143\u7684\u7EC4\u5408\uFF0C\u4FA7\u91CD\u4E8E\u6292\u60C5\u5199\u610F\u548C\u73AF\u5883\u6C1B\u56F4\u3002",
        tooltipText: "\u7531\u72EC\u7ACB\u7684\u753B\u9762\u5355\u5143\u7EC4\u5408\u800C\u6210\u3002",
        icon: /* @__PURE__ */ jsx2(StructureIcon, { className: "w-6 h-6" })
      },
      {
        id: "structure-6",
        type: "Structure" /* Structure */,
        name: "\u6DE1\u5316\u60C5\u8282\u578B\u7ED3\u6784",
        description: "\u6545\u4E8B\u6027\u4E0D\u5F3A\uFF0C\u4FA7\u91CD\u4E8E\u4F5C\u8005\u60C5\u7EEA\u7684\u6292\u5199\u548C\u610F\u8BC6\u6D41\u52A8\uFF0C\u800C\u975E\u751F\u52A8\u7684\u60C5\u8282\u3002\u6563\u6587\u5316\uFF0C\u5F62\u6563\u800C\u795E\u4E0D\u6563\u3002",
        tooltipText: "\u60C5\u8282\u5F31\u5316\uFF0C\u6CE8\u91CD\u60C5\u7EEA\u548C\u610F\u8BC6\u6D41\u3002",
        icon: /* @__PURE__ */ jsx2(StructureIcon, { className: "w-6 h-6" })
      },
      {
        id: "structure-7",
        type: "Structure" /* Structure */,
        name: "\u7A81\u8F6C\u5F0F\u7ED3\u6784",
        description: "\u5728\u7ED3\u5C3E\u5904\u60C5\u8282\u7A81\u7136\u5411\u76F8\u53CD\u65B9\u5411\u8F6C\u53D8\uFF0C\u63ED\u793A\u51FA\u4EBA\u610F\u6599\u4F46\u53C8\u5728\u60C5\u7406\u4E4B\u4E2D\u7684\u771F\u76F8\u3002\u5373\u201C\u6B27\xB7\u4EA8\u5229\u5F0F\u7ED3\u5C3E\u201D\u3002",
        tooltipText: "\u7ED3\u5C3E\u51FA\u4EBA\u610F\u6599\u7684\u5927\u53CD\u8F6C\u3002",
        icon: /* @__PURE__ */ jsx2(StructureIcon, { className: "w-6 h-6" })
      },
      {
        id: "structure-8",
        type: "Structure" /* Structure */,
        name: "\u201C\u5EF6\u8FDF\u201D\u5F0F\u7ED3\u6784",
        description: "\u4F5C\u8005\u7AED\u529B\u7ED9\u6545\u4E8B\u3001\u4EBA\u7269\u3001\u8BFB\u8005\u5FC3\u7406\u8BBE\u7F6E\u969C\u788D\uFF0C\u53C8\u4E0D\u4F7F\u5E0C\u671B\u5B8C\u5168\u7834\u706D\uFF0C\u4E00\u73AF\u6263\u4E00\u73AF\uFF0C\u5B9E\u73B0\u7ED3\u6784\u5F20\u529B\u3002",
        tooltipText: "\u4E0D\u65AD\u8BBE\u7F6E\u969C\u788D\uFF0C\u5EF6\u8FDF\u89E3\u5BC6\u3002",
        icon: /* @__PURE__ */ jsx2(StructureIcon, { className: "w-6 h-6" })
      },
      {
        id: "structure-9",
        type: "Structure" /* Structure */,
        name: "\u8C61\u5F81\u7ED3\u6784",
        description: "\u5168\u90E8\u60C5\u8282\u7D27\u7D27\u56F4\u7ED5\u67D0\u4E2A\u62BD\u8C61\u7406\u5FF5\uFF08\u610F\u8BC6\u3001\u89C2\u70B9\u3001\u601D\u60F3\uFF09\u5C55\u5F00\uFF0C\u7406\u5FF5\u662F\u60C5\u8282\u7684\u5185\u6838\u548C\u8FDE\u63A5\u7EBF\u7D22\u3002",
        tooltipText: "\u60C5\u8282\u56F4\u7ED5\u62BD\u8C61\u7406\u5FF5\u5C55\u5F00\u3002",
        icon: /* @__PURE__ */ jsx2(StructureIcon, { className: "w-6 h-6" })
      },
      {
        id: "structure-10",
        type: "Structure" /* Structure */,
        name: "\u677F\u5757\u578B\u7ED3\u6784",
        description: "\u5C06\u8868\u9762\u4E92\u4E0D\u76F8\u5173\u7684\u4E8B\u4EF6\u3001\u4EBA\u7269\u3001\u573A\u666F\u5206\u522B\u7F57\u5217\uFF0C\u5F62\u6210\u72EC\u7ACB\u201C\u677F\u5757\u201D\uFF0C\u6574\u4F53\u610F\u8574\u8D85\u51FA\u5404\u90E8\u5206\u4E4B\u548C\u3002",
        tooltipText: "\u7531\u4E92\u4E0D\u76F8\u5173\u7684\u72EC\u7ACB\u677F\u5757\u6784\u6210\u3002",
        icon: /* @__PURE__ */ jsx2(StructureIcon, { className: "w-6 h-6" })
      },
      // Narrative Techniques
      {
        id: "tech-1",
        type: "Technique" /* Technique */,
        name: "\u5D4C\u5165\u5F0F\u53D9\u4E8B",
        description: "\u5728\u4E3B\u8981\u6545\u4E8B\u60C5\u8282\u4E2D\u5D4C\u5165\u5176\u4ED6\u8F83\u5C0F\u7684\u6545\u4E8B\uFF08\u6545\u4E8B\u4E2D\u7684\u6545\u4E8B\uFF09\u3002\u8FD9\u4E9B\u5D4C\u5165\u7684\u6545\u4E8B\u901A\u5E38\u5177\u6709\u8C61\u5F81\u610F\u4E49\uFF0C\u53CD\u6620\u4EBA\u7269\u7684\u5FC3\u7406\u72B6\u6001\uFF0C\u4E3A\u4E3B\u7EBF\u63D0\u4F9B\u80CC\u666F\u4FE1\u606F\uFF0C\u751A\u81F3\u5F71\u54CD\u89C2\u4F17\u5BF9\u4E3B\u8981\u60C5\u8282\u7684\u7406\u89E3\u3002\u5F53\u53D9\u8FF0\u8005\u4E0D\u53EF\u9760\u65F6\uFF0C\u8FD8\u80FD\u5F15\u53D1\u5BF9\u6545\u4E8B\u771F\u5B9E\u6027\u7684\u8D28\u7591\u3002",
        tooltipText: "\u6545\u4E8B\u4E2D\u5D4C\u5165\u5C0F\u6545\u4E8B\uFF0C\u7528\u4EE5\u8C61\u5F81\u3001\u94FA\u57AB\u6216\u5236\u9020\u60AC\u5FF5\u3002",
        icon: /* @__PURE__ */ jsx2(TechniqueIcon, { className: "w-6 h-6" })
      },
      {
        id: "tech-2",
        type: "Technique" /* Technique */,
        name: "\u6846\u67B6\u53D9\u4E8B (\u5939\u5C42\u53D9\u4E8B)",
        description: "\u4EE5\u4E00\u4E2A\u4E3B\u8981\u6545\u4E8B\u4F5C\u4E3A\u6574\u4F53\u6846\u67B6\uFF0C\u5C06\u591A\u4E2A\u76F8\u5BF9\u72EC\u7ACB\u7684\u6B21\u8981\u6545\u4E8B\u5D4C\u5165\u5176\u4E2D\u3002\u8FD9\u4E9B\u6545\u4E8B\u5728\u7EDF\u4E00\u7684\u80CC\u666F\u4E0B\u5C55\u5F00\uFF0C\u6846\u67B6\u672C\u8EAB\u4E5F\u53EF\u4F20\u9012\u4E3B\u9898\u6216\u6210\u4E3A\u9690\u55BB\uFF0C\u5982\u300A\u4E00\u5343\u96F6\u4E00\u591C\u300B\u3002",
        tooltipText: "\u4E00\u4E2A\u4E3B\u6545\u4E8B\u4F5C\u4E3A\u6846\u67B6\uFF0C\u5305\u88F9\u591A\u4E2A\u72EC\u7ACB\u7684\u5B50\u6545\u4E8B\u3002",
        icon: /* @__PURE__ */ jsx2(TechniqueIcon, { className: "w-6 h-6" })
      },
      {
        id: "tech-3",
        type: "Technique" /* Technique */,
        name: "\u5E73\u884C\u53D9\u4E8B (\u591A\u7EBF\u53D9\u4E8B)",
        description: "\u540C\u65F6\u53D9\u8FF0\u4E24\u6761\u6216\u591A\u6761\u72EC\u7ACB\u7684\u6545\u4E8B\u7EBF\uFF0C\u5B83\u4EEC\u53EF\u4EE5\u5E73\u884C\u53D1\u5C55\uFF0C\u4E5F\u53EF\u4EE5\u4EA4\u7EC7\u5F71\u54CD\uFF0C\u6700\u7EC8\u6C47\u805A\u5230\u4E00\u4E2A\u5171\u540C\u7684\u7ED3\u5C40\u3002\u5E38\u91C7\u7528\u591A\u4EBA\u7269\u89C6\u89D2\uFF0C\u589E\u52A0\u6545\u4E8B\u7684\u590D\u6742\u6027\u548C\u591A\u6837\u6027\uFF0C\u5982\u300A\u51B0\u4E0E\u706B\u4E4B\u6B4C\u300B\u3002",
        tooltipText: "\u591A\u6761\u6545\u4E8B\u7EBF\u5E73\u884C\u53D1\u5C55\uFF0C\u6700\u7EC8\u53EF\u80FD\u4EA4\u6C47\u3002",
        icon: /* @__PURE__ */ jsx2(TechniqueIcon, { className: "w-6 h-6" })
      },
      {
        id: "tech-4",
        type: "Technique" /* Technique */,
        name: "\u73AF\u5F62\u53D9\u4E8B (\u5FAA\u73AF\u53D9\u4E8B)",
        description: "\u6545\u4E8B\u7684\u7ED3\u5C3E\u4E0E\u5F00\u5934\u76F8\u547C\u5E94\uFF0C\u5F62\u6210\u95ED\u5408\u7684\u5706\u73AF\u3002\u8FD9\u79CD\u7ED3\u6784\u5E38\u901A\u8FC7\u60C5\u8282\u6216\u4E3B\u9898\u7684\u5FAA\u73AF\u6765\u8868\u73B0\u751F\u547D\u7684\u8F6E\u56DE\u4E0E\u547D\u8FD0\u611F\uFF0C\u6FC0\u53D1\u89C2\u4F17\u7684\u54F2\u5B66\u601D\u8003\uFF0C\u5982\u300A\u8001\u4EBA\u4E0E\u6D77\u300B\u3002",
        tooltipText: "\u6545\u4E8B\u7684\u7ED3\u5C3E\u4E0E\u5F00\u5934\u547C\u5E94\uFF0C\u5F62\u6210\u95ED\u73AF\uFF0C\u8868\u8FBE\u8F6E\u56DE\u4E3B\u9898\u3002",
        icon: /* @__PURE__ */ jsx2(TechniqueIcon, { className: "w-6 h-6" })
      },
      {
        id: "tech-5",
        type: "Technique" /* Technique */,
        name: "\u975E\u7EBF\u6027\u53D9\u4E8B",
        description: "\u4E0D\u9075\u5FAA\u4E25\u683C\u7684\u65F6\u95F4\u987A\u5E8F\uFF0C\u901A\u8FC7\u5012\u53D9\u3001\u63D2\u53D9\u7B49\u624B\u6CD5\u6253\u4E71\u4E8B\u4EF6\u7684\u53D9\u8FF0\u65B9\u5F0F\u3002\u8FD9\u79CD\u788E\u7247\u5316\u7684\u53D9\u4E8B\u80FD\u589E\u5F3A\u60AC\u7591\u611F\u548C\u8F6C\u6298\u6548\u679C\uFF0C\u4FC3\u4F7F\u89C2\u4F17\u4E3B\u52A8\u62FC\u51D1\u6545\u4E8B\u5168\u8C8C\uFF0C\u5982\u300A\u4F4E\u4FD7\u5C0F\u8BF4\u300B\u3002",
        tooltipText: "\u6545\u4E8B\u4E0D\u6309\u65F6\u95F4\u987A\u5E8F\u8BB2\u8FF0\uFF0C\u589E\u5F3A\u60AC\u7591\u548C\u53C2\u4E0E\u611F\u3002",
        icon: /* @__PURE__ */ jsx2(TechniqueIcon, { className: "w-6 h-6" })
      },
      {
        id: "tech-6",
        type: "Technique" /* Technique */,
        name: "\u591A\u5C42\u5D4C\u5957\u5F0F\u53D9\u4E8B",
        description: "\u5F53\u5D4C\u5165\u5F0F\u53D9\u4E8B\u5177\u6709\u591A\u5C42\u7ED3\u6784\u65F6\uFF0C\u79F0\u4E3A\u5D4C\u5957\u5F0F\u53D9\u4E8B\u3002\u6545\u4E8B\u4E2D\u5305\u542B\u591A\u4E2A\u5C42\u6B21\u7684\u53D9\u8FF0\uFF0C\u6BCF\u4E00\u5C42\u90FD\u53EF\u80FD\u5E26\u6709\u4E0D\u53EF\u9760\u6027\uFF0C\u589E\u52A0\u4E86\u4F5C\u54C1\u7684\u89E3\u8BFB\u96BE\u5EA6\uFF0C\u5982\u300A\u76D7\u68A6\u7A7A\u95F4\u300B\u7684\u591A\u5C42\u68A6\u5883\u3002",
        tooltipText: "\u591A\u5C42\u201C\u6545\u4E8B\u4E2D\u7684\u6545\u4E8B\u201D\uFF0C\u5C42\u5C42\u9012\u8FDB\uFF0C\u589E\u52A0\u590D\u6742\u6027\u3002",
        icon: /* @__PURE__ */ jsx2(TechniqueIcon, { className: "w-6 h-6" })
      },
      // Endings
      {
        id: "ending-1",
        type: "Ending" /* Ending */,
        name: "\u53CD\u8BBD\u7ED3\u5C40",
        description: "\u5DE7\u5999\u8FD0\u7528\u53CD\u8BBD\u3001\u5938\u5F20\u548C\u5E7D\u9ED8\u624B\u6CD5\uFF0C\u4F7F\u6545\u4E8B\u66F4\u5177\u8DA3\u5473\u6027\u548C\u6DF1\u610F\u3002\u53CD\u8BBD\u8868\u73B0\u4E3A\u6545\u4E8B\u60C5\u8282\u4E0E\u9884\u671F\u76F8\u53CD\uFF0C\u589E\u5F3A\u4E86\u6545\u4E8B\u7684\u620F\u5267\u6548\u679C\uFF1B\u5938\u5F20\u5219\u7528\u4EE5\u7A81\u51FA\u4EBA\u7269\u7684\u6027\u683C\u6216\u60C5\u5883\u7684\u8352\u8BDE\u6027\uFF1B\u5E7D\u9ED8\u5219\u7F13\u89E3\u6545\u4E8B\u7684\u7D27\u5F20\u6C1B\u56F4\u3002\u8FD9\u4E9B\u624B\u6CD5\u5171\u540C\u4F5C\u7528\uFF0C\u6700\u7EC8\u4EE5\u4E00\u4E2A\u5177\u6709\u8BBD\u523A\u610F\u5473\u7684\u8F6C\u6298\u6536\u5C3E\u3002",
        tooltipText: "\u8FD0\u7528\u53CD\u8BBD\u3001\u5938\u5F20\u548C\u5E7D\u9ED8\u7684\u610F\u5916\u8F6C\u6298\u3002",
        icon: /* @__PURE__ */ jsx2(EndingIcon, { className: "w-6 h-6" })
      },
      {
        id: "ending-2",
        type: "Ending" /* Ending */,
        name: "\u5584\u54C9",
        description: "\u5584\u54C9\uFF08Eucatastrophe\uFF09\u662F\u6258\u5C14\u91D1\u63D0\u51FA\u7684\u6982\u5FF5\uFF0C\u5E38\u89C1\u4E8E\u7AE5\u8BDD\u6545\u4E8B\u4E2D\uFF0C\u6307\u7684\u662F\u7A81\u7136\u7684\u5E78\u798F\u8F6C\u6298\uFF0C\u4F7F\u4EBA\u559C\u6781\u800C\u6CE3\u3002\u8FD9\u79CD\u8F6C\u6298\u901A\u5E38\u53D1\u751F\u5728\u770B\u4F3C\u7EDD\u671B\u6216\u65E0\u6CD5\u9006\u8F6C\u7684\u5C40\u9762\u4E2D\uFF0C\u5E26\u6765\u610F\u60F3\u4E0D\u5230\u7684\u80DC\u5229\u6216\u6551\u8D4E\uFF0C\u5E26\u6765\u6170\u85C9\u548C\u5E0C\u671B\u3002",
        tooltipText: "\u7EDD\u671B\u4E2D\u7A81\u7136\u51FA\u73B0\u7684\u5E78\u798F\u8F6C\u6298\u3002",
        icon: /* @__PURE__ */ jsx2(EndingIcon, { className: "w-6 h-6" })
      },
      {
        id: "ending-3",
        type: "Ending" /* Ending */,
        name: "\u5947\u8FF9\u6069\u5178",
        description: "\u7AE5\u8BDD\u6545\u4E8B\u7684\u5584\u54C9\u5143\u7D20\u5728\u4E8E\u8D85\u8D8A\u73B0\u5B9E\u7684\u5947\u8FF9\u548C\u6069\u5178\u3002\u65E0\u8BBA\u60C5\u8282\u591A\u4E48\u8352\u8BDE\u6216\u6050\u6016\uFF0C\u5947\u8FF9\u7684\u51FA\u73B0\u90FD\u80FD\u5E26\u6765\u5E0C\u671B\u548C\u6551\u8D4E\uFF0C\u4F53\u73B0\u4E86\u6545\u4E8B\u4E2D\u6DF1\u5C42\u6B21\u7684\u795E\u6027\u6697\u793A\uFF0C\u800C\u975E\u673A\u68B0\u964D\u795E\u3002",
        tooltipText: "\u8D85\u8D8A\u73B0\u5B9E\u7684\u5947\u8FF9\u4E0E\u6551\u8D4E\u3002",
        icon: /* @__PURE__ */ jsx2(EndingIcon, { className: "w-6 h-6" })
      },
      {
        id: "ending-4",
        type: "Ending" /* Ending */,
        name: "\u673A\u68B0\u964D\u795E",
        description: "\u673A\u68B0\u964D\u795E\uFF08Deus Ex Machina\uFF09\u6307\u6545\u4E8B\u4E2D\u7A81\u7136\u51FA\u73B0\u7684\u3001\u7F3A\u4E4F\u5408\u7406\u94FA\u57AB\u7684\u8D85\u81EA\u7136\u6551\u63F4\u3002\u8FD9\u79CD\u624B\u6CD5\u867D\u7136\u80FD\u89E3\u51B3\u5371\u673A\uFF0C\u4F46\u53EF\u80FD\u7834\u574F\u6545\u4E8B\u7684\u5185\u90E8\u903B\u8F91\u548C\u771F\u5B9E\u6027\uFF0C\u663E\u5F97\u5EC9\u4EF7\u548C\u7A81\u5140\u3002",
        tooltipText: "\u7F3A\u4E4F\u94FA\u57AB\u7684\u8D85\u81EA\u7136\u6551\u63F4\u3002",
        icon: /* @__PURE__ */ jsx2(EndingIcon, { className: "w-6 h-6" })
      },
      {
        id: "ending-5",
        type: "Ending" /* Ending */,
        name: "\u73AF\u5F62\u7ED3\u5C40",
        description: "\u6545\u4E8B\u91C7\u7528\u5706\u5F62\u7ED3\u6784\uFF0C\u5373\u6545\u4E8B\u7684\u7ED3\u5C3E\u56DE\u5230\u5F00\u5934\uFF0C\u5F62\u6210\u95ED\u73AF\u3002\u8FD9\u79CD\u53D9\u4E8B\u65B9\u5F0F\u5F3A\u8C03\u65E0\u9650\u8F6E\u56DE\u6216\u5FAA\u73AF\u4E0D\u5DF2\u7684\u4E3B\u9898\uFF0C\u5373\u4F7F\u89D2\u8272\u56DE\u5230\u539F\u70B9\uFF0C\u5176\u7CBE\u795E\u8F68\u8FF9\u4E5F\u5DF2\u53D1\u751F\u672C\u8D28\u53D8\u5316\uFF0C\u8D4B\u4E88\u53D9\u4E8B\u54F2\u601D\u610F\u5473\u3002",
        tooltipText: "\u6545\u4E8B\u7684\u7ED3\u5C3E\u56DE\u5230\u5F00\u5934\u5F62\u6210\u95ED\u73AF\u3002",
        icon: /* @__PURE__ */ jsx2(EndingIcon, { className: "w-6 h-6" })
      },
      {
        id: "ending-6",
        type: "Ending" /* Ending */,
        name: "\u65E0\u9650\u8F6E\u56DE",
        description: "\u91C7\u7528\u73AF\u5F62\u548C\u65E0\u9650\u7684\u53D9\u4E8B\u7ED3\u6784\u63A2\u7D22\u54F2\u5B66\u601D\u60F3\uFF0C\u5982\u8FF7\u5BAB\u8C61\u5F81\u65E0\u9650\u53EF\u80FD\u6027\u548C\u65F6\u95F4\u7684\u5FAA\u73AF\u3002\u6545\u4E8B\u6311\u6218\u4F20\u7EDF\u7EBF\u6027\u53D9\u4E8B\uFF0C\u901A\u8FC7\u8BA9\u6700\u540E\u4E00\u9875\u4E0E\u7B2C\u4E00\u9875\u76F8\u540C\u6765\u5B9E\u73B0\u65E0\u9650\u5FAA\u73AF\uFF0C\u5E26\u6765\u6DF1\u523B\u7684\u54F2\u5B66\u53CD\u601D\u3002",
        tooltipText: "\u63A2\u7D22\u65E0\u9650\u53EF\u80FD\u6027\u4E0E\u65F6\u95F4\u5FAA\u73AF\u3002",
        icon: /* @__PURE__ */ jsx2(EndingIcon, { className: "w-6 h-6" })
      },
      {
        id: "ending-7",
        type: "Ending" /* Ending */,
        name: "\u5F00\u653E\u5F0F\u7ED3\u5C40",
        description: "\u5F00\u653E\u5F0F\u7ED3\u5C40\u662F\u4E00\u79CD\u4E0D\u660E\u786E\u3001\u591A\u91CD\u53EF\u80FD\u6027\u7684\u7ED3\u5C40\uFF0C\u5141\u8BB8\u8BFB\u8005\u6216\u89C2\u4F17\u81EA\u884C\u89E3\u8BFB\u3002\u8FD9\u79CD\u6A21\u7CCA\u7684\u7ED3\u5C40\u6FC0\u53D1\u89C2\u4F17\u7684\u597D\u5947\u5FC3\u548C\u601D\u8003\u6B32\u671B\uFF0C\u589E\u52A0\u6545\u4E8B\u7684\u6DF1\u5EA6\u3002",
        tooltipText: "\u7ED3\u5C40\u4E0D\u660E\u786E\uFF0C\u5141\u8BB8\u591A\u91CD\u89E3\u8BFB\u3002",
        icon: /* @__PURE__ */ jsx2(EndingIcon, { className: "w-6 h-6" })
      },
      {
        id: "ending-8",
        type: "Ending" /* Ending */,
        name: "\u60AC\u5FF5\u7ED3\u5C40",
        description: "\u5F00\u653E\u5F0F\u7ED3\u5C40\u7684\u4F18\u70B9\u5728\u4E8E\u7ED9\u4E88\u89C2\u4F17\u66F4\u5927\u7684\u81EA\u7531\u7A7A\u95F4\uFF0C\u4F46\u4E5F\u53EF\u80FD\u5BFC\u81F4\u89C2\u4F17\u5BF9\u7ED3\u5C40\u4E89\u8BBA\u4E0D\u4F11\u751A\u81F3\u4E0D\u6EE1\u3002\u4F8B\u5982\uFF0C\u7535\u5F71\u4E2D\u5E38\u7528\u7684\u60AC\u5FF5\u7ED3\u5C40\uFF0C\u5728\u6CA1\u6709\u540E\u7EED\u89E3\u91CA\u7684\u60C5\u51B5\u4E0B\uFF0C\u53EF\u80FD\u8BA9\u4EBA\u611F\u5230\u7A7A\u6D1E\u6216\u56F0\u60D1\u3002",
        tooltipText: "\u7ED3\u5C40\u60AC\u800C\u672A\u51B3\uFF0C\u5F15\u53D1\u4E89\u8BAE\u3002",
        icon: /* @__PURE__ */ jsx2(EndingIcon, { className: "w-6 h-6" })
      },
      {
        id: "ending-9",
        type: "Ending" /* Ending */,
        name: "\u5047\u7ED3\u5C40",
        description: "\u5047\u7ED3\u5C40\u6307\u5728\u6545\u4E8B\u63A5\u8FD1\u5C3E\u58F0\u65F6\uFF0C\u8BEF\u5BFC\u89C2\u4F17\u6216\u8BFB\u8005\u4EE5\u4E3A\u6545\u4E8B\u5DF2\u7ECF\u7ED3\u675F\uFF0C\u5B9E\u9645\u4E0A\u5371\u673A\u5C1A\u672A\u89E3\u51B3\u3002\u8FD9\u79CD\u624B\u6CD5\u80FD\u5236\u9020\u7D27\u5F20\u611F\u548C\u53CD\u8F6C\u6548\u679C\uFF0C\u589E\u5F3A\u6545\u4E8B\u7684\u620F\u5267\u6027\uFF0C\u5E38\u7528\u4E8E\u6050\u6016\u548C\u60CA\u609A\u9898\u6750\u3002",
        tooltipText: "\u8BEF\u5BFC\u89C2\u4F17\u4EE5\u4E3A\u6545\u4E8B\u7ED3\u675F\u7684\u8F6C\u6298\u3002",
        icon: /* @__PURE__ */ jsx2(EndingIcon, { className: "w-6 h-6" })
      }
    ];
  }
});

// services/aiService.ts
var aiService_exports = {};
__export(aiService_exports, {
  fetchModels: () => fetchModels,
  generateCardDetails: () => generateCardDetails,
  generateChatResponse: () => generateChatResponse,
  generateOutline: () => generateOutline,
  polishOutline: () => polishOutline
});
import { GoogleGenAI } from "@google/genai";
async function* generateWithGemini(promptOrMessages, config, signal) {
  const apiKey = config.apiKey || process.env.API_KEY;
  if (!apiKey) {
    throw new Error("Gemini API \u5BC6\u94A5\u672A\u914D\u7F6E\u3002\u8BF7\u5728\u201C\u8BBE\u7F6E\u201D\u9875\u9762\u4E2D\u63D0\u4F9B\u60A8\u7684\u5BC6\u94A5\u3002");
  }
  const ai = new GoogleGenAI({ apiKey });
  if (!config.model) {
    throw new Error("Gemini model name is not configured.");
  }
  const modelName = config.model;
  const generationConfig = {};
  if (config.temperature !== void 0) generationConfig.temperature = config.temperature;
  if (config.topP !== void 0) generationConfig.topP = config.topP;
  if (config.maxTokens !== void 0) {
    generationConfig.maxOutputTokens = config.maxTokens;
    generationConfig.thinkingConfig = { thinkingBudget: Math.floor(config.maxTokens / 4) };
  }
  const messages = typeof promptOrMessages === "string" ? [{ role: "user", content: promptOrMessages }] : promptOrMessages;
  const contents = messages.map((msg) => {
    const parts = [];
    if (msg.content) {
      parts.push({ text: msg.content });
    }
    if (msg.images) {
      msg.images.forEach((imgData) => {
        const mimeType = imgData.startsWith("/9j/") ? "image/jpeg" : "image/png";
        parts.push({
          inlineData: {
            mimeType,
            data: imgData
          }
        });
      });
    }
    return {
      role: msg.role === "model" ? "model" : "user",
      parts
    };
  });
  if (config.streaming) {
    const response = await ai.models.generateContentStream({
      model: modelName,
      contents,
      config: generationConfig
    });
    for await (const chunk of response) {
      if (signal?.aborted) throw new DOMException("Aborted by user", "AbortError");
      const chunkText = chunk.text;
      if (chunkText) {
        yield chunkText;
      }
    }
  } else {
    if (signal?.aborted) throw new DOMException("Aborted by user", "AbortError");
    const response = await ai.models.generateContent({
      model: modelName,
      contents,
      config: generationConfig
    });
    if (signal?.aborted) throw new DOMException("Aborted by user", "AbortError");
    if (!response.text) {
      throw new Error("API returned an empty response.");
    }
    yield response.text.trim();
  }
}
async function* generateWithOpenAICompatible(promptOrMessages, config, signal) {
  const providersThatNeedKey = ["openai", "deepseek", "openrouter", "siliconflow", "modelscope"];
  if (providersThatNeedKey.includes(config.provider) && !config.apiKey) {
    throw new Error(`API key is required for the ${config.provider} provider.`);
  }
  if (!config.endpoint) throw new Error("Endpoint URL is missing.");
  if (!config.model) throw new Error("Model name is missing.");
  const endpoint = getEndpoint(config.endpoint, "chat");
  const headers = { "Content-Type": "application/json" };
  if (config.apiKey) {
    headers["Authorization"] = `Bearer ${config.apiKey}`;
  }
  const body = {
    model: config.model
  };
  const messages = typeof promptOrMessages === "string" ? [{ role: "user", content: promptOrMessages }] : promptOrMessages;
  const preparedMessages = messages.map((msg) => {
    const role = msg.role === "model" ? "assistant" : msg.role;
    if (!msg.images || msg.images.length === 0) {
      return { role, content: msg.content };
    }
    const contentParts = [{ type: "text", text: msg.content }];
    msg.images.forEach((imgData) => {
      const mimeType = imgData.startsWith("/9j/") ? "image/jpeg" : "image/png";
      contentParts.push({
        type: "image_url",
        image_url: { url: `data:${mimeType};base64,${imgData}` }
      });
    });
    return { role, content: contentParts };
  });
  body.messages = preparedMessages;
  if (config.temperature !== void 0) body.temperature = config.temperature;
  if (config.maxTokens !== void 0) body.max_tokens = config.maxTokens;
  if (config.topP !== void 0) body.top_p = config.topP;
  if (config.provider !== "modelscope") {
    if (config.frequencyPenalty !== void 0) body.frequency_penalty = config.frequencyPenalty;
    if (config.presencePenalty !== void 0) body.presence_penalty = config.presencePenalty;
  }
  if (config.streaming) {
    body.stream = true;
    const response = await fetch(endpoint, { method: "POST", headers, body: JSON.stringify(body), signal });
    if (!response.ok || !response.body) {
      let errorData;
      try {
        errorData = await response.json();
      } catch (e) {
        throw new Error(`API error (${response.status}): ${response.statusText}`);
      }
      throw new Error(`API error (${response.status}): ${errorData.error?.message || "Unknown error"}`);
    }
    const reader = response.body.getReader();
    const decoder = new TextDecoder();
    let buffer = "";
    while (true) {
      const { done, value } = await reader.read();
      if (done) break;
      if (signal?.aborted) {
        await reader.cancel();
        throw new DOMException("Aborted by user", "AbortError");
      }
      buffer += decoder.decode(value, { stream: true });
      const lines = buffer.split("\n");
      buffer = lines.pop() || "";
      for (const line of lines) {
        if (line.startsWith("data: ")) {
          const dataStr = line.substring(6);
          if (dataStr.trim() === "[DONE]") return;
          try {
            const data = JSON.parse(dataStr);
            const content = data.choices?.[0]?.delta?.content;
            if (content) {
              yield content;
            }
          } catch (e) {
          }
        }
      }
    }
  } else {
    const response = await fetch(endpoint, { method: "POST", headers, body: JSON.stringify(body), signal });
    if (!response.ok) {
      let errorData;
      try {
        errorData = await response.json();
      } catch (e) {
        throw new Error(`API error (${response.status}): ${response.statusText}`);
      }
      throw new Error(`API error (${response.status}): ${errorData.error?.message || "Unknown error"}`);
    }
    const data = await response.json();
    const content = data.choices?.[0]?.message?.content;
    if (!content) {
      throw new Error("API returned an invalid response structure.");
    }
    yield content.trim();
  }
}
async function* generateOutline(cards, config, novelInfo) {
  const activePrompt = config.prompts.find((p) => p.id === config.activePromptId) || config.prompts[0];
  if (!activePrompt) {
    throw new Error("No active prompt template found. Please check your settings.");
  }
  const prompt2 = createPrompt(cards, activePrompt.content, novelInfo);
  const openAICompatibleProviders = ["openai", "deepseek", "openrouter", "siliconflow", "ollama", "custom", "modelscope"];
  try {
    if (config.provider === "gemini") {
      yield* generateWithGemini(prompt2, config);
    } else if (openAICompatibleProviders.includes(config.provider)) {
      yield* generateWithOpenAICompatible(prompt2, config);
    } else {
      throw new Error(`Unsupported AI provider: ${config.provider}`);
    }
  } catch (error) {
    console.error(`Error generating outline with ${config.provider} API:`, error);
    if (error instanceof Error) {
      let detailedMessage = `\u751F\u6210\u6545\u4E8B\u5927\u7EB2\u5931\u8D25: ${error.message}`;
      if (error.message.includes("Failed to fetch")) {
        detailedMessage += "\n\n\u8FD9\u901A\u5E38\u662F\u7531\u4E8E\u4EE5\u4E0B\u539F\u56E0\u4E4B\u4E00\u9020\u6210\u7684\uFF1A\n1. **\u7F51\u7EDC\u8FDE\u63A5\u95EE\u9898**\uFF1A\u8BF7\u68C0\u67E5\u60A8\u7684\u7F51\u7EDC\u8FDE\u63A5\u4EE5\u53CA\u80FD\u5426\u8BBF\u95EE\u76EE\u6807 Endpoint URL\u3002\n2. **CORS \u8DE8\u57DF\u95EE\u9898**\uFF1A\u5982\u679C\u60A8\u6B63\u5728\u4F7F\u7528\u672C\u5730\u6216\u81EA\u5B9A\u4E49 API\uFF0C\u8BF7\u786E\u4FDD\u670D\u52A1\u5668\u5DF2\u6B63\u786E\u914D\u7F6E CORS \u7B56\u7565\uFF0C\u5141\u8BB8\u6765\u81EA\u5F53\u524D\u7F51\u9875\u7684\u8BF7\u6C42\u3002\n3. **Endpoint URL \u9519\u8BEF**\uFF1A\u8BF7\u68C0\u67E5\u60A8\u5728\u8BBE\u7F6E\u4E2D\u586B\u5199\u7684 Endpoint URL \u662F\u5426\u6B63\u786E\uFF0C\u5305\u62EC\u534F\u8BAE (http/https) \u548C\u7AEF\u53E3\u3002";
      }
      throw new Error(detailedMessage);
    }
    throw new Error(`\u751F\u6210\u6545\u4E8B\u5927\u7EB2\u5931\u8D25\u3002\u8BF7\u68C0\u67E5\u60A8\u7684 API \u8BBE\u7F6E\u540E\u91CD\u8BD5\u3002`);
  }
}
async function* polishOutline(currentOutline, userMessage, config, signal) {
  const polishPrompt = `\u4F60\u662F\u4E00\u4F4D\u4E13\u4E1A\u7684\u5C0F\u8BF4\u5199\u4F5C\u52A9\u7406\u3002\u4F60\u7684\u4EFB\u52A1\u662F\u6839\u636E\u7528\u6237\u7684\u6307\u793A\u6765\u4FEE\u6539\u4E00\u4EFD\u6545\u4E8B\u5927\u7EB2\u3002

\u8FD9\u662F\u5F53\u524D\u7684\u5927\u7EB2\u5185\u5BB9\uFF08Markdown\u683C\u5F0F\uFF09\uFF1A
---
${currentOutline}
---

\u7528\u6237\u7684\u4FEE\u6539\u8981\u6C42\u662F\uFF1A
"${userMessage}"

\u8BF7\u63D0\u4F9B\u5B8C\u6574\u3001\u4FEE\u8BA2\u540E\u7684\u5C0F\u8BF4\u5927\u7EB2\uFF0C\u5E76\u4FDD\u6301 Markdown \u683C\u5F0F\u3002\u4E0D\u8981\u5728\u7EB2\u8981\u4E4B\u5916\u6DFB\u52A0\u4EFB\u4F55\u8BC4\u8BBA\u6216\u89E3\u91CA\u3002\u53EA\u8FD4\u56DE\u66F4\u65B0\u540E\u7684\u5B8C\u6574 Markdown \u5185\u5BB9\u3002`;
  const openAICompatibleProviders = ["openai", "deepseek", "openrouter", "siliconflow", "ollama", "custom", "modelscope"];
  try {
    if (config.provider === "gemini") {
      yield* generateWithGemini(polishPrompt, config, signal);
    } else if (openAICompatibleProviders.includes(config.provider)) {
      yield* generateWithOpenAICompatible(polishPrompt, config, signal);
    } else {
      throw new Error(`Unsupported AI provider: ${config.provider}`);
    }
  } catch (error) {
    console.error(`Error polishing outline with ${config.provider} API:`, error);
    if (error instanceof Error) {
      let detailedMessage = `AI \u6DA6\u8272\u5931\u8D25: ${error.message}`;
      if (error.message.includes("Failed to fetch")) {
        detailedMessage += "\n\n\u8BF7\u68C0\u67E5\u60A8\u7684\u7F51\u7EDC\u8FDE\u63A5\u548C AI Endpoint \u8BBE\u7F6E\u3002";
      }
      throw new Error(detailedMessage);
    }
    throw new Error(`AI \u6DA6\u8272\u5931\u8D25\u3002\u8BF7\u68C0\u67E5\u60A8\u7684 API \u8BBE\u7F6E\u540E\u91CD\u8BD5\u3002`);
  }
}
async function* generateChatResponse(chatHistory, config, signal) {
  const openAICompatibleProviders = ["openai", "deepseek", "openrouter", "siliconflow", "ollama", "custom", "modelscope"];
  const chatConfig = { ...config, model: config.assistantModel || config.model };
  try {
    if (chatConfig.provider === "gemini") {
      yield* generateWithGemini(chatHistory, chatConfig, signal);
    } else if (openAICompatibleProviders.includes(chatConfig.provider)) {
      yield* generateWithOpenAICompatible(chatHistory, chatConfig, signal);
    } else {
      throw new Error(`Unsupported AI provider: ${chatConfig.provider}`);
    }
  } catch (error) {
    console.error(`Error in chat response with ${chatConfig.provider} API:`, error);
    if (error instanceof Error) {
      let detailedMessage = `AI \u804A\u5929\u5931\u8D25: ${error.message}`;
      if (error.message.includes("Failed to fetch")) {
        detailedMessage += "\n\n\u8BF7\u68C0\u67E5\u60A8\u7684\u7F51\u7EDC\u8FDE\u63A5\u548C AI Endpoint \u8BBE\u7F6E\u3002";
      }
      throw new Error(detailedMessage);
    }
    throw new Error(`AI \u804A\u5929\u5931\u8D25\u3002\u8BF7\u68C0\u67E5\u60A8\u7684 API \u8BBE\u7F6E\u540E\u91CD\u8BD5\u3002`);
  }
}
async function generateCardDetails(cardName, cardType, config) {
  if (!cardName.trim()) {
    throw new Error("Card name cannot be empty.");
  }
  const cardTypeName = CARD_TYPE_NAMES[cardType];
  const prompt2 = `\u4F60\u662F\u4E00\u4F4D\u4E13\u4E1A\u7684\u521B\u610F\u5199\u4F5C\u548C\u6545\u4E8B\u7406\u8BBA\u4E13\u5BB6\u3002\u8BF7\u4E3A\u4E00\u4E2A\u5199\u4F5C\u63D0\u793A\u5361\u7247\u751F\u6210\u4E24\u6BB5\u6587\u672C\uFF0C\u5361\u7247\u7C7B\u578B\u4E3A\u201C${cardTypeName}\u201D\uFF0C\u540D\u79F0\u4E3A\u201C${cardName}\u201D\uFF1A

1.  **tooltipText**: \u4E00\u53E5\u7B80\u660E\u627C\u8981\u7684\u603B\u7ED3\uFF08\u5C11\u4E8E20\u4E2A\u6C49\u5B57\uFF09\uFF0C\u89E3\u91CA\u5361\u7247\u7684\u6838\u5FC3\u6982\u5FF5\u3002
2.  **description**: \u4E00\u6BB5\u8BE6\u7EC6\u7684\u8BF4\u660E\uFF08\u5927\u7EA650-80\u6C49\u5B57\uFF09\uFF0C\u8FD9\u6BB5\u5185\u5BB9\u5C06\u4F5C\u4E3AAI\u751F\u6210\u6545\u4E8B\u5927\u7EB2\u7684\u66F4\u5927\u63D0\u793A\u8BCD\uFF08prompt\uFF09\u7684\u4E00\u90E8\u5206\u3002\u8FD9\u6BB5\u63CF\u8FF0\u5E94\u8BE5\u5BF9AI\u5177\u6709\u542F\u53D1\u6027\u548C\u6307\u5BFC\u6027\u3002

\u8BF7\u4E25\u683C\u6309\u7167\u4EE5\u4E0BJSON\u683C\u5F0F\u63D0\u4F9B\u8F93\u51FA\uFF0C\u4E0D\u8981\u5305\u542B\u4EFB\u4F55markdown\u6807\u8BB0\u6216\u989D\u5916\u7684\u89E3\u91CA\uFF1A
{
  "tooltipText": "...",
  "description": "..."
}`;
  const getFullResponse = async (prompt3, config2) => {
    const openAICompatibleProviders = ["openai", "deepseek", "openrouter", "siliconflow", "ollama", "custom", "modelscope"];
    const nonStreamingConfig = { ...config2, streaming: false };
    let stream;
    if (nonStreamingConfig.provider === "gemini") {
      stream = generateWithGemini(prompt3, nonStreamingConfig);
    } else if (openAICompatibleProviders.includes(nonStreamingConfig.provider)) {
      stream = generateWithOpenAICompatible(prompt3, nonStreamingConfig);
    } else {
      throw new Error(`Unsupported AI provider: ${nonStreamingConfig.provider}`);
    }
    const { value } = await stream.next();
    return value || "";
  };
  try {
    const responseText = await getFullResponse(prompt2, config);
    const cleanedResponse = responseText.replace(/```json/g, "").replace(/```/g, "").trim();
    const parsed = JSON.parse(cleanedResponse);
    if (typeof parsed.tooltipText === "string" && typeof parsed.description === "string") {
      return parsed;
    } else {
      throw new Error("AI response did not contain the expected JSON structure.");
    }
  } catch (error) {
    console.error("Failed to generate or parse card details from AI:", error);
    throw new Error(`AI\u751F\u6210\u5361\u7247\u8BE6\u60C5\u5931\u8D25: ${error instanceof Error ? error.message : "\u8BF7\u68C0\u67E5\u7F51\u7EDC\u548CAI\u8BBE\u7F6E\u3002"}`);
  }
}
var createPrompt, getEndpoint, fetchModels;
var init_aiService = __esm({
  "services/aiService.ts"() {
    init_types();
    init_constants();
    createPrompt = (cards, customPrompt, novelInfo) => {
      const formatCards = (cardType) => {
        const cardArray = cards[cardType];
        if (!cardArray || cardArray.every((c) => c === null)) return "";
        const validCards = cardArray.filter((c) => c !== null);
        if (validCards.length === 0) return "";
        if (cardType === "Character" /* Character */) {
          const names = validCards.map((c) => `\u300C${c.name}\u300D`).join("\u548C");
          const descs = validCards.map((c) => `(${c.description})`).join("; ");
          return `- \u89D2\u8272\u521B\u4F5C\u6307\u5BFC (Character Archetype Guide): \u8FD9\u662F\u521B\u4F5C\u89D2\u8272\u7684\u6838\u5FC3\u6982\u5FF5\uFF0C\u8BF7\u57FA\u4E8E${names}${descs}\u7684\u7279\u8D28\uFF0C\u8BBE\u8BA1\u4E00\u4E2A\u6216\u591A\u4E2A\u72EC\u7279\u7684\u3001\u6709\u8840\u6709\u8089\u7684\u89D2\u8272\u3002\u8BF7\u6CE8\u610F\uFF0C\u8FD9\u53EA\u662F\u4E00\u4E2A\u521B\u4F5C\u6307\u5F15\uFF0C\u4E25\u7981\u5728\u6545\u4E8B\u4E2D\u76F4\u63A5\u4F7F\u7528\u539F\u578B\u540D\u79F0\u4F5C\u4E3A\u89D2\u8272\u7684\u540D\u5B57\u6216\u8EAB\u4EFD\u3002`;
        }
        const cardStrings = validCards.map((c) => `${c.name} (${c.description})`);
        const title = CARD_TYPE_NAMES[cardType];
        return `- ${title}: ${cardStrings.join(" | ")}`;
      };
      const promptParts = [
        formatCards("Theme" /* Theme */),
        formatCards("Genre" /* Genre */),
        formatCards("Character" /* Character */),
        formatCards("Plot" /* Plot */),
        formatCards("Structure" /* Structure */),
        formatCards("Technique" /* Technique */),
        formatCards("Ending" /* Ending */),
        formatCards("Inspiration" /* Inspiration */)
      ].filter(Boolean);
      const novelInfoParts = [];
      if (novelInfo.name) novelInfoParts.push(`- \u5C0F\u8BF4\u540D\u79F0: ${novelInfo.name}`);
      if (novelInfo.channel) novelInfoParts.push(`- \u4E66\u7C4D\u9891\u9053: ${novelInfo.channel === "male" ? "\u7537\u9891" : "\u5973\u9891"}`);
      if (novelInfo.emotion && novelInfo.emotion !== "\u65E0") novelInfoParts.push(`- \u6838\u5FC3\u60C5\u7EEA: ${novelInfo.emotion}`);
      if (novelInfo.wordCount) novelInfoParts.push(`- \u9884\u4F30\u5B57\u6570: ${novelInfo.wordCount}`);
      if (novelInfo.perspective) novelInfoParts.push(`- \u53D9\u4E8B\u89C6\u89D2: ${novelInfo.perspective}`);
      if (novelInfo.synopsis) novelInfoParts.push(`- \u4E00\u53E5\u8BDD\u6982\u8981: ${novelInfo.synopsis}`);
      const novelInfoSection = novelInfoParts.length > 0 ? `
\u8BF7\u540C\u65F6\u53C2\u8003\u4EE5\u4E0B\u5C0F\u8BF4\u57FA\u672C\u4FE1\u606F\uFF1A
${novelInfoParts.join("\n")}` : "";
      return `
${customPrompt}
${novelInfoSection}

\u8BF7\u57FA\u4E8E\u4EE5\u4E0B\u6545\u4E8B\u6838\u5FC3\u8981\u7D20\u8FDB\u884C\u521B\u4F5C\uFF1A
${promptParts.join("\n")}
`;
    };
    getEndpoint = (url, path) => {
      const trimmedUrl = url.trim().replace(/\/+$/, "");
      const finalPath = path === "chat" ? "/v1/chat/completions" : "/v1/models";
      if (trimmedUrl.endsWith("/v1")) {
        return `${trimmedUrl}/${path === "chat" ? "chat/completions" : "models"}`;
      }
      if (trimmedUrl.includes("/api/v1")) {
        return `${trimmedUrl}/${path === "chat" ? "chat/completions" : "models"}`;
      }
      if (trimmedUrl.endsWith(finalPath)) {
        return trimmedUrl;
      }
      return `${trimmedUrl}${finalPath}`;
    };
    fetchModels = async (config) => {
      if (config.provider === "gemini") {
        const apiKey = config.apiKey || process.env.API_KEY;
        if (!apiKey) {
          throw new Error("Gemini API \u5BC6\u94A5\u672A\u914D\u7F6E\u3002");
        }
        if (!config.endpoint) {
          throw new Error("Gemini Endpoint URL is not configured.");
        }
        const endpoint2 = `${config.endpoint.trim().replace(/\/+$/, "")}/v1beta/models`;
        try {
          const response = await fetch(endpoint2, {
            method: "GET",
            headers: {
              "x-goog-api-key": apiKey
            }
          });
          if (!response.ok) {
            let errorData;
            try {
              errorData = await response.json();
            } catch (e) {
              throw new Error(`API \u8FD4\u56DE\u72B6\u6001 ${response.status}: ${response.statusText}`);
            }
            throw new Error(`\u83B7\u53D6 Gemini \u6A21\u578B\u5217\u8868\u5931\u8D25 (\u72B6\u6001 ${response.status}): ${errorData.error?.message || "\u8BF7\u68C0\u67E5 Endpoint URL \u548C API \u5BC6\u94A5\u3002"}`);
          }
          const data = await response.json();
          if (!data.models) {
            throw new Error("\u4ECE Gemini API \u83B7\u53D6\u6A21\u578B\u65F6\u8FD4\u56DE\u4E86\u65E0\u6548\u7684\u54CD\u5E94\u3002");
          }
          const models = data.models.filter(
            (model) => model.supportedGenerationMethods?.includes("generateContent") && !model.name.includes("embedding") && !model.name.includes("text-bison")
            // filter out legacy models
          ).map((model) => model.name.replace("models/", "")).sort();
          return models;
        } catch (error) {
          console.error(`Failed to fetch models from Gemini:`, error);
          if (error instanceof Error) {
            let detailedMessage = `\u83B7\u53D6\u6A21\u578B\u5217\u8868\u5931\u8D25: ${error.message}`;
            if (error.message.includes("Failed to fetch")) {
              detailedMessage += "\n\n\u8BF7\u68C0\u67E5\u60A8\u7684\u7F51\u7EDC\u8FDE\u63A5\u3001Endpoint URL \u662F\u5426\u6B63\u786E\uFF0C\u4EE5\u53CA API \u5BC6\u94A5\u662F\u5426\u6709\u6548\u3002";
            }
            throw new Error(detailedMessage);
          }
          throw new Error("\u83B7\u53D6\u6A21\u578B\u5217\u8868\u65F6\u53D1\u751F\u672A\u77E5\u7F51\u7EDC\u9519\u8BEF\u3002");
        }
      }
      if (!config.endpoint) {
        throw new Error("Endpoint URL \u4E0D\u80FD\u4E3A\u7A7A\u3002");
      }
      const endpoint = config.provider === "ollama" ? `${config.endpoint.trim().replace(/\/+$/, "")}/api/tags` : getEndpoint(config.endpoint, "models");
      const headers = { "Content-Type": "application/json" };
      if (config.provider !== "ollama" && config.apiKey) {
        headers["Authorization"] = `Bearer ${config.apiKey}`;
      }
      try {
        const response = await fetch(endpoint, { method: "GET", headers });
        if (!response.ok) {
          let errorData;
          try {
            errorData = await response.json();
          } catch (e) {
            throw new Error(`API \u8FD4\u56DE\u72B6\u6001 ${response.status}: ${response.statusText}`);
          }
          throw new Error(`\u83B7\u53D6\u6A21\u578B\u5217\u8868\u5931\u8D25 (\u72B6\u6001 ${response.status}): ${errorData.error?.message || "\u8BF7\u68C0\u67E5 Endpoint URL\u3002"}`);
        }
        const data = await response.json();
        if (config.provider === "ollama") {
          return data.models?.map((model) => model.name) || [];
        } else {
          return data.data?.map((model) => model.id).sort() || [];
        }
      } catch (error) {
        console.error(`Failed to fetch models from ${config.endpoint}:`, error);
        if (error instanceof Error) {
          let detailedMessage = `\u83B7\u53D6\u6A21\u578B\u5217\u8868\u5931\u8D25: ${error.message}`;
          if (error.message.includes("Failed to fetch")) {
            detailedMessage += "\n\n\u8FD9\u901A\u5E38\u662F\u7531\u4E8E\u4EE5\u4E0B\u539F\u56E0\u4E4B\u4E00\u9020\u6210\u7684\uFF1A\n1. **\u7F51\u7EDC\u8FDE\u63A5\u95EE\u9898**\uFF1A\u8BF7\u68C0\u67E5\u60A8\u7684\u7F51\u7EDC\u8FDE\u63A5\u4EE5\u53CA\u80FD\u5426\u8BBF\u95EE\u76EE\u6807 Endpoint URL\u3002\n2. **CORS \u8DE8\u57DF\u95EE\u9898**\uFF1A\u5982\u679C\u60A8\u6B63\u5728\u4F7F\u7528\u672C\u5730\u6216\u81EA\u5B9A\u4E49 API\uFF0C\u8BF7\u786E\u4FDD\u670D\u52A1\u5668\u5DF2\u6B63\u786E\u914D\u7F6E CORS \u7B56\u7565\u3002\n3. **Endpoint URL \u9519\u8BEF**\uFF1A\u8BF7\u68C0\u67E5\u60A8\u5728\u8BBE\u7F6E\u4E2D\u586B\u5199\u7684 Endpoint URL \u662F\u5426\u6B63\u786E\u3002";
          }
          throw new Error(detailedMessage);
        }
        throw new Error("\u83B7\u53D6\u6A21\u578B\u5217\u8868\u65F6\u53D1\u751F\u672A\u77E5\u7F51\u7EDC\u9519\u8BEF\u3002");
      }
    };
  }
});

// index.tsx
import React14 from "react";
import ReactDOM from "react-dom/client";

// App.tsx
init_constants();
import { useState as useState11, useEffect as useEffect8, useCallback as useCallback5, useMemo as useMemo5 } from "react";

// prompts.ts
var DEFAULT_SNOWFLAKE_PROMPT_CONTENT = `\u4F60\u662F\u4E00\u4F4D\u4E13\u4E1A\u7684\u5C0F\u8BF4\u4F5C\u5BB6\uFF0C\u8BF7\u9075\u5FAA\u300C\u96EA\u82B1\u5199\u4F5C\u6CD5\u300D\u7684\u539F\u5219\uFF0C\u6839\u636E\u6211\u63D0\u4F9B\u7684\u6545\u4E8B\u6838\u5FC3\u8981\u7D20\uFF0C\u4E3A\u6211\u751F\u6210\u4E00\u4EFD\u8BE6\u5C3D\u7684\u5C0F\u8BF4\u5927\u7EB2\u3002

\u8BF7\u6309\u7167\u4EE5\u4E0B\u6B65\u9AA4\u8FDB\u884C\uFF1A

1.  **\u4E00\u53E5\u8BDD\u6545\u4E8B\u6897\u6982**\uFF1A\u7528\u4E00\u53E5\u8BDD\uFF08\u5927\u7EA615\u4E2A\u5B57\uFF09\u603B\u7ED3\u6574\u4E2A\u6545\u4E8B\u3002
2.  **\u4E00\u6BB5\u8BDD\u6545\u4E8B\u6897\u6982**\uFF1A\u5C06\u4E00\u53E5\u8BDD\u6897\u6982\u6269\u5C55\u6210\u4E00\u4E2A\u5B8C\u6574\u7684\u6BB5\u843D\uFF08\u5927\u7EA6100\u5B57\uFF09\uFF0C\u4ECB\u7ECD\u6545\u4E8B\u7684\u80CC\u666F\u3001\u4E3B\u8981\u51B2\u7A81\u548C\u7ED3\u5C40\u3002
3.  **\u4E3B\u8981\u4EBA\u7269\u5C0F\u4F20**\uFF1A\u4E3A\u6BCF\u4E2A\u4E3B\u8981\u89D2\u8272\u64B0\u5199\u4E00\u4EFD\u4EBA\u7269\u5C0F\u4F20\uFF0C\u5185\u5BB9\u5305\u62EC\uFF1A
    *   \u89D2\u8272\u59D3\u540D
    *   \u4E00\u53E5\u8BDD\u603B\u7ED3\u89D2\u8272\u7684\u6545\u4E8B\u7EBF
    *   \u89D2\u8272\u7684\u52A8\u673A\uFF08\u4ED6/\u5979\u60F3\u8981\u4EC0\u4E48\uFF1F\uFF09
    *   \u89D2\u8272\u7684\u51B2\u7A81\uFF08\u4EC0\u4E48\u963B\u6B62\u4E86\u4ED6/\u5979\uFF1F\uFF09
    *   \u89D2\u8272\u7684\u987F\u609F\uFF08\u4ED6/\u5979\u5C06\u5982\u4F55\u6539\u53D8\uFF1F\uFF09
    *   \u4E00\u6BB5\u8BDD\u603B\u7ED3\u89D2\u8272\u7684\u6545\u4E8B\u7EBF
4.  **\u6545\u4E8B\u4E09\u5E55\u5F0F\u7ED3\u6784\u5927\u7EB2**\uFF1A\u5C06\u6545\u4E8B\u6269\u5C55\u6210\u4E00\u4EFD\u5305\u542B\u591A\u4E2A\u6BB5\u843D\u7684\u5927\u7EB2\uFF0C\u6E05\u6670\u5730\u5212\u5206\u51FA\u4E09\u5E55\uFF08\u5F00\u7AEF\u3001\u4E2D\u6BB5\u3001\u7ED3\u5C3E\uFF09\u3002
    *   **\u7B2C\u4E00\u5E55\uFF08\u5F00\u7AEF\uFF09**\uFF1A\u4ECB\u7ECD\u4E3B\u89D2\u548C\u4E16\u754C\u89C2\uFF0C\u5448\u73B0\u6FC0\u52B1\u4E8B\u4EF6\uFF0C\u4E3B\u89D2\u88AB\u8FEB\u505A\u51FA\u9009\u62E9\u3002
    *   **\u7B2C\u4E8C\u5E55\uFF08\u4E2D\u6BB5\uFF09**\uFF1A\u4E3B\u89D2\u5728\u65B0\u4E16\u754C\u4E2D\u906D\u9047\u4E00\u7CFB\u5217\u6311\u6218\u548C\u969C\u788D\uFF0C\u4E0D\u65AD\u6210\u957F\uFF0C\u8FCE\u6765\u4E2D\u70B9\u8F6C\u6298\uFF0C\u98CE\u9669\u8D8A\u6765\u8D8A\u9AD8\u3002
    *   **\u7B2C\u4E09\u5E55\uFF08\u7ED3\u5C3E\uFF09**\uFF1A\u6545\u4E8B\u63A8\u5411\u9AD8\u6F6E\uFF0C\u4E3B\u89D2\u4E0E\u5BF9\u624B\u8FDB\u884C\u6700\u7EC8\u5BF9\u51B3\uFF0C\u63ED\u793A\u6240\u6709\u8C1C\u5E95\uFF0C\u5C55\u793A\u6545\u4E8B\u7ED3\u5C40\u548C\u4E3B\u89D2\u7684\u6700\u7EC8\u53D8\u5316\u3002`;
var DEFAULT_SNOWFLAKE_PROMPT_TEMPLATE = {
  id: "default-snowflake",
  name: "\u96EA\u82B1\u5199\u4F5C\u6CD5 (\u9ED8\u8BA4)",
  content: DEFAULT_SNOWFLAKE_PROMPT_CONTENT
};
var DEFAULT_SNOWFLAKE_STEP_BY_STEP_PROMPT_CONTENT = `# \u89D2\u8272:
\u5C0F\u8BF4\u521B\u4F5C\u52A9\u624B

# \u7B80\u4ECB:
\u719F\u6089\u96EA\u82B1\u5341\u6B65\u5199\u4F5C\u6CD5\uFF0C\u64C5\u957F\u6839\u636E\u7528\u6237\u8F93\u5165\u7684\u4E3B\u9898\uFF0C\u7CFB\u7EDF\u5730\u6269\u5C55\u548C\u5B8C\u5584\u6545\u4E8B\u7ED3\u6784\u548C\u5185\u5BB9\u3002

# \u6280\u80FD:
- \u96EA\u82B1\u5341\u6B65\u5199\u4F5C\u6CD5
- \u521B\u610F\u5199\u4F5C
- \u6545\u4E8B\u60C5\u8282\u8BBE\u8BA1

# \u89C4\u5219:
1. \u4E25\u683C\u6309\u7167\u96EA\u82B1\u5341\u6B65\u5199\u4F5C\u6CD5\u7684\u6B65\u9AA4\u8FDB\u884C\u3002
2. \u8F93\u51FA\u683C\u5F0F\u7EDF\u4E00\uFF0C\u786E\u4FDD\u5185\u5BB9\u6E05\u6670\u6613\u61C2\u3002
3. \u4E00\u9875\u4E3A500\u4E2A\u4E2D\u6587\u5B57\u7B26\uFF0C\u4E0D\u8981\u7F29\u51CF\u5185\u5BB9

\u8BA9\u6211\u4EEC\u6162\u6162\u4E00\u6B65\u4E00\u6B65\u89E3\u51B3\u8FD9\u4E2A\u95EE\u9898\uFF0C\u786E\u4FDD\u6211\u4EEC\u5F97\u5230\u6B63\u786E\u7684\u7B54\u6848\u3002
\u6BCF\u4E00\u6B65\u7684\u5DE5\u4F5C\u6D41\u7A0B\u90FD\u9700\u8981\u8BE6\u7EC6\u548C\u6E05\u6670\u7684\u8F93\u51FA\u3002
\u6BCF\u4E00\u6B65\u90FD\u9700\u8981\u57FA\u4E8E\u524D\u4E00\u90E8\u5206\u7684\u5185\u5BB9\u3002

# \u5DE5\u4F5C\u6D41\u7A0B\uFF08\u8F93\u51FA\u4E2D\u95F4\u6B65\u9AA4\u548C\u4E2D\u95F4\u6267\u884C\u7ED3\u679C\uFF09:
1. **\u4E00\u53E5\u8BDD\u6982\u8FF0**:
   - \u7528\u6237\u8F93\u5165\u4E3B\u9898\u3002
   - \u6839\u636E\u8F93\u5165\uFF0C\u751F\u6210\u5305\u542B\u4E3B\u89D2\u3001\u51B2\u7A81\u548C\u6545\u4E8B\u72EC\u7279\u4E4B\u5904\u7684\u4E00\u53E5\u8BDD\u6982\u8FF0\u3002


2. **\u4E00\u6BB5\u8BDD\u6982\u8FF0**:
   - \u5C06\u4E00\u53E5\u8BDD\u6982\u8FF0\u6269\u5C55\u4E3A\u4E94\u4E2A\u53E5\u5B50\uFF0C\u63CF\u8FF0\u6545\u4E8B\u5F00\u5934\u3001\u4E09\u4E2A\u4E3B\u8981\u51B2\u7A81\u548C\u7ED3\u5C3E\u3002


3. **\u89D2\u8272\u7B80\u4ECB**:
   - \u4E3A\u6BCF\u4E2A\u4E3B\u8981\u89D2\u8272\u5199\u4E00\u9875\u7B80\u4ECB\uFF0C\u5305\u62EC\u540D\u5B57\u3001\u52A8\u673A\u3001\u76EE\u6807\u3001\u51B2\u7A81\u548C\u89D2\u8272\u5F27\u7EBF\u3002


4. **\u6269\u5C55\u6BB5\u843D\u6982\u8FF0**:
   - \u5C06\u4E00\u6BB5\u8BDD\u6982\u8FF0\u6269\u5C55\u4E3A\u4E00\u9875\u957F\u7684\u6982\u8FF0\uFF0C\u6BCF\u4E2A\u4E3B\u8981\u53E5\u5B50\u6269\u5C55\u6210\u4E00\u4E2A\u6BB5\u843D\u3002


5. **\u89D2\u8272\u5927\u7EB2**:
   - \u4E3A\u6BCF\u4E2A\u4E3B\u8981\u89D2\u8272\u5199\u4E00\u9875\u7684\u8BE6\u7EC6\u5927\u7EB2\uFF0C\u5305\u62EC\u89D2\u8272\u7684\u6545\u4E8B\u5F27\u3001\u53D1\u5C55\u53CA\u4E0E\u5176\u4ED6\u89D2\u8272\u7684\u5173\u7CFB\u3002


6. **\u6269\u5C55\u60C5\u8282\u5927\u7EB2**:
   - \u5C06\u4E00\u9875\u60C5\u8282\u6982\u8FF0\u6269\u5C55\u4E3A\u56DB\u9875\u957F\u7684\u8BE6\u7EC6\u5927\u7EB2\uFF0C\u6BCF\u6BB5\u6269\u5C55\u6210\u4E00\u9875\u3002


7. **\u573A\u666F\u5217\u8868**:
   - \u5217\u51FA\u6240\u6709\u573A\u666F\uFF0C\u6BCF\u4E2A\u573A\u666F\u5305\u62EC\u4E3B\u8981\u4E8B\u4EF6\u3001\u6D89\u53CA\u89D2\u8272\u3001\u5730\u70B9\u548C\u65F6\u95F4\u3002


8. **\u573A\u666F\u6269\u5C55**:
   - \u5C06\u6BCF\u4E2A\u573A\u666F\u6269\u5C55\u4E3A\u4E00\u4E2A\u6BB5\u843D\uFF0C\u8BE6\u7EC6\u63CF\u8FF0\u4E8B\u4EF6\u3001\u5BF9\u8BDD\u548C\u89D2\u8272\u60C5\u611F\u53D8\u5316\u3002


9. **\u521D\u7A3F\u5199\u4F5C**:
   - \u6839\u636E\u524D\u9762\u7684\u51C6\u5907\u5DE5\u4F5C\uFF0C\u5F00\u59CB\u5199\u4F5C\u5C0F\u8BF4\u7684\u521D\u7A3F\u3002


10. **\u4FEE\u6539\u5B8C\u5584**:
    - \u5B8C\u6210\u521D\u7A3F\u540E\uFF0C\u591A\u6B21\u4FEE\u6539\uFF0C\u4FEE\u6B63\u60C5\u8282\u6F0F\u6D1E\u3001\u6DF1\u5316\u89D2\u8272\u5851\u9020\u3001\u6253\u78E8\u8BED\u8A00\u548C\u98CE\u683C\u3002


# \u8F93\u51FA\u683C\u5F0F:
[\u6BCF\u4E00\u6B65\u7684\u8F93\u51FA\u90FD\u4EE5\u8BE6\u7EC6\u6587\u672C\u683C\u5F0F\u5C55\u793A\uFF0C\u5305\u542B\u793A\u4F8B\u548C\u8BF4\u660E]`;
var DEFAULT_SNOWFLAKE_STEP_BY_STEP_PROMPT_TEMPLATE = {
  id: "default-snowflake-step-by-step",
  name: "\u96EA\u82B1\u5341\u6B65\u6CD5 (\u5206\u6B65)",
  content: DEFAULT_SNOWFLAKE_STEP_BY_STEP_PROMPT_CONTENT
};
var DEFAULT_SATISFYING_FORMULA_PROMPT_CONTENT = `1.\u7406\u89E3\u4E09\u8981\u7D20\u516C\u5F0F\u878D\u5165\u5230\u516B\u8981\u7D20\u548C\u5341\u5E8F\u5217\u5927\u7EB2\u91CC\u9762\u5E76\u4E14\u4E0D\u9700\u8981\u8F93\u51FA\u4E09\u8981\u7D20\u5185\u5BB9\uFF1A
1.\u538B\u529B\uFF1A\u7531\u5916\u90E8\u73AF\u5883\u6216\u5185\u90E8\u5FC3\u7406\u5E26\u6765\u7684\u77DB\u76FE\u4E0E\u56F0\u5883\uFF08\u5982\u53CD\u6D3E\u538B\u5236\u3001\u89C4\u5219\u4E0D\u516C\u3001\u4E3B\u89D2\u5F31\u52BF\uFF09\uFF0C\u662F\u60C5\u7EEA\u79EF\u7D2F\u7684\u6838\u5FC3\u6765\u6E90\uFF0C\u9A71\u52A8\u60C5\u8282\u53D1\u5C55\u3001\u6FC0\u53D1\u8BFB\u8005\u60C5\u7EEA\u5171\u9E23\u3002
2.\u51B2\u7A81\uFF1A\u538B\u529B\u4E0E\u91CA\u653E\u4E4B\u95F4\u7684\u6865\u6881\uFF0C\u901A\u8FC7\u4E3B\u89D2\u4E0E\u53CD\u6D3E\u3001\u73AF\u5883\u6216\u5185\u5FC3\u7684\u5BF9\u6297\u6DF1\u5316\u5F20\u529B\u3001\u63A8\u52A8\u60C5\u8282\u9012\u8FDB\uFF08\u5982\u77DB\u76FE\u5BF9\u7ACB\u5305\u62EC\u654C\u5BF9\u3001\u6218\u6597\u3001\u8C0B\u7565\uFF0C\u5FC3\u7406\u6597\u4E89\uFF09\u3002
3.\u91CA\u653E\uFF1A\u538B\u529B\u7684\u5316\u89E3\u548C\u51B2\u7A81\u7684\u7EC8\u7ED3\uFF0C\u901A\u8FC7\u5C0F\u723D\u6216\u5927\u723D\u5B9E\u73B0\u60C5\u7EEA\u51FA\u53E3\uFF08\u5C0F\u723D\u5373\u4E3B\u89D2\u884C\u4E3A\u5E26\u6765\u7684\u5373\u65F6\u80DC\u5229\u6216\u77ED\u671F\u53CD\u8F6C\uFF0C\u6EE1\u8DB3\u8BFB\u8005\u77ED\u671F\u60C5\u7EEA\u9700\u6C42\uFF1B\u5927\u723D\u662F\u901A\u8FC7\u957F\u65F6\u95F4\u60C5\u7EEA\u79EF\u7D2F\uFF0C\u5728\u6545\u4E8B\u5173\u952E\u8282\u70B9\u5982\u9AD8\u6F6E\u3001\u7ED3\u5C40\u4E2D\u96C6\u4E2D\u7206\u53D1\uFF0C\u5E26\u6765\u8BFB\u8005\u7684\u60C5\u7EEA\u5DC5\u5CF0\u4F53\u9A8C\uFF09\u3002
2.\u4FDD\u8BC1\u6545\u4E8B\u81EA\u6D3D\uFF0C\u8865\u5168\u7F3A\u5931\u90E8\u5206\uFF0C\u786E\u4FDD\u60C5\u8282\u3001\u89D2\u8272\u3001\u51B2\u7A81\u5408\u7406\u3002
3.\u723D\u611F\u516C\u5F0F\u7406\u89E3\u723D\u611F\u516C\u5F0F\u516C\u5F0F\u878D\u5165\u5230\u516B\u8981\u7D20\u548C\u5341\u5E8F\u5217\u5927\u7EB2\u91CC\u9762\u5E76\u4E14\u4E0D\u9700\u8981\u8F93\u51FA\u4E09\u8981\u7D20\u5185\u5BB9\uFF1A
1.\u723D\u611F\u516C\u5F0F\uFF1A\u723D = \u538B\u529B\u7684\u79EF\u7D2F + \u51B2\u7A81\u7684\u6DF1\u5316 + \u91CA\u653E\u7684\u6EE1\u8DB3\u3002
2.\u5C0F\u723D\u516C\u5F0F\uFF1A\u5C0F\u723D = \u5C40\u90E8\u51B2\u7A81 + \u77ED\u671F\u80DC\u5229\u3002
3.\u5927\u723D\u516C\u5F0F\uFF1A\u5927\u723D = \u957F\u671F\u94FA\u57AB + \u538B\u529B\u7206\u53D1 + \u7EC8\u6781\u80DC\u5229\u3002
4.\u6545\u4E8B\u8282\u594F\u516C\u5F0F\uFF1A\u60C5\u8282 = 10 \u5E8F\u5217\u7684\u903B\u8F91\u6846\u67B6 + \u5C0F\u723D\u7684\u5D4C\u5957 + \u5927\u723D\u7684\u7206\u53D1\u3002
5.\u538B\u529B\u9012\u8FDB\u516C\u5F0F\uFF1A\u538B\u529B\u9012\u8FDB = \u521D\u7EA7\u538B\u529B\uFF08\u5F00\u573A\uFF09 + \u4E2D\u7EA7\u538B\u529B\uFF08\u5BF9\u6297 / \u8F6C\u6298\uFF09 + \u9AD8\u7EA7\u538B\u529B\uFF08\u5371\u673A\uFF09\u3002
6.\u60C5\u7EEA\u66F2\u7EBF\u516C\u5F0F\uFF1A\u60C5\u7EEA\u6CE2\u52A8 = \u538B\u529B\u9012\u589E + \u5C0F\u723D\u7F13\u51B2 + \u5927\u723D\u91CA\u653E\u3002
5.\u8FDB\u884C\u516B\u8981\u7D20\u63D0\u70BC\u786E\u4FDD\u516B\u8981\u7D20\u4E0E\u5341\u5E8F\u5217\u903B\u8F91\u4E00\u81F4\uFF0C\u60C5\u8282\u63A8\u8FDB\u81EA\u7136\uFF1A
1.\u4EBA\u7269\uFF1A\u8BBE\u5B9A\u4E3B\u89D2\uFF08\u5305\u542B\u4E2A\u6027\u3001\u52A8\u673A\u3001\u80CC\u666F\u3001\u80FD\u529B\u3001\u6027\u683C\u53D8\u5316\uFF09\u4E0E\u914D\u89D2\uFF08\u660E\u786E\u5176\u4F5C\u7528\u3001\u6027\u683C\uFF09\u3002\u4E0D\u5C11\u4E8E 100 \u5B57
2.\u6B32\u671B\uFF1A\u786E\u5B9A\u4E3B\u89D2\u7B26\u5408\u80CC\u666F\u7684\u6B32\u671B\uFF08\u4F8B\u5982\u8D22\u5BCC\u7B49\uFF09\u3002\u4E0D\u5C11\u4E8E 100 \u5B57
3.\u52A8\u4F5C\uFF1A\u8BBE\u8BA1\u4E3B\u89D2\u4E3A\u5B9E\u73B0\u6B32\u671B\u7684\u884C\u52A8\u4EE5\u63A8\u52A8\u6545\u4E8B\u53D1\u5C55\u3002\u4E0D\u5C11\u4E8E 100 \u5B57
4.\u963B\u788D / \u51B2\u7A81\uFF1A\u5305\u542B\u4EBA\u7269\u3001\u73AF\u5883\u3001\u5FC3\u7406\u7B49\u56E0\u7D20\u4EE5\u589E\u5F3A\u7D27\u5F20\u611F\u3002\u4E0D\u5C11\u4E8E 100 \u5B57
5.\u7ED3\u679C\uFF1A\u786E\u5B9A\u5F71\u54CD\u6545\u4E8B\u8D70\u5411\u7684\u7ED3\u5C40\u6216\u8F6C\u6298\u3002\u4E0D\u5C11\u4E8E 100 \u5B57
6.\u4E3B\u9898\uFF1A\u901A\u8FC7\u89D2\u8272\u5C55\u73B0\u6838\u5FC3\u601D\u60F3\u3002\u4E0D\u5C11\u4E8E 100 \u5B57
7.\u4EF7\u503C\u89C2\uFF1A\u501F\u4E3B\u89D2\u884C\u4E3A\u63ED\u793A\u4EF7\u503C\u3002\u4E0D\u5C11\u4E8E 100 \u5B57
8.\u7ED3\u5C40\uFF1A\u5448\u73B0\u4E3B\u89D2\u5E94\u5BF9\u6700\u7EC8\u51B2\u7A81\u5E76\u4F53\u73B0\u6210\u957F\u53D8\u5316\u3002\u4E0D\u5C11\u4E8E 100 \u5B57
6.\u6784\u5EFA\u5341\u5E8F\u5217\u5927\u7EB2\uFF0C\u5927\u7EB2\u660E\u786E\u63CF\u8FF0\u60C5\u8282\u7EC6\u8282\uFF0C\u7A81\u51FA\u4E3B\u89D2\u76F8\u5173\u8981\u7D20\uFF0C\u7D27\u5BC6\u5173\u8054\u6B32\u671B\u4E0E\u51B2\u7A81\u3002
1.\u5F00\u573A\uFF1A\u5F15\u5165\u4E3B\u89D2\u3001\u80CC\u666F\u4E0E\u521D\u59CB\u538B\u529B\uFF0C\u5FEB\u901F\u5438\u5F15\u8BFB\u8005\uFF0C\u5E76\u5D4C\u5165\u7B2C\u4E00\u5C0F\u723D\u3002\u4E0D\u5C11\u4E8E 100 \u5B57
2.\u5EFA\u7F6E\uFF1A\u5C55\u793A\u4E3B\u89D2\u76EE\u6807\u3001\u6B32\u671B\u4E0E\u963B\u788D\u6765\u6E90\uFF0C\u7F13\u548C\u5F00\u573A\u538B\u529B\u5E76\u9884\u70ED\u5C0F\u723D\u3002\u4E0D\u5C11\u4E8E 100 \u5B57
3.\u6FC0\u52B1\u4E8B\u4EF6\uFF1A\u63A8\u52A8\u4E3B\u89D2\u8FDB\u5165\u4E3B\u7EBF\uFF0C\u901A\u8FC7\u521D\u6B65\u51B2\u7A81\u52A0\u6DF1\u5F20\u529B\u5E76\u8BBE\u7F6E\u5C40\u90E8\u53CD\u51FB\u7684\u5C0F\u723D\u3002\u4E0D\u5C11\u4E8E 100 \u5B57
4.\u5BF9\u6297\uFF1A\u4E3B\u89D2\u4E0E\u654C\u4EBA\u5C55\u5F00\u591A\u5C42\u6B21\u51B2\u7A81\uFF0C\u538B\u529B\u4E0E\u5C0F\u723D\u4EA4\u66FF\uFF0C\u63A8\u52A8\u60C5\u8282\u9012\u8FDB\u3002\u4E0D\u5C11\u4E8E 100 \u5B57
5.\u8F6C\u6298\uFF1A\u4E3B\u89D2\u5728\u5931\u8D25\u4E2D\u8C03\u6574\u7B56\u7565\uFF0C\u5F20\u529B\u589E\u5F3A\uFF0C\u540C\u65F6\u901A\u8FC7\u5C0F\u723D\u4FDD\u7559\u5E0C\u671B\u3002\u4E0D\u5C11\u4E8E 100 \u5B57
6.\u5371\u673A\uFF1A\u4E3B\u89D2\u9762\u4E34\u6700\u5927\u56F0\u5883\uFF0C\u60C5\u7EEA\u5F20\u529B\u8FBE\u5230\u9876\u70B9\uFF0C\u4E3A\u5927\u723D\u57CB\u4F0F\u7B14\u3002\u4E0D\u5C11\u4E8E 100 \u5B57
7.\u9AD8\u6F6E\uFF1A\u4E3B\u89D2\u9006\u88AD\u5B8C\u6210\u5173\u952E\u80DC\u5229\uFF0C\u5927\u723D\u5168\u9762\u7206\u53D1\u3002\u4E0D\u5C11\u4E8E 100 \u5B57
8.\u89E3\u51B3\uFF1A\u5904\u7406\u9AD8\u6F6E\u540E\u7684\u540E\u7EED\u5F71\u54CD\uFF0C\u5C55\u73B0\u4E3B\u89D2\u6210\u957F\uFF0C\u5E76\u901A\u8FC7\u5C0F\u723D\u5EF6\u7EED\u80DC\u5229\u611F\u3002\u4E0D\u5C11\u4E8E 100 \u5B57
9.\u7ED3\u5C40\uFF1A\u5C55\u793A\u4E3B\u89D2\u6700\u7EC8\u72B6\u6001\u6216\u9636\u6BB5\u6027\u76EE\u6807\u7684\u8FBE\u6210\uFF0C\u901A\u8FC7\u5927\u723D\u7684\u5347\u534E\u91CA\u653E\u4F59\u97F5\u3002\u4E0D\u5C11\u4E8E 100 \u5B57
10.\u56DE\u987E\uFF1A\u603B\u7ED3\u4E3B\u9898\u6216\u57CB\u4F0F\u7B14\uFF0C\u4E3A\u540E\u7EED\u60C5\u8282\u5236\u9020\u671F\u5F85\u3002\u4E0D\u5C11\u4E8E 100 \u5B57
\u8F93\u51FA\u903B\u8F91\uFF1A\u5168\u6587\u4EE5markdown\u683C\u5F0F\u8F93\u51FA\uFF0C\u907F\u514D\u5939\u6742\u82F1\u6587
\u8BFB\u53D6\u7528\u6237\u63D0\u4F9B\u5185\u5BB9\uFF0C\u5E76\u4EE5\u7CBE\u51C6\u63D0\u793A\u8BCD\u7B80\u5316\u7528\u6237\u63D0\u4F9B\u5185\u5BB9\uFF0C\u878D\u5165\u5230\u516B\u8981\u7D20\u548C\u5341\u5E8F\u5217\u5927\u7EB2\u91CC\u9762`;
var DEFAULT_SATISFYING_FORMULA_PROMPT_TEMPLATE = {
  id: "default-satisfying-formula",
  name: "\u516B\u8981\u7D20\u548C\u5341\u5E8F\u5217\u5927\u7EB2 (\u9ED8\u8BA4)",
  content: DEFAULT_SATISFYING_FORMULA_PROMPT_CONTENT
};
var DEFAULT_STORY_ARCHITECT_PROMPT_CONTENT = `## \u8EAB\u4EFD\u8BBE\u5B9A
\u4F60\u662F\u4E00\u4F4D\u4E13\u4E1A\u7684"\u6545\u4E8B\u5EFA\u7B51\u5E08"\uFF0C\u8FD0\u7528\u5DE5\u79D1\u601D\u7EF4\u5E2E\u52A9\u7528\u6237\u8FDB\u884C\u7CFB\u7EDF\u5316\u5199\u4F5C\u3002\u4F60\u5177\u5907\uFF1A
- \u7ED3\u6784\u5316\u601D\u7EF4\u80FD\u529B
- \u903B\u8F91\u5206\u6790\u6280\u80FD  
- \u7CFB\u7EDF\u5DE5\u7A0B\u65B9\u6CD5\u8BBA
- \u6545\u4E8B\u6784\u5EFA\u4E13\u4E1A\u77E5\u8BC6

## \u601D\u7EF4\u94FE\u5206\u6790\u6D41\u7A0B
### \u7B2C\u4E00\u6B65\uFF1A\u95EE\u9898\u8BCA\u65AD\u4E0E\u5206\u6790
\u5F53\u7528\u6237\u63D0\u51FA\u5199\u4F5C\u9700\u6C42\u65F6\uFF0C\u6309\u4EE5\u4E0B\u6B65\u9AA4\u601D\u8003\uFF1A
1. **\u8BC6\u522B\u7528\u6237\u72B6\u6001**
   - \u7528\u6237\u76EE\u524D\u5904\u4E8E\u4EC0\u4E48\u521B\u4F5C\u9636\u6BB5\uFF1F\uFF08\u7075\u611F\u788E\u7247/\u521D\u6B65\u6784\u601D/\u7ED3\u6784\u68B3\u7406\uFF09
   - \u7528\u6237\u9047\u5230\u7684\u6838\u5FC3\u56F0\u96BE\u662F\u4EC0\u4E48\uFF1F\uFF08\u4EBA\u7269\u6A21\u7CCA/\u60C5\u8282\u65AD\u88C2/\u903B\u8F91\u4E0D\u6E05\uFF09
   
2. **\u5B9A\u4F4D\u95EE\u9898\u6839\u6E90**
   - \u662F\u5426\u7F3A\u4E4F\u660E\u786E\u7684"\u524D\u63D0"\uFF1F
   - \u662F\u5426\u5B58\u5728"\u5730\u57FA"\u4E0D\u7262\u56FA\u7684\u95EE\u9898\uFF1F
   - \u56DB\u6839\u652F\u67F1\uFF08\u4EBA\u7269\u3001\u60C5\u8282\u3001\u610F\u8C61\u3001\u5BF9\u8BDD\uFF09\u54EA\u6839\u6700\u8584\u5F31\uFF1F

### \u7B2C\u4E8C\u6B65\uFF1A\u7CFB\u7EDF\u5316\u8BCA\u65AD\u5DE5\u5177
\u6839\u636E\u7528\u6237\u63D0\u4F9B\u7684\u4FE1\u606F\uFF0C\u8FD0\u7528\u4EE5\u4E0B\u8BCA\u65AD\u6846\u67B6\uFF1A
**A. \u7075\u611F\u7C7B\u578B\u5224\u65AD**
- \u5982\u679C\u662F\u4EBA\u7269\u7075\u611F \u2192 \u542F\u52A8\u4EBA\u7269\u6316\u6398\u5DE5\u5177\u94FE
- \u5982\u679C\u662F\u573A\u666F\u7075\u611F \u2192 \u542F\u52A8\u573A\u666F\u6EAF\u6E90\u5DE5\u5177\u94FE  
- \u5982\u679C\u662F\u610F\u8C61\u7075\u611F \u2192 \u542F\u52A8\u8C61\u5F81\u610F\u8C61\u5DE5\u5177\u94FE

**B. \u6545\u4E8B\u7C7B\u578B\u8BC6\u522B**
- \u5224\u65AD\u662F"\u575A\u5B9A\u4E3B\u89D2\u578B"\u8FD8\u662F"\u60C5\u8282\u9A71\u52A8\u578B"
- \u660E\u786E\u7528\u6237\u60F3\u8BB2\u8FF0\u7684\u6545\u4E8B\u6838\u5FC3\uFF1A\u4EBA\u7269\u6210\u957F vs \u884C\u52A8\u5192\u9669

### \u7B2C\u4E09\u6B65\uFF1A\u5DE5\u5177\u94FE\u8C03\u7528\u4E0E\u6267\u884C
**\u4EBA\u7269\u6316\u6398\u5DE5\u5177\u94FE\uFF1A**
1. \u4EBA\u7269\u8868\u8C61\u7279\u5F81\u662F\u4EC0\u4E48\uFF1F
2. \u8FD0\u7528"\u4E3A\u4EC0\u4E48\u9636\u68AF\u6CD5"\uFF1A\u8FDE\u7EED\u8FFD\u95EE5\u4E2A"\u4E3A\u4EC0\u4E48"
3. \u6316\u6398\u5185\u5728\u77DB\u76FE\uFF1A\u6838\u5FC3\u4FE1\u5FF5\u662F\u4EC0\u4E48\uFF1F
4. \u8BBE\u8BA1"\u5929\u654C"\u4FE1\u5FF5\uFF1A\u4E0E\u6838\u5FC3\u4FE1\u5FF5\u5BF9\u7ACB\u7684\u89C2\u70B9
5. \u6784\u5EFA\u524D\u63D0\uFF1A\u4FE1\u5FF5\u51B2\u7A81\u5982\u4F55\u63A8\u52A8\u6545\u4E8B\uFF1F
6. \u9A8C\u8BC1\u903B\u8F91\uFF1A\u4EBA\u7269\u884C\u4E3A\u662F\u5426\u7B26\u5408\u5185\u5728\u903B\u8F91\uFF1F

**\u573A\u666F\u6EAF\u6E90\u5DE5\u5177\u94FE\uFF1A**
1. \u8BC6\u522B\u5173\u952E\u573A\u666F\uFF1A\u8FD9\u4E2A\u573A\u666F\u7684\u60C5\u611F\u5F3A\u5EA6\u5982\u4F55\uFF1F
2. \u53CD\u5411\u8FFD\u6EAF\uFF1A\u8FD9\u4E2A\u573A\u666F\u4E3A\u4EC0\u4E48\u4F1A\u53D1\u751F\uFF1F
3. \u56E0\u679C\u94FE\u6784\u5EFA\uFF1A\u524D\u7F6E\u4E8B\u4EF6 \u2192 \u5173\u952E\u573A\u666F \u2192 \u540E\u7EED\u5F71\u54CD
4. \u5BFB\u627E\u5185\u5728\u51B2\u7A81\uFF1A\u573A\u666F\u53CD\u6620\u4E86\u4EC0\u4E48\u6DF1\u5C42\u77DB\u76FE\uFF1F
5. \u524D\u63D0\u63D0\u70BC\uFF1A\u4ECE\u56E0\u679C\u94FE\u4E2D\u63D0\u53D6\u6545\u4E8B\u524D\u63D0
6. \u903B\u8F91\u9A8C\u8BC1\uFF1A\u56E0\u679C\u5173\u7CFB\u662F\u5426\u5408\u7406\uFF1F

**\u610F\u8C61\u8C61\u5F81\u5DE5\u5177\u94FE\uFF1A**
1. \u610F\u8C61\u8BC6\u522B\uFF1A\u8FD9\u4E2A\u610F\u8C61\u627F\u8F7D\u4EC0\u4E48\u542B\u4E49\uFF1F
2. \u8C61\u5F81\u5206\u6790\uFF1A\u5B83\u4EE3\u8868\u4EBA\u7269\u7684\u4EC0\u4E48\u5185\u5728\u72B6\u6001\uFF1F
3. \u53D8\u5316\u8F68\u8FF9\uFF1A\u610F\u8C61\u5982\u4F55\u968F\u4EBA\u7269\u6210\u957F\u800C\u53D8\u5316\uFF1F
4. \u6545\u4E8B\u6574\u5408\uFF1A\u5982\u4F55\u5C06\u610F\u8C61\u878D\u5165\u56DB\u6839\u652F\u67F1\uFF1F
5. \u6548\u679C\u8BC4\u4F30\uFF1A\u610F\u8C61\u662F\u5426\u589E\u5F3A\u4E86\u6545\u4E8B\u8868\u73B0\u529B\uFF1F

### \u7B2C\u56DB\u6B65\uFF1A\u7ED3\u6784\u5316\u8F93\u51FA\u4E0E\u5EFA\u8BAE
**\u8F93\u51FA\u683C\u5F0F\uFF1A**
1. **\u8BCA\u65AD\u7ED3\u679C**\uFF1A\u7528\u6237\u5F53\u524D\u521B\u4F5C\u72B6\u6001\u5206\u6790
2. **\u6838\u5FC3\u95EE\u9898**\uFF1A\u4E3B\u8981\u8584\u5F31\u73AF\u8282\u8BC6\u522B
3. **\u5DE5\u5177\u5E94\u7528**\uFF1A\u5177\u4F53\u4F7F\u7528\u54EA\u4E2A\u5DE5\u5177\u94FE
4. **\u7CFB\u7EDF\u5316\u5EFA\u8BAE**\uFF1A\u5206\u6B65\u9AA4\u7684\u6539\u8FDB\u65B9\u6848
5. **\u9A8C\u8BC1\u68C0\u67E5**\uFF1A\u903B\u8F91\u81EA\u6D3D\u6027\u68C0\u9A8C

### \u7B2C\u4E94\u6B65\uFF1A\u8D28\u91CF\u63A7\u5236\u4E0E\u53CD\u9988\u4F18\u5316
\u5728\u6BCF\u6B21\u8F93\u51FA\u540E\uFF0C\u8FDB\u884C\u81EA\u6211\u68C0\u9A8C\uFF1A
- \u5EFA\u8BAE\u662F\u5426\u5177\u6709\u53EF\u64CD\u4F5C\u6027\uFF1F
- \u903B\u8F91\u94FE\u6761\u662F\u5426\u5B8C\u6574\uFF1F
- \u662F\u5426\u5E2E\u52A9\u7528\u6237\u4ECE"\u788E\u7247"\u8D70\u5411"\u7CFB\u7EDF"\uFF1F
- \u662F\u5426\u4F53\u73B0\u4E86"\u5EFA\u7B51\u5E08"\u601D\u7EF4\uFF1F`;
var DEFAULT_STORY_ARCHITECT_PROMPT_TEMPLATE = {
  id: "default-story-architect",
  name: "\u6545\u4E8B\u5EFA\u7B51\u5E08 (\u9ED8\u8BA4)",
  content: DEFAULT_STORY_ARCHITECT_PROMPT_CONTENT
};
var DEFAULT_PROMPTS = [
  DEFAULT_SNOWFLAKE_PROMPT_TEMPLATE,
  DEFAULT_SNOWFLAKE_STEP_BY_STEP_PROMPT_TEMPLATE,
  DEFAULT_SATISFYING_FORMULA_PROMPT_TEMPLATE,
  DEFAULT_STORY_ARCHITECT_PROMPT_TEMPLATE
];

// inspirationConstants.ts
var DEFAULT_INSPIRATION_DATA = [
  {
    id: "fantasy",
    title: "\u5947\u5E7B\u91CD\u6784",
    items: [
      { id: 1, title: "\u9B54\u6CD5\u6E90\u4E8E\u60C5\u7EEA", description: "\u5728\u8FD9\u4E2A\u8BBE\u5B9A\u4E2D\uFF0C\u9B54\u6CD5\u7684\u529B\u91CF\u76F4\u63A5\u6E90\u4E8E\u65BD\u6CD5\u8005\u7684\u60C5\u611F\u72B6\u6001\u3002\u503A\u52A1\u8D8A\u91CD\u7684\u6CD5\u672F\uFF0C\u5176\u80CC\u540E\u6240\u9700\u507F\u8FD8\u7684\u60C5\u611F\u4EE3\u4EF7\u4E5F\u8D8A\u9AD8\u3002\u8FD9\u79CD\u8BBE\u5B9A\u5F3A\u8C03\u60C5\u611F\u5728\u9B54\u6CD5\u4F53\u7CFB\u4E2D\u7684\u6838\u5FC3\u4F5C\u7528\uFF0C\u4F7F\u5F97\u9B54\u6CD5\u4E0D\u4EC5\u4EC5\u662F\u529B\u91CF\u7684\u8C61\u5F81\uFF0C\u66F4\u662F\u60C5\u611F\u7684\u4F53\u73B0\u548C\u8D1F\u62C5\u3002" },
      { id: 2, title: "\u795E\u660E\u5DF2\u6B7B", description: "\u795E\u660E\u7684\u5B58\u5728\u5DF2\u6210\u4E3A\u8FC7\u53BB\u5F0F\uFF0C\u5B83\u4EEC\u7684\u5DE8\u5927\u9AB8\u9AA8\u6210\u4E3A\u5927\u9646\u7684\u9AA8\u67B6\u3002\u4EBA\u4EEC\u5728\u795E\u8C37\u4E2D\u5F00\u91C7\u795E\u8840\uFF0C\u5C06\u5176\u4F5C\u4E3A\u80FD\u6E90\u4F7F\u7528\u3002\u8FD9\u4E00\u8BBE\u5B9A\u6253\u7834\u4F20\u7EDF\u795E\u8BDD\u4F53\u7CFB\uFF0C\u8D4B\u4E88\u795E\u660E\u4E00\u79CD\u6B7B\u53BB\u7684\u3001\u53EF\u88AB\u5229\u7528\u7684\u5B9E\u4F53\u5F62\u8C61\uFF0C\u6697\u793A\u4EBA\u7C7B\u5BF9\u795E\u7947\u7684\u4F9D\u8D56\u9010\u6E10\u8F6C\u53D8\u4E3A\u5BF9\u5176\u9057\u9AB8\u7684\u5229\u7528\u3002" },
      { id: 3, title: "\u9F99\u4E0E\u72EE\u9E6B", description: "\u8FD9\u4E9B\u751F\u7269\u5B9E\u9645\u4E0A\u662F\u53E4\u4EE3\u751F\u7269\u6253\u5370\u673A\u5931\u63A7\u540E\u5236\u9020\u7684\u6218\u4E89\u6B66\u5668\u3002\u5B83\u4EEC\u7684\u51FA\u73B0\u4E0D\u4EC5\u4E30\u5BCC\u4E86\u5947\u5E7B\u4E16\u754C\u7684\u6218\u6597\u5143\u7D20\uFF0C\u4E5F\u6697\u793A\u79D1\u6280\u4E0E\u9B54\u6CD5\u7684\u7ED3\u5408\uFF0C\u5C55\u73B0\u51FA\u53E4\u4EE3\u79D1\u6280\u5931\u63A7\u5E26\u6765\u7684\u540E\u679C\u3002" },
      { id: 4, title: "\u53EA\u6709\u5B69\u5B50\u80FD\u770B\u89C1\u9B54\u6CD5", description: "\u5728\u8FD9\u4E2A\u4E16\u754C\u4E2D\uFF0C\u9B54\u6CD5\u7684\u5B58\u5728\u53EA\u88AB\u513F\u7AE5\u6240\u611F\u77E5\uFF0C\u6210\u5E74\u4EBA\u5219\u4F1A\u5931\u660E\u3002\u8FD9\u4E00\u8BBE\u5B9A\u5F3A\u8C03\u5E74\u9F84\u4E0E\u611F\u77E5\u80FD\u529B\u7684\u5173\u7CFB\uFF0C\u4E5F\u4E3A\u6545\u4E8B\u63D0\u4F9B\u4E86\u5173\u4E8E\u6210\u957F\u4E0E\u8BA4\u77E5\u7684\u6DF1\u5C42\u5BD3\u610F\u3002" },
      { id: 5, title: "\u6C38\u6052\u6781\u5149\u7B3C\u7F69\u5929\u7A7A", description: "\u5929\u7A7A\u88AB\u6C38\u6052\u7684\u6781\u5149\u8986\u76D6\uFF0C\u793E\u4F1A\u9636\u7EA7\u7531\u8EAB\u4E0A\u53D1\u5149\u7684\u989C\u8272\u51B3\u5B9A\u3002\u8FD9\u79CD\u8BBE\u5B9A\u8D4B\u4E88\u4E86\u793E\u4F1A\u7ED3\u6784\u4EE5\u89C6\u89C9\u8C61\u5F81\uFF0C\u6781\u5149\u7684\u989C\u8272\u6210\u4E3A\u8EAB\u4EFD\u7684\u6807\u5FD7\uFF0C\u53CD\u6620\u51FA\u793E\u4F1A\u7B49\u7EA7\u5236\u5EA6\u7684\u5947\u5E7B\u8272\u5F69\u3002" },
      { id: 6, title: "\u7075\u9B42\u4E0E\u52A8\u7269\u7ED1\u5B9A", description: "\u6240\u6709\u4EBA\u7684\u7075\u9B42\u90FD\u4E0E\u4E00\u79CD\u52A8\u7269\u7ED1\u5B9A\uFF0C\u52A8\u7269\u7684\u6B7B\u53BB\u610F\u5473\u7740\u7075\u9B42\u7684\u6B7B\u4EA1\u3002\u4E3B\u89D2\u7684\u7075\u9B42\u517D\u662F\u65E9\u5DF2\u706D\u7EDD\u7684\u6E21\u6E21\u9E1F\uFF0C\u8FD9\u79CD\u8BBE\u5B9A\u5F3A\u8C03\u7075\u9B42\u4E0E\u52A8\u7269\u7684\u5173\u7CFB\uFF0C\u8D4B\u4E88\u89D2\u8272\u7279\u6B8A\u7684\u8EAB\u4EFD\u548C\u547D\u8FD0\u3002" },
      { id: 7, title: "\u65E0\u91D1\u5C5E\u4E16\u754C", description: "\u5728\u6CA1\u6709\u91D1\u5C5E\u7684\u4E16\u754C\u4E2D\uFF0C\u6700\u5F3A\u7684\u6B66\u5668\u548C\u5DE5\u5177\u90FD\u662F\u7528\u9B54\u6CD5\u5904\u7406\u8FC7\u7684\u53E4\u74F7\u5236\u9020\u3002\u8FD9\u4E00\u8BBE\u5B9A\u521B\u9020\u51FA\u4E00\u4E2A\u5B8C\u5168\u4E0D\u540C\u7684\u6750\u6599\u4F53\u7CFB\uFF0C\u5F3A\u8C03\u9B54\u6CD5\u5728\u65E5\u5E38\u751F\u6D3B\u4E2D\u7684\u57FA\u7840\u6027\u4F5C\u7528\u3002" },
      { id: 8, title: "\u667A\u6167\u7684\u690D\u7269", description: "\u690D\u7269\u8FDB\u5316\u51FA\u667A\u6167\u548C\u653B\u51FB\u6027\uFF0C\u57CE\u5E02\u88AB\u5DE8\u5927\u7684\u8089\u98DF\u68EE\u6797\u5305\u56F4\u3002\u8FD9\u4E00\u8BBE\u5B9A\u5C06\u690D\u7269\u62DF\u4EBA\u5316\uFF0C\u5C55\u73B0\u81EA\u7136\u754C\u7684\u53CD\u6297\u4E0E\u5A01\u80C1\uFF0C\u4E3A\u5947\u5E7B\u4E16\u754C\u589E\u6DFB\u4E86\u5371\u9669\u4E0E\u795E\u79D8\u611F\u3002" }
    ]
  },
  {
    id: "sci-fi",
    title: "\u79D1\u5E7B\u65B0\u8BED",
    items: [
      { id: 9, title: "\u8BB0\u5FC6\u7684\u79FB\u690D\u4E0E\u4E70\u5356", description: "\u8BB0\u5FC6\u53EF\u4EE5\u88AB\u79FB\u690D\u548C\u4E70\u5356\uFF0C\u5BCC\u4EBA\u8D2D\u4E70\u6210\u529F\u7ECF\u9A8C\u5305\uFF0C\u7A77\u4EBA\u5219\u51FA\u5356\u7AE5\u5E74\u3002\u8FD9\u4E00\u8BBE\u5B9A\u63A2\u8BA8\u8BB0\u5FC6\u7684\u4EF7\u503C\u4E0E\u4F26\u7406\u95EE\u9898\uFF0C\u53CD\u6620\u73B0\u4EE3\u793E\u4F1A\u5BF9\u8BB0\u5FC6\u4E0E\u7ECF\u9A8C\u7684\u5546\u54C1\u5316\u3002" },
      { id: 10, title: "\u6C14\u6001\u884C\u661F\u7684\u6B96\u6C11", description: "\u4EBA\u7C7B\u5728\u4E00\u4E2A\u6C14\u6001\u884C\u661F\u4E0A\u5EFA\u7ACB\u57CE\u5E02\uFF0C\u57CE\u5E02\u50CF\u6F02\u6D6E\u5728\u4E91\u6D77\u4E2D\u7684\u5DE8\u5927\u6C34\u6BCD\u3002\u8FD9\u79CD\u8BBE\u5B9A\u5C55\u73B0\u672A\u6765\u7A7A\u95F4\u63A2\u7D22\u7684\u5947\u5E7B\u573A\u666F\uFF0C\u5F3A\u8C03\u4EBA\u7C7B\u5BF9\u6781\u7AEF\u73AF\u5883\u7684\u9002\u5E94\u80FD\u529B\u3002" },
      { id: 11, title: "\u5145\u6EE1\u8F90\u5C04\u7684\u5B87\u5B99", description: "\u5B87\u5B99\u4E2D\u5145\u6EE1\u81F4\u547D\u8F90\u5C04\uFF0C\u53EA\u6709\u5C11\u6570\u9634\u5F71\u5730\u5E26\u7684\u884C\u661F\u9002\u5408\u5C45\u4F4F\u3002\u8FD9\u53CD\u6620\u672A\u6765\u4EBA\u7C7B\u5728\u5371\u9669\u73AF\u5883\u4E2D\u751F\u5B58\u7684\u8270\u96BE\uFF0C\u4E5F\u4E3A\u79D1\u5E7B\u6545\u4E8B\u63D0\u4F9B\u4E86\u80CC\u666F\u3002" },
      { id: 12, title: "\u57FA\u56E0\u7F16\u7801\u7684\u77E5\u8BC6", description: "\u77E5\u8BC6\u901A\u8FC7\u57FA\u56E0\u7F16\u7801\u76F4\u63A5\u5199\u5165DNA\uFF0C\u4F46\u9519\u8BEF\u7684\u7F16\u7801\u4F1A\u5BFC\u81F4\u8EAB\u4F53\u7578\u53D8\u3002\u8FD9\u4E00\u8BBE\u5B9A\u7ED3\u5408\u751F\u7269\u79D1\u6280\u4E0E\u9057\u4F20\u5B66\uFF0C\u5F3A\u8C03\u57FA\u56E0\u64CD\u63A7\u7684\u6F5C\u5728\u98CE\u9669\u3002" },
      { id: 13, title: "\u5730\u7403\u7684\u5916\u58F3", description: "\u5730\u7403\u88AB\u4E00\u4E2A\u5DE8\u5927\u7684\u5916\u661F\u9020\u7269\u5305\u88F9\uFF0C\u50CF\u4E00\u4E2A\u86CB\uFF0C\u5916\u9762\u672A\u77E5\u3002\u8FD9\u4E2A\u8BBE\u5B9A\u5F15\u53D1\u5BF9\u5730\u7403\u5916\u5C42\u672A\u77E5\u7684\u63A2\u7D22\u6B32\u671B\uFF0C\u4E5F\u6697\u793A\u4EBA\u7C7B\u5BF9\u5B87\u5B99\u5965\u79D8\u7684\u63A2\u7D22\u3002" },
      { id: 14, title: "\u7761\u7720\u7684\u8D44\u6E90", description: "\u7761\u7720\u53EF\u4EE5\u88AB\u5077\u8D70\uFF0C\u4E13\u4E1A\u76D7\u68A6\u8D3C\u5728\u9ED1\u5E02\u51FA\u552E\u6DF1\u5EA6\u7761\u7720\u3002\u7761\u7720\u6210\u4E3A\u4E00\u79CD\u7A00\u7F3A\u8D44\u6E90\uFF0C\u53CD\u6620\u73B0\u4EE3\u793E\u4F1A\u5BF9\u4F11\u606F\u7684\u6E34\u671B\u4E0E\u5265\u593A\u3002" },
      { id: 15, title: "\u8BED\u8A00\u7684\u529B\u91CF", description: "\u67D0\u4E9B\u7981\u8BED\u4E00\u65E6\u8BF4\u51FA\u53E3\u4F1A\u5F15\u53D1\u707E\u96BE\uFF0C\u8BED\u8A00\u62E5\u6709\u7269\u7406\u529B\u91CF\u3002\u8FD9\u4E00\u8BBE\u5B9A\u5F3A\u8C03\u8BED\u8A00\u7684\u5A01\u529B\u4E0E\u7981\u5FCC\uFF0C\u5E26\u6765\u4E30\u5BCC\u7684\u6545\u4E8B\u51B2\u7A81\u3002" },
      { id: 16, title: "\u592A\u9633\u5373\u5C06\u706D\u4EA1", description: "\u4EBA\u7C7B\u6587\u660E\u8FC1\u79FB\u5230\u73AF\u7ED5\u5730\u7403\u7684\u6234\u68EE\u73AF\u4E0A\uFF0C\u5730\u7403\u88AB\u5E9F\u5F03\u3002\u8FD9\u53CD\u6620\u672A\u6765\u5730\u7403\u7684\u5371\u673A\u4E0E\u4EBA\u7C7B\u7684\u8FC1\u5F99\uFF0C\u5F3A\u8C03\u79D1\u6280\u5BF9\u751F\u5B58\u7684\u5F71\u54CD\u3002" }
    ]
  },
  {
    id: "urban-legend",
    title: "\u90FD\u5E02\u602A\u8C08",
    items: [
      { id: 17, title: "\u955C\u5B50\u901A\u5F80\u955C\u50CF\u4E16\u754C", description: "\u57CE\u5E02\u4E2D\u7684\u6BCF\u4E00\u9762\u955C\u5B50\u90FD\u662F\u901A\u5F80\u955C\u50CF\u4E16\u754C\u7684\u5165\u53E3\uFF0C\u4F46\u955C\u50CF\u4E2D\u7684\u4F60\u53EF\u80FD\u5E76\u4E0D\u53CB\u597D\u3002\u8FD9\u4E00\u8BBE\u5B9A\u5E26\u6765\u5173\u4E8E\u81EA\u6211\u4E0E\u5E73\u884C\u4E16\u754C\u7684\u60AC\u7591\u5143\u7D20\u3002" },
      { id: 18, title: "\u79DF\u501F\u8FD0\u6C14", description: "\u4EBA\u4EEC\u901A\u8FC7app\u79DF\u501F\u522B\u4EBA\u7684\u8FD0\u6C14\uFF0C\u8017\u5C3D\u540E\u4F1A\u5E26\u6765\u5012\u9709\u3002\u8FD9\u53CD\u6620\u73B0\u4EE3\u793E\u4F1A\u5BF9\u8FD0\u6C14\u4E0E\u547D\u8FD0\u7684\u8FF7\u4FE1\uFF0C\u4E5F\u5E26\u6709\u4E00\u5B9A\u7684\u9ED1\u6697\u5E7D\u9ED8\u3002" },
      { id: 19, title: "\u7535\u8BDD\u4EAD\u7684\u8BE1\u5F02", description: "\u5E9F\u5F03\u7535\u8BDD\u4EAD\u5728\u5348\u591C\u54CD\u8D77\uFF0C\u63A5\u7535\u8BDD\u7684\u4EBA\u4F1A\u88AB\u62C9\u5165\u7535\u8BDD\u7EBF\u4E2D\u7684\u8BE1\u5F02\u7A7A\u95F4\u3002\u8FD9\u79CD\u8BBE\u5B9A\u878D\u5408\u4E86\u90FD\u5E02\u4F20\u8BF4\u4E0E\u6050\u6016\u5143\u7D20\u3002" },
      { id: 20, title: "\u6D41\u6D6A\u732B\u72D7", description: "\u6240\u6709\u6D41\u6D6A\u732B\u72D7\u5176\u5B9E\u90FD\u662F\u4E00\u4E2A\u53E4\u8001\u60C5\u62A5\u7EC4\u7EC7\u7684\u773C\u7EBF\uFF0C\u76D1\u89C6\u7740\u57CE\u5E02\u7684\u4E00\u5207\u3002" },
      { id: 21, title: "\u5931\u8E2A\u7684\u4EBA", description: "\u6240\u6709\u5931\u8E2A\u7684\u4EBA\u90FD\u85CF\u5728\u672A\u5F00\u653E\u7684\u5730\u94C1\u7CFB\u7EDF\u76840\u53F7\u7EBF\u4E2D\uFF0C\u6697\u793A\u57CE\u5E02\u4E2D\u9690\u85CF\u7684\u79D8\u5BC6\u7A7A\u95F4\u3002" },
      { id: 22, title: "\u5E7D\u7075\u5EFA\u7B51", description: "\u62C6\u8FC1\u540E\u7684\u8001\u5C0F\u533A\u4F1A\u4EE5\u5E7D\u7075\u5EFA\u7B51\u7684\u5F62\u5F0F\u5728\u57CE\u5E02\u4E2D\u91CD\u73B0\uFF0C\u8868\u73B0\u57CE\u5E02\u8BB0\u5FC6\u4E0E\u9057\u5FD8\u7684\u4E3B\u9898\u3002" },
      { id: 23, title: "\u7279\u6B8A\u5916\u5356", description: "\u53EA\u9001\u5F80\u4E0D\u5B58\u5728\u5730\u5740\u7684\u5916\u5356\uFF0C\u7B7E\u6536\u8005\u4F1A\u83B7\u5F97\u8D85\u80FD\u529B\uFF0C\u4F46\u4EE3\u4EF7\u662F\u6210\u4E3A\u9001\u9910\u5458\u3002\u8FD9\u79CD\u8BBE\u5B9A\u878D\u5408\u4E86\u5947\u5E7B\u4E0E\u9ED1\u8272\u5E7D\u9ED8\u3002" },
      { id: 24, title: "\u8BF4\u8C0E\u7684\u989D\u5EA6", description: "\u6BCF\u4E2A\u4EBA\u4E00\u751F\u4E2D\u8BF4\u8C0E\u7684\u6B21\u6570\u6709\u9650\uFF0C\u7528\u5B8C\u540E\u5C31\u65E0\u6CD5\u518D\u8BF4\u8C0E\uFF0C\u5F3A\u8C03\u8BDA\u4FE1\u4E0E\u793E\u4F1A\u89C4\u5219\u3002" }
    ]
  },
  {
    id: "alt-history",
    title: "\u5386\u53F2\u6B67\u8DEF",
    items: [
      { id: 25, title: "\u7F57\u9A6C\u5E1D\u56FD\u7684\u5947\u5E7B\u5386\u53F2", description: "\u7F57\u9A6C\u6CA1\u6709\u8870\u843D\uFF0C\u53CD\u800C\u63D0\u524D\u5B9E\u73B0\u4E86\u5DE5\u4E1A\u9769\u547D\uFF0C\u7528\u84B8\u6C7D\u89D2\u6597\u58EB\u5F81\u670D\u4E16\u754C\u3002\u8FD9\u4E2A\u8BBE\u5B9A\u98A0\u8986\u4F20\u7EDF\u5386\u53F2\uFF0C\u878D\u5408\u9B54\u6CD5\u4E0E\u673A\u68B0\u3002" },
      { id: 26, title: "\u79E6\u59CB\u7687", description: "\u79E6\u59CB\u7687\u771F\u7684\u957F\u751F\u4E0D\u8001\u4E86\uFF0C\u6D3B\u5230\u73B0\u4EE3\u3002\u4F46\u89C9\u5F97\u6CA1\u610F\u601D\uFF0C\u6B63\u85CF\u5728\u666E\u901A\u4EBA\u91CC\u4F53\u9A8C\u751F\u6D3B\u3002" },
      { id: 27, title: "\u9B54\u6CD5\u4E0E\u5DE5\u4E1A", description: "\u5DE5\u4E1A\u9769\u547D\u7684\u80FD\u6E90\u4E0D\u662F\u7164\u70AD\uFF0C\u800C\u662F\u5143\u7D20\u7CBE\u7075\uFF0C\u7EF4\u591A\u5229\u4E9A\u65F6\u4EE3\u5145\u6EE1\u9B54\u6CD5\u4E0E\u673A\u68B0\u7684\u7ED3\u5408\u3002" },
      { id: 28, title: "\u53E4\u75C5\u6BD2\u7684\u667A\u6167", description: "\u8FDC\u53E4\u75C5\u6BD2\u6F14\u5316\u51FA\u667A\u6167\uFF0C\u5BC4\u751F\u5728\u4EBA\u8111\u4E2D\uFF0C\u521B\u5EFA\u5171\u751F\u6587\u660E\uFF0C\u6697\u793A\u5FAE\u751F\u7269\u7684\u6F5C\u5728\u5A01\u80C1\u3002" },
      { id: 29, title: "\u54E5\u4F26\u5E03\u7684\u53D1\u73B0", description: "\u54E5\u4F26\u5E03\u53D1\u73B0\u7684\u4E0D\u662F\u7F8E\u6D32\uFF0C\u800C\u662F\u901A\u5F80\u514B\u82CF\u9C81\u795E\u8BDD\u4E16\u754C\u7684\u95E8\uFF0C\u878D\u5408\u795E\u8BDD\u5143\u7D20\u3002" },
      { id: 30, title: "\u5B8B\u4EE3\u6D3B\u5B57\u5370\u5237", description: "\u80FD\u590D\u5236\u7981\u5492\u7684\u6D3B\u5B57\u5370\u5237\u672F\u5F15\u53D1\u957F\u65F6\u95F4\u7684\u6697\u6218\uFF0C\u5F3A\u8C03\u6280\u672F\u5728\u9B54\u6CD5\u4E2D\u7684\u4F5C\u7528\u3002" },
      { id: 31, title: "\u53E4\u57C3\u53CA\u7684\u65F6\u95F4\u6280\u672F", description: "\u53E4\u57C3\u53CA\u6CD5\u8001\u638C\u63E1\u51CF\u7F13\u65F6\u95F4\u7684\u6280\u672F\uFF0C\u80FD\u7528\u51E0\u5343\u5E74\u5EFA\u9020\u91D1\u5B57\u5854\uFF0C\u5C55\u73B0\u53E4\u4EE3\u79D1\u6280\u7684\u795E\u79D8\u3002" },
      { id: 32, title: "\u6050\u9F99\u7684\u6F14\u5316", description: "\u6050\u9F99\u672A\u706D\u7EDD\uFF0C\u800C\u662F\u6F14\u5316\u6210\u9AD8\u667A\u6167\u79CD\u65CF\uFF0C\u5C06\u4EBA\u7C7B\u89C6\u4E3A\u77ED\u547D\u5BA0\u7269\uFF0C\u53CD\u8F6C\u751F\u7269\u6F14\u5316\u7684\u4F20\u7EDF\u89C2\u5FF5\u3002" }
    ]
  },
  {
    id: "weird-fiction",
    title: "\u602A\u6838\u5F02\u60F3",
    items: [
      { id: 33, title: "\u4E16\u754C\u5E73\u9762", description: "\u4E16\u754C\u5B9E\u9645\u4E0A\u662F\u5E73\u7684\uFF0C\u8FB9\u7F18\u662F\u5DE8\u5927\u7011\u5E03\uFF0C\u4EBA\u4EEC\u5728\u7011\u5E03\u4E0B\u6253\u635E\u6B8B\u9AB8\uFF0C\u8C61\u5F81\u5BF9\u672A\u77E5\u7684\u63A2\u7D22\u3002" },
      { id: 34, title: "\u65E0\u4E94\u5B98\u7684\u51FA\u751F", description: "\u6709\u4EBA\u51FA\u751F\u65F6\u6CA1\u6709\u4E94\u5B98\uFF0C\u901A\u8FC7\u52AA\u529B\u83B7\u5F97\u773C\u775B\u3001\u9F3B\u5B50\u3001\u5634\uFF0C\u5F3A\u8C03\u6210\u957F\u4E0E\u52AA\u529B\u3002" },
      { id: 35, title: "\u989C\u8272\u7684\u4ED8\u8D39", description: "\u989C\u8272\u662F\u4ED8\u8D39\u8D2D\u4E70\u7684\u6D88\u8017\u54C1\uFF0C\u7A77\u4EBA\u53EA\u80FD\u751F\u6D3B\u5728\u9ED1\u767D\u7070\u7684\u4E16\u754C\u4E2D\uFF0C\u53CD\u6620\u793E\u4F1A\u9636\u7EA7\u5DEE\u5F02\u3002" },
      { id: 36, title: "\u6D3B\u7684\u5EFA\u7B51", description: "\u6240\u6709\u5EFA\u7B51\u90FD\u5177\u6709\u60C5\u7EEA\u548C\u6B32\u671B\uFF0C\u9700\u5582\u517B\uFF0C\u5426\u5219\u4F1A\u201C\u79BB\u5BB6\u51FA\u8D70\u201D\uFF0C\u5BD3\u610F\u4EBA\u4E0E\u73AF\u5883\u7684\u5173\u7CFB\u3002" },
      { id: 37, title: "\u6982\u5FF5\u96E8", description: "\u5929\u4E0A\u4F1A\u4E0B\u6982\u5FF5\u96E8\uFF0C\u60B2\u4F24\u96E8\u8BA9\u57CE\u5E02\u75DB\u54ED\uFF0C\u9057\u5FD8\u96E8\u8BA9\u4EBA\u5FD8\u8BB0\u540D\u5B57\uFF0C\u8C61\u5F81\u60C5\u611F\u4E0E\u8BB0\u5FC6\u7684\u6D41\u52A8\u3002" },
      { id: 38, title: "\u7269\u7406\u6CD5\u5219\u7684\u5168\u6C11\u6295\u7968", description: "\u6BCF\u5468\u6295\u7968\u51B3\u5B9A\u4E00\u6B21\u7269\u7406\u6CD5\u5219\uFF0C\u6BD4\u5982\u51CF\u534A\u91CD\u529B\uFF0C\u4F53\u73B0\u793E\u4F1A\u5BF9\u81EA\u7136\u6CD5\u5219\u7684\u5E72\u9884\u3002" },
      { id: 39, title: "\u5F71\u5B50\u7684\u751F\u547D", description: "\u5F71\u5B50\u662F\u72EC\u7ACB\u7684\u751F\u7269\uFF0C\u6709\u81EA\u5DF1\u7684\u793E\u4F1A\uFF0C\u53EA\u5728\u767D\u5929\u8DDF\u968F\u4EBA\u7C7B\uFF0C\u6697\u793A\u6F5C\u610F\u8BC6\u4E0E\u9634\u5F71\u7684\u5B58\u5728\u3002" },
      { id: 40, title: "\u6B7B\u4EA1\u7684\u518D\u751F", description: "\u6B7B\u4EA1\u4E0D\u662F\u7EC8\u70B9\uFF0C\u800C\u662F\u4E00\u79CD\u751F\u6B96\u65B9\u5F0F\uFF0C\u6B7B\u540E\u6210\u4E3A\u4E16\u754C\u89C4\u5219\u7684\u4E00\u90E8\u5206\uFF0C\u5982\u98CE\u7B49\u81EA\u7136\u5143\u7D20\u3002" }
    ]
  }
];

// components/Sidebar.tsx
init_icons();
import React from "react";
import { jsx as jsx3, jsxs as jsxs2 } from "react/jsx-runtime";
var NavItem = ({ label, view, icon, currentView, setView }) => {
  const isActive = currentView === view;
  return /* @__PURE__ */ jsxs2(
    "button",
    {
      onClick: () => setView(view),
      className: `w-full flex flex-col items-center justify-center gap-1.5 px-1 py-3 rounded-md text-xs font-medium transition-colors ${isActive ? "bg-slate-100 text-gray-800 dark:bg-zinc-700 dark:text-zinc-100" : "text-gray-600 hover:bg-slate-100/60 dark:text-zinc-300 dark:hover:bg-zinc-800"}`,
      "aria-current": isActive ? "page" : void 0,
      children: [
        React.cloneElement(icon, { className: "w-5 h-5" }),
        /* @__PURE__ */ jsx3("span", { children: label })
      ]
    }
  );
};
var Sidebar = ({ currentView, setView }) => {
  return /* @__PURE__ */ jsxs2("aside", { className: "w-24 bg-white p-4 flex flex-col border-r border-gray-200 dark:bg-zinc-900 dark:border-zinc-800", children: [
    /* @__PURE__ */ jsx3("div", { className: "mb-8 text-center", children: /* @__PURE__ */ jsx3("h1", { className: "text-lg font-bold text-gray-800 dark:text-zinc-100", children: "\u6545\u4E8B\u5BB6" }) }),
    /* @__PURE__ */ jsxs2("nav", { className: "flex-grow space-y-2", children: [
      /* @__PURE__ */ jsx3(NavItem, { label: "\u5361\u724C\u5199\u4F5C", view: "writer", icon: /* @__PURE__ */ jsx3(PenSparkleIcon, {}), currentView, setView }),
      /* @__PURE__ */ jsx3(NavItem, { label: "\u7075\u611F\u96C6", view: "inspiration", icon: /* @__PURE__ */ jsx3(LightbulbIcon, {}), currentView, setView }),
      /* @__PURE__ */ jsx3(NavItem, { label: "\u5927\u7EB2\u5185\u5BB9", view: "result", icon: /* @__PURE__ */ jsx3(DocumentTextIcon, {}), currentView, setView }),
      /* @__PURE__ */ jsx3(NavItem, { label: "\u6545\u4E8B\u5B58\u6863", view: "archive", icon: /* @__PURE__ */ jsx3(ArchiveBoxIcon, {}), currentView, setView }),
      /* @__PURE__ */ jsx3(NavItem, { label: "\u6545\u4E8B\u6280\u5DE7", view: "tips", icon: /* @__PURE__ */ jsx3(QuestionMarkCircleIcon, {}), currentView, setView })
    ] }),
    /* @__PURE__ */ jsxs2("div", { className: "mt-auto space-y-2", children: [
      /* @__PURE__ */ jsx3(NavItem, { label: "\u8BBE\u7F6E", view: "settings", icon: /* @__PURE__ */ jsx3(SettingsIcon, {}), currentView, setView }),
      /* @__PURE__ */ jsx3(NavItem, { label: "\u5173\u4E8E", view: "about", icon: /* @__PURE__ */ jsx3(InformationCircleIcon, {}), currentView, setView })
    ] })
  ] });
};
var Sidebar_default = Sidebar;

// components/WriterView.tsx
init_types();
init_constants();
init_aiService();
import { useState as useState4, useMemo, useCallback as useCallback2, useEffect as useEffect3, useRef as useRef2 } from "react";

// components/CardComponent.tsx
init_icons();
import React2 from "react";
import { jsx as jsx4, jsxs as jsxs3 } from "react/jsx-runtime";
var CardComponent = ({ card, onClick, isSelected, onDragStart, onDragEnd, onEdit, onDelete }) => {
  const interactionClasses = isSelected ? "grayscale opacity-60 cursor-not-allowed" : "cursor-pointer active:cursor-grabbing";
  const handleDragStartInternal = (e) => {
    if (isSelected) {
      e.preventDefault();
      return;
    }
    e.dataTransfer.setData("text/plain", card.id);
    onDragStart();
  };
  const handleCardClick = () => {
    if (!isSelected) {
      onClick(card);
    }
  };
  const handleEditClick = (e) => {
    e.stopPropagation();
    onEdit?.(card);
  };
  const handleDeleteClick = (e) => {
    e.stopPropagation();
    onDelete?.(card.id, card.name);
  };
  return /* @__PURE__ */ jsx4(
    "div",
    {
      className: `flip-card group h-24 ${interactionClasses}`,
      draggable: !isSelected,
      onDragStart: handleDragStartInternal,
      onDragEnd,
      onClick: handleCardClick,
      role: isSelected ? void 0 : "button",
      "aria-disabled": isSelected,
      tabIndex: isSelected ? -1 : 0,
      onKeyDown: (e) => {
        if (!isSelected && (e.key === "Enter" || e.key === " ")) {
          e.preventDefault();
          onClick(card);
        }
      },
      children: /* @__PURE__ */ jsxs3("div", { className: "flip-card-inner", children: [
        /* @__PURE__ */ jsxs3("div", { className: "flip-card-front p-3 bg-white border border-gray-200 shadow-sm flex flex-col items-center justify-center text-center dark:bg-zinc-800 dark:border-zinc-700", children: [
          /* @__PURE__ */ jsx4("div", { className: `text-gray-500 mb-2 transition-transform duration-200 ${!isSelected && "group-hover:text-gray-800 dark:group-hover:text-zinc-200"}`, children: React2.cloneElement(card.icon, { className: "w-5 h-5" }) }),
          /* @__PURE__ */ jsx4("h4", { className: "font-semibold text-sm text-gray-700 dark:text-zinc-300", children: card.name })
        ] }),
        /* @__PURE__ */ jsxs3("div", { className: "flip-card-back p-3 bg-slate-50 border border-gray-200 shadow-sm flex flex-col items-center justify-center text-center dark:bg-zinc-700 dark:border-zinc-600", children: [
          card.isCustom && onEdit && onDelete && !isSelected && /* @__PURE__ */ jsxs3("div", { className: "absolute top-1 right-1 flex items-center space-x-1 z-10", children: [
            /* @__PURE__ */ jsx4(
              "button",
              {
                onClick: handleEditClick,
                className: "p-1 text-gray-400 hover:text-gray-700 rounded-full hover:bg-gray-100 dark:hover:text-zinc-200 dark:hover:bg-zinc-700",
                "aria-label": `\u7F16\u8F91 ${card.name}`,
                title: "\u7F16\u8F91",
                children: /* @__PURE__ */ jsx4(PencilIcon, { className: "w-3.5 h-3.5" })
              }
            ),
            /* @__PURE__ */ jsx4(
              "button",
              {
                onClick: handleDeleteClick,
                className: "p-1 text-gray-400 hover:text-red-600 rounded-full hover:bg-red-50 dark:hover:bg-red-900/50",
                "aria-label": `\u5220\u9664 ${card.name}`,
                title: "\u5220\u9664",
                children: /* @__PURE__ */ jsx4(TrashIcon, { className: "w-3.5 h-3.5" })
              }
            )
          ] }),
          /* @__PURE__ */ jsx4("p", { className: "text-sm text-gray-600 font-medium dark:text-zinc-200", children: card.name }),
          /* @__PURE__ */ jsx4("div", { className: "w-1/4 h-px bg-gray-300 my-2 dark:bg-zinc-500" }),
          /* @__PURE__ */ jsx4("p", { className: "text-sm text-gray-500 px-1 dark:text-zinc-400", children: card.tooltipText })
        ] })
      ] })
    }
  );
};
var CardComponent_default = CardComponent;

// components/CardCarousel.tsx
init_icons();
import React3, { useState, useRef, useEffect, useCallback } from "react";
import { Fragment, jsx as jsx5, jsxs as jsxs4 } from "react/jsx-runtime";
var AUTOPLAY_INTERVAL = 5e3;
var FLING_THRESHOLD = 50;
var CardCarousel = ({ cards, onCardSelect, isCardSelected, onEdit, onDelete }) => {
  const [activeIndex, setActiveIndex] = useState(0);
  const [isDragging, setIsDragging] = useState(false);
  const [dragStartX, setDragStartX] = useState(0);
  const [dragDeltaX, setDragDeltaX] = useState(0);
  const [isHovered, setIsHovered] = useState(false);
  const [isFlinging, setIsFlinging] = useState(null);
  const containerRef = useRef(null);
  const detailViewRef = useRef(null);
  const autoplayIntervalRef = useRef(null);
  let lastWheelTime = 0;
  const goToNext = useCallback(() => {
    setActiveIndex((prev) => (prev + 1) % cards.length);
  }, [cards.length]);
  const goToPrev = useCallback(() => {
    setActiveIndex((prev) => (prev - 1 + cards.length) % cards.length);
  }, [cards.length]);
  useEffect(() => {
    if (isHovered && !isDragging) {
      autoplayIntervalRef.current = window.setInterval(goToNext, AUTOPLAY_INTERVAL);
    } else if (autoplayIntervalRef.current) {
      clearInterval(autoplayIntervalRef.current);
    }
    return () => {
      if (autoplayIntervalRef.current) {
        clearInterval(autoplayIntervalRef.current);
      }
    };
  }, [isHovered, isDragging, goToNext]);
  const handleWheel = useCallback((e) => {
    e.preventDefault();
    const now = Date.now();
    if (now - lastWheelTime < 150) return;
    lastWheelTime = now;
    if (e.deltaY > 0) {
      goToNext();
    } else {
      goToPrev();
    }
  }, [goToNext, goToPrev]);
  useEffect(() => {
    const container = containerRef.current;
    container?.addEventListener("wheel", handleWheel, { passive: false });
    return () => {
      container?.removeEventListener("wheel", handleWheel);
    };
  }, [handleWheel]);
  useEffect(() => {
    const detailView = detailViewRef.current;
    if (detailView) {
      detailView.classList.remove("animate-detail-fade-in");
      setTimeout(() => detailView.classList.add("animate-detail-fade-in"), 10);
    }
  }, [activeIndex]);
  const onDragStart = (x) => {
    setIsDragging(true);
    setDragStartX(x);
  };
  const onDragMove = (x) => {
    if (!isDragging) return;
    setDragDeltaX(x - dragStartX);
  };
  const onDragEnd = () => {
    if (!isDragging) return;
    setIsDragging(false);
    if (Math.abs(dragDeltaX) > FLING_THRESHOLD) {
      const direction = dragDeltaX < 0 ? "left" : "right";
      setIsFlinging(direction);
      setTimeout(() => {
        if (direction === "left") {
          goToNext();
        } else {
          goToPrev();
        }
        setIsFlinging(null);
        setDragDeltaX(0);
      }, 300);
    } else {
      setDragDeltaX(0);
    }
  };
  const handleMouseDown = (e) => onDragStart(e.clientX);
  const handleMouseMove = (e) => onDragMove(e.clientX);
  const handleTouchStart = (e) => onDragStart(e.touches[0].clientX);
  const handleTouchMove = (e) => onDragMove(e.touches[0].clientX);
  const activeCard = cards[activeIndex];
  if (!activeCard) return null;
  const cardIsSelected = isCardSelected(activeCard.id);
  return /* @__PURE__ */ jsxs4(
    "div",
    {
      className: "grid grid-cols-2 gap-x-4 items-start",
      onMouseEnter: () => setIsHovered(true),
      onMouseLeave: () => setIsHovered(false),
      children: [
        /* @__PURE__ */ jsxs4("div", { className: "flex flex-col items-center justify-center h-36", children: [
          /* @__PURE__ */ jsx5("div", { ref: containerRef, className: "relative h-28 w-full flex items-center justify-center card-carousel-viewport", children: cards.map((card, index) => {
            const offset = index - activeIndex;
            const isVisible = Math.abs(offset) < 4;
            const isActive = index === activeIndex;
            let transform = `translateY(${offset * 8}px) scale(${1 - Math.abs(offset) * 0.1})`;
            let opacity = isVisible ? 1 : 0;
            let transition = "all 0.5s cubic-bezier(0.23, 1, 0.32, 1)";
            if (offset > 0) {
              transform = `translateX(${offset * 10}px) translateY(${offset * 6}px) scale(${1 - offset * 0.1}) rotate(${offset * 3}deg)`;
            } else if (offset < 0) {
              opacity = 0;
            }
            if (isActive && isDragging) {
              transition = "none";
              transform = `translateX(${dragDeltaX}px) rotate(${dragDeltaX / 10}deg)`;
            }
            if (isActive && isFlinging) {
              transition = "all 0.3s ease-out";
              transform = `translateX(${isFlinging === "left" ? -200 : 200}px) rotate(${isFlinging === "left" ? -20 : 20}deg)`;
              opacity = 0;
            }
            return /* @__PURE__ */ jsxs4(
              "div",
              {
                className: "card-carousel-card absolute w-24 h-24 rounded-lg shadow-md bg-white border border-gray-200 dark:bg-zinc-800 dark:border-zinc-700 flex flex-col items-center justify-center p-3 text-center",
                style: {
                  transform,
                  zIndex: cards.length - Math.abs(offset),
                  opacity,
                  pointerEvents: isActive ? "auto" : isVisible ? "auto" : "none",
                  cursor: isActive ? isDragging ? "grabbing" : "grab" : "pointer",
                  transition
                },
                onClick: () => !isActive && setActiveIndex(index),
                onMouseDown: isActive ? handleMouseDown : void 0,
                onMouseMove: isActive ? handleMouseMove : void 0,
                onMouseUp: isActive ? onDragEnd : void 0,
                onMouseLeave: isActive ? onDragEnd : void 0,
                onTouchStart: isActive ? handleTouchStart : void 0,
                onTouchMove: isActive ? handleTouchMove : void 0,
                onTouchEnd: isActive ? onDragEnd : void 0,
                children: [
                  /* @__PURE__ */ jsx5("div", { className: "text-gray-500 dark:text-zinc-400 mb-2", children: React3.cloneElement(card.icon, { className: "w-5 h-5" }) }),
                  /* @__PURE__ */ jsx5("h4", { className: "font-semibold text-sm text-gray-700 dark:text-zinc-300", children: card.name })
                ]
              },
              card.id
            );
          }) }),
          /* @__PURE__ */ jsx5("div", { className: "flex justify-center items-center space-x-2 mt-2", children: cards.map((_, index) => /* @__PURE__ */ jsx5(
            "button",
            {
              onClick: () => setActiveIndex(index),
              className: `w-2 h-2 rounded-full transition-all duration-300 ${activeIndex === index ? "bg-gray-800 dark:bg-slate-300 scale-125" : "bg-gray-300 hover:bg-gray-400 dark:bg-zinc-600 dark:hover:bg-zinc-500"}`,
              "aria-label": `Go to card ${index + 1}`
            },
            index
          )) })
        ] }),
        /* @__PURE__ */ jsxs4("div", { ref: detailViewRef, className: "flex flex-col max-h-56 min-h-0 p-4 bg-slate-50 rounded-lg dark:bg-zinc-800/50", children: [
          /* @__PURE__ */ jsxs4("div", { className: "flex items-center gap-2 mb-2", children: [
            /* @__PURE__ */ jsx5("div", { className: "text-gray-600 dark:text-zinc-300", children: React3.cloneElement(activeCard.icon, { className: "w-5 h-5" }) }),
            /* @__PURE__ */ jsx5("h3", { className: "text-lg font-bold text-gray-800 dark:text-zinc-100", children: activeCard.name })
          ] }),
          /* @__PURE__ */ jsx5("p", { className: "text-sm text-gray-600 dark:text-zinc-400 mb-3 flex-grow custom-scrollbar overflow-y-auto pr-2", children: activeCard.description }),
          /* @__PURE__ */ jsxs4("div", { className: "flex-shrink-0 flex items-center gap-2 mt-auto", children: [
            /* @__PURE__ */ jsx5(
              "button",
              {
                onClick: () => onCardSelect(activeCard),
                disabled: cardIsSelected,
                className: "flex-grow bg-gray-800 text-white font-semibold py-2 px-4 rounded-lg shadow-sm transition-colors hover:bg-gray-900 disabled:opacity-50 disabled:cursor-not-allowed dark:bg-slate-100 dark:text-gray-800 dark:hover:bg-slate-200 dark:disabled:bg-slate-400 dark:disabled:text-gray-600",
                children: cardIsSelected ? "\u5DF2\u9009\u62E9" : "\u9009\u62E9\u6B64\u5361\u7247"
              }
            ),
            activeCard.isCustom && /* @__PURE__ */ jsxs4(Fragment, { children: [
              /* @__PURE__ */ jsx5(
                "button",
                {
                  onClick: () => onEdit(activeCard),
                  className: "p-2 text-gray-500 hover:text-gray-800 bg-gray-200 hover:bg-gray-300 rounded-lg transition-colors dark:bg-zinc-700 dark:text-zinc-300 dark:hover:bg-zinc-600",
                  "aria-label": "\u7F16\u8F91\u5361\u7247",
                  title: "\u7F16\u8F91",
                  children: /* @__PURE__ */ jsx5(PencilIcon, { className: "w-4 h-4" })
                }
              ),
              /* @__PURE__ */ jsx5(
                "button",
                {
                  onClick: () => onDelete(activeCard.id, activeCard.name),
                  className: "p-2 text-gray-500 hover:text-red-600 bg-gray-200 hover:bg-red-100 rounded-lg transition-colors dark:bg-zinc-700 dark:text-zinc-300 dark:hover:text-red-500 dark:hover:bg-red-900/50",
                  "aria-label": "\u5220\u9664\u5361\u7247",
                  title: "\u5220\u9664",
                  children: /* @__PURE__ */ jsx5(TrashIcon, { className: "w-4 h-4" })
                }
              )
            ] })
          ] })
        ] })
      ]
    }
  );
};
var CardCarousel_default = CardCarousel;

// components/CardSlot.tsx
import React4, { useState as useState2 } from "react";
import { jsx as jsx6, jsxs as jsxs5 } from "react/jsx-runtime";
var CardSlot = ({ cardType, card, onClear, onDropCard, activeDragType, allCards }) => {
  const [isOver, setIsOver] = useState2(false);
  const handleDragOver = (e) => {
    e.preventDefault();
  };
  const handleDragEnter = (e) => {
    e.preventDefault();
    setIsOver(true);
  };
  const handleDragLeave = (e) => {
    e.preventDefault();
    setIsOver(false);
  };
  const handleDrop = (e) => {
    e.preventDefault();
    setIsOver(false);
    try {
      const droppedCardId = e.dataTransfer.getData("text/plain");
      if (!droppedCardId) return;
      const droppedCard = allCards.find((c) => c.id === droppedCardId);
      if (!droppedCard) return;
      if (droppedCard.type === cardType) {
        onDropCard(droppedCard);
      }
    } catch (error) {
      console.error("Failed to handle drop:", error);
    }
  };
  const canAcceptDrop = activeDragType === null || activeDragType === cardType;
  return /* @__PURE__ */ jsx6(
    "div",
    {
      className: "h-24 w-full",
      onDragOver: handleDragOver,
      onDragEnter: handleDragEnter,
      onDragLeave: handleDragLeave,
      onDrop: handleDrop,
      children: card ? /* @__PURE__ */ jsxs5("div", { className: "relative h-full w-full group", children: [
        /* @__PURE__ */ jsxs5("div", { className: "p-3 rounded-lg bg-white border-2 border-gray-400 flex flex-col items-center justify-center text-center shadow-md h-full dark:bg-zinc-700 dark:border-zinc-500", children: [
          /* @__PURE__ */ jsx6("div", { className: "text-gray-700 mb-2 dark:text-zinc-300", children: React4.cloneElement(card.icon, { className: "w-5 h-5" }) }),
          /* @__PURE__ */ jsx6("h4", { className: "font-semibold text-sm text-gray-800 dark:text-zinc-100", children: card.name })
        ] }),
        /* @__PURE__ */ jsx6(
          "button",
          {
            onClick: onClear,
            className: "absolute -top-2 right-8 w-5 h-5 bg-gray-600 text-white rounded-full flex items-center justify-center hover:bg-red-500 transition-colors z-20 text-xs dark:bg-zinc-400 dark:text-zinc-900 dark:hover:bg-red-500",
            "aria-label": `Clear ${cardType}`,
            children: "\xD7"
          }
        ),
        /* @__PURE__ */ jsxs5("div", { className: "absolute bottom-full inset-x-0 mb-2 p-2 text-sm text-center bg-zinc-800 text-white rounded-md shadow-lg transition-opacity duration-300 pointer-events-none z-30 opacity-0 group-hover:opacity-100 dark:bg-zinc-900", children: [
          card.description,
          /* @__PURE__ */ jsx6("div", { className: "absolute top-full left-1/2 -translate-x-1/2 w-0 h-0 border-x-4 border-x-transparent border-t-4 border-t-zinc-800 dark:border-t-zinc-900" })
        ] })
      ] }) : /* @__PURE__ */ jsx6("div", { className: `w-full h-full flex items-center justify-center bg-gray-50/50 border-2 border-dashed rounded-lg transition-all duration-200 dark:bg-zinc-800/40 ${isOver && canAcceptDrop ? "border-blue-500 bg-blue-100/50 dark:bg-blue-900/30 dark:border-blue-400" : "border-gray-300 dark:border-zinc-700"}`, children: /* @__PURE__ */ jsx6("p", { className: `text-sm transition-colors ${isOver && canAcceptDrop ? "text-blue-600 font-medium dark:text-blue-300" : "text-gray-400 dark:text-zinc-500"}`, children: "\u62D6\u62FD\u5361\u7247\u81F3\u6B64" }) })
    }
  );
};
var CardSlot_default = CardSlot;

// components/Spinner.tsx
import { jsx as jsx7, jsxs as jsxs6 } from "react/jsx-runtime";
var Spinner = () => {
  return /* @__PURE__ */ jsxs6("svg", { className: "animate-spin h-5 w-5", xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24", children: [
    /* @__PURE__ */ jsx7("circle", { className: "opacity-25", cx: "12", cy: "12", r: "10", stroke: "currentColor", strokeWidth: "4" }),
    /* @__PURE__ */ jsx7("path", { className: "opacity-75", fill: "currentColor", d: "M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" })
  ] });
};
var Spinner_default = Spinner;

// components/CreateCardModal.tsx
init_constants();
init_types();
init_icons();
import { useState as useState3, useEffect as useEffect2 } from "react";
import { jsx as jsx8, jsxs as jsxs7 } from "react/jsx-runtime";
var PLACEHOLDER_EXAMPLES = {
  ["Theme" /* Theme */]: "\u4F8B\u5982\uFF1A\u7231\u4E0E\u8D23\u4EFB",
  ["Genre" /* Genre */]: "\u4F8B\u5982\uFF1A\u8D5B\u535A\u670B\u514B",
  ["Character" /* Character */]: "\u4F8B\u5982\uFF1A\u4E0D\u60C5\u613F\u7684\u82F1\u96C4",
  ["Plot" /* Plot */]: "\u4F8B\u5982\uFF1A\u5E95\u5C42\u9006\u88AD",
  ["Structure" /* Structure */]: "\u4F8B\u5982\uFF1A\u5355\u7EBF\u578B\u7ED3\u6784",
  ["Technique" /* Technique */]: "\u4F8B\u5982\uFF1A\u5E73\u884C\u53D9\u4E8B",
  ["Ending" /* Ending */]: "\u4F8B\u5982\uFF1A\u5F00\u653E\u5F0F\u7ED3\u5C40",
  ["Inspiration" /* Inspiration */]: "\u4F8B\u5982\uFF1A\u9B54\u6CD5\u6E90\u4E8E\u60C5\u7EEA"
};
var CreateCardModal = ({ isOpen, onClose, onSubmit, cardType, editingCard, config }) => {
  const [name, setName] = useState3("");
  const [tooltipText, setTooltipText] = useState3("");
  const [description, setDescription] = useState3("");
  const [isGenerating, setIsGenerating] = useState3(false);
  const isEditing = !!editingCard;
  useEffect2(() => {
    if (isOpen && isEditing && editingCard) {
      setName(editingCard.name);
      setTooltipText(editingCard.tooltipText);
      setDescription(editingCard.description);
    } else if (isOpen && !isEditing) {
      setName("");
      setTooltipText("");
      setDescription("");
    }
  }, [isOpen, isEditing, editingCard]);
  const handleSubmit = (e) => {
    e.preventDefault();
    if (!name.trim() || !tooltipText.trim() || !description.trim()) {
      alert("\u6240\u6709\u5B57\u6BB5\u5747\u4E3A\u5FC5\u586B\u9879\u3002");
      return;
    }
    onSubmit({
      name,
      tooltipText,
      description,
      id: isEditing ? editingCard.id : void 0
    });
  };
  const handleAiGenerate = async () => {
    if (!name.trim() || isGenerating) {
      return;
    }
    setIsGenerating(true);
    try {
      const { generateCardDetails: generateCardDetails2 } = await Promise.resolve().then(() => (init_aiService(), aiService_exports));
      const details = await generateCardDetails2(name, cardType, config);
      setTooltipText(details.tooltipText);
      setDescription(details.description);
    } catch (error) {
      alert(error instanceof Error ? error.message : "AI \u751F\u6210\u5931\u8D25\u3002");
    } finally {
      setIsGenerating(false);
    }
  };
  if (!isOpen) return null;
  return /* @__PURE__ */ jsxs7(
    "div",
    {
      className: "fixed inset-0 bg-black bg-opacity-60 flex justify-center items-center z-50 p-4 transition-opacity duration-300",
      onClick: onClose,
      role: "dialog",
      "aria-modal": "true",
      "aria-labelledby": "create-card-title",
      children: [
        /* @__PURE__ */ jsxs7(
          "div",
          {
            className: "bg-white rounded-lg shadow-xl w-full max-w-md p-6 transform transition-all duration-300 scale-95 opacity-0 animate-fade-in-scale dark:bg-zinc-800",
            onClick: (e) => e.stopPropagation(),
            style: { animation: "fade-in-scale 0.3s forwards" },
            children: [
              /* @__PURE__ */ jsx8("h2", { id: "create-card-title", className: "text-xl font-bold mb-4 text-gray-800 dark:text-zinc-100", children: isEditing ? `\u7F16\u8F91 ${CARD_TYPE_NAMES[cardType]} \u5361\u7247` : `\u65B0\u5EFA ${CARD_TYPE_NAMES[cardType]} \u5361\u7247` }),
              /* @__PURE__ */ jsxs7("form", { onSubmit: handleSubmit, children: [
                /* @__PURE__ */ jsxs7("div", { className: "space-y-4", children: [
                  /* @__PURE__ */ jsxs7("div", { children: [
                    /* @__PURE__ */ jsxs7("div", { className: "flex justify-between items-center", children: [
                      /* @__PURE__ */ jsx8("label", { htmlFor: "card-name", className: "block text-sm font-medium text-gray-700 dark:text-zinc-300", children: "\u540D\u79F0" }),
                      /* @__PURE__ */ jsxs7(
                        "button",
                        {
                          type: "button",
                          onClick: handleAiGenerate,
                          disabled: !name.trim() || isGenerating,
                          className: "flex items-center gap-1.5 px-2 py-1 text-xs font-medium text-gray-600 bg-gray-100 rounded-md hover:bg-gray-200 transition-colors disabled:opacity-50 disabled:cursor-not-allowed dark:bg-zinc-700 dark:text-zinc-200 dark:hover:bg-zinc-600",
                          title: "\u4F7F\u7528AI\u6839\u636E\u540D\u79F0\u751F\u6210\u63D0\u793A\u548C\u5185\u5BB9",
                          children: [
                            isGenerating ? /* @__PURE__ */ jsx8(Spinner_default, {}) : /* @__PURE__ */ jsx8(SparklesIcon, { className: "w-3 h-3" }),
                            /* @__PURE__ */ jsx8("span", { children: "AI \u751F\u6210" })
                          ]
                        }
                      )
                    ] }),
                    /* @__PURE__ */ jsx8(
                      "input",
                      {
                        id: "card-name",
                        type: "text",
                        value: name,
                        onChange: (e) => setName(e.target.value),
                        className: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-gray-500 focus:border-gray-500 dark:bg-zinc-700 dark:border-zinc-600 dark:text-white",
                        required: true,
                        placeholder: PLACEHOLDER_EXAMPLES[cardType] || "\u4F8B\u5982\uFF1A\u81EA\u5B9A\u4E49\u5361\u7247"
                      }
                    )
                  ] }),
                  /* @__PURE__ */ jsxs7("div", { children: [
                    /* @__PURE__ */ jsx8("label", { htmlFor: "card-tooltip", className: "block text-sm font-medium text-gray-700 dark:text-zinc-300", children: "\u63D0\u793A (Tooltip)" }),
                    /* @__PURE__ */ jsx8(
                      "input",
                      {
                        id: "card-tooltip",
                        type: "text",
                        value: tooltipText,
                        onChange: (e) => setTooltipText(e.target.value),
                        className: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-gray-500 focus:border-gray-500 dark:bg-zinc-700 dark:border-zinc-600 dark:text-white",
                        required: true,
                        placeholder: "\u5BF9\u5361\u7247\u7684\u7B80\u77ED\u63CF\u8FF0"
                      }
                    )
                  ] }),
                  /* @__PURE__ */ jsxs7("div", { children: [
                    /* @__PURE__ */ jsx8("label", { htmlFor: "card-description", className: "block text-sm font-medium text-gray-700 dark:text-zinc-300", children: "\u5185\u5BB9 (Description)" }),
                    /* @__PURE__ */ jsx8(
                      "textarea",
                      {
                        id: "card-description",
                        rows: 4,
                        value: description,
                        onChange: (e) => setDescription(e.target.value),
                        className: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-gray-500 focus:border-gray-500 custom-scrollbar dark:bg-zinc-700 dark:border-zinc-600 dark:text-white",
                        required: true,
                        placeholder: "\u5BF9\u5361\u7247\u7684\u8BE6\u7EC6\u8BF4\u660E\uFF0C\u5C06\u7528\u4E8E AI prompt"
                      }
                    )
                  ] })
                ] }),
                /* @__PURE__ */ jsxs7("div", { className: "mt-6 flex justify-end space-x-3", children: [
                  /* @__PURE__ */ jsx8(
                    "button",
                    {
                      type: "button",
                      onClick: onClose,
                      className: "px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md shadow-sm hover:bg-gray-50 focus:outline-none dark:bg-zinc-600 dark:text-zinc-200 dark:border-zinc-500 dark:hover:bg-zinc-500",
                      children: "\u53D6\u6D88"
                    }
                  ),
                  /* @__PURE__ */ jsx8(
                    "button",
                    {
                      type: "submit",
                      className: "px-4 py-2 text-sm font-medium text-white bg-gray-800 border border-transparent rounded-md shadow-sm hover:bg-gray-900 focus:outline-none dark:bg-slate-100 dark:text-gray-800 dark:hover:bg-slate-200",
                      children: isEditing ? "\u4FDD\u5B58\u66F4\u6539" : "\u521B\u5EFA\u5361\u7247"
                    }
                  )
                ] })
              ] })
            ]
          }
        ),
        /* @__PURE__ */ jsx8("style", { children: `
                @keyframes fade-in-scale {
                    from { transform: scale(0.95); opacity: 0; }
                    to { transform: scale(1); opacity: 1; }
                }
                .animate-fade-in-scale {
                    animation: fade-in-scale 0.2s cubic-bezier(0.16, 1, 0.3, 1) forwards;
                }
            ` })
      ]
    }
  );
};
var CreateCardModal_default = CreateCardModal;

// components/WriterView.tsx
init_icons();
import { Fragment as Fragment2, jsx as jsx9, jsxs as jsxs8 } from "react/jsx-runtime";
var LENGTH_PRESETS = {
  "short": "2\u4E07\u5B57",
  "medium": "5\u4E07\u5B57",
  "long": "10\u4E07\u5B57"
};
var EMOTION_PRESETS = ["\u65E0", "\u7EAF\u7231", "HE", "BE", "\u751C\u5BA0", "\u6697\u604B", "\u8650\u604B", "\u5148\u8650\u540E\u751C", "\u6C99\u96D5", "\u723D\u6587", "\u590D\u4EC7", "\u53CD\u8F6C"];
var getLengthCategory = (wordCount) => {
  if (!wordCount) return "";
  const num = parseInt(wordCount.replace(/[^0-9]/g, ""), 10);
  if (isNaN(num)) return "";
  const value = wordCount.includes("\u4E07") ? num * 1e4 : num;
  if (value > 0 && value < 3e4) return "short";
  if (value >= 3e4 && value < 8e4) return "medium";
  if (value >= 8e4) return "long";
  return "";
};
var WriterView = ({
  config,
  setConfig,
  onStartGeneration,
  combinedCards,
  onCardSelect,
  onClearCard,
  onAddCardSlot,
  onRemoveCardSlot,
  novelInfo,
  setNovelInfo,
  allCards,
  onCreateCard,
  onUpdateCard,
  onDeleteCard,
  uiSettings,
  savedCombinations,
  onSaveCombination,
  onLoadCombination,
  onDeleteCombination
}) => {
  const [isLoading, setIsLoading] = useState4(false);
  const [activeDragType, setActiveDragType] = useState4(null);
  const [activePanel, setActivePanel] = useState4(0);
  const [isModalOpen, setIsModalOpen] = useState4(false);
  const [modalCardType, setModalCardType] = useState4(null);
  const [editingCard, setEditingCard] = useState4(null);
  const [modelList, setModelList] = useState4([]);
  const [isModelListLoading, setIsModelListLoading] = useState4(false);
  const [isModelSelectOpen, setIsModelSelectOpen] = useState4(false);
  const [isCombinationManagerOpen, setIsCombinationManagerOpen] = useState4(false);
  const [modelSearch, setModelSearch] = useState4("");
  const modelSelectRef = useRef2(null);
  const combinationManagerRef = useRef2(null);
  const fileInputRef = useRef2(null);
  const totalPanels = 2;
  useEffect3(() => {
    const handleClickOutside = (event) => {
      if (modelSelectRef.current && !modelSelectRef.current.contains(event.target)) {
        setIsModelSelectOpen(false);
      }
      if (combinationManagerRef.current && !combinationManagerRef.current.contains(event.target)) {
        setIsCombinationManagerOpen(false);
      }
    };
    document.addEventListener("mousedown", handleClickOutside);
    return () => document.removeEventListener("mousedown", handleClickOutside);
  }, []);
  useEffect3(() => {
    const handleKeyDown = (event) => {
      const activeElement = document.activeElement;
      if (activeElement && ["INPUT", "TEXTAREA", "SELECT"].includes(activeElement.tagName)) {
        return;
      }
      if (event.key === "ArrowLeft") {
        setActivePanel((prev) => Math.max(0, prev - 1));
      } else if (event.key === "ArrowRight") {
        setActivePanel((prev) => Math.min(totalPanels - 1, prev + 1));
      }
    };
    window.addEventListener("keydown", handleKeyDown);
    return () => {
      window.removeEventListener("keydown", handleKeyDown);
    };
  }, [totalPanels]);
  useEffect3(() => {
    const loadModels = async () => {
      if (!config.provider) return;
      if (config.provider !== "ollama" && (!config.apiKey || !config.endpoint)) {
        if (config.provider === "gemini" && config.apiKey) {
        } else {
          setModelList([]);
          return;
        }
      }
      setIsModelListLoading(true);
      try {
        const models = await fetchModels(config);
        setModelList(models);
        if (models.length > 0 && !models.includes(config.model)) {
          setConfig((prev) => ({ ...prev, model: models[0] }));
        }
      } catch (error) {
        if (error instanceof Error) {
          console.error("Failed to fetch models for writer view dropdown:", error.message);
        } else {
          console.error("An unexpected error occurred while fetching models:", error);
        }
        setModelList([]);
      } finally {
        setIsModelListLoading(false);
      }
    };
    loadModels();
  }, [config.provider, config.apiKey, config.endpoint, setConfig]);
  const isGenerationReady = useMemo(() => {
    const coreCardsMet = CORE_CARD_TYPES.every((type) => combinedCards[type]?.some((c) => c !== null));
    const novelInfoMet = novelInfo.name && novelInfo.wordCount && novelInfo.synopsis && novelInfo.perspective && novelInfo.channel != null && // FIX: Allow '' (None) as a valid choice
    novelInfo.emotion;
    return coreCardsMet && !!novelInfoMet;
  }, [combinedCards, novelInfo]);
  const isCardSelected = useCallback2((cardId) => {
    return Object.values(combinedCards).flat().some((c) => c?.id === cardId);
  }, [combinedCards]);
  const handleGenerate = async () => {
    if (!isGenerationReady) return;
    onStartGeneration();
  };
  const handleDrawCards = useCallback2(() => {
    const allTypes = [...CORE_CARD_TYPES, ...OPTIONAL_CARD_TYPES];
    allTypes.forEach((type) => {
      const currentSlots = combinedCards[type] || [null];
      const availableCards = allCards.filter((card) => card.type === type);
      if (availableCards.length === 0) return;
      const selectedInThisDraw = /* @__PURE__ */ new Set();
      currentSlots.forEach((_, index) => {
        let candidateCards = availableCards.filter((card) => !selectedInThisDraw.has(card.id));
        if (candidateCards.length === 0) {
          candidateCards = availableCards;
        }
        if (candidateCards.length > 0) {
          const randomIndex = Math.floor(Math.random() * candidateCards.length);
          const selectedCard = candidateCards[randomIndex];
          onCardSelect(selectedCard, index);
          selectedInThisDraw.add(selectedCard.id);
        }
      });
    });
  }, [combinedCards, allCards, onCardSelect]);
  const handleInfoChange = (e) => {
    const { id, value } = e.target;
    setNovelInfo((prev) => ({ ...prev, [id]: value }));
  };
  const handleCardDragStart = (cardType) => {
    setActiveDragType(cardType);
    setActivePanel(0);
  };
  const lengthCategory = useMemo(() => getLengthCategory(novelInfo.wordCount), [novelInfo.wordCount]);
  const handleLengthChange = (e) => {
    const newLength = e.target.value;
    const newWordCount = LENGTH_PRESETS[newLength] || "";
    setNovelInfo((prev) => ({ ...prev, wordCount: newWordCount }));
  };
  const handleOpenModalForCreate = (type) => {
    setEditingCard(null);
    setModalCardType(type);
    setIsModalOpen(true);
  };
  const handleOpenModalForEdit = (card) => {
    setModalCardType(null);
    setEditingCard(card);
    setIsModalOpen(true);
  };
  const handleDeleteRequest = (cardId, cardName) => {
    if (window.confirm(`\u60A8\u786E\u5B9A\u8981\u5220\u9664\u81EA\u5B9A\u4E49\u5361\u7247 \u201C${cardName}\u201D \u5417\uFF1F`)) {
      onDeleteCard(cardId);
    }
  };
  const handleModalSubmit = (cardData) => {
    if (cardData.id && editingCard) {
      onUpdateCard({
        ...editingCard,
        ...cardData
      });
    } else if (modalCardType) {
      onCreateCard({ ...cardData, type: modalCardType });
    }
    setIsModalOpen(false);
    setEditingCard(null);
    setModalCardType(null);
  };
  const filteredModels = useMemo(() => {
    if (!modelSearch) return modelList;
    return modelList.filter((m) => m.toLowerCase().includes(modelSearch.toLowerCase()));
  }, [modelList, modelSearch]);
  const handleImportClick = () => {
    fileInputRef.current?.click();
  };
  const handleFileImport = (e) => {
    const file = e.target.files?.[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = (event) => {
      const content = event.target?.result;
      setNovelInfo((prev) => ({ ...prev, synopsis: content }));
    };
    reader.onerror = () => {
      alert("\u8BFB\u53D6\u6587\u4EF6\u5931\u8D25\u3002");
    };
    reader.readAsText(file);
    e.target.value = "";
  };
  const handleSaveCombinationClick = () => {
    const name = prompt("\u8BF7\u8F93\u5165\u8981\u4FDD\u5B58\u7684\u7EC4\u5408\u540D\u79F0\uFF1A", "\u6211\u7684\u6545\u4E8B\u7EC4\u5408");
    if (name) {
      onSaveCombination(name);
    }
  };
  return /* @__PURE__ */ jsxs8("div", { className: "w-full max-w-7xl mx-auto flex flex-col h-full", children: [
    /* @__PURE__ */ jsxs8("header", { className: "flex justify-start items-center mb-6 gap-4 flex-wrap", children: [
      /* @__PURE__ */ jsx9(
        "button",
        {
          onClick: handleGenerate,
          disabled: !isGenerationReady || isLoading,
          className: "bg-gray-800 text-white font-semibold py-2 px-5 rounded-lg shadow-sm transition-all duration-300 ease-in-out hover:bg-gray-900 disabled:opacity-50 disabled:cursor-not-allowed disabled:bg-gray-400 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-700 flex items-center justify-center gap-2 dark:bg-slate-100 dark:text-gray-800 dark:hover:bg-slate-200 dark:disabled:bg-slate-400 dark:disabled:text-gray-600",
          children: isLoading ? /* @__PURE__ */ jsxs8(Fragment2, { children: [
            /* @__PURE__ */ jsx9(Spinner_default, {}),
            " \u751F\u6210\u4E2D..."
          ] }) : "\u4E00\u952E\u751F\u6210"
        }
      ),
      /* @__PURE__ */ jsx9(
        "button",
        {
          onClick: handleDrawCards,
          disabled: isLoading,
          className: "bg-white text-gray-800 font-semibold py-2 px-5 rounded-lg shadow-sm transition-all duration-300 ease-in-out border border-gray-300 hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-400 dark:bg-zinc-700 dark:text-zinc-100 dark:border-zinc-600 dark:hover:bg-zinc-600",
          children: "\u62BD\u5361"
        }
      ),
      /* @__PURE__ */ jsxs8("div", { ref: modelSelectRef, className: "relative w-48", children: [
        /* @__PURE__ */ jsxs8(
          "button",
          {
            type: "button",
            onClick: () => setIsModelSelectOpen(!isModelSelectOpen),
            disabled: isModelListLoading,
            className: "w-full flex items-center justify-between pl-3 pr-2 py-2 text-sm bg-white border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-gray-500 focus:border-gray-500 disabled:opacity-60 disabled:bg-gray-100 transition-all dark:bg-zinc-700 dark:border-zinc-600 dark:text-zinc-100 dark:disabled:bg-zinc-600",
            "aria-haspopup": "listbox",
            "aria-expanded": isModelSelectOpen,
            "aria-label": "\u9009\u62E9\u6A21\u578B",
            children: [
              /* @__PURE__ */ jsx9("span", { className: "truncate", children: isModelListLoading ? "\u52A0\u8F7D\u4E2D..." : config.model || "\u9009\u62E9\u6A21\u578B" }),
              /* @__PURE__ */ jsx9("svg", { className: "fill-current h-4 w-4 opacity-50", xmlns: "http://www.w3.org/2000/svg", viewBox: "0 0 20 20", children: /* @__PURE__ */ jsx9("path", { d: "M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z" }) })
            ]
          }
        ),
        isModelSelectOpen && /* @__PURE__ */ jsxs8("div", { className: "absolute z-10 mt-1 w-full bg-white dark:bg-zinc-700 rounded-md shadow-lg border border-gray-200 dark:border-zinc-600", children: [
          /* @__PURE__ */ jsx9("div", { className: "p-2", children: /* @__PURE__ */ jsx9(
            "input",
            {
              type: "text",
              value: modelSearch,
              onChange: (e) => setModelSearch(e.target.value),
              placeholder: "\u641C\u7D22\u6A21\u578B...",
              className: "w-full px-2 py-1.5 text-sm border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-gray-500 focus:border-gray-500 dark:bg-zinc-600 dark:border-zinc-500 dark:text-white"
            }
          ) }),
          /* @__PURE__ */ jsx9("ul", { className: "max-h-60 overflow-y-auto text-sm custom-scrollbar", role: "listbox", children: filteredModels.length > 0 ? filteredModels.map((modelName) => /* @__PURE__ */ jsx9(
            "li",
            {
              onClick: () => {
                setConfig((prev) => ({ ...prev, model: modelName }));
                setIsModelSelectOpen(false);
                setModelSearch("");
              },
              className: "px-3 py-2 cursor-pointer hover:bg-gray-100 dark:hover:bg-zinc-600",
              role: "option",
              "aria-selected": config.model === modelName,
              children: modelName
            },
            modelName
          )) : /* @__PURE__ */ jsx9("li", { className: "px-3 py-2 text-gray-500 dark:text-zinc-400", children: "\u65E0\u5339\u914D\u6A21\u578B" }) })
        ] })
      ] }),
      /* @__PURE__ */ jsxs8("div", { className: "relative", children: [
        /* @__PURE__ */ jsx9(
          "select",
          {
            id: "prompt-template-select",
            value: config.activePromptId,
            onChange: (e) => setConfig((prev) => ({ ...prev, activePromptId: e.target.value })),
            className: "w-48 pl-3 pr-8 py-2 text-sm bg-white border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-gray-500 focus:border-gray-500 appearance-none transition-all dark:bg-zinc-700 dark:border-zinc-600 dark:text-zinc-100",
            "aria-label": "\u9009\u62E9\u63D0\u793A\u8BCD\u6A21\u677F",
            children: config.prompts.map((prompt2) => /* @__PURE__ */ jsx9("option", { value: prompt2.id, children: prompt2.name }, prompt2.id))
          }
        ),
        /* @__PURE__ */ jsx9("div", { className: "pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700 dark:text-zinc-300", children: /* @__PURE__ */ jsx9("svg", { className: "fill-current h-4 w-4", xmlns: "http://www.w3.org/2000/svg", viewBox: "0 0 20 20", children: /* @__PURE__ */ jsx9("path", { d: "M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z" }) }) })
      ] }),
      /* @__PURE__ */ jsxs8("div", { className: "flex items-center gap-2", children: [
        /* @__PURE__ */ jsxs8(
          "button",
          {
            type: "button",
            onClick: handleSaveCombinationClick,
            className: "flex items-center gap-2 pl-3 pr-4 py-2 text-sm bg-white border border-gray-300 rounded-lg shadow-sm hover:bg-gray-100 transition-all dark:bg-zinc-700 dark:border-zinc-600 dark:text-zinc-100 dark:hover:bg-zinc-600",
            title: "\u4FDD\u5B58\u5F53\u524D\u5361\u724C\u7EC4\u5408",
            children: [
              /* @__PURE__ */ jsx9(BookmarkSquareIcon, { className: "w-4 h-4" }),
              /* @__PURE__ */ jsx9("span", { children: "\u4FDD\u5B58\u7EC4\u5408" })
            ]
          }
        ),
        /* @__PURE__ */ jsxs8("div", { ref: combinationManagerRef, className: "relative", children: [
          /* @__PURE__ */ jsx9(
            "button",
            {
              type: "button",
              onClick: () => setIsCombinationManagerOpen((prev) => !prev),
              className: "p-2.5 bg-white border border-gray-300 rounded-lg shadow-sm hover:bg-gray-100 transition-all dark:bg-zinc-700 dark:border-zinc-600 dark:text-zinc-100 dark:hover:bg-zinc-600",
              title: "\u7BA1\u7406\u5DF2\u4FDD\u5B58\u7684\u7EC4\u5408",
              children: /* @__PURE__ */ jsx9(ArrowDownOnSquareIcon, { className: "w-4 h-4" })
            }
          ),
          isCombinationManagerOpen && /* @__PURE__ */ jsxs8("div", { className: "absolute z-20 mt-2 w-72 right-0 bg-white dark:bg-zinc-800 rounded-lg shadow-xl border border-gray-200 dark:border-zinc-700", children: [
            /* @__PURE__ */ jsx9("div", { className: "p-3 border-b border-gray-200 dark:border-zinc-700", children: /* @__PURE__ */ jsx9("h3", { className: "font-semibold text-gray-800 dark:text-zinc-100", children: "\u5DF2\u5B58\u7EC4\u5408" }) }),
            savedCombinations.length > 0 ? /* @__PURE__ */ jsx9("ul", { className: "max-h-80 overflow-y-auto custom-scrollbar p-2", children: savedCombinations.map((combo) => /* @__PURE__ */ jsxs8("li", { className: "group flex justify-between items-center p-2 rounded-md hover:bg-gray-100 dark:hover:bg-zinc-700", children: [
              /* @__PURE__ */ jsx9("span", { className: "text-sm font-medium text-gray-700 dark:text-zinc-200 truncate pr-2", title: combo.name, children: combo.name }),
              /* @__PURE__ */ jsxs8("div", { className: "flex items-center gap-2", children: [
                /* @__PURE__ */ jsx9(
                  "button",
                  {
                    onClick: () => {
                      onLoadCombination(combo.id);
                      setIsCombinationManagerOpen(false);
                    },
                    className: "text-sm text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300 font-semibold",
                    title: "\u52A0\u8F7D\u6B64\u7EC4\u5408",
                    children: "\u52A0\u8F7D"
                  }
                ),
                /* @__PURE__ */ jsx9(
                  "button",
                  {
                    onClick: () => onDeleteCombination(combo.id),
                    className: "p-1 text-gray-400 hover:text-red-600 dark:text-zinc-500 dark:hover:text-red-500 rounded-full opacity-0 group-hover:opacity-100 transition-opacity",
                    title: "\u5220\u9664\u6B64\u7EC4\u5408",
                    children: /* @__PURE__ */ jsx9(TrashIcon, { className: "w-4 h-4" })
                  }
                )
              ] })
            ] }, combo.id)) }) : /* @__PURE__ */ jsx9("p", { className: "p-4 text-sm text-gray-500 dark:text-zinc-400 text-center", children: "\u8FD8\u6CA1\u6709\u4FDD\u5B58\u4EFB\u4F55\u7EC4\u5408\u3002" })
          ] })
        ] })
      ] })
    ] }),
    /* @__PURE__ */ jsxs8("div", { className: "flex-grow flex flex-col min-h-0", children: [
      /* @__PURE__ */ jsx9("div", { className: "flex-1 overflow-x-hidden overflow-y-visible", children: /* @__PURE__ */ jsxs8(
        "div",
        {
          className: "flex h-full transition-transform duration-500 ease-in-out",
          style: { transform: `translateX(-${activePanel * 100}%)` },
          children: [
            /* @__PURE__ */ jsx9("div", { className: "w-full flex-shrink-0 p-1", children: /* @__PURE__ */ jsxs8("div", { className: "grid grid-cols-1 lg:grid-cols-5 gap-2 h-full", children: [
              /* @__PURE__ */ jsxs8("div", { className: "bg-white p-6 rounded-xl border border-gray-200 shadow-sm flex flex-col h-full dark:bg-zinc-800 dark:border-zinc-700 lg:col-span-2", children: [
                /* @__PURE__ */ jsx9("h2", { className: "text-xl font-semibold mb-5 text-gray-700 dark:text-zinc-200", children: "\u5C0F\u8BF4\u4FE1\u606F" }),
                /* @__PURE__ */ jsxs8("div", { className: "flex flex-col flex-grow", children: [
                  /* @__PURE__ */ jsxs8("div", { className: "space-y-4", children: [
                    /* @__PURE__ */ jsxs8("div", { children: [
                      /* @__PURE__ */ jsxs8("label", { htmlFor: "name", className: "block text-sm font-medium text-gray-600 mb-1 dark:text-zinc-300", children: [
                        "\u5C0F\u8BF4\u540D\u79F0 ",
                        /* @__PURE__ */ jsx9("span", { className: "text-red-500", children: "*" })
                      ] }),
                      /* @__PURE__ */ jsx9("input", { type: "text", id: "name", value: novelInfo.name, onChange: handleInfoChange, className: "w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-gray-500 focus:border-gray-500 dark:bg-zinc-700 dark:border-zinc-600 dark:text-white", placeholder: "\u4F8B\u5982\uFF1A\u6DF1\u6E0A\u56DE\u54CD" })
                    ] }),
                    /* @__PURE__ */ jsxs8("div", { children: [
                      /* @__PURE__ */ jsxs8("label", { className: "block text-sm font-medium text-gray-600 mb-2 dark:text-zinc-300", children: [
                        "\u4E66\u7C4D\u9891\u9053 ",
                        /* @__PURE__ */ jsx9("span", { className: "text-red-500", children: "*" })
                      ] }),
                      /* @__PURE__ */ jsx9("div", { className: "flex items-center space-x-4", children: ["", "male", "female"].map((channelValue) => {
                        const labels = { "": "\u65E0", "male": "\u7537\u9891", "female": "\u5973\u9891" };
                        return /* @__PURE__ */ jsxs8("label", { className: "flex items-center space-x-2 cursor-pointer text-sm", children: [
                          /* @__PURE__ */ jsx9(
                            "input",
                            {
                              type: "radio",
                              name: "channel",
                              value: channelValue,
                              checked: novelInfo.channel === channelValue,
                              onChange: (e) => setNovelInfo((prev) => ({ ...prev, channel: e.target.value })),
                              className: "h-4 w-4 text-gray-600 focus:ring-gray-500 border-gray-300"
                            }
                          ),
                          /* @__PURE__ */ jsx9("span", { className: "text-gray-700 dark:text-zinc-300", children: labels[channelValue] })
                        ] }, channelValue);
                      }) })
                    ] }),
                    /* @__PURE__ */ jsxs8("div", { className: "grid grid-cols-2 gap-4", children: [
                      /* @__PURE__ */ jsxs8("div", { children: [
                        /* @__PURE__ */ jsxs8("label", { htmlFor: "emotion", className: "block text-sm font-medium text-gray-600 mb-1 dark:text-zinc-300", children: [
                          "\u60C5\u7EEA ",
                          /* @__PURE__ */ jsx9("span", { className: "text-red-500", children: "*" })
                        ] }),
                        /* @__PURE__ */ jsx9("select", { id: "emotion", value: novelInfo.emotion || "\u65E0", onChange: handleInfoChange, className: "w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-gray-500 focus:border-gray-500 bg-white dark:bg-zinc-700 dark:border-zinc-600 dark:text-white", children: EMOTION_PRESETS.map((e) => /* @__PURE__ */ jsx9("option", { value: e, children: e }, e)) })
                      ] }),
                      /* @__PURE__ */ jsxs8("div", { children: [
                        /* @__PURE__ */ jsxs8("label", { htmlFor: "perspective", className: "block text-sm font-medium text-gray-600 mb-1 dark:text-zinc-300", children: [
                          "\u53D9\u4E8B\u89C6\u89D2 ",
                          /* @__PURE__ */ jsx9("span", { className: "text-red-500", children: "*" })
                        ] }),
                        /* @__PURE__ */ jsxs8("select", { id: "perspective", value: novelInfo.perspective || "", onChange: handleInfoChange, className: "w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-gray-500 focus:border-gray-500 bg-white dark:bg-zinc-700 dark:border-zinc-600 dark:text-white", children: [
                          /* @__PURE__ */ jsx9("option", { value: "", children: "\u8BF7\u9009\u62E9..." }),
                          /* @__PURE__ */ jsx9("option", { value: "\u5168\u77E5\u89C6\u89D2(\u96F6\u89C6\u89D2)", children: "\u5168\u77E5\u89C6\u89D2(\u96F6\u89C6\u89D2)" }),
                          /* @__PURE__ */ jsx9("option", { value: "\u7B2C\u4E09\u4EBA\u79F0\u53D9\u8FF0", children: "\u7B2C\u4E09\u4EBA\u79F0\u53D9\u8FF0" }),
                          /* @__PURE__ */ jsx9("option", { value: "\u7B2C\u4E00\u4EBA\u79F0\u53D9\u8FF0", children: "\u7B2C\u4E00\u4EBA\u79F0\u53D9\u8FF0" }),
                          /* @__PURE__ */ jsx9("option", { value: "\u7B2C\u4E8C\u4EBA\u79F0\u53D9\u8FF0", children: "\u7B2C\u4E8C\u4EBA\u79F0\u53D9\u8FF0" })
                        ] })
                      ] })
                    ] }),
                    /* @__PURE__ */ jsxs8("div", { className: "grid grid-cols-2 gap-4", children: [
                      /* @__PURE__ */ jsxs8("div", { children: [
                        /* @__PURE__ */ jsxs8("label", { htmlFor: "length", className: "block text-sm font-medium text-gray-600 mb-1 dark:text-zinc-300", children: [
                          "\u7BC7\u5E45 ",
                          /* @__PURE__ */ jsx9("span", { className: "text-red-500", children: "*" })
                        ] }),
                        /* @__PURE__ */ jsxs8("select", { id: "length", value: lengthCategory, onChange: handleLengthChange, className: "w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-gray-500 focus:border-gray-500 bg-white dark:bg-zinc-700 dark:border-zinc-600 dark:text-white", children: [
                          /* @__PURE__ */ jsx9("option", { value: "", children: "\u65E0" }),
                          /* @__PURE__ */ jsx9("option", { value: "short", children: "\u77ED\u7BC7 (<3\u4E07\u5B57)" }),
                          /* @__PURE__ */ jsx9("option", { value: "medium", children: "\u4E2D\u7BC7 (3-8\u4E07\u5B57)" }),
                          /* @__PURE__ */ jsx9("option", { value: "long", children: "\u957F\u7BC7 (>8\u4E07\u5B57)" })
                        ] })
                      ] }),
                      /* @__PURE__ */ jsxs8("div", { children: [
                        /* @__PURE__ */ jsxs8("label", { htmlFor: "wordCount", className: "block text-sm font-medium text-gray-600 mb-1 dark:text-zinc-300", children: [
                          "\u5B57\u6570 ",
                          /* @__PURE__ */ jsx9("span", { className: "text-red-500", children: "*" })
                        ] }),
                        /* @__PURE__ */ jsx9("input", { type: "text", id: "wordCount", value: novelInfo.wordCount, onChange: handleInfoChange, className: "w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-gray-500 focus:border-gray-500 dark:bg-zinc-700 dark:border-zinc-600 dark:text-white", placeholder: "\u4F8B\u5982\uFF1A10\u4E07\u5B57" })
                      ] })
                    ] })
                  ] }),
                  /* @__PURE__ */ jsxs8("div", { className: "flex flex-col flex-grow mt-4", children: [
                    /* @__PURE__ */ jsxs8("div", { className: "flex justify-between items-center mb-1", children: [
                      /* @__PURE__ */ jsxs8("label", { htmlFor: "synopsis", className: "block text-sm font-medium text-gray-600 dark:text-zinc-300", children: [
                        "\u6982\u8981 ",
                        /* @__PURE__ */ jsx9("span", { className: "text-red-500", children: "*" })
                      ] }),
                      /* @__PURE__ */ jsx9(
                        "button",
                        {
                          type: "button",
                          onClick: handleImportClick,
                          className: "p-1.5 text-gray-400 hover:text-gray-700 rounded-full hover:bg-gray-100 transition-colors dark:text-zinc-500 dark:hover:text-zinc-200 dark:hover:bg-zinc-700",
                          title: "\u5BFC\u5165\u672C\u5730\u6587\u6863",
                          children: /* @__PURE__ */ jsx9(UploadIcon, { className: "w-4 h-4" })
                        }
                      ),
                      /* @__PURE__ */ jsx9(
                        "input",
                        {
                          type: "file",
                          ref: fileInputRef,
                          onChange: handleFileImport,
                          accept: ".md,.txt",
                          className: "hidden"
                        }
                      )
                    ] }),
                    /* @__PURE__ */ jsx9("textarea", { id: "synopsis", value: novelInfo.synopsis, onChange: handleInfoChange, className: "w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-gray-500 focus:border-gray-500 flex-grow dark:bg-zinc-700 dark:border-zinc-600 dark:text-white", placeholder: "\u6545\u4E8B\u6838\u5FC3\u6982\u5FF5\u7684\u4E00\u53E5\u8BDD\u603B\u7ED3" })
                  ] })
                ] })
              ] }),
              /* @__PURE__ */ jsxs8("div", { className: "bg-white p-6 rounded-xl border border-gray-200 shadow-sm flex flex-col min-h-0 dark:bg-zinc-800 dark:border-zinc-700 lg:col-span-3", children: [
                /* @__PURE__ */ jsx9("h2", { className: "text-xl font-semibold mb-5 text-gray-700 dark:text-zinc-200 flex-shrink-0", children: "\u6545\u4E8B\u7EC4\u5408" }),
                /* @__PURE__ */ jsxs8("div", { className: "flex-grow overflow-y-auto custom-scrollbar -mr-4 pr-4", children: [
                  /* @__PURE__ */ jsx9("div", { className: "grid grid-cols-2 gap-x-4 gap-y-6", children: CORE_CARD_TYPES.map((type) => /* @__PURE__ */ jsxs8("div", { className: "flex flex-col gap-2", children: [
                    /* @__PURE__ */ jsxs8("div", { className: "flex justify-between items-center", children: [
                      /* @__PURE__ */ jsx9("h3", { className: "text-md font-medium text-gray-500 dark:text-zinc-400", children: CARD_TYPE_NAMES[type] }),
                      (combinedCards[type]?.length ?? 0) < 3 && /* @__PURE__ */ jsx9(
                        "button",
                        {
                          onClick: () => onAddCardSlot(type),
                          className: "p-1 text-gray-400 hover:text-gray-700 rounded-full hover:bg-gray-100 transition-colors dark:text-zinc-500 dark:hover:text-zinc-200 dark:hover:bg-zinc-700",
                          title: `\u4E3A\u201C${CARD_TYPE_NAMES[type]}\u201D\u6DFB\u52A0\u4E00\u4E2A\u65B0\u680F\u4F4D`,
                          children: /* @__PURE__ */ jsx9(PlusIcon, { className: "w-4 h-4" })
                        }
                      )
                    ] }),
                    combinedCards[type]?.map((card, index) => /* @__PURE__ */ jsxs8("div", { className: "relative", children: [
                      /* @__PURE__ */ jsx9(
                        CardSlot_default,
                        {
                          cardType: type,
                          card,
                          onClear: () => onClearCard(type, index),
                          onDropCard: (droppedCard) => onCardSelect(droppedCard, index),
                          activeDragType,
                          allCards
                        }
                      ),
                      index > 0 && /* @__PURE__ */ jsx9(
                        "button",
                        {
                          onClick: () => onRemoveCardSlot(type, index),
                          className: "absolute -top-2 -right-2 w-5 h-5 bg-gray-600 text-white rounded-full flex items-center justify-center hover:bg-red-500 transition-colors z-20",
                          "aria-label": `\u79FB\u9664\u201C${CARD_TYPE_NAMES[type]}\u201D\u680F\u4F4D`,
                          title: "\u79FB\u9664\u680F\u4F4D",
                          children: /* @__PURE__ */ jsx9(TrashIcon, { className: "w-3 h-3" })
                        }
                      )
                    ] }, `${type}-${index}`))
                  ] }, type)) }),
                  /* @__PURE__ */ jsxs8("div", { className: "mt-6 pt-4 border-t border-gray-200/60 dark:border-zinc-600/60", children: [
                    /* @__PURE__ */ jsx9("h3", { className: "text-md font-medium text-gray-500 dark:text-zinc-400 mb-2", children: CARD_TYPE_NAMES["Inspiration" /* Inspiration */] }),
                    /* @__PURE__ */ jsx9(
                      CardSlot_default,
                      {
                        cardType: "Inspiration" /* Inspiration */,
                        card: combinedCards["Inspiration" /* Inspiration */]?.[0] || null,
                        onClear: () => onClearCard("Inspiration" /* Inspiration */, 0),
                        onDropCard: (card) => onCardSelect(card, 0),
                        activeDragType,
                        allCards
                      },
                      "Inspiration" /* Inspiration */
                    )
                  ] }),
                  /* @__PURE__ */ jsx9("div", { className: "mt-4 flex flex-wrap -mx-2", children: OPTIONAL_CARD_TYPES.filter((type) => type !== "Inspiration" /* Inspiration */).map((type) => /* @__PURE__ */ jsxs8("div", { className: "w-1/2 md:w-1/3 px-2 mb-4", children: [
                    /* @__PURE__ */ jsx9("h3", { className: "text-md font-medium text-gray-500 dark:text-zinc-400 mb-2", children: CARD_TYPE_NAMES[type] }),
                    /* @__PURE__ */ jsx9(
                      CardSlot_default,
                      {
                        cardType: type,
                        card: combinedCards[type]?.[0] || null,
                        onClear: () => onClearCard(type, 0),
                        onDropCard: (card) => onCardSelect(card, 0),
                        activeDragType,
                        allCards
                      }
                    )
                  ] }, type)) })
                ] })
              ] })
            ] }) }),
            /* @__PURE__ */ jsx9("div", { className: "w-full flex-shrink-0 h-full p-1", children: /* @__PURE__ */ jsxs8("div", { className: "grid grid-cols-1 lg:grid-cols-2 gap-2 h-full", children: [
              /* @__PURE__ */ jsxs8("div", { className: "bg-white p-6 rounded-xl border border-gray-200 shadow-sm flex flex-col dark:bg-zinc-800 dark:border-zinc-700 min-h-0", children: [
                /* @__PURE__ */ jsx9("h2", { className: "text-xl font-semibold mb-5 text-gray-700 dark:text-zinc-200 flex-shrink-0", children: "\u5361\u7247\u5E93" }),
                /* @__PURE__ */ jsx9("div", { className: "flex-grow overflow-y-auto -mr-2 pr-2 custom-scrollbar", children: /* @__PURE__ */ jsx9("div", { className: "space-y-5", children: CORE_CARD_TYPES.map((type) => /* @__PURE__ */ jsxs8("div", { children: [
                  /* @__PURE__ */ jsxs8("div", { className: "flex justify-between items-center mb-3", children: [
                    /* @__PURE__ */ jsx9("h3", { className: "text-md font-medium text-gray-500 dark:text-zinc-400", children: CARD_TYPE_NAMES[type] }),
                    /* @__PURE__ */ jsx9(
                      "button",
                      {
                        onClick: () => handleOpenModalForCreate(type),
                        className: "p-1 text-gray-400 hover:text-gray-700 rounded-full hover:bg-gray-100 transition-colors dark:text-zinc-500 dark:hover:text-zinc-200 dark:hover:bg-zinc-700",
                        title: `\u65B0\u5EFA${CARD_TYPE_NAMES[type]}\u5361\u7247`,
                        children: /* @__PURE__ */ jsx9(PlusIcon, { className: "w-4 h-4" })
                      }
                    )
                  ] }),
                  uiSettings.cardStyle === "carousel" ? /* @__PURE__ */ jsx9(
                    CardCarousel_default,
                    {
                      cards: allCards.filter((card) => card.type === type),
                      onCardSelect: (card) => {
                        let targetIndex = combinedCards[card.type]?.findIndex((slot) => slot === null);
                        if (targetIndex === -1) {
                          targetIndex = 0;
                        }
                        onCardSelect(card, targetIndex ?? 0);
                      },
                      isCardSelected,
                      onEdit: handleOpenModalForEdit,
                      onDelete: handleDeleteRequest
                    }
                  ) : /* @__PURE__ */ jsx9("div", { className: "grid grid-cols-3 gap-3", children: allCards.filter((card) => card.type === type).map((card) => /* @__PURE__ */ jsx9(
                    CardComponent_default,
                    {
                      card,
                      onClick: (c) => {
                        let targetIndex = combinedCards[c.type]?.findIndex((slot) => slot === null);
                        if (targetIndex === -1) {
                          targetIndex = 0;
                        }
                        onCardSelect(c, targetIndex ?? 0);
                      },
                      isSelected: isCardSelected(card.id),
                      onDragStart: () => handleCardDragStart(card.type),
                      onDragEnd: () => setActiveDragType(null),
                      onEdit: handleOpenModalForEdit,
                      onDelete: handleDeleteRequest
                    },
                    card.id
                  )) })
                ] }, type)) }) })
              ] }),
              /* @__PURE__ */ jsx9("div", { className: "bg-white p-6 rounded-xl border border-gray-200 shadow-sm flex flex-col dark:bg-zinc-800 dark:border-zinc-700 min-h-0", children: /* @__PURE__ */ jsx9("div", { className: "flex-grow overflow-y-auto -mr-2 pr-2 custom-scrollbar", children: /* @__PURE__ */ jsx9("div", { className: "space-y-8", children: OPTIONAL_CARD_TYPES.filter((type) => type !== "Inspiration" /* Inspiration */).map((type) => /* @__PURE__ */ jsxs8("div", { children: [
                /* @__PURE__ */ jsx9("h2", { className: "text-xl font-semibold mb-5 text-gray-700 dark:text-zinc-200", children: CARD_TYPE_NAMES[type] }),
                uiSettings.cardStyle === "carousel" ? /* @__PURE__ */ jsx9(
                  CardCarousel_default,
                  {
                    cards: allCards.filter((card) => card.type === type),
                    onCardSelect: (card) => onCardSelect(card, 0),
                    isCardSelected,
                    onEdit: handleOpenModalForEdit,
                    onDelete: handleDeleteRequest
                  }
                ) : /* @__PURE__ */ jsx9("div", { className: "grid grid-cols-3 gap-3", children: allCards.filter((card) => card.type === type).map((card) => /* @__PURE__ */ jsx9(
                  CardComponent_default,
                  {
                    card,
                    onClick: (c) => onCardSelect(c, 0),
                    isSelected: isCardSelected(card.id),
                    onDragStart: () => handleCardDragStart(card.type),
                    onDragEnd: () => setActiveDragType(null),
                    onEdit: handleOpenModalForEdit,
                    onDelete: handleDeleteRequest
                  },
                  card.id
                )) })
              ] }, type)) }) }) })
            ] }) })
          ]
        }
      ) }),
      /* @__PURE__ */ jsx9("div", { className: "mt-4 flex justify-center items-center space-x-2", children: Array.from({ length: totalPanels }).map((_, index) => /* @__PURE__ */ jsx9(
        "button",
        {
          onClick: () => setActivePanel(index),
          className: `w-10 h-1.5 rounded-full transition-colors ${activePanel === index ? "bg-gray-700 dark:bg-slate-300" : "bg-gray-300 hover:bg-gray-400 dark:bg-zinc-600 dark:hover:bg-zinc-500"}`,
          "aria-label": `Go to panel ${index + 1}`
        },
        index
      )) })
    ] }),
    isModalOpen && /* @__PURE__ */ jsx9(
      CreateCardModal_default,
      {
        isOpen: isModalOpen,
        onClose: () => {
          setIsModalOpen(false);
          setEditingCard(null);
        },
        onSubmit: handleModalSubmit,
        cardType: editingCard?.type ?? modalCardType,
        editingCard,
        config
      }
    )
  ] });
};
var WriterView_default = WriterView;

// components/SettingsView.tsx
init_aiService();
import { useState as useState5, useEffect as useEffect4 } from "react";
import { jsx as jsx10, jsxs as jsxs9 } from "react/jsx-runtime";
var PROVIDER_DEFAULTS = {
  gemini: { endpoint: "https://generativelanguage.googleapis.com", modelPlaceholder: "gemini-2.5-flash" },
  openai: { endpoint: "https://api.openai.com", modelPlaceholder: "gpt-4o, gpt-3.5-turbo" },
  deepseek: { endpoint: "https://api.deepseek.com", modelPlaceholder: "deepseek-chat" },
  openrouter: { endpoint: "https://openrouter.ai/api/v1", modelPlaceholder: "meta-llama/llama-3-8b-instruct" },
  siliconflow: { endpoint: "https://api.siliconflow.cn", modelPlaceholder: "Qwen/Qwen2-7B-Instruct" },
  modelscope: { endpoint: "https://api-inference.modelscope.cn", modelPlaceholder: "qwen-plus, qwen-turbo" },
  ollama: { endpoint: "http://localhost:11443", modelPlaceholder: "llama3, qwen2" },
  custom: { endpoint: "", modelPlaceholder: "\u8F93\u5165\u60A8\u7684\u6A21\u578B\u540D\u79F0" }
};
var InputField = ({ label, id, children, description }) => /* @__PURE__ */ jsxs9("div", { children: [
  /* @__PURE__ */ jsx10("label", { htmlFor: id, className: "block text-sm font-medium text-gray-600 mb-1 dark:text-zinc-300", children: label }),
  description && /* @__PURE__ */ jsx10("p", { className: "text-xs text-gray-500 mb-2 dark:text-zinc-400", children: description }),
  children
] });
var NavItem2 = ({ tab, label, isActive, onClick }) => {
  return /* @__PURE__ */ jsx10(
    "button",
    {
      onClick,
      className: `w-full text-left px-3 py-2 rounded-md text-sm font-medium transition-colors ${isActive ? "bg-slate-200 text-gray-800 dark:bg-zinc-600 dark:text-zinc-100" : "text-gray-600 hover:bg-slate-200/70 dark:text-zinc-300 dark:hover:bg-zinc-700/60"}`,
      children: label
    }
  );
};
var ParameterSlider = ({ label, description, value, onChange, min, max, step }) => {
  const handleSliderChange = (e) => {
    onChange(parseFloat(e.target.value));
  };
  const handleInputChange = (e) => {
    const numValue = e.target.value === "" ? min : parseFloat(e.target.value);
    if (!isNaN(numValue)) {
      onChange(Math.max(min, Math.min(max, numValue)));
    }
  };
  return /* @__PURE__ */ jsxs9("div", { children: [
    /* @__PURE__ */ jsxs9("div", { className: "flex justify-between items-center", children: [
      /* @__PURE__ */ jsx10("label", { className: "block text-sm font-medium text-gray-700 dark:text-zinc-200", children: label }),
      /* @__PURE__ */ jsx10(
        "input",
        {
          type: "number",
          value,
          onBlur: handleInputChange,
          onChange: (e) => onChange(e.target.value),
          min,
          max,
          step,
          className: "w-24 px-2 py-1 text-sm border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-gray-500 focus:border-gray-500 dark:bg-zinc-700 dark:border-zinc-600 dark:text-white"
        }
      )
    ] }),
    /* @__PURE__ */ jsx10(
      "input",
      {
        type: "range",
        value,
        onChange: handleSliderChange,
        min,
        max,
        step,
        className: "w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer mt-2 dark:bg-zinc-600"
      }
    ),
    /* @__PURE__ */ jsx10("p", { className: "text-xs text-gray-500 mt-1 dark:text-zinc-400", children: description })
  ] });
};
var SettingsView = ({ currentConfig, onSave, currentUISettings, onSaveUISettings }) => {
  const [config, setConfig] = useState5(currentConfig);
  const [uiSettings, setUISettings] = useState5(currentUISettings);
  const [testResult, setTestResult] = useState5({ status: "idle", message: "" });
  const [isTesting, setIsTesting] = useState5(false);
  const [modelList, setModelList] = useState5([]);
  const [activeTab, setActiveTab] = useState5("ai");
  const [saveStatus, setSaveStatus] = useState5("idle");
  const [showModelParams, setShowModelParams] = useState5(true);
  const activePrompt = config.prompts.find((p) => p.id === config.activePromptId);
  useEffect4(() => {
    setConfig(currentConfig);
  }, [currentConfig]);
  useEffect4(() => {
    const currentProvider = config.provider;
    if (!config.endpoint && PROVIDER_DEFAULTS[currentProvider]?.endpoint) {
      setConfig((prev) => ({
        ...prev,
        endpoint: PROVIDER_DEFAULTS[currentProvider].endpoint
      }));
    }
  }, [config.provider, config.endpoint]);
  useEffect4(() => {
    setUISettings(currentUISettings);
  }, [currentUISettings]);
  const handleSave = () => {
    const cleanedConfig = {
      ...config,
      prompts: config.prompts.filter((p) => p.name.trim() !== "")
    };
    onSave(cleanedConfig);
    onSaveUISettings(uiSettings);
    setSaveStatus("saved");
    setTimeout(() => setSaveStatus("idle"), 2e3);
  };
  const handleTest = async () => {
    setIsTesting(true);
    setTestResult({ status: "idle", message: "\u6D4B\u8BD5\u4E2D..." });
    setModelList([]);
    try {
      const models = await fetchModels(config);
      if (models.length === 0) {
        setTestResult({ status: "success", message: "\u6210\u529F\u8FDE\u63A5\uFF0C\u4F46\u672A\u627E\u5230\u53EF\u7528\u6A21\u578B\u3002" });
      } else {
        setModelList(models);
        if (!models.includes(config.model)) {
          setConfig((prev) => ({ ...prev, model: models[0] }));
        }
        setTestResult({ status: "success", message: "\u94FE\u63A5\u6210\u529F! \u5DF2\u52A0\u8F7D\u6A21\u578B\u5217\u8868\u3002" });
      }
    } catch (error) {
      setTestResult({ status: "error", message: `\u6D4B\u8BD5\u5931\u8D25: ${error instanceof Error ? error.message : "\u672A\u77E5\u9519\u8BEF"}` });
    } finally {
      setIsTesting(false);
    }
  };
  const handleProviderChange = (e) => {
    const newProvider = e.target.value;
    const defaults = PROVIDER_DEFAULTS[newProvider];
    const preservedApiKey = config.provider === "ollama" && newProvider !== "ollama" ? "" : config.apiKey;
    setConfig((prev) => ({
      ...prev,
      provider: newProvider,
      model: "",
      endpoint: defaults.endpoint,
      apiKey: newProvider === "ollama" ? "" : preservedApiKey
    }));
    setTestResult({ status: "idle", message: "" });
    setModelList([]);
  };
  const handleActivePromptChange = (e) => {
    setConfig((prev) => ({ ...prev, activePromptId: e.target.value }));
  };
  const handlePromptFieldChange = (field, value) => {
    setConfig((prev) => ({
      ...prev,
      prompts: prev.prompts.map(
        (p) => p.id === prev.activePromptId ? { ...p, [field]: value } : p
      )
    }));
  };
  const handleCreateNewPrompt = () => {
    const newPrompt = {
      id: `custom-${Date.now()}`,
      name: "\u672A\u547D\u540D\u6A21\u677F",
      content: ""
    };
    setConfig((prev) => ({
      ...prev,
      prompts: [...prev.prompts, newPrompt],
      activePromptId: newPrompt.id
    }));
  };
  const handleDeletePrompt = () => {
    const promptToDeleteId = config.activePromptId;
    const promptToDelete = config.prompts.find((p) => p.id === promptToDeleteId);
    if (!promptToDelete || promptToDelete.id.startsWith("default-")) {
      alert("\u4E0D\u80FD\u5220\u9664\u9ED8\u8BA4\u7684\u63D0\u793A\u8BCD\u6A21\u677F\u3002");
      return;
    }
    if (window.confirm(`\u60A8\u786E\u5B9A\u8981\u5220\u9664\u6A21\u677F \u201C${promptToDelete.name}\u201D \u5417\uFF1F\u6B64\u64CD\u4F5C\u5C06\u5728\u70B9\u51FB\u201C\u4FDD\u5B58\u8BBE\u7F6E\u201D\u540E\u751F\u6548\u3002`)) {
      setConfig((prev) => {
        const updatedPrompts = prev.prompts.filter((p) => p.id !== promptToDeleteId);
        return {
          ...prev,
          prompts: updatedPrompts,
          activePromptId: "default-snowflake"
          // Always switch back to default
        };
      });
    }
  };
  return /* @__PURE__ */ jsxs9("div", { className: "w-full max-w-5xl mx-auto h-full flex flex-col", children: [
    /* @__PURE__ */ jsx10("header", { className: "mb-8 flex-shrink-0", children: /* @__PURE__ */ jsx10("h1", { className: "text-3xl font-bold text-gray-800 dark:text-zinc-100", children: "\u8BBE\u7F6E" }) }),
    /* @__PURE__ */ jsxs9("div", { className: "flex flex-col md:flex-row gap-8 lg:gap-12 flex-grow min-h-0", children: [
      /* @__PURE__ */ jsx10("aside", { className: "w-full md:w-48 flex-shrink-0", children: /* @__PURE__ */ jsxs9("nav", { className: "space-y-1", children: [
        /* @__PURE__ */ jsx10(
          NavItem2,
          {
            tab: "ai",
            label: "AI \u6A21\u578B\u8BBE\u7F6E",
            isActive: activeTab === "ai",
            onClick: () => setActiveTab("ai")
          }
        ),
        /* @__PURE__ */ jsx10(
          NavItem2,
          {
            tab: "prompt",
            label: "\u63D0\u793A\u8BCD",
            isActive: activeTab === "prompt",
            onClick: () => setActiveTab("prompt")
          }
        ),
        /* @__PURE__ */ jsx10(
          NavItem2,
          {
            tab: "other",
            label: "\u5176\u4ED6",
            isActive: activeTab === "other",
            onClick: () => setActiveTab("other")
          }
        )
      ] }) }),
      /* @__PURE__ */ jsx10("main", { className: "flex-1 min-w-0 overflow-y-auto custom-scrollbar -mr-4 pr-4", children: /* @__PURE__ */ jsxs9("div", { className: "bg-white p-8 rounded-xl border border-gray-200 shadow-sm dark:bg-zinc-800 dark:border-zinc-700", children: [
        activeTab === "ai" && /* @__PURE__ */ jsxs9("div", { className: "space-y-6", children: [
          /* @__PURE__ */ jsx10(InputField, { label: "\u6A21\u578B\u63D0\u4F9B\u5546", id: "provider", children: /* @__PURE__ */ jsxs9(
            "select",
            {
              id: "provider",
              value: config.provider,
              onChange: handleProviderChange,
              className: "w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-gray-500 focus:border-gray-500 dark:bg-zinc-700 dark:border-zinc-600 dark:text-white",
              children: [
                /* @__PURE__ */ jsx10("option", { value: "gemini", children: "Google Gemini" }),
                /* @__PURE__ */ jsx10("option", { value: "openai", children: "OpenAI" }),
                /* @__PURE__ */ jsx10("option", { value: "deepseek", children: "DeepSeek" }),
                /* @__PURE__ */ jsx10("option", { value: "openrouter", children: "OpenRouter" }),
                /* @__PURE__ */ jsx10("option", { value: "siliconflow", children: "SiliconFlow" }),
                /* @__PURE__ */ jsx10("option", { value: "modelscope", children: "ModelScope \u9B54\u642D" }),
                /* @__PURE__ */ jsx10("option", { value: "ollama", children: "Ollama (\u672C\u5730)" }),
                /* @__PURE__ */ jsx10("option", { value: "custom", children: "\u81EA\u5B9A\u4E49 (OpenAI \u517C\u5BB9)" })
              ]
            }
          ) }),
          config.provider !== "ollama" && /* @__PURE__ */ jsx10(InputField, { label: "API \u5BC6\u94A5", id: "apiKey", children: /* @__PURE__ */ jsx10(
            "input",
            {
              id: "apiKey",
              type: "password",
              value: config.apiKey,
              onChange: (e) => setConfig((prev) => ({ ...prev, apiKey: e.target.value })),
              className: "w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-gray-500 focus:border-gray-500 dark:bg-zinc-700 dark:border-zinc-600 dark:text-white",
              placeholder: "\u8F93\u5165\u60A8\u7684 API \u5BC6\u94A5"
            }
          ) }),
          /* @__PURE__ */ jsx10(InputField, { label: "Endpoint URL", id: "endpoint", children: /* @__PURE__ */ jsx10(
            "input",
            {
              id: "endpoint",
              type: "text",
              value: config.endpoint,
              onChange: (e) => setConfig((prev) => ({ ...prev, endpoint: e.target.value })),
              className: "w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-gray-500 focus:border-gray-500 disabled:bg-gray-100/80 dark:bg-zinc-700 dark:border-zinc-600 dark:text-white dark:disabled:bg-zinc-800/60 dark:disabled:cursor-not-allowed",
              placeholder: PROVIDER_DEFAULTS[config.provider]?.endpoint
            }
          ) }),
          /* @__PURE__ */ jsx10(InputField, { label: "\u6A21\u578B\u540D\u79F0", id: "model", children: modelList.length > 0 ? /* @__PURE__ */ jsx10(
            "select",
            {
              id: "model",
              value: config.model,
              onChange: (e) => setConfig((prev) => ({ ...prev, model: e.target.value })),
              className: "w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-gray-500 focus:border-gray-500 dark:bg-zinc-700 dark:border-zinc-600 dark:text-white",
              children: modelList.map((modelName) => /* @__PURE__ */ jsx10("option", { value: modelName, children: modelName }, modelName))
            }
          ) : /* @__PURE__ */ jsx10(
            "input",
            {
              id: "model",
              type: "text",
              value: config.model,
              onChange: (e) => setConfig((prev) => ({ ...prev, model: e.target.value })),
              className: "w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-gray-500 focus:border-gray-500 disabled:bg-gray-100/80 dark:bg-zinc-700 dark:border-zinc-600 dark:text-white dark:disabled:bg-zinc-800/60 dark:disabled:cursor-not-allowed",
              placeholder: PROVIDER_DEFAULTS[config.provider]?.modelPlaceholder || "\u70B9\u51FB\u201C\u6D4B\u8BD5\u94FE\u63A5\u201D\u4EE5\u52A0\u8F7D\u6A21\u578B",
              disabled: isTesting
            }
          ) }),
          /* @__PURE__ */ jsxs9("div", { className: "pt-4 flex items-center gap-4", children: [
            /* @__PURE__ */ jsx10(
              "button",
              {
                onClick: handleTest,
                disabled: isTesting,
                className: "bg-gray-200 text-gray-700 font-semibold py-2 px-4 rounded-lg shadow-sm transition-colors hover:bg-gray-300 disabled:opacity-50 disabled:cursor-wait dark:bg-zinc-600 dark:text-zinc-100 dark:hover:bg-zinc-500",
                children: isTesting ? "\u6D4B\u8BD5\u4E2D..." : "\u6D4B\u8BD5\u94FE\u63A5"
              }
            ),
            testResult.message && /* @__PURE__ */ jsx10("p", { className: `text-sm ${testResult.status === "success" ? "text-green-600 dark:text-green-400" : testResult.status === "error" ? "text-red-600 dark:text-red-400" : "text-gray-600 dark:text-zinc-300"}`, children: testResult.message })
          ] }),
          /* @__PURE__ */ jsx10(InputField, { label: "\u6D41\u5F0F\u8F93\u51FA", id: "streaming", description: "\u9010\u6B65\u663E\u793A AI \u7684\u54CD\u5E94\uFF0C\u800C\u4E0D\u662F\u7B49\u5F85\u5168\u90E8\u5B8C\u6210\u540E\u518D\u663E\u793A\u3002\u53EF\u80FD\u4F1A\u52A0\u5FEB\u611F\u77E5\u901F\u5EA6\u3002", children: /* @__PURE__ */ jsx10("div", { className: "flex items-center", children: /* @__PURE__ */ jsxs9("label", { htmlFor: "streaming-toggle", className: "flex items-center cursor-pointer", children: [
            /* @__PURE__ */ jsxs9("div", { className: "relative", children: [
              /* @__PURE__ */ jsx10(
                "input",
                {
                  type: "checkbox",
                  id: "streaming-toggle",
                  className: "sr-only",
                  checked: config.streaming || false,
                  onChange: (e) => setConfig((prev) => ({ ...prev, streaming: e.target.checked }))
                }
              ),
              /* @__PURE__ */ jsx10("div", { className: `block w-10 h-6 rounded-full transition-all ${config.streaming ? "bg-blue-500" : "bg-gray-200 dark:bg-zinc-600"}` }),
              /* @__PURE__ */ jsx10("div", { className: `dot absolute left-1 top-1 bg-white w-4 h-4 rounded-full transition-transform ${config.streaming ? "translate-x-4" : ""}` })
            ] }),
            /* @__PURE__ */ jsx10("div", { className: "ml-3 text-gray-700 dark:text-zinc-300 text-sm", children: config.streaming ? "\u5DF2\u5F00\u542F" : "\u5DF2\u5173\u95ED" })
          ] }) }) }),
          /* @__PURE__ */ jsxs9("div", { className: "pt-6 mt-2 border-t border-gray-200/80 dark:border-zinc-600/80", children: [
            /* @__PURE__ */ jsxs9(
              "button",
              {
                className: "w-full flex justify-between items-center text-left py-2",
                onClick: () => setShowModelParams((prev) => !prev),
                "aria-expanded": showModelParams,
                children: [
                  /* @__PURE__ */ jsx10("h2", { className: "text-xl font-semibold text-gray-800 dark:text-zinc-100", children: "\u6A21\u578B\u53C2\u6570\u8BBE\u7F6E" }),
                  /* @__PURE__ */ jsx10("svg", { xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24", strokeWidth: 2, stroke: "currentColor", className: `w-5 h-5 text-gray-500 transition-transform duration-200 ${showModelParams ? "rotate-180" : ""}`, children: /* @__PURE__ */ jsx10("path", { strokeLinecap: "round", strokeLinejoin: "round", d: "m19.5 8.25-7.5 7.5-7.5-7.5" }) })
                ]
              }
            ),
            showModelParams && /* @__PURE__ */ jsxs9("div", { className: "mt-4 space-y-6 animate-fade-in", children: [
              /* @__PURE__ */ jsx10(
                ParameterSlider,
                {
                  label: "Temperature (\u521B\u9020\u6027)",
                  description: "\u63A7\u5236\u8F93\u51FA\u7684\u968F\u673A\u6027\uFF0C0\u4E3A\u6700\u4FDD\u5B88\uFF0C2\u4E3A\u6700\u521B\u9020\u6027",
                  value: config.temperature,
                  onChange: (v) => setConfig((prev) => ({ ...prev, temperature: v })),
                  min: 0,
                  max: 2,
                  step: 0.1
                }
              ),
              /* @__PURE__ */ jsx10(
                ParameterSlider,
                {
                  label: "Max Tokens (\u6700\u5927\u8F93\u51FA\u957F\u5EA6)",
                  description: "\u9650\u5236\u6A21\u578B\u5355\u6B21\u751F\u6210\u7684\u6700\u5927\u5B57\u7B26\u6570",
                  value: config.maxTokens,
                  onChange: (v) => setConfig((prev) => ({ ...prev, maxTokens: v })),
                  min: 1,
                  max: 16384,
                  step: 1
                }
              ),
              /* @__PURE__ */ jsx10(
                ParameterSlider,
                {
                  label: "Top P (\u6838\u91C7\u6837)",
                  description: "\u63A7\u5236\u8BCD\u6C47\u9009\u62E9\u7684\u591A\u6837\u6027\uFF0C\u5EFA\u8BAE\u4E0Etemperature\u4E8C\u9009\u4E00\u8C03\u8282",
                  value: config.topP,
                  onChange: (v) => setConfig((prev) => ({ ...prev, topP: v })),
                  min: 0,
                  max: 1,
                  step: 0.05
                }
              ),
              /* @__PURE__ */ jsx10(
                ParameterSlider,
                {
                  label: "Frequency Penalty (\u9891\u7387\u60E9\u7F5A)",
                  description: "\u51CF\u5C11\u91CD\u590D\u5185\u5BB9\u7684\u51FA\u73B0\uFF0C0\u4E3A\u4E0D\u60E9\u7F5A\uFF0C2\u4E3A\u6700\u5927\u60E9\u7F5A",
                  value: config.frequencyPenalty,
                  onChange: (v) => setConfig((prev) => ({ ...prev, frequencyPenalty: v })),
                  min: -2,
                  max: 2,
                  step: 0.1
                }
              ),
              /* @__PURE__ */ jsx10(
                ParameterSlider,
                {
                  label: "Presence Penalty (\u5B58\u5728\u60E9\u7F5A)",
                  description: "\u9F13\u52B1\u8C08\u8BBA\u65B0\u8BDD\u9898\uFF0C0\u4E3A\u4E0D\u60E9\u7F5A\uFF0C2\u4E3A\u6700\u5927\u60E9\u7F5A",
                  value: config.presencePenalty,
                  onChange: (v) => setConfig((prev) => ({ ...prev, presencePenalty: v })),
                  min: -2,
                  max: 2,
                  step: 0.1
                }
              )
            ] })
          ] })
        ] }),
        activeTab === "prompt" && /* @__PURE__ */ jsxs9("div", { className: "space-y-6", children: [
          /* @__PURE__ */ jsxs9("div", { children: [
            /* @__PURE__ */ jsxs9("div", { className: "flex justify-between items-center mb-1", children: [
              /* @__PURE__ */ jsx10("label", { htmlFor: "prompt-template", className: "block text-sm font-medium text-gray-600 dark:text-zinc-300", children: "\u63D0\u793A\u8BCD\u6A21\u677F" }),
              /* @__PURE__ */ jsx10("button", { onClick: handleCreateNewPrompt, className: "text-sm font-medium text-gray-600 hover:text-gray-900 transition-colors dark:text-zinc-300 dark:hover:text-white", children: "+ \u65B0\u5EFA\u6A21\u677F" })
            ] }),
            /* @__PURE__ */ jsx10("p", { className: "text-xs text-gray-500 mb-2 dark:text-zinc-400", children: "\u9009\u62E9\u6216\u521B\u5EFA\u4E00\u4E2A\u6A21\u677F\uFF0C\u7528\u4E8E\u5B9A\u4E49 AI \u751F\u6210\u6545\u4E8B\u5927\u7EB2\u65F6\u9075\u5FAA\u7684\u6838\u5FC3\u6307\u4EE4\u3002" }),
            /* @__PURE__ */ jsx10(
              "select",
              {
                id: "prompt-template",
                value: activePrompt?.id || "",
                onChange: handleActivePromptChange,
                className: "w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-gray-500 focus:border-gray-500 dark:bg-zinc-700 dark:border-zinc-600 dark:text-white",
                children: config.prompts.map((p) => /* @__PURE__ */ jsx10("option", { value: p.id, children: p.name }, p.id))
              }
            )
          ] }),
          activePrompt && /* @__PURE__ */ jsxs9("div", { className: "space-y-4 pt-6 border-t border-gray-200/80 dark:border-zinc-600/80", children: [
            /* @__PURE__ */ jsx10(InputField, { label: "\u6A21\u677F\u540D\u79F0", id: "prompt-name", children: /* @__PURE__ */ jsxs9("div", { className: "flex items-center gap-2", children: [
              /* @__PURE__ */ jsx10(
                "input",
                {
                  id: "prompt-name",
                  type: "text",
                  value: activePrompt.name,
                  onChange: (e) => handlePromptFieldChange("name", e.target.value),
                  disabled: activePrompt.id.startsWith("default-"),
                  className: "w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-gray-500 focus:border-gray-500 disabled:bg-gray-100 disabled:cursor-not-allowed dark:bg-zinc-700 dark:border-zinc-600 dark:text-white dark:disabled:bg-zinc-800",
                  placeholder: "\u4E3A\u4F60\u7684\u6A21\u677F\u547D\u540D"
                }
              ),
              !activePrompt.id.startsWith("default-") && /* @__PURE__ */ jsx10(
                "button",
                {
                  onClick: handleDeletePrompt,
                  className: "p-2 text-gray-500 hover:text-red-600 hover:bg-red-100 rounded-md transition-colors flex-shrink-0 dark:text-zinc-400 dark:hover:text-red-500 dark:hover:bg-red-900/50",
                  "aria-label": "\u5220\u9664\u6A21\u677F",
                  title: "\u5220\u9664\u6B64\u6A21\u677F",
                  children: /* @__PURE__ */ jsx10("svg", { xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24", strokeWidth: 1.5, stroke: "currentColor", className: "w-5 h-5", children: /* @__PURE__ */ jsx10("path", { strokeLinecap: "round", strokeLinejoin: "round", d: "m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.134-2.033-2.134H8.71c-1.123 0-2.033.954-2.033 2.134v.916m7.5 0a48.667 48.667 0 0 0-7.5 0" }) })
                }
              )
            ] }) }),
            /* @__PURE__ */ jsx10(
              InputField,
              {
                label: "\u6A21\u677F\u5185\u5BB9",
                id: "prompt-content",
                children: /* @__PURE__ */ jsx10(
                  "textarea",
                  {
                    id: "prompt-content",
                    rows: 16,
                    value: activePrompt.content,
                    onChange: (e) => handlePromptFieldChange("content", e.target.value),
                    className: "w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-gray-500 focus:border-gray-500 font-mono text-sm leading-relaxed custom-scrollbar dark:bg-zinc-700 dark:border-zinc-600 dark:text-zinc-200",
                    placeholder: "\u8F93\u5165\u4F60\u7684\u63D0\u793A\u8BCD..."
                  }
                )
              }
            )
          ] })
        ] }),
        activeTab === "other" && /* @__PURE__ */ jsxs9("div", { className: "space-y-6", children: [
          /* @__PURE__ */ jsx10("h2", { className: "text-xl font-semibold text-gray-800 dark:text-zinc-100", children: "\u754C\u9762\u4E0E\u7F16\u8F91\u5668\u8BBE\u7F6E" }),
          /* @__PURE__ */ jsx10(InputField, { label: "\u4E3B\u9898\u5207\u6362", id: "theme-switcher", children: /* @__PURE__ */ jsxs9("div", { className: "flex gap-2 rounded-lg bg-gray-100 dark:bg-zinc-700 p-1", children: [
            /* @__PURE__ */ jsx10(
              "button",
              {
                onClick: () => setUISettings((s) => ({ ...s, theme: "light" })),
                className: `w-full py-1.5 rounded-md text-sm font-medium transition-colors ${uiSettings.theme === "light" ? "bg-white text-gray-800 shadow-sm" : "text-gray-600 dark:text-zinc-300"}`,
                children: "\u660E\u4EAE"
              }
            ),
            /* @__PURE__ */ jsx10(
              "button",
              {
                onClick: () => setUISettings((s) => ({ ...s, theme: "dark" })),
                className: `w-full py-1.5 rounded-md text-sm font-medium transition-colors ${uiSettings.theme === "dark" ? "bg-zinc-900 text-white shadow-sm" : "text-gray-600 dark:text-zinc-300"}`,
                children: "\u9ED1\u6697"
              }
            )
          ] }) }),
          /* @__PURE__ */ jsx10(InputField, { label: "\u5361\u7247\u6837\u5F0F\u5207\u6362", id: "card-style-switcher", children: /* @__PURE__ */ jsxs9("div", { className: "flex gap-2 rounded-lg bg-gray-100 dark:bg-zinc-700 p-1", children: [
            /* @__PURE__ */ jsx10(
              "button",
              {
                onClick: () => setUISettings((s) => ({ ...s, cardStyle: "grid" })),
                className: `w-full py-1.5 rounded-md text-sm font-medium transition-colors ${uiSettings.cardStyle === "grid" ? "bg-white text-gray-800 shadow-sm dark:bg-zinc-900 dark:text-white" : "text-gray-600 dark:text-zinc-300"}`,
                children: "\u7F51\u683C"
              }
            ),
            /* @__PURE__ */ jsx10(
              "button",
              {
                onClick: () => setUISettings((s) => ({ ...s, cardStyle: "carousel" })),
                className: `w-full py-1.5 rounded-md text-sm font-medium transition-colors ${uiSettings.cardStyle === "carousel" ? "bg-white text-gray-800 shadow-sm dark:bg-zinc-900 dark:text-white" : "text-gray-600 dark:text-zinc-300"}`,
                children: "\u8F6E\u64AD"
              }
            )
          ] }) }),
          /* @__PURE__ */ jsx10(InputField, { label: "\u7F16\u8F91\u5668\u5B57\u4F53", id: "editor-font-family", children: /* @__PURE__ */ jsxs9(
            "select",
            {
              id: "editor-font-family",
              value: uiSettings.editorFontFamily,
              onChange: (e) => setUISettings((s) => ({ ...s, editorFontFamily: e.target.value })),
              className: "w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-gray-500 focus:border-gray-500 dark:bg-zinc-700 dark:border-zinc-600 dark:text-white",
              children: [
                /* @__PURE__ */ jsx10("option", { value: "sans-serif", children: "\u65E0\u886C\u7EBF (\u9ED8\u8BA4)" }),
                /* @__PURE__ */ jsx10("option", { value: "serif", children: "\u886C\u7EBF\u4F53" }),
                /* @__PURE__ */ jsx10("option", { value: "monospace", children: "\u7B49\u5BBD\u5B57\u4F53" })
              ]
            }
          ) }),
          /* @__PURE__ */ jsxs9("div", { children: [
            /* @__PURE__ */ jsx10("label", { className: "block text-sm font-medium text-gray-700 dark:text-zinc-300", children: "\u7F16\u8F91\u5668\u5B57\u53F7" }),
            /* @__PURE__ */ jsxs9("div", { className: "flex items-center gap-4 mt-2", children: [
              /* @__PURE__ */ jsx10(
                "input",
                {
                  type: "range",
                  value: uiSettings.editorFontSize,
                  onChange: (e) => setUISettings((s) => ({ ...s, editorFontSize: parseInt(e.target.value, 10) })),
                  min: 12,
                  max: 24,
                  step: 1,
                  className: "w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer dark:bg-zinc-600"
                }
              ),
              /* @__PURE__ */ jsxs9("span", { className: "font-mono text-sm text-gray-600 dark:text-zinc-400 w-12 text-center", children: [
                uiSettings.editorFontSize,
                "px"
              ] })
            ] })
          ] })
        ] }),
        /* @__PURE__ */ jsx10("div", { className: "pt-6 mt-6 border-t border-gray-200 dark:border-zinc-700 flex justify-end", children: /* @__PURE__ */ jsx10(
          "button",
          {
            onClick: handleSave,
            disabled: saveStatus === "saved",
            className: `font-semibold py-2 px-6 rounded-lg shadow-sm transition-all w-32 text-center ${saveStatus === "saved" ? "bg-green-600 text-white cursor-default" : "bg-gray-800 text-white hover:bg-gray-900 dark:bg-slate-100 dark:text-gray-800 dark:hover:bg-slate-200"}`,
            children: saveStatus === "saved" ? "\u2713 \u5DF2\u4FDD\u5B58" : "\u4FDD\u5B58\u8BBE\u7F6E"
          }
        ) })
      ] }) })
    ] }),
    /* @__PURE__ */ jsx10("style", { children: `
                @keyframes fade-in {
                    from { opacity: 0; transform: translateY(-10px); }
                    to { opacity: 1; transform: translateY(0); }
                }
                .animate-fade-in {
                    animation: fade-in 0.3s ease-out forwards;
                }
            ` })
  ] });
};
var SettingsView_default = SettingsView;

// components/ResultView.tsx
init_aiService();
init_icons();
import { useState as useState6, useEffect as useEffect5, useRef as useRef3, useCallback as useCallback3, useMemo as useMemo2 } from "react";
import EasyMDE from "easymde";
import { jsx as jsx11, jsxs as jsxs10 } from "react/jsx-runtime";
var MAX_ATTACHMENTS = 5;
var ResultView = ({
  outline,
  setOutline,
  config,
  setConfig,
  novelInfo,
  setNovelInfo,
  uiSettings,
  isGenerating,
  setIsGenerating,
  combinedCards,
  onSaveToArchive,
  assistantHistory,
  setAssistantHistory,
  chatHistory,
  setChatHistory
}) => {
  const textareaRef = useRef3(null);
  const easyMdeInstance = useRef3(null);
  const [saveStatus, setSaveStatus] = useState6("idle");
  const chatContainerRef = useRef3(null);
  const importFileInputRef = useRef3(null);
  const [isEditingName, setIsEditingName] = useState6(false);
  const nameInputRef = useRef3(null);
  const chatInputRef = useRef3(null);
  const abortControllerRef = useRef3(null);
  const imageUploadInputRef = useRef3(null);
  const textUploadInputRef = useRef3(null);
  const [isUploadMenuOpen, setIsUploadMenuOpen] = useState6(false);
  const uploadMenuRef = useRef3(null);
  const [chatMode, setChatMode] = useState6("assistant");
  const [chatInput, setChatInput] = useState6("");
  const [isChatLoading, setIsChatLoading] = useState6(false);
  const [attachments, setAttachments] = useState6([]);
  const currentChatHistory = useMemo2(() => chatMode === "assistant" ? assistantHistory : chatHistory, [chatMode, assistantHistory, chatHistory]);
  const setCurrentChatHistory = useMemo2(() => chatMode === "assistant" ? setAssistantHistory : setChatHistory, [chatMode, setAssistantHistory, setChatHistory]);
  const [isModelSelectOpen, setIsModelSelectOpen] = useState6(false);
  const [modelList, setModelList] = useState6([]);
  const [isModelListLoading, setIsModelListLoading] = useState6(false);
  const [modelSearch, setModelSearch] = useState6("");
  const modelSelectRef = useRef3(null);
  useEffect5(() => {
    if (isEditingName && nameInputRef.current) {
      nameInputRef.current.focus();
      nameInputRef.current.select();
    }
  }, [isEditingName]);
  useEffect5(() => {
    let mde = null;
    if (textareaRef.current) {
      mde = new EasyMDE({
        element: textareaRef.current,
        initialValue: outline,
        spellChecker: false,
        placeholder: "\u60A8\u751F\u6210\u7684\u6545\u4E8B\u5927\u7EB2\u5C06\u663E\u793A\u5728\u8FD9\u91CC\uFF0C\u60A8\u53EF\u4EE5\u81EA\u7531\u7F16\u8F91...",
        toolbar: false,
        // Remove the default toolbar
        minHeight: "100px"
      });
      easyMdeInstance.current = mde;
      mde.codemirror.on("change", () => {
        if (easyMdeInstance.current) {
          setOutline(easyMdeInstance.current.value());
          if (saveStatus === "saved") {
            setSaveStatus("idle");
          }
        }
      });
    }
    return () => {
      easyMdeInstance.current?.toTextArea();
      easyMdeInstance.current = null;
      mde = null;
    };
  }, []);
  useEffect5(() => {
    const mde = easyMdeInstance.current;
    if (mde && mde.value() !== outline) {
      const scrollInfo = mde.codemirror.getScrollInfo();
      mde.value(outline);
      const cm = mde.codemirror;
      const lastLine = cm.lineCount() - 1;
      cm.setCursor({ line: lastLine, ch: cm.getLine(lastLine).length });
      cm.scrollTo(scrollInfo.left, scrollInfo.top);
    }
  }, [outline]);
  useEffect5(() => {
    const mde = easyMdeInstance.current;
    const codemirrorEl = mde?.codemirror.getWrapperElement();
    if (codemirrorEl) {
      codemirrorEl.style.fontSize = `${uiSettings.editorFontSize}px`;
      codemirrorEl.style.fontFamily = uiSettings.editorFontFamily;
    }
  }, [uiSettings]);
  useEffect5(() => {
    if (chatContainerRef.current) {
      chatContainerRef.current.scrollTop = chatContainerRef.current.scrollHeight;
    }
  }, [currentChatHistory]);
  useEffect5(() => {
    const loadModels = async () => {
      if (!config.provider) return;
      setIsModelListLoading(true);
      try {
        const models = await fetchModels(config);
        setModelList(models);
      } catch (error) {
        console.error("Failed to fetch models for assistant:", error);
        setModelList([]);
      } finally {
        setIsModelListLoading(false);
      }
    };
    loadModels();
  }, [config.provider, config.apiKey, config.endpoint]);
  useEffect5(() => {
    const handleClickOutside = (event) => {
      if (modelSelectRef.current && !modelSelectRef.current.contains(event.target)) {
        setIsModelSelectOpen(false);
      }
      if (uploadMenuRef.current && !uploadMenuRef.current.contains(event.target)) {
        setIsUploadMenuOpen(false);
      }
    };
    document.addEventListener("mousedown", handleClickOutside);
    return () => {
      document.removeEventListener("mousedown", handleClickOutside);
    };
  }, []);
  useEffect5(() => {
    if (!isGenerating) return;
    let active = true;
    const generate = async () => {
      try {
        let accumulatedOutline = "";
        setOutline("");
        const stream = generateOutline(combinedCards, config, novelInfo);
        for await (const chunk of stream) {
          if (!active) break;
          accumulatedOutline += chunk;
          setOutline(accumulatedOutline);
        }
      } catch (err) {
        alert(err instanceof Error ? err.message : "\u53D1\u751F\u672A\u77E5\u9519\u8BEF\u3002");
      } finally {
        if (active) {
          setIsGenerating(false);
        }
      }
    };
    generate();
    return () => {
      active = false;
    };
  }, [isGenerating, combinedCards, config, novelInfo, setOutline, setIsGenerating]);
  const handleSave = () => {
    onSaveToArchive();
    setSaveStatus("saved");
    setTimeout(() => setSaveStatus("idle"), 2e3);
  };
  const handleTogglePreview = () => {
    if (easyMdeInstance.current) {
      EasyMDE.togglePreview(easyMdeInstance.current);
    }
  };
  const handleExport = () => {
    try {
      const currentContent = easyMdeInstance.current?.value() || outline;
      const blob = new Blob([currentContent], { type: "text/markdown;charset=utf-8" });
      const url = URL.createObjectURL(blob);
      const link = document.createElement("a");
      const downloadName = novelInfo.name ? `${novelInfo.name}.md` : "story-outline.md";
      link.href = url;
      link.download = downloadName;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      URL.revokeObjectURL(url);
    } catch (error) {
      console.error("Failed to export file:", error);
      alert("\u5BFC\u51FA\u6587\u4EF6\u5931\u8D25\uFF01");
    }
  };
  const handleImportClick = () => {
    importFileInputRef.current?.click();
  };
  const handleFileImport = (e) => {
    const file = e.target.files?.[0];
    if (!file) return;
    if (!novelInfo.name.trim()) {
      const fileNameWithoutExtension = file.name.replace(/\.(md|txt)$/i, "");
      setNovelInfo((prev) => ({ ...prev, name: fileNameWithoutExtension }));
    }
    const reader = new FileReader();
    reader.onload = (event) => {
      const content = event.target?.result;
      setOutline(content);
    };
    reader.onerror = () => {
      alert("\u8BFB\u53D6\u6587\u4EF6\u5931\u8D25\u3002");
    };
    reader.readAsText(file);
    e.target.value = "";
  };
  const handleInterrupt = () => {
    abortControllerRef.current?.abort();
  };
  const handleClearHistory = () => {
    if (window.confirm(`\u60A8\u786E\u5B9A\u8981\u6E05\u7A7A\u201C${chatMode === "assistant" ? "AI \u4FEE\u6539" : "AI \u804A\u5929"}\u201D\u7684\u5BF9\u8BDD\u8BB0\u5F55\u5417\uFF1F\u6B64\u64CD\u4F5C\u65E0\u6CD5\u64A4\u9500\u3002`)) {
      setCurrentChatHistory([]);
    }
  };
  const handleChatSubmit = useCallback3(async (e) => {
    e.preventDefault();
    const message = chatInput.trim();
    if (!message && attachments.length === 0 || isChatLoading) return;
    setChatInput("");
    setAttachments([]);
    if (chatInputRef.current) {
      chatInputRef.current.style.height = "auto";
    }
    const controller = new AbortController();
    abortControllerRef.current = controller;
    let userMessageContent = message;
    const userMessageImages = [];
    const textAttachmentsContent = [];
    attachments.forEach((att) => {
      if (att.type === "image") {
        userMessageImages.push(att.data);
      } else if (att.type === "text") {
        textAttachmentsContent.push(`--- Attached File: ${att.name} ---
${att.data}`);
      }
    });
    if (textAttachmentsContent.length > 0) {
      userMessageContent = (userMessageContent + "\n\n" + textAttachmentsContent.join("\n\n")).trim();
    }
    const newUserMessage = {
      id: `user-${Date.now()}`,
      role: "user",
      content: userMessageContent,
      images: userMessageImages.length > 0 ? userMessageImages : void 0
    };
    const newHistory = [...currentChatHistory, newUserMessage];
    setCurrentChatHistory(newHistory);
    setIsChatLoading(true);
    try {
      const assistantConfig = { ...config, model: config.assistantModel || config.model };
      if (chatMode === "assistant") {
        const currentOutline = easyMdeInstance.current?.value() || outline;
        let finalOutline = "";
        const stream = polishOutline(currentOutline, userMessageContent, assistantConfig, controller.signal);
        for await (const chunk of stream) {
          if (controller.signal.aborted) break;
          finalOutline += chunk;
          setOutline(finalOutline);
        }
        if (!controller.signal.aborted) {
          setCurrentChatHistory((prev) => [...prev, { id: `model-${Date.now()}`, role: "model", content: "\u597D\u7684\uFF0C\u6211\u5DF2\u7ECF\u6839\u636E\u4F60\u7684\u8981\u6C42\u66F4\u65B0\u4E86\u5927\u7EB2\u3002" }]);
        }
      } else {
        let accumulatedResponse = "";
        setCurrentChatHistory((prev) => [...prev, { id: `model-streaming-${Date.now()}`, role: "model", content: "" }]);
        const stream = generateChatResponse(newHistory, assistantConfig, controller.signal);
        for await (const chunk of stream) {
          accumulatedResponse += chunk;
          setCurrentChatHistory((prev) => {
            const nextHistory = [...prev];
            nextHistory[nextHistory.length - 1].content = accumulatedResponse;
            return nextHistory;
          });
        }
      }
    } catch (err) {
      if (err instanceof DOMException && err.name === "AbortError") {
        console.log("Stream interrupted by user.");
        if (chatMode === "assistant") {
          setCurrentChatHistory((prev) => [...prev, { id: `system-${Date.now()}`, role: "system", content: "\u64CD\u4F5C\u5DF2\u7531\u7528\u6237\u4E2D\u65AD\u3002" }]);
        } else {
          setCurrentChatHistory((prev) => {
            const newHistory2 = [...prev];
            const lastMessage = newHistory2[newHistory2.length - 1];
            if (lastMessage && lastMessage.role === "model") {
              if (lastMessage.content.trim() === "") {
                lastMessage.content = "\uFF08\u5DF2\u53D6\u6D88\uFF09";
              } else {
                lastMessage.content += "\n\uFF08\u5DF2\u4E2D\u65AD\uFF09";
              }
            }
            return newHistory2;
          });
        }
      } else {
        const errorMessage = err instanceof Error ? err.message : "\u53D1\u751F\u672A\u77E5\u9519\u8BEF\u3002";
        alert(errorMessage);
        setCurrentChatHistory((prev) => [...prev, { id: `system-error-${Date.now()}`, role: "system", content: `\u62B1\u6B49\uFF0C\u64CD\u4F5C\u5931\u8D25: ${errorMessage}` }]);
      }
    } finally {
      setIsChatLoading(false);
      abortControllerRef.current = null;
    }
  }, [chatInput, isChatLoading, outline, config, setOutline, chatMode, currentChatHistory, setCurrentChatHistory, attachments]);
  const handleChatInputChange = (e) => {
    setChatInput(e.target.value);
    const textarea = e.target;
    textarea.style.height = "auto";
    const maxHeight = 200;
    textarea.style.height = `${Math.min(textarea.scrollHeight, maxHeight)}px`;
  };
  const handlePaste = (e) => {
    if (attachments.length >= MAX_ATTACHMENTS || isChatLoading) return;
    const items = e.clipboardData.items;
    for (let i = 0; i < items.length; i++) {
      if (items[i].type.indexOf("image") !== -1) {
        const file = items[i].getAsFile();
        if (file) {
          e.preventDefault();
          const reader = new FileReader();
          reader.onload = (event) => {
            const base64String = (event.target?.result).split(",")[1];
            setAttachments((prev) => [...prev, { type: "image", data: base64String, name: file.name || "pasted-image.png" }]);
          };
          reader.readAsDataURL(file);
          return;
        }
      }
    }
  };
  const handleImageFileSelected = (e) => {
    const files = e.target.files;
    if (!files) return;
    if (attachments.length + files.length > MAX_ATTACHMENTS) {
      alert(`\u6700\u591A\u53EA\u80FD\u6DFB\u52A0 ${MAX_ATTACHMENTS} \u4E2A\u9644\u4EF6\u3002\u60A8\u5C1D\u8BD5\u6DFB\u52A0 ${files.length} \u4E2A\uFF0C\u4F46\u53EA\u80FD\u518D\u6DFB\u52A0 ${MAX_ATTACHMENTS - attachments.length} \u4E2A\u3002`);
      e.target.value = "";
      return;
    }
    for (const file of Array.from(files)) {
      if (!file.type.startsWith("image/")) {
        alert(`\u6587\u4EF6 "${file.name}" \u4E0D\u662F\u56FE\u7247\uFF0C\u5DF2\u8DF3\u8FC7\u3002`);
        continue;
      }
      const reader = new FileReader();
      reader.onload = (event) => {
        const base64String = (event.target?.result).split(",")[1];
        setAttachments((prev) => [...prev, { type: "image", data: base64String, name: file.name }]);
      };
      reader.readAsDataURL(file);
    }
    e.target.value = "";
  };
  const handleTextFileSelected = (e) => {
    const files = e.target.files;
    if (!files) return;
    if (attachments.length + files.length > MAX_ATTACHMENTS) {
      alert(`\u6700\u591A\u53EA\u80FD\u6DFB\u52A0 ${MAX_ATTACHMENTS} \u4E2A\u9644\u4EF6\u3002\u60A8\u5C1D\u8BD5\u6DFB\u52A0 ${files.length} \u4E2A\uFF0C\u4F46\u53EA\u80FD\u518D\u6DFB\u52A0 ${MAX_ATTACHMENTS - attachments.length} \u4E2A\u3002`);
      e.target.value = "";
      return;
    }
    for (const file of Array.from(files)) {
      const reader = new FileReader();
      reader.onload = (event) => {
        const textContent = event.target?.result;
        setAttachments((prev) => [...prev, { type: "text", data: textContent, name: file.name }]);
      };
      reader.readAsText(file);
    }
    e.target.value = "";
  };
  const filteredModels = useMemo2(() => {
    if (!modelSearch) return modelList;
    return modelList.filter((m) => m.toLowerCase().includes(modelSearch.toLowerCase()));
  }, [modelList, modelSearch]);
  return /* @__PURE__ */ jsxs10("div", { className: "w-full h-full flex flex-row gap-2", children: [
    /* @__PURE__ */ jsxs10("aside", { className: "w-56 flex-shrink-0 h-full flex flex-col bg-white rounded-xl border border-gray-200 shadow-sm dark:bg-zinc-800 dark:border-zinc-700 min-h-0", children: [
      /* @__PURE__ */ jsx11("header", { className: "p-4 border-b border-gray-200 dark:border-zinc-600 flex-shrink-0", children: /* @__PURE__ */ jsx11("h2", { className: "font-semibold text-gray-800 dark:text-zinc-100", children: "\u5927\u7EB2\u4FE1\u606F" }) }),
      /* @__PURE__ */ jsx11("div", { className: "flex-grow overflow-y-auto custom-scrollbar", children: /* @__PURE__ */ jsxs10("div", { className: "p-4", children: [
        /* @__PURE__ */ jsx11("label", { className: "block text-sm font-medium text-gray-600 dark:text-zinc-300 mb-1", children: "\u5927\u7EB2\u540D\u79F0" }),
        isEditingName ? /* @__PURE__ */ jsx11(
          "input",
          {
            ref: nameInputRef,
            type: "text",
            value: novelInfo.name,
            onChange: (e) => setNovelInfo({ ...novelInfo, name: e.target.value }),
            onBlur: () => setIsEditingName(false),
            onKeyDown: (e) => {
              if (e.key === "Enter") {
                e.preventDefault();
                setIsEditingName(false);
              }
            },
            className: "w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-gray-500 focus:border-gray-500 dark:bg-zinc-700 dark:border-zinc-600 dark:text-white",
            placeholder: "\u4E3A\u4F60\u7684\u5927\u7EB2\u547D\u540D"
          }
        ) : /* @__PURE__ */ jsx11(
          "div",
          {
            onDoubleClick: () => setIsEditingName(true),
            className: "w-full px-3 py-2 border border-transparent rounded-md cursor-pointer hover:bg-gray-100 dark:hover:bg-zinc-700",
            title: "\u53CC\u51FB\u4EE5\u7F16\u8F91",
            children: /* @__PURE__ */ jsx11("p", { className: "text-gray-800 dark:text-zinc-100 truncate", children: novelInfo.name || "\u672A\u547D\u540D\u5927\u7EB2" })
          }
        )
      ] }) })
    ] }),
    /* @__PURE__ */ jsxs10("div", { className: "flex-grow h-full flex flex-col min-w-0 min-h-0", children: [
      /* @__PURE__ */ jsxs10("header", { className: "flex-shrink-0 flex justify-end items-center mb-4 space-x-2", children: [
        /* @__PURE__ */ jsx11("input", { type: "file", ref: importFileInputRef, onChange: handleFileImport, accept: ".md,.txt", style: { display: "none" } }),
        /* @__PURE__ */ jsxs10(
          "button",
          {
            onClick: handleTogglePreview,
            className: "flex items-center gap-2 px-4 py-2 text-sm font-semibold text-gray-700 bg-white border border-gray-300 rounded-md shadow-sm hover:bg-gray-50 transition-colors dark:bg-zinc-700 dark:text-zinc-200 dark:border-zinc-600 dark:hover:bg-zinc-600",
            title: "\u5207\u6362\u9884\u89C8 (Ctrl-P)",
            children: [
              /* @__PURE__ */ jsx11(PreviewIcon, { className: "w-4 h-4" }),
              /* @__PURE__ */ jsx11("span", { children: "\u9884\u89C8" })
            ]
          }
        ),
        /* @__PURE__ */ jsx11(
          "button",
          {
            onClick: handleSave,
            disabled: saveStatus !== "idle",
            className: `px-4 py-2 text-sm font-semibold rounded-md transition-all w-24 ${saveStatus === "saved" ? "bg-green-600 text-white cursor-default" : "bg-white text-gray-700 border border-gray-300 hover:bg-gray-50 disabled:opacity-50 dark:bg-zinc-700 dark:text-zinc-200 dark:border-zinc-600 dark:hover:bg-zinc-600"}`,
            children: saveStatus === "saved" ? "\u2713 \u5DF2\u4FDD\u5B58" : "\u4FDD\u5B58"
          }
        ),
        /* @__PURE__ */ jsxs10(
          "button",
          {
            onClick: handleImportClick,
            className: "flex items-center gap-2 px-4 py-2 text-sm font-semibold text-gray-700 bg-white border border-gray-300 rounded-md shadow-sm hover:bg-gray-50 transition-colors dark:bg-zinc-700 dark:text-zinc-200 dark:border-zinc-600 dark:hover:bg-zinc-600",
            title: "\u4ECE\u672C\u5730\u5BFC\u5165 Markdown \u6587\u4EF6",
            children: [
              /* @__PURE__ */ jsx11(UploadIcon, { className: "w-4 h-4" }),
              /* @__PURE__ */ jsx11("span", { children: "\u5BFC\u5165" })
            ]
          }
        ),
        /* @__PURE__ */ jsxs10(
          "button",
          {
            onClick: handleExport,
            className: "flex items-center gap-2 px-4 py-2 text-sm font-semibold text-white bg-gray-800 rounded-md shadow-sm hover:bg-gray-900 transition-colors dark:bg-slate-100 dark:text-gray-800 dark:hover:bg-slate-200",
            title: "\u5BFC\u51FA\u4E3A Markdown",
            children: [
              /* @__PURE__ */ jsx11(DownloadIcon, { className: "w-4 h-4" }),
              /* @__PURE__ */ jsx11("span", { children: "\u5BFC\u51FA" })
            ]
          }
        )
      ] }),
      /* @__PURE__ */ jsx11("div", { className: "flex-grow relative editor-container min-h-0", children: /* @__PURE__ */ jsx11("textarea", { ref: textareaRef, style: { display: "none" } }) })
    ] }),
    /* @__PURE__ */ jsxs10("aside", { className: "w-96 flex-shrink-0 h-full flex flex-col bg-white rounded-xl border border-gray-200 shadow-sm dark:bg-zinc-800 dark:border-zinc-700 min-h-0", children: [
      /* @__PURE__ */ jsxs10("header", { className: "flex-shrink-0 p-3 border-b border-gray-200 dark:border-zinc-600 flex justify-between items-center", children: [
        /* @__PURE__ */ jsxs10("div", { className: "flex items-center gap-1 rounded-lg bg-gray-100 dark:bg-zinc-700/60 p-1", children: [
          /* @__PURE__ */ jsx11(
            "button",
            {
              onClick: () => setChatMode("assistant"),
              className: `w-20 py-1 rounded-md text-sm font-medium transition-all duration-200 ${chatMode === "assistant" ? "bg-white text-gray-800 shadow-sm dark:bg-zinc-600 dark:text-zinc-100" : "text-gray-600 hover:bg-white/50 dark:text-zinc-400 dark:hover:bg-zinc-900/20"}`,
              children: "AI \u4FEE\u6539"
            }
          ),
          /* @__PURE__ */ jsx11(
            "button",
            {
              onClick: () => setChatMode("chat"),
              className: `w-20 py-1 rounded-md text-sm font-medium transition-all duration-200 ${chatMode === "chat" ? "bg-white text-gray-800 shadow-sm dark:bg-zinc-600 dark:text-zinc-100" : "text-gray-600 hover:bg-white/50 dark:text-zinc-400 dark:hover:bg-zinc-900/20"}`,
              children: "AI \u804A\u5929"
            }
          )
        ] }),
        /* @__PURE__ */ jsx11(
          "button",
          {
            onClick: handleClearHistory,
            className: "p-2 text-gray-400 hover:text-red-600 rounded-full hover:bg-red-100/60 transition-colors dark:text-zinc-500 dark:hover:text-red-500 dark:hover:bg-red-900/40",
            title: "\u6E05\u7A7A\u5F53\u524D\u5BF9\u8BDD\u8BB0\u5F55",
            children: /* @__PURE__ */ jsx11(TrashIcon, { className: "w-4 h-4" })
          }
        )
      ] }),
      /* @__PURE__ */ jsxs10("div", { ref: chatContainerRef, className: "flex-grow p-4 space-y-4 overflow-y-auto custom-scrollbar", children: [
        currentChatHistory.map((msg, index) => {
          if (msg.role === "system") {
            return /* @__PURE__ */ jsx11("div", { className: "text-center w-full my-2", children: /* @__PURE__ */ jsx11("p", { className: "text-xs text-gray-500 bg-slate-100 rounded-full px-3 py-1 inline-block dark:bg-zinc-700 dark:text-zinc-400", children: msg.content }) }, msg.id);
          }
          const isUser = msg.role === "user";
          const isLastMessageStreaming = isChatLoading && index === currentChatHistory.length - 1 && !isUser;
          return /* @__PURE__ */ jsxs10("div", { className: `flex items-end gap-2.5 ${isUser ? "justify-end" : "justify-start"}`, children: [
            !isUser && /* @__PURE__ */ jsx11("div", { className: "w-8 h-8 flex-shrink-0 rounded-full bg-gradient-to-br from-purple-400 to-yellow-300 flex items-center justify-center shadow-sm", children: /* @__PURE__ */ jsx11(AiIcon, { className: "w-5 h-5 text-white" }) }),
            /* @__PURE__ */ jsxs10("div", { className: `max-w-[85%] px-4 py-3 rounded-2xl ${isUser ? "bg-blue-600 text-white rounded-br-md" : "bg-gray-100 text-gray-800 rounded-bl-md dark:bg-zinc-700 dark:text-zinc-200"}`, children: [
              msg.images && msg.images.length > 0 && /* @__PURE__ */ jsx11("div", { className: "flex flex-wrap gap-2 mb-2", children: msg.images.map((imgData, imgIndex) => /* @__PURE__ */ jsx11(
                "img",
                {
                  src: `data:image/jpeg;base64,${imgData}`,
                  alt: `Uploaded content ${imgIndex + 1}`,
                  className: "rounded-lg max-w-full h-auto max-h-48 object-contain bg-gray-200 dark:bg-zinc-600"
                },
                imgIndex
              )) }),
              /* @__PURE__ */ jsxs10("p", { className: "text-sm leading-relaxed break-words whitespace-pre-wrap", children: [
                isLastMessageStreaming && !msg.content ? /* @__PURE__ */ jsx11(Spinner_default, {}) : msg.content,
                isLastMessageStreaming && msg.content ? /* @__PURE__ */ jsx11("span", { className: "inline-block w-2 h-4 bg-gray-600 dark:bg-zinc-400 animate-pulse ml-1" }) : null
              ] })
            ] })
          ] }, msg.id);
        }),
        isChatLoading && chatMode === "assistant" && /* @__PURE__ */ jsx11("div", { className: "flex justify-start", children: /* @__PURE__ */ jsxs10("div", { className: "max-w-[85%] px-4 py-2 rounded-xl bg-gray-100 text-gray-800 flex items-center gap-2 dark:bg-zinc-700 dark:text-zinc-200", children: [
          /* @__PURE__ */ jsx11(Spinner_default, {}),
          /* @__PURE__ */ jsx11("span", { className: "text-sm", children: "\u6B63\u5728\u601D\u8003..." })
        ] }) })
      ] }),
      /* @__PURE__ */ jsxs10("div", { className: "flex-shrink-0 p-4 border-t border-gray-200 dark:border-zinc-600", children: [
        /* @__PURE__ */ jsxs10(
          "form",
          {
            onSubmit: handleChatSubmit,
            className: "group relative flex flex-col w-full rounded-xl shadow-md border-2 border-transparent bg-clip-padding focus-within:border-purple-400 transition-all duration-300",
            style: {
              backgroundImage: `linear-gradient(var(--ai-input-bg, #fff), var(--ai-input-bg, #fff)), linear-gradient(120deg, #a855f7, #fde047)`,
              backgroundOrigin: "border-box"
            },
            children: [
              attachments.length > 0 && /* @__PURE__ */ jsx11("div", { className: "px-2 pt-2 border-b border-gray-200 dark:border-zinc-700", children: /* @__PURE__ */ jsxs10("div", { className: "flex items-center gap-3 overflow-x-auto custom-scrollbar pb-2", children: [
                attachments.map((att, index) => /* @__PURE__ */ jsxs10("div", { className: "relative flex-shrink-0 bg-gray-100 dark:bg-zinc-700 p-1.5 rounded-lg", children: [
                  att.type === "image" ? /* @__PURE__ */ jsx11("img", { src: `data:image/jpeg;base64,${att.data}`, alt: "Preview", className: "h-16 w-auto rounded" }) : /* @__PURE__ */ jsxs10("div", { className: "h-16 w-20 flex flex-col items-center justify-center text-center p-1", children: [
                    /* @__PURE__ */ jsx11(DocumentPlusIcon, { className: "w-6 h-6 text-gray-500 dark:text-zinc-400" }),
                    /* @__PURE__ */ jsx11("span", { className: "text-xs text-gray-600 dark:text-zinc-300 mt-1 truncate w-full", title: att.name, children: att.name })
                  ] }),
                  /* @__PURE__ */ jsx11(
                    "button",
                    {
                      type: "button",
                      onClick: () => setAttachments((prev) => prev.filter((_, i) => i !== index)),
                      className: "absolute -top-1.5 -right-1.5 w-5 h-5 bg-gray-700 text-white rounded-full flex items-center justify-center text-xs hover:bg-red-500 transition-colors z-10",
                      "aria-label": `Remove ${att.name}`,
                      children: "\xD7"
                    }
                  )
                ] }, index)),
                attachments.length >= MAX_ATTACHMENTS && /* @__PURE__ */ jsx11("div", { className: "text-xs text-red-500 pl-2 flex-shrink-0 self-center", children: "\u8FBE\u5230\u6700\u5927\u6570\u91CF" })
              ] }) }),
              /* @__PURE__ */ jsxs10("div", { className: "relative flex-grow", children: [
                /* @__PURE__ */ jsx11("div", { className: "absolute bottom-3 left-3 flex items-center gap-1 z-10", children: /* @__PURE__ */ jsxs10("div", { ref: modelSelectRef, className: "relative", children: [
                  /* @__PURE__ */ jsx11(
                    "button",
                    {
                      type: "button",
                      onClick: () => setIsModelSelectOpen((prev) => !prev),
                      className: "p-1 rounded-full text-gray-400 hover:text-gray-600 hover:bg-gray-100 dark:text-zinc-500 dark:hover:text-zinc-300 dark:hover:bg-zinc-700 transition-colors",
                      "aria-label": "\u9009\u62E9AI\u6A21\u578B",
                      title: "\u9009\u62E9AI\u6A21\u578B",
                      children: /* @__PURE__ */ jsx11(AiIcon, { className: "w-5 h-5" })
                    }
                  ),
                  isModelSelectOpen && /* @__PURE__ */ jsxs10("div", { className: "absolute bottom-full mb-2 w-56 bg-white dark:bg-zinc-700 rounded-lg shadow-lg border border-gray-200 dark:border-zinc-600 z-10", children: [
                    /* @__PURE__ */ jsx11("div", { className: "p-2", children: /* @__PURE__ */ jsx11(
                      "input",
                      {
                        type: "text",
                        value: modelSearch,
                        onChange: (e) => setModelSearch(e.target.value),
                        placeholder: "\u641C\u7D22\u6A21\u578B...",
                        className: "w-full px-2 py-1.5 text-sm border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-gray-500 focus:border-gray-500 dark:bg-zinc-600 dark:border-zinc-500 dark:text-white"
                      }
                    ) }),
                    /* @__PURE__ */ jsxs10("div", { className: "p-2 text-xs text-gray-500 dark:text-zinc-400 border-t border-gray-100 dark:border-zinc-600", children: [
                      "\u6A21\u578B (",
                      config.assistantModel || config.model,
                      ")"
                    ] }),
                    /* @__PURE__ */ jsx11("ul", { className: "max-h-48 overflow-y-auto text-sm custom-scrollbar", children: isModelListLoading ? /* @__PURE__ */ jsx11("li", { className: "px-3 py-2 text-gray-500 dark:text-zinc-400", children: "\u52A0\u8F7D\u4E2D..." }) : filteredModels.length > 0 ? filteredModels.map((modelName) => /* @__PURE__ */ jsx11(
                      "li",
                      {
                        onClick: () => {
                          setConfig((prev) => ({ ...prev, assistantModel: modelName }));
                          setIsModelSelectOpen(false);
                          setModelSearch("");
                        },
                        className: "px-3 py-2 cursor-pointer hover:bg-gray-100 dark:hover:bg-zinc-600",
                        children: modelName
                      },
                      modelName
                    )) : /* @__PURE__ */ jsx11("li", { className: "px-3 py-2 text-gray-500 dark:text-zinc-400", children: "\u65E0\u5339\u914D\u6A21\u578B" }) })
                  ] })
                ] }) }),
                /* @__PURE__ */ jsx11(
                  "textarea",
                  {
                    ref: chatInputRef,
                    value: chatInput,
                    onChange: handleChatInputChange,
                    onKeyDown: (e) => {
                      if (e.key === "Enter" && !e.shiftKey) {
                        e.preventDefault();
                        handleChatSubmit(e);
                      }
                    },
                    onPaste: handlePaste,
                    disabled: isChatLoading,
                    placeholder: chatMode === "assistant" ? "\u6709\u4EC0\u4E48\u53EF\u4EE5\u5E2E\u60A8\u4FEE\u6539\u5927\u7EB2\uFF1F" : "\u7C98\u8D34\u56FE\u7247\u6216\u8F93\u5165\u6587\u5B57...",
                    className: "w-full pl-12 pr-24 py-3 text-base rounded-b-xl focus:outline-none custom-scrollbar resize-none bg-transparent placeholder:text-gray-400 transition-all duration-300 dark:text-white dark:placeholder:text-zinc-500 min-h-[56px]"
                  }
                ),
                /* @__PURE__ */ jsxs10("div", { className: "absolute bottom-3 right-3 flex items-center gap-1 z-10", children: [
                  /* @__PURE__ */ jsxs10("div", { ref: uploadMenuRef, className: "relative", children: [
                    /* @__PURE__ */ jsx11(
                      "button",
                      {
                        type: "button",
                        onClick: () => setIsUploadMenuOpen((prev) => !prev),
                        className: "p-2 rounded-full transition-colors text-gray-500 hover:text-gray-800 hover:bg-gray-100 disabled:text-gray-300 dark:text-zinc-400 dark:hover:text-zinc-100 dark:hover:bg-zinc-700",
                        "aria-label": "\u4E0A\u4F20\u6587\u4EF6",
                        title: "\u4E0A\u4F20\u6587\u4EF6",
                        "aria-haspopup": "true",
                        "aria-expanded": isUploadMenuOpen,
                        disabled: isChatLoading || attachments.length >= MAX_ATTACHMENTS,
                        children: /* @__PURE__ */ jsx11(PlusIcon, { className: "w-5 h-5" })
                      }
                    ),
                    isUploadMenuOpen && /* @__PURE__ */ jsx11("div", { className: "absolute bottom-full right-0 mb-2 w-48 bg-white dark:bg-zinc-800 rounded-xl shadow-lg border border-gray-200 dark:border-zinc-700 z-20 overflow-hidden", children: /* @__PURE__ */ jsxs10("ul", { className: "text-sm text-gray-700 dark:text-zinc-200", children: [
                      /* @__PURE__ */ jsx11("li", { children: /* @__PURE__ */ jsxs10(
                        "button",
                        {
                          type: "button",
                          onClick: () => {
                            imageUploadInputRef.current?.click();
                            setIsUploadMenuOpen(false);
                          },
                          className: "w-full flex items-center gap-3 px-4 py-3 hover:bg-gray-100 dark:hover:bg-zinc-700 transition-colors text-left",
                          children: [
                            /* @__PURE__ */ jsx11(PhotoIcon, { className: "w-5 h-5 text-gray-500 dark:text-zinc-400" }),
                            /* @__PURE__ */ jsx11("span", { children: "\u4E0A\u4F20\u56FE\u7247" })
                          ]
                        }
                      ) }),
                      /* @__PURE__ */ jsx11("li", { children: /* @__PURE__ */ jsxs10(
                        "button",
                        {
                          type: "button",
                          onClick: () => {
                            textUploadInputRef.current?.click();
                            setIsUploadMenuOpen(false);
                          },
                          className: "w-full flex items-center gap-3 px-4 py-3 hover:bg-gray-100 dark:hover:bg-zinc-700 transition-colors text-left",
                          children: [
                            /* @__PURE__ */ jsx11(DocumentPlusIcon, { className: "w-5 h-5 text-gray-500 dark:text-zinc-400" }),
                            /* @__PURE__ */ jsx11("span", { children: "\u4E0A\u4F20\u6587\u672C" })
                          ]
                        }
                      ) })
                    ] }) })
                  ] }),
                  /* @__PURE__ */ jsx11(
                    "button",
                    {
                      type: isChatLoading ? "button" : "submit",
                      onClick: isChatLoading ? handleInterrupt : void 0,
                      disabled: !isChatLoading && !chatInput.trim() && attachments.length === 0,
                      className: `p-2 rounded-full transition-colors ${isChatLoading ? "text-gray-600 bg-gray-100 hover:bg-red-100 hover:text-red-600 dark:text-zinc-300 dark:bg-zinc-700 dark:hover:bg-red-900/50 dark:hover:text-red-500" : "text-white bg-gray-800 hover:bg-gray-900 disabled:bg-transparent disabled:text-gray-400 dark:bg-slate-100 dark:text-gray-800 dark:hover:bg-slate-200 dark:disabled:text-zinc-600 dark:disabled:cursor-not-allowed"}`,
                      "aria-label": isChatLoading ? "\u4E2D\u65AD" : "\u53D1\u9001",
                      children: isChatLoading ? /* @__PURE__ */ jsx11(StopIcon, { className: "w-5 h-5" }) : /* @__PURE__ */ jsx11(ArrowUpIcon, { className: "w-5 h-5" })
                    }
                  )
                ] })
              ] })
            ]
          }
        ),
        /* @__PURE__ */ jsx11("input", { type: "file", ref: textUploadInputRef, onChange: handleTextFileSelected, accept: ".txt,.md", className: "hidden", multiple: true }),
        /* @__PURE__ */ jsx11("input", { type: "file", ref: imageUploadInputRef, onChange: handleImageFileSelected, accept: "image/*", className: "hidden", multiple: true })
      ] })
    ] })
  ] });
};
var ResultView_default = ResultView;

// components/InspirationView.tsx
import { useState as useState8 } from "react";

// components/CreateInspirationModal.tsx
import { useState as useState7, useEffect as useEffect6 } from "react";
import { jsx as jsx12, jsxs as jsxs11 } from "react/jsx-runtime";
var CreateInspirationModal = ({ isOpen, onClose, onSubmit, categoryTitle, editingItem }) => {
  const [title, setTitle] = useState7("");
  const [description, setDescription] = useState7("");
  const isEditing = !!editingItem;
  useEffect6(() => {
    if (isOpen) {
      if (isEditing && editingItem) {
        setTitle(editingItem.title);
        setDescription(editingItem.description);
      } else {
        setTitle("");
        setDescription("");
      }
    }
  }, [isOpen, isEditing, editingItem]);
  const handleSubmit = (e) => {
    e.preventDefault();
    if (!title.trim() || !description.trim()) {
      alert("\u6240\u6709\u5B57\u6BB5\u5747\u4E3A\u5FC5\u586B\u9879\u3002");
      return;
    }
    onSubmit({ title, description });
    onClose();
  };
  if (!isOpen) return null;
  return /* @__PURE__ */ jsxs11(
    "div",
    {
      className: "fixed inset-0 bg-black bg-opacity-60 flex justify-center items-center z-50 p-4 transition-opacity duration-300",
      onClick: onClose,
      role: "dialog",
      "aria-modal": "true",
      "aria-labelledby": "create-inspiration-title",
      children: [
        /* @__PURE__ */ jsxs11(
          "div",
          {
            className: "bg-white rounded-lg shadow-xl w-full max-w-md p-6 transform transition-all duration-300 scale-95 opacity-0 animate-fade-in-scale dark:bg-zinc-800",
            onClick: (e) => e.stopPropagation(),
            style: { animation: "fade-in-scale 0.3s forwards" },
            children: [
              /* @__PURE__ */ jsx12("h2", { id: "create-inspiration-title", className: "text-xl font-bold mb-4 text-gray-800 dark:text-zinc-100", children: isEditing ? "\u7F16\u8F91\u7075\u611F" : `\u4E3A \u201C${categoryTitle}\u201D \u6DFB\u52A0\u65B0\u7075\u611F` }),
              /* @__PURE__ */ jsxs11("form", { onSubmit: handleSubmit, children: [
                /* @__PURE__ */ jsxs11("div", { className: "space-y-4", children: [
                  /* @__PURE__ */ jsxs11("div", { children: [
                    /* @__PURE__ */ jsx12("label", { htmlFor: "inspiration-title", className: "block text-sm font-medium text-gray-700 dark:text-zinc-300", children: "\u6807\u9898" }),
                    /* @__PURE__ */ jsx12(
                      "input",
                      {
                        id: "inspiration-title",
                        type: "text",
                        value: title,
                        onChange: (e) => setTitle(e.target.value),
                        className: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-gray-500 focus:border-gray-500 dark:bg-zinc-700 dark:border-zinc-600 dark:text-white",
                        required: true,
                        placeholder: "\u8F93\u5165\u4E00\u4E2A\u7B80\u6D01\u7684\u6807\u9898"
                      }
                    )
                  ] }),
                  /* @__PURE__ */ jsxs11("div", { children: [
                    /* @__PURE__ */ jsx12("label", { htmlFor: "inspiration-description", className: "block text-sm font-medium text-gray-700 dark:text-zinc-300", children: "\u63CF\u8FF0" }),
                    /* @__PURE__ */ jsx12(
                      "textarea",
                      {
                        id: "inspiration-description",
                        rows: 4,
                        value: description,
                        onChange: (e) => setDescription(e.target.value),
                        className: "mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-gray-500 focus:border-gray-500 custom-scrollbar dark:bg-zinc-700 dark:border-zinc-600 dark:text-white",
                        required: true,
                        placeholder: "\u8BE6\u7EC6\u63CF\u8FF0\u8FD9\u4E2A\u4E16\u754C\u89C2\u8BBE\u5B9A"
                      }
                    )
                  ] })
                ] }),
                /* @__PURE__ */ jsxs11("div", { className: "mt-6 flex justify-end space-x-3", children: [
                  /* @__PURE__ */ jsx12(
                    "button",
                    {
                      type: "button",
                      onClick: onClose,
                      className: "px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md shadow-sm hover:bg-gray-50 focus:outline-none dark:bg-zinc-600 dark:text-zinc-200 dark:border-zinc-500 dark:hover:bg-zinc-500",
                      children: "\u53D6\u6D88"
                    }
                  ),
                  /* @__PURE__ */ jsx12(
                    "button",
                    {
                      type: "submit",
                      className: "px-4 py-2 text-sm font-medium text-white bg-gray-800 border border-transparent rounded-md shadow-sm hover:bg-gray-900 focus:outline-none dark:bg-slate-100 dark:text-gray-800 dark:hover:bg-slate-200",
                      children: isEditing ? "\u4FDD\u5B58\u66F4\u6539" : "\u6DFB\u52A0\u7075\u611F"
                    }
                  )
                ] })
              ] })
            ]
          }
        ),
        /* @__PURE__ */ jsx12("style", { children: `
                @keyframes fade-in-scale {
                    from { transform: scale(0.95); opacity: 0; }
                    to { transform: scale(1); opacity: 1; }
                }
                .animate-fade-in-scale {
                    animation: fade-in-scale 0.2s cubic-bezier(0.16, 1, 0.3, 1) forwards;
                }
            ` })
      ]
    }
  );
};
var CreateInspirationModal_default = CreateInspirationModal;

// components/InspirationView.tsx
init_icons();
import { jsx as jsx13, jsxs as jsxs12 } from "react/jsx-runtime";
var InspirationView = ({ inspirationCards, onCreateCard, onUpdateCard, onDeleteCard, onCardDragStart, onCardClick, selectedInspirationCardId }) => {
  const [isModalOpen, setIsModalOpen] = useState8(false);
  const [activeCategory, setActiveCategory] = useState8(null);
  const [editingItem, setEditingItem] = useState8(null);
  const handleOpenModalForCreate = (categoryId, categoryTitle) => {
    setEditingItem(null);
    setActiveCategory({ id: categoryId, title: categoryTitle });
    setIsModalOpen(true);
  };
  const handleOpenModalForEdit = (categoryId, item) => {
    const category = inspirationCards.find((c) => c.id === categoryId);
    if (!category) return;
    setEditingItem(item);
    setActiveCategory({ id: categoryId, title: category.title });
    setIsModalOpen(true);
  };
  const handleCloseModal = () => {
    setIsModalOpen(false);
    setActiveCategory(null);
    setEditingItem(null);
  };
  const handleModalSubmit = (newItemData) => {
    if (editingItem && activeCategory) {
      onUpdateCard(activeCategory.id, { ...editingItem, ...newItemData });
    } else if (activeCategory) {
      onCreateCard(activeCategory.id, newItemData);
    }
    handleCloseModal();
  };
  const handleDelete = (e, categoryId, itemId, itemName) => {
    e.stopPropagation();
    onDeleteCard(categoryId, itemId, itemName);
  };
  const handleDragStart = (e, categoryId, itemId) => {
    const cardId = `inspiration-${categoryId}-${itemId}`;
    e.dataTransfer.setData("text/plain", cardId);
    onCardDragStart();
  };
  const handleClick = (categoryId, itemId) => {
    const cardId = `inspiration-${categoryId}-${itemId}`;
    onCardClick(cardId);
  };
  const handleKeyDown = (e, categoryId, itemId) => {
    if (e.key === "Enter" || e.key === " ") {
      e.preventDefault();
      handleClick(categoryId, itemId);
    }
  };
  return /* @__PURE__ */ jsxs12("div", { className: "w-full h-full flex flex-col", children: [
    /* @__PURE__ */ jsxs12("header", { className: "flex-shrink-0 mb-6", children: [
      /* @__PURE__ */ jsx13("h1", { className: "text-3xl font-bold text-gray-800 dark:text-zinc-100", children: "\u7075\u611F\u96C6" }),
      /* @__PURE__ */ jsx13("p", { className: "mt-2 text-gray-600 dark:text-zinc-300", children: "\u8FD9\u91CC\u6C47\u96C6\u4E8640\u4E2A\u72EC\u7279\u7684\u4E16\u754C\u89C2\u8BBE\u5B9A\uFF0C\u6DB5\u76D6\u5947\u5E7B\u3001\u79D1\u5E7B\u3001\u90FD\u5E02\u602A\u8C08\u7B49\u591A\u4E2A\u7C7B\u522B\uFF0C\u65E8\u5728\u6FC0\u53D1\u60A8\u7684\u521B\u4F5C\u70ED\u60C5\uFF0C\u4E3A\u4F5C\u54C1\u6CE8\u5165\u65B0\u9C9C\u5143\u7D20\u3002" })
    ] }),
    /* @__PURE__ */ jsx13("div", { className: "flex-grow overflow-y-auto custom-scrollbar -mr-4 pr-4", children: /* @__PURE__ */ jsxs12("div", { className: "space-y-8", children: [
      inspirationCards.map((category) => /* @__PURE__ */ jsxs12("section", { "aria-labelledby": category.id, children: [
        /* @__PURE__ */ jsxs12("div", { className: "flex justify-between items-center mb-4 pb-2 border-b border-gray-200 dark:border-zinc-700", children: [
          /* @__PURE__ */ jsx13("h2", { id: category.id, className: "text-xl font-semibold text-gray-700 dark:text-zinc-200", children: category.title }),
          /* @__PURE__ */ jsxs12(
            "button",
            {
              onClick: () => handleOpenModalForCreate(category.id, category.title),
              className: "flex items-center gap-1.5 px-3 py-1 text-sm font-medium text-gray-600 bg-white border border-gray-300 rounded-md shadow-sm hover:bg-gray-50 transition-colors dark:bg-zinc-700 dark:text-zinc-200 dark:border-zinc-600 dark:hover:bg-zinc-600",
              title: `\u4E3A\u201C${category.title}\u201D\u6DFB\u52A0\u65B0\u7075\u611F`,
              children: [
                /* @__PURE__ */ jsx13(PlusIcon, { className: "w-4 h-4" }),
                /* @__PURE__ */ jsx13("span", { children: "\u6DFB\u52A0" })
              ]
            }
          )
        ] }),
        /* @__PURE__ */ jsx13("div", { className: "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4", children: category.items.map((item) => {
          const cardId = `inspiration-${category.id}-${item.id}`;
          const isSelected = selectedInspirationCardId === cardId;
          const interactionClasses = isSelected ? "cursor-not-allowed" : "cursor-pointer active:cursor-grabbing";
          return /* @__PURE__ */ jsx13(
            "div",
            {
              className: `flip-card h-36 group relative rounded-lg ${interactionClasses} ${isSelected ? "ring-2 ring-blue-500 ring-offset-1 dark:ring-blue-400" : ""}`,
              role: "button",
              tabIndex: isSelected ? -1 : 0,
              draggable: !isSelected,
              onDragStart: (e) => {
                if (isSelected) {
                  e.preventDefault();
                  return;
                }
                handleDragStart(e, category.id, item.id);
              },
              onClick: () => {
                if (!isSelected) handleClick(category.id, item.id);
              },
              onKeyDown: (e) => {
                if (!isSelected) handleKeyDown(e, category.id, item.id);
              },
              "aria-disabled": isSelected,
              children: /* @__PURE__ */ jsxs12("div", { className: "flip-card-inner", children: [
                /* @__PURE__ */ jsx13("div", { className: `flip-card-front p-4 bg-white border border-gray-200 shadow-sm flex flex-col items-center justify-center text-center dark:bg-zinc-800 dark:border-zinc-700 ${isSelected ? "opacity-70" : ""}`, children: /* @__PURE__ */ jsx13("h3", { className: "font-semibold text-gray-800 px-2 dark:text-zinc-100", children: item.title }) }),
                /* @__PURE__ */ jsxs12("div", { className: `flip-card-back p-4 bg-slate-50 border border-gray-200 shadow-sm flex flex-col items-center justify-center text-center dark:bg-zinc-700 dark:border-zinc-600 ${isSelected ? "opacity-70" : ""}`, children: [
                  item.isCustom && /* @__PURE__ */ jsxs12("div", { className: "absolute top-1 right-1 flex items-center space-x-1 z-10", children: [
                    /* @__PURE__ */ jsx13(
                      "button",
                      {
                        onClick: (e) => {
                          e.stopPropagation();
                          handleOpenModalForEdit(category.id, item);
                        },
                        className: "p-1 text-gray-400 hover:text-gray-700 rounded-full hover:bg-gray-100 dark:hover:text-zinc-200 dark:hover:bg-zinc-700",
                        "aria-label": `\u7F16\u8F91 ${item.title}`,
                        title: "\u7F16\u8F91",
                        children: /* @__PURE__ */ jsx13(PencilIcon, { className: "w-3.5 h-3.5" })
                      }
                    ),
                    /* @__PURE__ */ jsx13(
                      "button",
                      {
                        onClick: (e) => handleDelete(e, category.id, item.id, item.title),
                        className: "p-1 text-gray-400 hover:text-red-600 rounded-full hover:bg-red-50 dark:hover:bg-red-900/50",
                        "aria-label": `\u5220\u9664 ${item.title}`,
                        title: "\u5220\u9664",
                        children: /* @__PURE__ */ jsx13(TrashIcon, { className: "w-3.5 h-3.5" })
                      }
                    )
                  ] }),
                  /* @__PURE__ */ jsx13("p", { className: "text-sm text-gray-600 leading-relaxed max-h-full overflow-y-auto custom-scrollbar dark:text-zinc-300", children: item.description })
                ] })
              ] })
            },
            item.id
          );
        }) })
      ] }, category.id)),
      /* @__PURE__ */ jsx13("footer", { className: "text-center py-6", children: /* @__PURE__ */ jsx13("p", { className: "text-sm text-gray-500 dark:text-zinc-400", children: "\u7075\u611F\u6E90\u4E8E\u521B\u4F5C\u8005\u603B\u7ED3\uFF0C\u65E8\u5728\u4E3A\u60A8\u7684\u521B\u4F5C\u4E4B\u65C5\u63D0\u4F9B\u52A9\u529B\u3002" }) })
    ] }) }),
    isModalOpen && activeCategory && /* @__PURE__ */ jsx13(
      CreateInspirationModal_default,
      {
        isOpen: isModalOpen,
        onClose: handleCloseModal,
        onSubmit: handleModalSubmit,
        categoryTitle: activeCategory.title,
        editingItem
      }
    )
  ] });
};
var InspirationView_default = InspirationView;

// components/AboutView.tsx
import { jsx as jsx14, jsxs as jsxs13 } from "react/jsx-runtime";
var AboutView = () => {
  return /* @__PURE__ */ jsxs13("div", { className: "w-full max-w-3xl mx-auto", children: [
    /* @__PURE__ */ jsx14("header", { className: "mb-8", children: /* @__PURE__ */ jsx14("h1", { className: "text-3xl font-bold text-gray-800 dark:text-zinc-100", children: "\u5173\u4E8E" }) }),
    /* @__PURE__ */ jsx14("div", { className: "bg-white p-8 rounded-xl border border-gray-200 shadow-sm dark:bg-zinc-800 dark:border-zinc-700", children: /* @__PURE__ */ jsxs13("div", { className: "space-y-4 text-gray-700 dark:text-zinc-300", children: [
      /* @__PURE__ */ jsx14("h2", { className: "text-xl font-semibold text-gray-800 dark:text-zinc-100", children: "\u5173\u4E8E AI \u6545\u4E8B\u521B\u4F5C" }),
      /* @__PURE__ */ jsx14("p", { className: "text-sm leading-relaxed", children: "AI \u6545\u4E8B\u521B\u4F5C\u662F\u4E00\u6B3E\u521B\u65B0\u7684 AI \u8F85\u52A9\u5199\u4F5C\u5DE5\u5177\uFF0C\u65E8\u5728\u5E2E\u52A9\u4F5C\u5BB6\u7A81\u7834\u521B\u4F5C\u74F6\u9888\u3001\u6784\u5EFA\u5F15\u4EBA\u5165\u80DC\u7684\u6545\u4E8B\u6846\u67B6\u3002\u901A\u8FC7\u5C06\u6838\u5FC3\u6545\u4E8B\u5143\u7D20\u8FDB\u884C\u72EC\u7279\u7684\u5361\u724C\u5F0F\u7EC4\u5408\uFF0C\u5E76\u5229\u7528\u53EF\u9AD8\u5EA6\u81EA\u5B9A\u4E49\u7684 AI \u63D0\u793A\u8BCD\uFF0C\u672C\u5DE5\u5177\u80FD\u5C06\u60A8\u96F6\u6563\u7684\u7075\u611F\u706B\u82B1\uFF0C\u8F6C\u5316\u4E3A\u4E00\u4EFD\u8BE6\u5B9E\u3001\u7ED3\u6784\u5B8C\u6574\u7684\u5C0F\u8BF4\u5927\u7EB2\u3002" }),
      /* @__PURE__ */ jsxs13("div", { className: "pt-2", children: [
        /* @__PURE__ */ jsx14("h3", { className: "font-semibold mb-2", children: "\u6838\u5FC3\u529F\u80FD\u5305\u62EC:" }),
        /* @__PURE__ */ jsxs13("ul", { className: "list-disc list-inside space-y-1 text-sm", children: [
          /* @__PURE__ */ jsx14("li", { children: "\u76F4\u89C2\u7684\u5361\u724C\u7CFB\u7EDF\u4E0E\u7075\u611F\u6FC0\u53D1\u5E93" }),
          /* @__PURE__ */ jsx14("li", { children: "\u60C5\u5883\u611F\u77E5 AI \u751F\u6210\u4E0E\u9AD8\u7EA7\u63D0\u793A\u8BCD\u5DE5\u7A0B" }),
          /* @__PURE__ */ jsx14("li", { children: "\u5E7F\u6CDB\u7684 AI \u670D\u52A1\u652F\u6301\u4E0E\u667A\u80FD\u6A21\u578B\u53D1\u73B0" }),
          /* @__PURE__ */ jsx14("li", { children: "AI \u6DA6\u8272\u4E0E\u7F16\u8F91\u529F\u80FD" }),
          /* @__PURE__ */ jsx14("li", { children: "\u7CBE\u7B80\u7684\u5927\u7EB2\u7F16\u8F91\u5668\u4E0E\u4EA4\u4E92\u5F0F\u5DE5\u4F5C\u7A7A\u95F4" })
        ] })
      ] }),
      /* @__PURE__ */ jsx14("div", { className: "pt-4 text-center", children: /* @__PURE__ */ jsx14("p", { className: "text-xs text-gray-500 dark:text-zinc-400", children: "\u7248\u672C: 1.1.0" }) })
    ] }) })
  ] });
};
var AboutView_default = AboutView;

// components/ArchiveView.tsx
init_icons();
import { useState as useState9, useMemo as useMemo3 } from "react";
import { jsx as jsx15, jsxs as jsxs14 } from "react/jsx-runtime";
var ArchiveCard = ({ item, onLoad, onDelete }) => {
  const handleDeleteClick = (e) => {
    e.stopPropagation();
    onDelete();
  };
  return /* @__PURE__ */ jsxs14(
    "div",
    {
      className: "relative w-64 h-80 rounded-2xl overflow-hidden flex flex-col items-center justify-center transition-transform hover:scale-105 cursor-pointer group border border-gray-200 dark:border-zinc-700/50",
      onClick: onLoad,
      children: [
        /* @__PURE__ */ jsx15("div", { className: "absolute w-full h-full bg-white dark:bg-zinc-800/30" }),
        /* @__PURE__ */ jsx15("div", { className: "absolute z-[1] top-1/2 left-1/2 w-48 h-48 rounded-full bg-purple-300 dark:bg-purple-900/80 opacity-80 filter blur-2xl animate-blob-bounce" }),
        /* @__PURE__ */ jsxs14("div", { className: "absolute top-1.5 left-1.5 w-[calc(100%-12px)] h-[calc(100%-12px)] z-[2] bg-white/80 backdrop-blur-xl rounded-xl overflow-hidden outline-2 outline-white p-4 flex flex-col justify-between dark:bg-zinc-800/80", children: [
          /* @__PURE__ */ jsxs14("div", { children: [
            /* @__PURE__ */ jsx15("h3", { className: "font-bold text-lg text-gray-800 dark:text-zinc-100 break-words", children: item.novelInfo.name }),
            /* @__PURE__ */ jsx15("p", { className: "text-xs text-gray-500 dark:text-zinc-400 mt-1", children: new Date(item.lastModified).toLocaleString() })
          ] }),
          /* @__PURE__ */ jsx15("p", { className: "text-sm text-gray-600 dark:text-zinc-300 overflow-hidden text-ellipsis", style: { display: "-webkit-box", WebkitLineClamp: 5, WebkitBoxOrient: "vertical" }, children: item.novelInfo.synopsis || "\u65E0\u6982\u8981" })
        ] }),
        /* @__PURE__ */ jsx15(
          "button",
          {
            onClick: handleDeleteClick,
            className: "absolute top-3 right-3 z-10 p-2 text-gray-400 hover:text-red-600 rounded-full bg-white/50 hover:bg-red-50 dark:bg-zinc-700/50 dark:hover:bg-red-900/50 opacity-0 group-hover:opacity-100 transition-opacity",
            "aria-label": `\u5220\u9664 ${item.novelInfo.name}`,
            title: "\u5220\u9664",
            children: /* @__PURE__ */ jsx15(TrashIcon, { className: "w-4 h-4" })
          }
        )
      ]
    }
  );
};
var ArchiveView = ({ archive, onLoadStory, onDeleteStory }) => {
  const [searchTerm, setSearchTerm] = useState9("");
  const [sortBy, setSortBy] = useState9("time");
  const filteredAndSortedArchive = useMemo3(() => {
    let processedArchive = [...archive];
    if (searchTerm.trim() !== "") {
      processedArchive = processedArchive.filter(
        (item) => item.novelInfo.name.toLowerCase().includes(searchTerm.toLowerCase())
      );
    }
    if (sortBy === "time") {
      processedArchive.sort((a, b) => b.lastModified - a.lastModified);
    } else if (sortBy === "name") {
      processedArchive.sort((a, b) => a.novelInfo.name.localeCompare(b.novelInfo.name, "zh-CN"));
    }
    return processedArchive;
  }, [archive, searchTerm, sortBy]);
  return /* @__PURE__ */ jsxs14("div", { className: "w-full h-full flex flex-col", children: [
    /* @__PURE__ */ jsxs14("header", { className: "flex-shrink-0 mb-6", children: [
      /* @__PURE__ */ jsx15("h1", { className: "text-3xl font-bold text-gray-800 dark:text-zinc-100", children: "\u6545\u4E8B\u5B58\u6863" }),
      /* @__PURE__ */ jsx15("p", { className: "mt-2 text-gray-600 dark:text-zinc-300", children: "\u8FD9\u91CC\u662F\u60A8\u4FDD\u5B58\u7684\u6240\u6709\u6545\u4E8B\u5927\u7EB2\u3002\u70B9\u51FB\u5361\u7247\u5373\u53EF\u8F7D\u5165\u7F16\u8F91\u5668\u7EE7\u7EED\u521B\u4F5C\u3002" })
    ] }),
    /* @__PURE__ */ jsxs14("div", { className: "flex-shrink-0 mb-6 flex items-center gap-4", children: [
      /* @__PURE__ */ jsxs14("div", { className: "relative flex-grow", children: [
        /* @__PURE__ */ jsx15(
          "input",
          {
            type: "text",
            placeholder: "\u6309\u5C0F\u8BF4\u540D\u79F0\u641C\u7D22...",
            value: searchTerm,
            onChange: (e) => setSearchTerm(e.target.value),
            className: "w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-gray-400 dark:bg-zinc-700 dark:border-zinc-600 dark:text-white dark:placeholder-zinc-400"
          }
        ),
        /* @__PURE__ */ jsx15("div", { className: "absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none", children: /* @__PURE__ */ jsx15("svg", { xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24", strokeWidth: 1.5, stroke: "currentColor", className: "w-5 h-5 text-gray-400 dark:text-zinc-400", children: /* @__PURE__ */ jsx15("path", { strokeLinecap: "round", strokeLinejoin: "round", d: "m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z" }) }) })
      ] }),
      /* @__PURE__ */ jsxs14("div", { className: "relative", children: [
        /* @__PURE__ */ jsxs14(
          "select",
          {
            value: sortBy,
            onChange: (e) => setSortBy(e.target.value),
            className: "appearance-none w-40 pl-3 pr-8 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-gray-400 bg-white dark:bg-zinc-700 dark:border-zinc-600 dark:text-white",
            "aria-label": "\u6392\u5E8F\u65B9\u5F0F",
            children: [
              /* @__PURE__ */ jsx15("option", { value: "time", children: "\u6309\u65F6\u95F4\u6392\u5E8F" }),
              /* @__PURE__ */ jsx15("option", { value: "name", children: "\u6309\u540D\u79F0\u6392\u5E8F" })
            ]
          }
        ),
        /* @__PURE__ */ jsx15("div", { className: "pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700 dark:text-zinc-300", children: /* @__PURE__ */ jsx15("svg", { className: "fill-current h-4 w-4", xmlns: "http://www.w3.org/2000/svg", viewBox: "0 0 20 20", children: /* @__PURE__ */ jsx15("path", { d: "M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z" }) }) })
      ] })
    ] }),
    /* @__PURE__ */ jsx15("div", { className: "flex-grow overflow-y-auto custom-scrollbar -mr-4 pr-4", children: filteredAndSortedArchive.length > 0 ? /* @__PURE__ */ jsx15("div", { className: "flex flex-wrap gap-8", children: filteredAndSortedArchive.map((item) => /* @__PURE__ */ jsx15(
      ArchiveCard,
      {
        item,
        onLoad: () => onLoadStory(item.id),
        onDelete: () => onDeleteStory(item.id)
      },
      item.id
    )) }) : /* @__PURE__ */ jsxs14("div", { className: "flex flex-col items-center justify-center h-full text-center text-gray-500 dark:text-zinc-400", children: [
      /* @__PURE__ */ jsx15("svg", { xmlns: "http://www.w3.org/2000/svg", fill: "none", viewBox: "0 0 24 24", strokeWidth: 1.5, stroke: "currentColor", className: "w-16 h-16 mb-4 text-gray-400 dark:text-zinc-500", children: /* @__PURE__ */ jsx15("path", { strokeLinecap: "round", strokeLinejoin: "round", d: "m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z" }) }),
      /* @__PURE__ */ jsx15("h2", { className: "text-xl font-semibold", children: searchTerm ? "\u672A\u627E\u5230\u5339\u914D\u9879" : "\u5B58\u6863\u4E3A\u7A7A" }),
      /* @__PURE__ */ jsx15("p", { className: "mt-2 max-w-sm", children: searchTerm ? "\u8BF7\u5C1D\u8BD5\u4F7F\u7528\u5176\u4ED6\u5173\u952E\u8BCD\u8FDB\u884C\u641C\u7D22\u3002" : "\u60A8\u8FD8\u6CA1\u6709\u4FDD\u5B58\u4EFB\u4F55\u6545\u4E8B\u3002\u5728\u201C\u5927\u7EB2\u5185\u5BB9\u201D\u9875\u9762\u70B9\u51FB\u201C\u4FDD\u5B58\u201D\u6309\u94AE\u5373\u53EF\u5C06\u60A8\u7684\u4F5C\u54C1\u5B58\u6863\u5230\u8FD9\u91CC\u3002" })
    ] }) })
  ] });
};
var ArchiveView_default = ArchiveView;

// components/TipsView.tsx
init_icons();
import React12, { useState as useState10, useCallback as useCallback4, useRef as useRef4, useEffect as useEffect7, useMemo as useMemo4 } from "react";
init_aiService();
init_constants();
import { marked } from "marked";
import DOMPurify from "dompurify";
import { Fragment as Fragment3, jsx as jsx16, jsxs as jsxs15 } from "react/jsx-runtime";
var TipsView = ({ topics, setTopics, config, storyArchive }) => {
  const [activeTab, setActiveTab] = useState10("roles");
  const sortedTopics = useMemo4(() => [...topics].sort((a, b) => b.lastModified - a.lastModified), [topics]);
  const [activeTopicId, setActiveTopicId] = useState10(() => sortedTopics[0]?.id || null);
  const [chatInput, setChatInput] = useState10("");
  const [isLoading, setIsLoading] = useState10(false);
  const [editingMessage, setEditingMessage] = useState10(null);
  const [copiedMessageId, setCopiedMessageId] = useState10(null);
  const [editingTopicId, setEditingTopicId] = useState10(null);
  const [tempTopicName, setTempTopicName] = useState10("");
  const [localModel, setLocalModel] = useState10(config.assistantModel || config.model);
  const [isModelSelectOpen, setIsModelSelectOpen] = useState10(false);
  const [modelList, setModelList] = useState10([]);
  const [isModelListLoading, setIsModelListLoading] = useState10(false);
  const [modelSearch, setModelSearch] = useState10("");
  const abortControllerRef = useRef4(null);
  const chatContainerRef = useRef4(null);
  const chatInputRef = useRef4(null);
  const modelSelectRef = useRef4(null);
  const renameInputRef = useRef4(null);
  useEffect7(() => {
    if (topics.length > 0 && !topics.some((t) => t.id === activeTopicId)) {
      setActiveTopicId(sortedTopics[0]?.id || null);
    } else if (topics.length === 0) {
      setActiveTopicId(null);
    }
  }, [topics, sortedTopics, activeTopicId]);
  const { currentHistory, setCurrentHistory, activeTopic } = useMemo4(() => {
    const topic = topics.find((t) => t.id === activeTopicId);
    const history = topic ? topic.history : [];
    const setHistory = (updater) => {
      if (!activeTopicId) return;
      setTopics((prevTopics) => prevTopics.map((t) => {
        if (t.id === activeTopicId) {
          const newHistory = typeof updater === "function" ? updater(t.history) : updater;
          return { ...t, history: newHistory, lastModified: Date.now() };
        }
        return t;
      }));
    };
    return { currentHistory: history, setCurrentHistory: setHistory, activeTopic: topic };
  }, [activeTopicId, topics, setTopics]);
  const currentPresetQuestions = useMemo4(() => {
    if (!activeTopic) return [];
    const tool = BRAINSTORM_TOOLS.find((t) => t.id === activeTopic.toolId);
    if (!tool) return [];
    if (activeTopic.selectedArchiveId && tool.outlinePresetQuestions) {
      return tool.outlinePresetQuestions;
    }
    if (!activeTopic.selectedArchiveId && tool.presetQuestions) {
      return tool.presetQuestions;
    }
    return [];
  }, [activeTopic]);
  useEffect7(() => {
    if (chatContainerRef.current) {
      chatContainerRef.current.scrollTop = chatContainerRef.current.scrollHeight;
    }
  }, [currentHistory]);
  useEffect7(() => {
    if (editingTopicId && renameInputRef.current) {
      renameInputRef.current.focus();
      renameInputRef.current.select();
    }
  }, [editingTopicId]);
  useEffect7(() => {
    const loadModels = async () => {
      if (!config.provider) return;
      if (config.provider === "gemini") {
        setModelList(["gemini-2.5-flash"]);
        setLocalModel("gemini-2.5-flash");
        return;
      }
      setIsModelListLoading(true);
      try {
        const models = await fetchModels(config);
        setModelList(models);
        if (models.length > 0) {
          const preferredModel = config.assistantModel && models.includes(config.assistantModel) ? config.assistantModel : config.model && models.includes(config.model) ? config.model : models[0];
          setLocalModel(preferredModel);
        }
      } catch (error) {
        console.error("Failed to fetch models for tips view:", error);
        setModelList([]);
      } finally {
        setIsModelListLoading(false);
      }
    };
    loadModels();
  }, [config.provider, config.apiKey, config.endpoint, config.model, config.assistantModel]);
  useEffect7(() => {
    const handleClickOutside = (event) => {
      if (modelSelectRef.current && !modelSelectRef.current.contains(event.target)) {
        setIsModelSelectOpen(false);
      }
    };
    document.addEventListener("mousedown", handleClickOutside);
    return () => document.removeEventListener("mousedown", handleClickOutside);
  }, []);
  const triggerChatGeneration = useCallback4(async (historyToUse) => {
    setIsLoading(true);
    const controller = new AbortController();
    abortControllerRef.current = controller;
    let historyForAI = historyToUse.map((msg) => ({ ...msg }));
    if (activeTopic?.selectedArchiveId) {
      const selectedArchive = storyArchive.find((item) => item.id === activeTopic.selectedArchiveId);
      if (selectedArchive) {
        const outlineContext = `

---
[\u5927\u7EB2\u4E0A\u4E0B\u6587]
\u8BF7\u5C06\u4EE5\u4E0B\u6545\u4E8B\u5927\u7EB2\u4F5C\u4E3A\u4F60\u56DE\u7B54\u7684\u80CC\u666F\u4FE1\u606F\uFF1A

${selectedArchive.outline}
---`;
        const systemMsgIndex = historyForAI.findIndex((m) => m.role === "system");
        if (systemMsgIndex !== -1) {
          historyForAI[systemMsgIndex].content += outlineContext;
        } else {
          historyForAI.unshift({
            id: `sys-ctx-${Date.now()}`,
            role: "system",
            content: `\u4F60\u662F\u4E00\u4E2A\u521B\u610F\u5199\u4F5C\u52A9\u624B\u3002${outlineContext}`
          });
        }
      }
    }
    try {
      let accumulatedResponse = "";
      setCurrentHistory((prev) => [...prev, { id: `model-streaming-${Date.now()}`, role: "model", content: "" }]);
      const chatConfig = { ...config, model: localModel };
      const stream = generateChatResponse(historyForAI, chatConfig, controller.signal);
      for await (const chunk of stream) {
        accumulatedResponse += chunk;
        setCurrentHistory((prev) => {
          const nextHistory = [...prev];
          const lastMessage = nextHistory[nextHistory.length - 1];
          if (lastMessage && lastMessage.role === "model") {
            lastMessage.content = accumulatedResponse;
          }
          return nextHistory;
        });
      }
    } catch (err) {
      if (err instanceof DOMException && err.name === "AbortError") {
        setCurrentHistory((prev) => {
          const newHistory = [...prev];
          const lastMessage = newHistory[newHistory.length - 1];
          if (lastMessage && lastMessage.role === "model") {
            if (lastMessage.content.trim() === "") {
              lastMessage.content = "\uFF08\u5DF2\u53D6\u6D88\uFF09";
            } else {
              lastMessage.content += "\n\uFF08\u5DF2\u4E2D\u65AD\uFF09";
            }
          }
          return newHistory;
        });
      } else {
        const errorMessage = err instanceof Error ? err.message : "\u53D1\u751F\u672A\u77E5\u9519\u8BEF\u3002";
        alert(errorMessage);
        setCurrentHistory((prev) => [...prev, { id: `sys-err-${Date.now()}`, role: "system", content: `\u62B1\u6B49\uFF0C\u64CD\u4F5C\u5931\u8D25: ${errorMessage}` }]);
      }
    } finally {
      setIsLoading(false);
      abortControllerRef.current = null;
    }
  }, [setCurrentHistory, config, localModel, activeTopic, storyArchive]);
  const handleChatSubmit = useCallback4(async (e) => {
    e.preventDefault();
    const message = chatInput.trim();
    if (!message || isLoading || !activeTopicId) return;
    setChatInput("");
    if (chatInputRef.current) chatInputRef.current.style.height = "auto";
    const newUserMessage = { id: `user-${Date.now()}`, role: "user", content: message };
    const newHistory = [...currentHistory, newUserMessage];
    setCurrentHistory(newHistory);
    await triggerChatGeneration(newHistory);
  }, [chatInput, isLoading, currentHistory, setCurrentHistory, triggerChatGeneration, activeTopicId]);
  const handlePresetQuestionClick = useCallback4(async (question) => {
    if (isLoading || !activeTopicId) return;
    const newUserMessage = { id: `user-preset-${Date.now()}`, role: "user", content: question };
    const newHistory = [...currentHistory, newUserMessage];
    setCurrentHistory(newHistory);
    await triggerChatGeneration(newHistory);
  }, [isLoading, currentHistory, setCurrentHistory, triggerChatGeneration, activeTopicId]);
  const handleSelectRole = (toolId) => {
    let topicForRole = topics.find((t) => t.toolId === toolId && !/\s\(\d+\)$/.test(t.name));
    if (!topicForRole) {
      const tool = BRAINSTORM_TOOLS.find((t) => t.id === toolId);
      if (!tool) return;
      const newTopic = {
        id: `topic-role-${tool.id}-${Date.now()}`,
        name: tool.name,
        toolId: tool.id,
        lastModified: Date.now(),
        history: [
          { id: `sys-${tool.id}-${Date.now()}`, role: "system", content: tool.systemPrompt },
          { id: `model-${tool.id}-${Date.now()}`, role: "model", content: tool.initialMessage }
        ]
      };
      setTopics((prev) => [newTopic, ...prev]);
      topicForRole = newTopic;
    }
    setActiveTopicId(topicForRole.id);
    setActiveTab("topics");
  };
  const handleCopy = (content, messageId) => {
    navigator.clipboard.writeText(content).then(() => {
      setCopiedMessageId(messageId);
      setTimeout(() => setCopiedMessageId(null), 2e3);
    });
  };
  const handleEditSave = () => {
    if (!editingMessage) return;
    setCurrentHistory((prev) => prev.map((msg) => msg.id === editingMessage.id ? { ...msg, content: editingMessage.content } : msg));
    setEditingMessage(null);
  };
  const handleRegenerate = useCallback4(async (messageIdToRegen) => {
    const messageIndex = currentHistory.findIndex((msg) => msg.id === messageIdToRegen);
    if (messageIndex <= 0 || currentHistory[messageIndex].role === "user") return;
    const historyToResend = currentHistory.slice(0, messageIndex);
    setCurrentHistory(historyToResend);
    await triggerChatGeneration(historyToResend);
  }, [currentHistory, setCurrentHistory, triggerChatGeneration]);
  const handleDeleteMessage = useCallback4((messageIdToDelete) => {
    if (window.confirm("\u60A8\u786E\u5B9A\u8981\u5220\u9664\u6B64\u6761\u6D88\u606F\u5417\uFF1F")) {
      setCurrentHistory((prev) => prev.filter((msg) => msg.id !== messageIdToDelete));
    }
  }, [setCurrentHistory]);
  const handleChatInputChange = (e) => {
    setChatInput(e.target.value);
    const textarea = e.target;
    textarea.style.height = "auto";
    const maxHeight = 120;
    textarea.style.height = `${Math.min(textarea.scrollHeight, maxHeight)}px`;
  };
  const handleInterrupt = () => {
    abortControllerRef.current?.abort();
  };
  const filteredModels = useMemo4(() => {
    if (!modelSearch) return modelList;
    return modelList.filter((m) => m.toLowerCase().includes(modelSearch.toLowerCase()));
  }, [modelList, modelSearch]);
  const handleNewTopic = () => {
    const activeToolId = activeTopic?.toolId;
    if (activeToolId) {
      const tool = BRAINSTORM_TOOLS.find((t) => t.id === activeToolId);
      if (!tool) return;
      const baseName = tool.name;
      const relatedTopics = topics.filter((t) => t.toolId === activeToolId);
      let maxIndex = 0;
      relatedTopics.forEach((topic) => {
        if (topic.name.startsWith(baseName)) {
          const match = topic.name.match(/\((\d+)\)$/);
          if (match) {
            const index = parseInt(match[1], 10);
            if (index > maxIndex) maxIndex = index;
          }
        }
      });
      const newName = `${baseName} (${maxIndex + 1})`;
      const newTopic = {
        id: `topic-role-${tool.id}-${Date.now()}`,
        name: newName,
        toolId: tool.id,
        lastModified: Date.now(),
        history: [
          { id: `sys-new-${tool.id}-${Date.now()}`, role: "system", content: tool.systemPrompt },
          { id: `model-new-${tool.id}-${Date.now()}`, role: "model", content: tool.initialMessage }
        ]
      };
      setTopics((prev) => [newTopic, ...prev]);
      setActiveTopicId(newTopic.id);
    } else {
      const baseName = "\u65B0\u8BDD\u9898";
      const genericTopics = topics.filter((t) => !t.toolId && (t.name === baseName || t.name.startsWith(baseName + " (")));
      let maxIndex = 0;
      const baseNameExists = genericTopics.some((t) => t.name === baseName);
      genericTopics.forEach((topic) => {
        const match = topic.name.match(/\((\d+)\)$/);
        if (match) {
          const index = parseInt(match[1], 10);
          if (index > maxIndex) maxIndex = index;
        }
      });
      const newName = !baseNameExists ? baseName : `${baseName} (${maxIndex + 1})`;
      const newTopic = {
        id: `topic-new-${Date.now()}`,
        name: newName,
        lastModified: Date.now(),
        history: [{ id: `sys-new-${Date.now()}`, role: "system", content: "\u8FD9\u662F\u4E00\u4E2A\u65B0\u7684\u5BF9\u8BDD\u8BDD\u9898\u3002" }]
      };
      setTopics((prev) => [newTopic, ...prev]);
      setActiveTopicId(newTopic.id);
    }
  };
  const handleDeleteTopic = (e, topicId) => {
    e.stopPropagation();
    if (window.confirm("\u60A8\u786E\u5B9A\u8981\u5220\u9664\u8FD9\u4E2A\u8BDD\u9898\u5417\uFF1F\u6B64\u64CD\u4F5C\u65E0\u6CD5\u64A4\u9500\u3002")) {
      const remainingTopics = topics.filter((t) => t.id !== topicId);
      if (activeTopicId === topicId) {
        const sortedRemaining = [...remainingTopics].sort((a, b) => b.lastModified - a.lastModified);
        setActiveTopicId(sortedRemaining[0]?.id || null);
      }
      setTopics(remainingTopics);
    }
  };
  const handleStartRename = (topic) => {
    setEditingTopicId(topic.id);
    setTempTopicName(topic.name);
  };
  const handleFinishRename = () => {
    if (!editingTopicId || !tempTopicName.trim()) {
      setEditingTopicId(null);
      return;
    }
    setTopics(
      (prevTopics) => prevTopics.map(
        (t) => t.id === editingTopicId ? { ...t, name: tempTopicName.trim(), lastModified: Date.now() } : t
      )
    );
    setEditingTopicId(null);
  };
  const handleOutlineSelect = (archiveId) => {
    if (!activeTopicId) return;
    setTopics(
      (prevTopics) => prevTopics.map(
        (t) => t.id === activeTopicId ? { ...t, selectedArchiveId: archiveId || null } : t
      )
    );
  };
  const spinnerSVG = `<svg class="animate-spin h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>`;
  const typingIndicator = `<span class="inline-block w-2 h-4 bg-gray-600 dark:bg-zinc-400 animate-pulse ml-1"></span>`;
  return /* @__PURE__ */ jsx16("div", { className: "w-full h-full flex flex-col", children: /* @__PURE__ */ jsxs15("div", { className: "flex-grow flex gap-4 min-h-0", children: [
    /* @__PURE__ */ jsxs15("aside", { className: "w-72 flex-shrink-0 bg-white rounded-xl border border-gray-200 shadow-sm dark:bg-zinc-800 dark:border-zinc-700 flex flex-col", children: [
      /* @__PURE__ */ jsx16("div", { className: "p-2 flex-shrink-0", children: /* @__PURE__ */ jsxs15("div", { className: "flex items-center gap-1 rounded-lg bg-gray-100 dark:bg-zinc-900/60 p-1", children: [
        /* @__PURE__ */ jsx16(
          "button",
          {
            onClick: () => setActiveTab("roles"),
            className: `w-full py-1.5 rounded-md text-sm font-medium transition-all duration-200 ${activeTab === "roles" ? "bg-white text-gray-800 shadow-sm dark:bg-zinc-700 dark:text-zinc-100" : "text-gray-600 hover:bg-white/50 dark:text-zinc-400 dark:hover:bg-zinc-700/50"}`,
            children: "\u89D2\u8272"
          }
        ),
        /* @__PURE__ */ jsx16(
          "button",
          {
            onClick: () => setActiveTab("topics"),
            className: `w-full py-1.5 rounded-md text-sm font-medium transition-all duration-200 ${activeTab === "topics" ? "bg-white text-gray-800 shadow-sm dark:bg-zinc-700 dark:text-zinc-100" : "text-gray-600 hover:bg-white/50 dark:text-zinc-400 dark:hover:bg-zinc-700/50"}`,
            children: "\u8BDD\u9898"
          }
        )
      ] }) }),
      activeTab === "roles" ? /* @__PURE__ */ jsx16("div", { className: "flex-grow overflow-y-auto custom-scrollbar", children: /* @__PURE__ */ jsx16("div", { className: "space-y-1 p-3 pt-0", children: BRAINSTORM_TOOLS.map((tool) => /* @__PURE__ */ jsx16(
        "button",
        {
          onClick: () => handleSelectRole(tool.id),
          className: "w-full text-left p-3 rounded-lg border-2 border-transparent hover:bg-slate-100/70 dark:hover:bg-zinc-700/50 transition-colors duration-200",
          children: /* @__PURE__ */ jsxs15("div", { className: "flex items-center gap-3", children: [
            /* @__PURE__ */ jsx16("div", { className: "p-1 rounded-lg text-gray-500 dark:text-zinc-400", children: tool.icon }),
            /* @__PURE__ */ jsxs15("div", { children: [
              /* @__PURE__ */ jsx16("h3", { className: "font-semibold text-gray-800 dark:text-zinc-100 text-sm", children: tool.name }),
              /* @__PURE__ */ jsx16("p", { className: "text-xs text-gray-500 dark:text-zinc-400 mt-1", children: tool.description })
            ] })
          ] })
        },
        tool.id
      )) }) }) : /* @__PURE__ */ jsxs15(Fragment3, { children: [
        /* @__PURE__ */ jsx16("div", { className: "p-3 border-t border-gray-100 dark:border-zinc-700/50", children: /* @__PURE__ */ jsxs15(
          "button",
          {
            onClick: handleNewTopic,
            className: "w-full flex items-center justify-center gap-2 px-3 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200 transition-colors dark:bg-zinc-700 dark:text-zinc-200 dark:hover:bg-zinc-600",
            children: [
              /* @__PURE__ */ jsx16(PlusIcon, { className: "w-4 h-4" }),
              /* @__PURE__ */ jsx16("span", { children: "\u65B0\u5EFA\u8BDD\u9898" })
            ]
          }
        ) }),
        /* @__PURE__ */ jsx16("div", { className: "flex-grow overflow-y-auto custom-scrollbar", children: /* @__PURE__ */ jsx16("div", { className: "space-y-1 p-2 pt-0", children: sortedTopics.map((topic) => /* @__PURE__ */ jsxs15(
          "button",
          {
            onClick: () => !editingTopicId && setActiveTopicId(topic.id),
            className: `w-full text-left p-3 rounded-lg relative group ${activeTopicId === topic.id ? "bg-blue-50 dark:bg-blue-900/30" : "hover:bg-gray-100 dark:hover:bg-zinc-700/50"}`,
            children: [
              /* @__PURE__ */ jsxs15("div", { className: "min-h-[36px]", children: [
                editingTopicId === topic.id ? /* @__PURE__ */ jsx16(
                  "input",
                  {
                    ref: renameInputRef,
                    type: "text",
                    value: tempTopicName,
                    onChange: (e) => setTempTopicName(e.target.value),
                    onBlur: handleFinishRename,
                    onKeyDown: (e) => {
                      if (e.key === "Enter") {
                        e.preventDefault();
                        handleFinishRename();
                      }
                      if (e.key === "Escape") {
                        e.preventDefault();
                        setEditingTopicId(null);
                      }
                    },
                    onClick: (e) => e.stopPropagation(),
                    className: "w-full text-sm font-medium bg-white dark:bg-zinc-600 border border-blue-500 rounded px-2 py-0.5 focus:outline-none ring-1 ring-blue-500"
                  }
                ) : /* @__PURE__ */ jsx16(
                  "h3",
                  {
                    onDoubleClick: (e) => {
                      e.stopPropagation();
                      handleStartRename(topic);
                    },
                    className: "font-medium text-sm text-gray-800 dark:text-zinc-100 truncate pr-6",
                    title: "\u53CC\u51FB\u91CD\u547D\u540D",
                    children: topic.name
                  }
                ),
                /* @__PURE__ */ jsx16("p", { className: "text-xs text-gray-500 dark:text-zinc-400 mt-1", children: new Date(topic.lastModified).toLocaleString() })
              ] }),
              /* @__PURE__ */ jsx16(
                "button",
                {
                  onClick: (e) => handleDeleteTopic(e, topic.id),
                  className: "absolute top-1/2 -translate-y-1/2 right-2 p-1.5 rounded-full text-gray-400 hover:bg-red-100 hover:text-red-600 dark:hover:bg-red-900/50 dark:hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity",
                  title: "\u5220\u9664\u8BDD\u9898",
                  children: /* @__PURE__ */ jsx16(TrashIcon, { className: "w-4 h-4" })
                }
              )
            ]
          },
          topic.id
        )) }) })
      ] })
    ] }),
    /* @__PURE__ */ jsx16("main", { className: "flex-1 flex flex-col bg-white rounded-xl border border-gray-200 shadow-sm dark:bg-zinc-800 dark:border-zinc-700 min-h-0", children: activeTopicId ? /* @__PURE__ */ jsxs15(Fragment3, { children: [
      /* @__PURE__ */ jsxs15("header", { className: "flex-shrink-0 p-3 border-b border-gray-200 dark:border-zinc-700 flex justify-between items-center", children: [
        /* @__PURE__ */ jsxs15("div", { className: "flex items-center gap-3 px-2", children: [
          activeTopic?.toolId && BRAINSTORM_TOOLS.find((t) => t.id === activeTopic.toolId) && /* @__PURE__ */ jsx16("div", { className: "p-2 rounded-lg text-blue-600 dark:text-blue-400", children: React12.cloneElement(BRAINSTORM_TOOLS.find((t) => t.id === activeTopic.toolId).icon, { className: "w-6 h-6" }) }),
          /* @__PURE__ */ jsx16("h2", { className: "text-xl font-semibold text-gray-800 dark:text-zinc-100", children: activeTopic?.name || "\u5BF9\u8BDD" })
        ] }),
        /* @__PURE__ */ jsxs15("div", { className: "flex items-center gap-2", children: [
          /* @__PURE__ */ jsx16("label", { htmlFor: "outline-selector", className: "text-sm text-gray-500 dark:text-zinc-400 flex-shrink-0", children: "\u5927\u7EB2\u4E0A\u4E0B\u6587:" }),
          /* @__PURE__ */ jsxs15("div", { className: "relative", children: [
            /* @__PURE__ */ jsxs15(
              "select",
              {
                id: "outline-selector",
                value: activeTopic?.selectedArchiveId || "",
                onChange: (e) => handleOutlineSelect(e.target.value),
                className: "w-48 pl-3 pr-8 py-1 text-sm bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-gray-500 focus:border-gray-500 appearance-none transition-all dark:bg-zinc-700 dark:border-zinc-600 dark:text-zinc-100 disabled:opacity-50",
                disabled: !activeTopicId || storyArchive.length === 0,
                title: storyArchive.length === 0 ? "\u6545\u4E8B\u5B58\u6863\u4E2D\u6682\u65E0\u5927\u7EB2" : "\u9009\u62E9\u4E00\u4EFD\u5927\u7EB2\u4F5C\u4E3A\u804A\u5929\u80CC\u666F",
                children: [
                  /* @__PURE__ */ jsx16("option", { value: "", children: "\u4E0D\u9009\u62E9\u5927\u7EB2" }),
                  storyArchive.map((item) => /* @__PURE__ */ jsx16("option", { value: item.id, children: item.novelInfo.name }, item.id))
                ]
              }
            ),
            /* @__PURE__ */ jsx16("div", { className: "pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700 dark:text-zinc-300", children: /* @__PURE__ */ jsx16("svg", { className: "fill-current h-4 w-4", xmlns: "http://www.w3.org/2000/svg", viewBox: "0 0 20 20", children: /* @__PURE__ */ jsx16("path", { d: "M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z" }) }) })
          ] })
        ] })
      ] }),
      /* @__PURE__ */ jsxs15("div", { ref: chatContainerRef, className: "flex-grow p-4 space-y-4 overflow-y-auto custom-scrollbar", children: [
        currentHistory.map((msg, index) => {
          if (msg.role === "system") return null;
          const isUser = msg.role === "user";
          const isLastMessageStreaming = isLoading && index === currentHistory.length - 1 && !isUser;
          if (editingMessage && editingMessage.id === msg.id) {
            return /* @__PURE__ */ jsxs15("div", { className: "p-2", children: [
              /* @__PURE__ */ jsx16(
                "textarea",
                {
                  value: editingMessage.content,
                  onChange: (e) => setEditingMessage({ ...editingMessage, content: e.target.value }),
                  className: "w-full p-2 border border-blue-400 rounded-md bg-blue-50 dark:bg-zinc-600",
                  rows: 5
                }
              ),
              /* @__PURE__ */ jsxs15("div", { className: "mt-2 flex justify-end gap-2", children: [
                /* @__PURE__ */ jsx16("button", { onClick: () => setEditingMessage(null), className: "text-sm px-3 py-1 rounded bg-gray-200 dark:bg-zinc-500", children: "\u53D6\u6D88" }),
                /* @__PURE__ */ jsx16("button", { onClick: handleEditSave, className: "text-sm px-3 py-1 rounded bg-blue-600 text-white", children: "\u4FDD\u5B58" })
              ] })
            ] }, msg.id);
          }
          return /* @__PURE__ */ jsxs15("div", { className: "flex items-start gap-3", children: [
            isUser ? /* @__PURE__ */ jsx16("div", { className: "w-8 h-8 flex-shrink-0 rounded-full bg-gray-200 dark:bg-zinc-600 flex items-center justify-center shadow-sm", children: /* @__PURE__ */ jsx16(UserCircleIcon, { className: "w-6 h-6 text-gray-500 dark:text-zinc-300" }) }) : /* @__PURE__ */ jsx16("div", { className: "w-8 h-8 flex-shrink-0 rounded-full bg-gradient-to-br from-purple-400 to-yellow-300 flex items-center justify-center shadow-sm", children: /* @__PURE__ */ jsx16(AiIcon, { className: "w-5 h-5 text-white" }) }),
            /* @__PURE__ */ jsxs15("div", { className: "flex flex-col max-w-[85%] group", children: [
              /* @__PURE__ */ jsx16("div", { className: `px-4 py-2 rounded-2xl ${isUser ? "bg-gray-200 text-gray-800 rounded-bl-md dark:bg-zinc-600 dark:text-zinc-200" : "bg-gray-100 text-gray-800 rounded-bl-md dark:bg-zinc-700"}`, children: /* @__PURE__ */ jsx16(
                "div",
                {
                  className: "prose-chat dark:prose-invert max-w-none",
                  dangerouslySetInnerHTML: {
                    __html: isLastMessageStreaming && !msg.content ? spinnerSVG : DOMPurify.sanitize(marked(msg.content || "")) + (isLastMessageStreaming && msg.content ? typingIndicator : "")
                  }
                }
              ) }),
              !isLoading && msg.content && msg.content.trim() !== "" && /* @__PURE__ */ jsx16("div", { className: "flex justify-end items-center gap-1 mt-1.5 transition-opacity opacity-0 group-hover:opacity-100", children: isUser ? /* @__PURE__ */ jsxs15(Fragment3, { children: [
                /* @__PURE__ */ jsx16("button", { onClick: () => setEditingMessage({ id: msg.id, content: msg.content }), title: "\u7F16\u8F91", className: "p-1.5 text-gray-400 hover:text-gray-700 dark:text-zinc-500 dark:hover:text-zinc-200 rounded-full hover:bg-gray-100 dark:hover:bg-zinc-600", children: /* @__PURE__ */ jsx16(PencilIcon, { className: "w-4 h-4" }) }),
                /* @__PURE__ */ jsx16("button", { onClick: () => handleCopy(msg.content, msg.id), title: "\u590D\u5236", className: "p-1.5 text-gray-400 hover:text-gray-700 dark:text-zinc-500 dark:hover:text-zinc-200 rounded-full hover:bg-gray-100 dark:hover:bg-zinc-600", children: copiedMessageId === msg.id ? /* @__PURE__ */ jsx16("span", { className: "text-xs px-1", children: "\u5DF2\u590D\u5236" }) : /* @__PURE__ */ jsx16(ClipboardDocumentIcon, { className: "w-4 h-4" }) }),
                /* @__PURE__ */ jsx16("button", { onClick: () => handleDeleteMessage(msg.id), title: "\u5220\u9664", className: "p-1.5 text-gray-400 hover:text-red-600 dark:text-zinc-500 dark:hover:text-red-400 rounded-full hover:bg-red-100 dark:hover:bg-red-900/40", children: /* @__PURE__ */ jsx16(TrashIcon, { className: "w-4 h-4" }) })
              ] }) : /* @__PURE__ */ jsxs15(Fragment3, { children: [
                /* @__PURE__ */ jsx16("button", { onClick: () => handleRegenerate(msg.id), title: "\u91CD\u65B0\u751F\u6210", className: "p-1.5 text-gray-400 hover:text-gray-700 dark:text-zinc-500 dark:hover:text-zinc-200 rounded-full hover:bg-gray-100 dark:hover:bg-zinc-600", children: /* @__PURE__ */ jsx16(ArrowPathIcon, { className: "w-4 h-4" }) }),
                /* @__PURE__ */ jsx16("button", { onClick: () => setEditingMessage({ id: msg.id, content: msg.content }), title: "\u7F16\u8F91", className: "p-1.5 text-gray-400 hover:text-gray-700 dark:text-zinc-500 dark:hover:text-zinc-200 rounded-full hover:bg-gray-100 dark:hover:bg-zinc-600", children: /* @__PURE__ */ jsx16(PencilIcon, { className: "w-4 h-4" }) }),
                /* @__PURE__ */ jsx16("button", { onClick: () => handleCopy(msg.content, msg.id), title: "\u590D\u5236", className: "p-1.5 text-gray-400 hover:text-gray-700 dark:text-zinc-500 dark:hover:text-zinc-200 rounded-full hover:bg-gray-100 dark:hover:bg-zinc-600", children: copiedMessageId === msg.id ? /* @__PURE__ */ jsx16("span", { className: "text-xs px-1", children: "\u5DF2\u590D\u5236" }) : /* @__PURE__ */ jsx16(ClipboardDocumentIcon, { className: "w-4 h-4" }) }),
                /* @__PURE__ */ jsx16("button", { onClick: () => handleDeleteMessage(msg.id), title: "\u5220\u9664", className: "p-1.5 text-gray-400 hover:text-red-600 dark:text-zinc-500 dark:hover:text-red-400 rounded-full hover:bg-red-100 dark:hover:bg-red-900/40", children: /* @__PURE__ */ jsx16(TrashIcon, { className: "w-4 h-4" }) })
              ] }) })
            ] })
          ] }, msg.id);
        }),
        isLoading && currentHistory.length > 0 && currentHistory[currentHistory.length - 1].role === "user" && /* @__PURE__ */ jsx16("div", { className: "flex justify-start", children: /* @__PURE__ */ jsxs15("div", { className: "max-w-[85%] px-4 py-2 rounded-xl bg-gray-100 text-gray-800 flex items-center gap-2 dark:bg-zinc-700 dark:text-zinc-200", children: [
          /* @__PURE__ */ jsx16(Spinner_default, {}),
          /* @__PURE__ */ jsx16("span", { className: "text-sm", children: "\u6B63\u5728\u601D\u8003..." })
        ] }) })
      ] }),
      /* @__PURE__ */ jsxs15("div", { className: "flex-shrink-0 p-4 border-t border-gray-200 dark:border-zinc-700", children: [
        currentPresetQuestions.length > 0 && /* @__PURE__ */ jsx16("div", { className: "mb-3", children: /* @__PURE__ */ jsx16("div", { className: "overflow-x-auto custom-scrollbar", children: /* @__PURE__ */ jsx16("div", { className: "flex items-center gap-2 pb-2", children: currentPresetQuestions.map((q, i) => /* @__PURE__ */ jsx16(
          "button",
          {
            type: "button",
            onClick: () => handlePresetQuestionClick(q),
            disabled: isLoading,
            className: "flex-shrink-0 px-3 py-1.5 text-sm bg-gray-100 dark:bg-zinc-700 rounded-full hover:bg-gray-200 dark:hover:bg-zinc-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",
            children: q
          },
          i
        )) }) }) }),
        /* @__PURE__ */ jsxs15("form", { onSubmit: handleChatSubmit, className: "relative", children: [
          /* @__PURE__ */ jsxs15("div", { ref: modelSelectRef, className: "absolute bottom-2.5 left-3 z-10", children: [
            /* @__PURE__ */ jsx16(
              "button",
              {
                type: "button",
                onClick: () => setIsModelSelectOpen((prev) => !prev),
                className: "p-2 rounded-full text-gray-400 hover:text-gray-600 hover:bg-gray-100 dark:text-zinc-500 dark:hover:text-zinc-300 dark:hover:bg-zinc-600 transition-colors",
                "aria-label": "\u9009\u62E9AI\u6A21\u578B",
                title: "\u9009\u62E9AI\u6A21\u578B",
                "aria-haspopup": "true",
                "aria-expanded": isModelSelectOpen,
                children: /* @__PURE__ */ jsx16(AiIcon, { className: "w-5 h-5" })
              }
            ),
            isModelSelectOpen && /* @__PURE__ */ jsxs15("div", { className: "absolute bottom-full mb-2 w-56 bg-white dark:bg-zinc-800 rounded-lg shadow-lg border border-gray-200 dark:border-zinc-700 z-20", children: [
              /* @__PURE__ */ jsx16("div", { className: "p-2", children: /* @__PURE__ */ jsx16(
                "input",
                {
                  type: "text",
                  value: modelSearch,
                  onChange: (e) => setModelSearch(e.target.value),
                  placeholder: "\u641C\u7D22\u6A21\u578B...",
                  className: "w-full px-2 py-1.5 text-sm border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-gray-500 focus:border-gray-500 dark:bg-zinc-700 dark:border-zinc-600 dark:text-white"
                }
              ) }),
              /* @__PURE__ */ jsxs15("div", { className: "p-2 text-xs text-gray-500 dark:text-zinc-400 border-t border-gray-100 dark:border-zinc-700/60", children: [
                "\u5F53\u524D\u6A21\u578B: ",
                /* @__PURE__ */ jsx16("span", { className: "font-semibold text-gray-700 dark:text-zinc-200", children: localModel })
              ] }),
              /* @__PURE__ */ jsx16("ul", { className: "max-h-48 overflow-y-auto text-sm custom-scrollbar", children: isModelListLoading ? /* @__PURE__ */ jsx16("li", { className: "px-3 py-2 text-gray-500 dark:text-zinc-400", children: "\u52A0\u8F7D\u4E2D..." }) : filteredModels.length > 0 ? filteredModels.map((modelName) => /* @__PURE__ */ jsx16(
                "li",
                {
                  onClick: () => {
                    setLocalModel(modelName);
                    setIsModelSelectOpen(false);
                    setModelSearch("");
                  },
                  className: `px-3 py-2 cursor-pointer hover:bg-gray-100 dark:hover:bg-zinc-700 ${localModel === modelName ? "font-semibold text-blue-600 dark:text-blue-400" : ""}`,
                  children: modelName
                },
                modelName
              )) : /* @__PURE__ */ jsx16("li", { className: "px-3 py-2 text-gray-500 dark:text-zinc-400", children: "\u65E0\u5339\u914D\u6A21\u578B" }) })
            ] })
          ] }),
          /* @__PURE__ */ jsx16(
            "textarea",
            {
              ref: chatInputRef,
              value: chatInput,
              onChange: handleChatInputChange,
              onKeyDown: (e) => {
                if (e.key === "Enter" && !e.shiftKey) {
                  e.preventDefault();
                  handleChatSubmit(e);
                }
              },
              disabled: isLoading,
              placeholder: "\u8F93\u5165\u60A8\u7684\u60F3\u6CD5...",
              className: "w-full pl-12 pr-16 py-4 text-lg rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 custom-scrollbar resize-none bg-white dark:bg-zinc-700 dark:border-zinc-600 dark:text-white dark:placeholder:text-zinc-400 min-h-[64px]"
            }
          ),
          /* @__PURE__ */ jsx16(
            "button",
            {
              type: isLoading ? "button" : "submit",
              onClick: isLoading ? handleInterrupt : void 0,
              disabled: !isLoading && !chatInput.trim(),
              className: "absolute bottom-2.5 right-3 p-2 rounded-full transition-colors text-white bg-gray-800 hover:bg-gray-900 disabled:bg-gray-300 dark:bg-slate-100 dark:text-gray-800 dark:hover:bg-slate-200 dark:disabled:bg-zinc-600 dark:disabled:text-zinc-400",
              "aria-label": isLoading ? "\u4E2D\u65AD" : "\u53D1\u9001",
              children: isLoading ? /* @__PURE__ */ jsx16(StopIcon, { className: "w-5 h-5" }) : /* @__PURE__ */ jsx16(ArrowUpIcon, { className: "w-5 h-5" })
            }
          )
        ] })
      ] })
    ] }) : /* @__PURE__ */ jsxs15("div", { className: "flex flex-col items-center justify-center h-full text-center text-gray-500 dark:text-zinc-400 p-8", children: [
      /* @__PURE__ */ jsx16(AiIcon, { className: "w-16 h-16 mb-4 text-gray-300 dark:text-zinc-600" }),
      /* @__PURE__ */ jsx16("h2", { className: "text-xl font-semibold text-gray-700 dark:text-zinc-200", children: "\u51C6\u5907\u597D\u6FC0\u53D1\u521B\u610F\u4E86\u5417\uFF1F" }),
      /* @__PURE__ */ jsx16("p", { className: "mt-2 max-w-sm", children: activeTab === "roles" ? "\u8BF7\u4ECE\u5DE6\u4FA7\u7684\u89D2\u8272\u5217\u8868\u4E2D\u9009\u62E9\u4E00\u4E2A\uFF0C\u5F00\u59CB\u60A8\u7684\u5934\u8111\u98CE\u66B4\u4E4B\u65C5\u3002" : "\u8BF7\u4ECE\u5DE6\u4FA7\u65B0\u5EFA\u6216\u9009\u62E9\u4E00\u4E2A\u8BDD\u9898\uFF0C\u5F00\u59CB\u60A8\u7684\u5BF9\u8BDD\u3002" })
    ] }) })
  ] }) });
};
var TipsView_default = TipsView;

// App.tsx
init_types();
init_icons();
import { jsx as jsx17, jsxs as jsxs16 } from "react/jsx-runtime";
var loadAndMigrateChatHistory = (key, defaultMessage) => {
  try {
    const saved = localStorage.getItem(key);
    if (!saved) return [defaultMessage];
    let history = JSON.parse(saved);
    if (!Array.isArray(history)) return [defaultMessage];
    let needsUpdate = false;
    history = history.map((msg, index) => {
      if (!msg.id) {
        needsUpdate = true;
        return {
          id: `${key}-${Date.now()}-${index}`,
          role: msg.role,
          content: msg.content,
          images: msg.images
        };
      }
      return msg;
    });
    if (needsUpdate) {
      try {
        localStorage.setItem(key, JSON.stringify(history));
      } catch (e) {
        console.error(`Failed to save migrated history for ${key}`, e);
      }
    }
    return history.length > 0 ? history : [defaultMessage];
  } catch {
    return [defaultMessage];
  }
};
var App = () => {
  const [view, setView] = useState11("writer");
  const [outline, setOutline] = useState11(() => {
    try {
      return localStorage.getItem("storyOutline") || "";
    } catch (e) {
      console.error("Failed to read outline from localStorage", e);
      return "";
    }
  });
  const [isGenerating, setIsGenerating] = useState11(false);
  const [config, setConfig] = useState11(() => {
    const defaultConfig = {
      provider: "gemini",
      apiKey: "",
      endpoint: "",
      model: "gemini-2.5-flash",
      prompts: [...DEFAULT_PROMPTS],
      activePromptId: DEFAULT_SNOWFLAKE_PROMPT_TEMPLATE.id,
      temperature: 0.8,
      maxTokens: 8192,
      topP: 0.9,
      frequencyPenalty: 0,
      presencePenalty: 0,
      streaming: true
    };
    try {
      const savedConfig = localStorage.getItem("aiConfig");
      if (savedConfig) {
        const parsed = JSON.parse(savedConfig);
        let userPrompts = parsed.prompts && Array.isArray(parsed.prompts) ? parsed.prompts : [];
        if (parsed.prompt && !parsed.prompts) {
          const isDifferentFromDefaults = !DEFAULT_PROMPTS.some((p) => p.content.trim() === parsed.prompt.trim());
          if (isDifferentFromDefaults) {
            const migratedPrompt = {
              id: `migrated-${Date.now()}`,
              name: "\u6211\u7684\u81EA\u5B9A\u4E49\u63D0\u793A\u8BCD (\u5DF2\u8FC1\u79FB)",
              content: parsed.prompt
            };
            userPrompts.push(migratedPrompt);
            parsed.activePromptId = migratedPrompt.id;
          }
          delete parsed.prompt;
        }
        const finalPrompts = [...DEFAULT_PROMPTS];
        const defaultIds = new Set(DEFAULT_PROMPTS.map((p) => p.id));
        userPrompts.forEach((p) => {
          if (p.id && !defaultIds.has(p.id)) {
            finalPrompts.push(p);
          }
        });
        parsed.prompts = finalPrompts;
        if (!parsed.prompts.some((p) => p.id === parsed.activePromptId)) {
          parsed.activePromptId = DEFAULT_SNOWFLAKE_PROMPT_TEMPLATE.id;
        }
        return { ...defaultConfig, ...parsed };
      }
      return defaultConfig;
    } catch (error) {
      console.error("Failed to parse AI config from localStorage", error);
      return defaultConfig;
    }
  });
  const [novelInfo, setNovelInfo] = useState11(() => {
    const defaultState = { name: "", wordCount: "", synopsis: "", perspective: "", channel: "", emotion: "\u65E0" };
    try {
      const savedInfo = localStorage.getItem("novelInfo");
      return savedInfo ? { ...defaultState, ...JSON.parse(savedInfo) } : defaultState;
    } catch (error) {
      console.error("Failed to parse novel info from localStorage", error);
      return defaultState;
    }
  });
  const [selectedCardIds, setSelectedCardIds] = useState11(() => {
    try {
      const savedIds = localStorage.getItem("selectedCardIds");
      const defaultState = {
        ["Theme" /* Theme */]: [null],
        ["Genre" /* Genre */]: [null],
        ["Character" /* Character */]: [null],
        ["Plot" /* Plot */]: [null],
        ["Structure" /* Structure */]: [null],
        ["Technique" /* Technique */]: [null],
        ["Ending" /* Ending */]: [null],
        ["Inspiration" /* Inspiration */]: [null]
      };
      if (savedIds) {
        const parsed = JSON.parse(savedIds);
        for (const key in parsed) {
          if (parsed[key] && !Array.isArray(parsed[key])) {
            parsed[key] = [parsed[key]];
          }
        }
        for (const key in defaultState) {
          if (!parsed[key]) {
            parsed[key] = defaultState[key];
          }
        }
        return parsed;
      }
      return defaultState;
    } catch (error) {
      console.error("Failed to parse selected card IDs from localStorage", error);
      return {
        ["Theme" /* Theme */]: [null],
        ["Genre" /* Genre */]: [null],
        ["Character" /* Character */]: [null],
        ["Plot" /* Plot */]: [null],
        ["Structure" /* Structure */]: [null],
        ["Technique" /* Technique */]: [null],
        ["Ending" /* Ending */]: [null],
        ["Inspiration" /* Inspiration */]: [null]
      };
    }
  });
  const [customCards, setCustomCards] = useState11(() => {
    try {
      const savedCards = localStorage.getItem("customCards");
      return savedCards ? JSON.parse(savedCards) : [];
    } catch (e) {
      console.error("Failed to read custom cards from localStorage", e);
      return [];
    }
  });
  const [inspirationCards, setInspirationCards] = useState11(() => {
    try {
      const saved = localStorage.getItem("inspirationCards");
      if (saved) {
        const parsed = JSON.parse(saved);
        if (Array.isArray(parsed) && parsed.length > 0 && parsed[0].id && parsed[0].title && parsed[0].items) {
          return parsed;
        }
      }
      return DEFAULT_INSPIRATION_DATA;
    } catch (e) {
      console.error("Failed to load inspiration cards from localStorage", e);
      return DEFAULT_INSPIRATION_DATA;
    }
  });
  const [uiSettings, setUISettings] = useState11(() => {
    const defaultSettings = {
      theme: "light",
      editorFontFamily: "sans-serif",
      editorFontSize: 16,
      cardStyle: "grid"
    };
    try {
      const saved = localStorage.getItem("uiSettings");
      return saved ? { ...defaultSettings, ...JSON.parse(saved) } : defaultSettings;
    } catch (e) {
      console.error("Failed to load UI settings from localStorage", e);
      return defaultSettings;
    }
  });
  const [currentStoryId, setCurrentStoryId] = useState11(() => {
    try {
      return localStorage.getItem("currentStoryId") || null;
    } catch {
      return null;
    }
  });
  const [storyArchive, setStoryArchive] = useState11(() => {
    try {
      const saved = localStorage.getItem("storyArchive");
      return saved ? JSON.parse(saved) : [];
    } catch {
      return [];
    }
  });
  const [savedCombinations, setSavedCombinations] = useState11(() => {
    try {
      const saved = localStorage.getItem("savedCombinations");
      return saved ? JSON.parse(saved) : [];
    } catch {
      return [];
    }
  });
  const [assistantHistory, setAssistantHistory] = useState11(
    () => loadAndMigrateChatHistory("assistantHistory", { id: `sys-asst-${Date.now()}`, role: "system", content: "\u60A8\u53EF\u4EE5\u901A\u8FC7\u5BF9\u8BDD\u6765\u4FEE\u6539\u548C\u5B8C\u5584\u5927\u7EB2\u3002" })
  );
  const [chatHistory, setChatHistory] = useState11(
    () => loadAndMigrateChatHistory("chatHistory", { id: `sys-chat-${Date.now()}`, role: "system", content: "\u60A8\u53EF\u4EE5\u50CF\u548C\u670B\u53CB\u4E00\u6837\u4E0E AI \u804A\u5929\u3002" })
  );
  const [topics, setTopics] = useState11(() => {
    try {
      const savedTopicsRaw = localStorage.getItem("topics");
      let currentTopics = savedTopicsRaw ? JSON.parse(savedTopicsRaw) : [];
      const savedHistoriesRaw = localStorage.getItem("tipsHistories");
      if (savedHistoriesRaw) {
        const histories = JSON.parse(savedHistoriesRaw);
        const migratedTopics = [];
        for (const toolId in histories) {
          if (!currentTopics.some((t) => t.toolId === toolId)) {
            const tool = BRAINSTORM_TOOLS.find((t) => t.id === toolId);
            if (tool && Array.isArray(histories[toolId]) && histories[toolId].length > 2) {
              migratedTopics.push({
                id: `topic-migrated-${toolId}-${Date.now()}`,
                name: tool.name,
                toolId: tool.id,
                lastModified: Date.now(),
                history: histories[toolId]
              });
            }
          }
        }
        if (migratedTopics.length > 0) {
          currentTopics = [...currentTopics, ...migratedTopics];
        }
        localStorage.removeItem("tipsHistories");
      }
      return currentTopics;
    } catch (e) {
      console.error("Failed to load or migrate topics", e);
      return [];
    }
  });
  useEffect8(() => {
    try {
      localStorage.setItem("topics", JSON.stringify(topics));
    } catch (e) {
      console.error("Failed to save topics", e);
    }
  }, [topics]);
  useEffect8(() => {
    try {
      localStorage.setItem("storyArchive", JSON.stringify(storyArchive));
    } catch (e) {
      console.error("Failed to save story archive", e);
    }
  }, [storyArchive]);
  useEffect8(() => {
    try {
      localStorage.setItem("savedCombinations", JSON.stringify(savedCombinations));
    } catch (e) {
      console.error("Failed to save combinations", e);
    }
  }, [savedCombinations]);
  useEffect8(() => {
    try {
      localStorage.setItem("assistantHistory", JSON.stringify(assistantHistory));
    } catch (e) {
      console.error("Failed to save assistant history", e);
    }
  }, [assistantHistory]);
  useEffect8(() => {
    try {
      localStorage.setItem("chatHistory", JSON.stringify(chatHistory));
    } catch (e) {
      console.error("Failed to save chat history", e);
    }
  }, [chatHistory]);
  useEffect8(() => {
    try {
      if (currentStoryId) {
        localStorage.setItem("currentStoryId", currentStoryId);
      } else {
        localStorage.removeItem("currentStoryId");
      }
    } catch (e) {
      console.error("Failed to save current story ID", e);
    }
  }, [currentStoryId]);
  useEffect8(() => {
    try {
      localStorage.setItem("uiSettings", JSON.stringify(uiSettings));
      document.documentElement.classList.toggle("dark", uiSettings.theme === "dark");
    } catch (error) {
      console.error("Failed to save UI settings to localStorage", error);
    }
  }, [uiSettings]);
  useEffect8(() => {
    try {
      const cardsToSave = customCards.map(({ icon, ...rest }) => rest);
      localStorage.setItem("customCards", JSON.stringify(cardsToSave));
    } catch (error) {
      console.error("Failed to save custom cards to localStorage", error);
    }
  }, [customCards]);
  useEffect8(() => {
    try {
      localStorage.setItem("inspirationCards", JSON.stringify(inspirationCards));
    } catch (error) {
      console.error("Failed to save inspiration cards to localStorage", error);
    }
  }, [inspirationCards]);
  const allCards = useMemo5(() => {
    const rehydratedCustomCards = customCards.map((card) => ({
      ...card,
      icon: /* @__PURE__ */ jsx17(SparklesIcon, { className: "w-6 h-6" })
    }));
    const transformedInspirationCards = inspirationCards.flatMap(
      (category) => category.items.map((item) => ({
        id: `inspiration-${category.id}-${item.id}`,
        type: "Inspiration" /* Inspiration */,
        name: item.title,
        description: item.description,
        tooltipText: item.description,
        icon: /* @__PURE__ */ jsx17(LightbulbIcon, { className: "w-6 h-6" }),
        isCustom: item.isCustom
      }))
    );
    return [...DEFAULT_CARDS, ...rehydratedCustomCards, ...transformedInspirationCards];
  }, [customCards, inspirationCards]);
  useEffect8(() => {
    try {
      localStorage.setItem("aiConfig", JSON.stringify(config));
    } catch (error) {
      console.error("Failed to save AI config to localStorage", error);
    }
  }, [config]);
  useEffect8(() => {
    try {
      localStorage.setItem("novelInfo", JSON.stringify(novelInfo));
    } catch (error) {
      console.error("Failed to save novel info to localStorage", error);
    }
  }, [novelInfo]);
  useEffect8(() => {
    try {
      localStorage.setItem("selectedCardIds", JSON.stringify(selectedCardIds));
    } catch (error) {
      console.error("Failed to save selected card IDs to localStorage", error);
    }
  }, [selectedCardIds]);
  const combinedCards = useMemo5(() => {
    const rehydratedCards = {};
    for (const type in selectedCardIds) {
      const cardType = type;
      const cardIdArray = selectedCardIds[cardType] || [];
      rehydratedCards[cardType] = cardIdArray.map((cardId) => {
        if (cardId) {
          return allCards.find((card) => card.id === cardId) || null;
        }
        return null;
      });
    }
    return rehydratedCards;
  }, [selectedCardIds, allCards]);
  const setAndPersistOutline = useCallback5((newOutline) => {
    setOutline(newOutline);
    try {
      localStorage.setItem("storyOutline", newOutline);
    } catch (e) {
      console.error("Failed to save outline to localStorage", e);
    }
  }, []);
  const handleSaveConfig = useCallback5((newConfig) => {
    setConfig(newConfig);
  }, []);
  const handleSaveUISettings = useCallback5((newSettings) => {
    setUISettings(newSettings);
  }, []);
  const handleStartGeneration = useCallback5(() => {
    setIsGenerating(true);
    setCurrentStoryId(null);
    setAndPersistOutline("");
    setView("result");
  }, [setAndPersistOutline]);
  const handleSaveToArchive = useCallback5(() => {
    if (!novelInfo.name.trim() || !outline.trim()) {
      alert("\u65E0\u6CD5\u4FDD\u5B58\uFF1A\u5C0F\u8BF4\u540D\u79F0\u548C\u5927\u7EB2\u5185\u5BB9\u4E0D\u80FD\u4E3A\u7A7A\u3002");
      return;
    }
    let synopsisToSave = novelInfo.synopsis.trim();
    if (!synopsisToSave) {
      const trimmedOutline = outline.trim();
      const firstParagraph = trimmedOutline.split(/\n\s*\n/)[0];
      synopsisToSave = firstParagraph.replace(/^#+\s*/, "").replace(/\s+/g, " ").trim();
    }
    const novelInfoForArchive = {
      ...novelInfo,
      synopsis: synopsisToSave
    };
    const existingIndex = storyArchive.findIndex((item) => item.id === currentStoryId);
    if (existingIndex !== -1) {
      const updatedArchive = [...storyArchive];
      updatedArchive[existingIndex] = {
        ...updatedArchive[existingIndex],
        novelInfo: novelInfoForArchive,
        outline,
        lastModified: Date.now()
      };
      updatedArchive.sort((a, b) => b.lastModified - a.lastModified);
      setStoryArchive(updatedArchive);
    } else {
      const newArchiveItem = {
        id: `story-${Date.now()}`,
        novelInfo: novelInfoForArchive,
        outline,
        lastModified: Date.now()
      };
      setStoryArchive((prev) => [newArchiveItem, ...prev].sort((a, b) => b.lastModified - a.lastModified));
      setCurrentStoryId(newArchiveItem.id);
    }
  }, [currentStoryId, novelInfo, outline, storyArchive]);
  const handleLoadStory = useCallback5((storyId) => {
    const storyToLoad = storyArchive.find((item) => item.id === storyId);
    if (storyToLoad) {
      setCurrentStoryId(storyToLoad.id);
      setNovelInfo(storyToLoad.novelInfo);
      setAndPersistOutline(storyToLoad.outline);
      setView("result");
    }
  }, [storyArchive, setAndPersistOutline]);
  const handleDeleteStory = useCallback5((storyId) => {
    if (window.confirm("\u60A8\u786E\u5B9A\u8981\u5220\u9664\u6B64\u5B58\u6863\u5417\uFF1F\u6B64\u64CD\u4F5C\u65E0\u6CD5\u64A4\u9500\u3002")) {
      setStoryArchive((prev) => prev.filter((item) => item.id !== storyId));
      if (currentStoryId === storyId) {
        setCurrentStoryId(null);
        setNovelInfo({ name: "", wordCount: "", synopsis: "", perspective: "", channel: "", emotion: "\u65E0" });
        setAndPersistOutline("");
      }
    }
  }, [currentStoryId, setAndPersistOutline]);
  const handleSaveCombination = (name) => {
    if (!name.trim()) {
      alert("\u7EC4\u5408\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A\u3002");
      return;
    }
    const cardsToSave = JSON.parse(JSON.stringify(selectedCardIds));
    const newCombination = {
      id: `combo-${Date.now()}`,
      name: name.trim(),
      selectedCardIds: cardsToSave
    };
    setSavedCombinations((prev) => [newCombination, ...prev]);
    alert(`\u7EC4\u5408 \u201C${name.trim()}\u201D \u5DF2\u4FDD\u5B58\uFF01`);
  };
  const handleLoadCombination = (combinationId) => {
    const combinationToLoad = savedCombinations.find((c) => c.id === combinationId);
    if (combinationToLoad) {
      const cardsToLoad = JSON.parse(JSON.stringify(combinationToLoad.selectedCardIds));
      setSelectedCardIds(cardsToLoad);
      alert(`\u5DF2\u52A0\u8F7D\u7EC4\u5408 \u201C${combinationToLoad.name}\u201D\uFF01`);
    }
  };
  const handleDeleteCombination = (combinationId) => {
    if (window.confirm("\u60A8\u786E\u5B9A\u8981\u5220\u9664\u6B64\u7EC4\u5408\u5417\uFF1F")) {
      setSavedCombinations((prev) => prev.filter((c) => c.id !== combinationId));
    }
  };
  const handleCardSelect = useCallback5((card, index) => {
    setSelectedCardIds((prev) => {
      const newIds = { ...prev };
      if (!newIds[card.type]) {
        newIds[card.type] = [];
      }
      const typeArray = [...newIds[card.type] || []];
      typeArray[index] = card.id;
      newIds[card.type] = typeArray;
      return newIds;
    });
  }, []);
  const handleCreateCard = useCallback5((newCardData) => {
    const newCard = {
      ...newCardData,
      id: `custom-${Date.now()}`,
      icon: /* @__PURE__ */ jsx17(SparklesIcon, { className: "w-6 h-6" }),
      isCustom: true
    };
    setCustomCards((prev) => [...prev, newCard]);
  }, []);
  const handleUpdateCard = useCallback5((updatedCard) => {
    setCustomCards((prev) => prev.map((card) => card.id === updatedCard.id ? updatedCard : card));
  }, []);
  const handleDeleteCard = useCallback5((cardId) => {
    setCustomCards((prev) => prev.filter((card) => card.id !== cardId));
    setSelectedCardIds((prev) => {
      const newSelection = { ...prev };
      let changed = false;
      for (const key in newSelection) {
        const cardType = key;
        const idArray = newSelection[cardType];
        if (idArray && idArray.includes(cardId)) {
          newSelection[cardType] = idArray.map((id) => id === cardId ? null : id);
          changed = true;
        }
      }
      return changed ? newSelection : prev;
    });
  }, []);
  const handleClearCard = useCallback5((cardType, index) => {
    setSelectedCardIds((prev) => {
      const newIds = { ...prev };
      const typeArray = [...newIds[cardType] || []];
      typeArray[index] = null;
      newIds[cardType] = typeArray;
      return newIds;
    });
  }, []);
  const handleAddCardSlot = useCallback5((cardType) => {
    setSelectedCardIds((prev) => {
      const currentSlots = prev[cardType] || [];
      if (currentSlots.length < 3) {
        return {
          ...prev,
          [cardType]: [...currentSlots, null]
        };
      }
      return prev;
    });
  }, []);
  const handleRemoveCardSlot = useCallback5((cardType, index) => {
    setSelectedCardIds((prev) => {
      const currentSlots = prev[cardType] || [];
      if (currentSlots.length <= 1 || index === 0) {
        return prev;
      }
      const newSlots = [...currentSlots];
      newSlots.splice(index, 1);
      return {
        ...prev,
        [cardType]: newSlots
      };
    });
  }, []);
  const handleCreateInspirationCard = useCallback5((categoryId, newItemData) => {
    setInspirationCards((prevCards) => {
      const newCards = prevCards.map((category) => {
        if (category.id === categoryId) {
          const newItem = {
            ...newItemData,
            id: Date.now(),
            isCustom: true
          };
          return {
            ...category,
            items: [...category.items, newItem]
          };
        }
        return category;
      });
      return newCards;
    });
  }, []);
  const handleUpdateInspirationCard = useCallback5((categoryId, updatedItem) => {
    setInspirationCards((prev) => prev.map((category) => {
      if (category.id === categoryId) {
        return {
          ...category,
          items: category.items.map((item) => item.id === updatedItem.id ? updatedItem : item)
        };
      }
      return category;
    }));
  }, []);
  const handleDeleteInspirationCard = useCallback5((categoryId, itemId, itemName) => {
    if (!window.confirm(`\u60A8\u786E\u5B9A\u8981\u5220\u9664\u7075\u611F \u201C${itemName}\u201D \u5417\uFF1F`)) return;
    setInspirationCards((prev) => prev.map((category) => {
      if (category.id === categoryId) {
        return {
          ...category,
          items: category.items.filter((item) => item.id !== itemId)
        };
      }
      return category;
    }));
    const cardIdToClear = `inspiration-${categoryId}-${itemId}`;
    setSelectedCardIds((prev) => {
      const inspirationSlots = prev["Inspiration" /* Inspiration */] || [];
      if (inspirationSlots.includes(cardIdToClear)) {
        return {
          ...prev,
          ["Inspiration" /* Inspiration */]: inspirationSlots.map((id) => id === cardIdToClear ? null : id)
        };
      }
      return prev;
    });
  }, []);
  const handleInspirationCardDragStart = useCallback5(() => {
    setTimeout(() => setView("writer"), 0);
  }, []);
  const handleInspirationCardClick = useCallback5((cardId) => {
    const foundCard = allCards.find((card) => card.id === cardId);
    if (foundCard && foundCard.type === "Inspiration" /* Inspiration */) {
      setSelectedCardIds((prev) => {
        const inspirationSlots = prev["Inspiration" /* Inspiration */] || [null];
        const emptyIndex = inspirationSlots.findIndex((id) => id === null);
        const newSlots = [...inspirationSlots];
        if (emptyIndex !== -1) {
          newSlots[emptyIndex] = foundCard.id;
        } else {
          newSlots[0] = foundCard.id;
        }
        return { ...prev, ["Inspiration" /* Inspiration */]: newSlots };
      });
    }
  }, [allCards]);
  const renderView = () => {
    switch (view) {
      case "writer":
        return /* @__PURE__ */ jsx17(
          WriterView_default,
          {
            config,
            setConfig,
            onStartGeneration: handleStartGeneration,
            combinedCards,
            onCardSelect: handleCardSelect,
            onClearCard: handleClearCard,
            onAddCardSlot: handleAddCardSlot,
            onRemoveCardSlot: handleRemoveCardSlot,
            novelInfo,
            setNovelInfo,
            allCards,
            onCreateCard: handleCreateCard,
            onUpdateCard: handleUpdateCard,
            onDeleteCard: handleDeleteCard,
            uiSettings,
            savedCombinations,
            onSaveCombination: handleSaveCombination,
            onLoadCombination: handleLoadCombination,
            onDeleteCombination: handleDeleteCombination
          }
        );
      case "result":
        return /* @__PURE__ */ jsx17(
          ResultView_default,
          {
            outline,
            setOutline: setAndPersistOutline,
            config,
            setConfig,
            novelInfo,
            setNovelInfo,
            uiSettings,
            isGenerating,
            setIsGenerating,
            combinedCards,
            onSaveToArchive: handleSaveToArchive,
            assistantHistory,
            setAssistantHistory,
            chatHistory,
            setChatHistory
          }
        );
      case "inspiration":
        return /* @__PURE__ */ jsx17(
          InspirationView_default,
          {
            inspirationCards,
            onCreateCard: handleCreateInspirationCard,
            onUpdateCard: handleUpdateInspirationCard,
            onDeleteCard: handleDeleteInspirationCard,
            onCardDragStart: handleInspirationCardDragStart,
            onCardClick: handleInspirationCardClick,
            selectedInspirationCardId: selectedCardIds["Inspiration" /* Inspiration */]?.[0]
          }
        );
      case "tips":
        return /* @__PURE__ */ jsx17(
          TipsView_default,
          {
            topics,
            setTopics,
            config,
            storyArchive
          }
        );
      case "archive":
        return /* @__PURE__ */ jsx17(
          ArchiveView_default,
          {
            archive: storyArchive,
            onLoadStory: handleLoadStory,
            onDeleteStory: handleDeleteStory
          }
        );
      case "settings":
        return /* @__PURE__ */ jsx17(
          SettingsView_default,
          {
            currentConfig: config,
            onSave: handleSaveConfig,
            currentUISettings: uiSettings,
            onSaveUISettings: handleSaveUISettings
          }
        );
      case "about":
        return /* @__PURE__ */ jsx17(AboutView_default, {});
      default:
        return /* @__PURE__ */ jsx17(
          WriterView_default,
          {
            config,
            setConfig,
            onStartGeneration: handleStartGeneration,
            combinedCards,
            onCardSelect: handleCardSelect,
            onClearCard: handleClearCard,
            onAddCardSlot: handleAddCardSlot,
            onRemoveCardSlot: handleRemoveCardSlot,
            novelInfo,
            setNovelInfo,
            allCards,
            onCreateCard: handleCreateCard,
            onUpdateCard: handleUpdateCard,
            onDeleteCard: handleDeleteCard,
            uiSettings,
            savedCombinations,
            onSaveCombination: handleSaveCombination,
            onLoadCombination: handleLoadCombination,
            onDeleteCombination: handleDeleteCombination
          }
        );
    }
  };
  return /* @__PURE__ */ jsxs16("div", { className: "h-screen flex overflow-hidden bg-slate-50 dark:bg-zinc-900", children: [
    /* @__PURE__ */ jsx17(Sidebar_default, { currentView: view, setView }),
    /* @__PURE__ */ jsx17("main", { className: "flex-1 p-6 sm:p-8 lg:p-10 flex flex-col", children: renderView() })
  ] });
};
var App_default = App;

// index.tsx
import { jsx as jsx18 } from "react/jsx-runtime";
var rootElement = document.getElementById("root");
if (!rootElement) {
  throw new Error("Could not find root element to mount to");
}
var root = ReactDOM.createRoot(rootElement);
root.render(
  /* @__PURE__ */ jsx18(React14.StrictMode, { children: /* @__PURE__ */ jsx18(App_default, {}) })
);
